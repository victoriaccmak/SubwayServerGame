'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[16],{1224:function(n,C,a){n=a(0);var c=a(947),b=a(4);class d{}Object(n.a)(d,"LokiTokenResult",null,[]);class f{constructor(t){this.gVb=t}Lfd(){const t=this.kSh();return t?f.Ypd?new Promise((w,r)=>{this.gVb.continueWith(()=>{this.gVb.Eh||this.gVb.Tf?r(Error.create("Error downloading auth library")):this.gVb.result.CL("Loki",t).then(v=>{v=b.AFrameworkApplication.fa.qa("ForceLokiFallbackToACLPTokenIsEnabled")?this.nSh():
v.IsSuccess&&v.Token?Object.assign(new d,{isSuccess:!0,token:v.Token,errorMessage:null}):Object.assign(new d,{isSuccess:!1,token:null,errorMessage:JSON.stringify(v)});w(v);return v})})}):Promise.resolve(Object.assign(new d,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):Promise.resolve(Object.assign(new d,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",c.a.LXe())}))}nSh(){const t=
b.AFrameworkApplication.fa.Xa("LokiUserDataSignature")||"";return Object.assign(new d,{isSuccess:!0,token:t,errorMessage:null})}kSh(){let t=null;const w=c.a.lac();2===w?t=b.AFrameworkApplication.fa.Xa("LokiAADAppId"):1===w&&(t=b.AFrameworkApplication.fa.Xa("LokiMSAAppId"));return t}static get Ypd(){return b.AFrameworkApplication.fa.qa("IsO365CommercialHost")||b.AFrameworkApplication.fa.qa("IsO365ConsumerHost")}}Object(n.a)(f,"LokiTokenManager",null,[516]);var e=a(247),k=a(83),l=a(518);class m{get name(){return"Common.App.LivePersonaUtils"}init(){k.a.instance.resolve("Common.ILokiTokenManager")}dispose(){}Wh(t){t.register(f,
"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").wc().Fc(()=>new f(l.a.er(t.Ub("Common.App.OAuth.IOAuthManager"))))}static main(){e.a.instance.Gi(new m)}}Object(n.a)(m,"LivePersonaUtilsPackage",null,[3,4]);a.d(C,"a",function(){return u});const u=()=>{Type.registerNamespace("Common.App.LivePersonaUtils");m.main()}},1247:function(n,C,a){var c=a(9);n=a(0);var b=a(83),d=a(222),f=a(7),e=a(15),k=a(765);class l{constructor(w){this.oAuthManager=w}CL(w,r){return this.oAuthManager?
this.oAuthManager.CL(w,r).then(v=>{v.IsSuccess||e.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+v.ErrorMessage+" Error code: "+v.ErrorCode+" App name: "+w);return Object(f.a)(new k.a,{IsSuccess:v.IsSuccess,Token:v.Token,ErrorCode:v.ErrorCode,ErrorMessage:v.ErrorMessage})}):(e.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),Promise.resolve(Object(f.a)(new k.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))}qMa(){return this.oAuthManager?
this.oAuthManager.qMa():null}}Object(n.a)(l,"OAuthManagerWrapper",null,[381]);var m=a(699);class u extends d.a{constructor(w){super();this.$=w;this.Eb()}create(){this.pb(Object(m.a)(this.$.da,349,()=>new l(b.a.instance.resolve("Common.App.OAuth.IOAuthManager"))))}static ka(w){w.da.Ga(350,new u(w))}}Object(n.a)(u,"OAuthManagerFactory",d.a,[]);a.d(C,"a",function(){return t});const t=()=>{c.a.Fa(w=>{u.ka(w)})}},1271:function(n,C,a){n=a(0);var c=a(15),b=a(841),d=a(923),f=a(4),e=a(98),k=a(731),l=a(247),
m=a(41),u=a(39),t=a(27),w=a(111),r=a(83),v=a(188);class y{get name(){return"Common.App.OAuth.OAuthPackage"}Wh(B){B.register(364,"Common.App.OAuth.IOAuthManager").wc().Fc(()=>new b.OAuthManager)}init(){const B=r.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.kOj(B)}kOj(B){const z=f.AFrameworkApplication.fa.Xa("FileSource");if(f.AFrameworkApplication.fa.qa("IsO365ConsumerHost")||f.AFrameworkApplication.fa.qa("IsO365CommercialHost")||"WopiTest"===z){var A=k.a.S4g;if(A&&A.IsEnabled){var I=
A.Application,F=k.a.authority;if(void 0!==I&&null!==I&&I.length&&void 0!==F&&null!==F&&F.length){var U=d.a[B.zS],X=t.a.PGa,T=B.lv();try{var G=new Map;void 0!==G&&null!==G?(G.set("SupportStatus",U),G.set("Browser",X),G.set("AuthStrategy",T)):G=null}catch(J){G=null}e.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",G);var D=u.a.Ud();B.CL("Core",I).then(J=>{const L=Math.floor(u.a.Ud()-D);U=d.a[B.zS];X=t.a.PGa;T=B.lv();c.ULS.sendTraceTag(562943369,3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',
L,J.IsSuccess,U,J.ErrorCode,z,X,T);G&&(G.set("SupportStatus",U),G.set("Browser",X),G.set("AuthStrategy",T));var H=Object.assign(new v.a,{durationMs:L,extendedProperties:G});if(J.IsSuccess){if(e.Health.instance.recordKpiSuccess("WacCorePFT",H),H=A.Endpoint){var R=u.a.Ud();f.AFrameworkApplication.yd.nnb(H,1,null,{["Authorization"]:"Bearer "+J.Token},"OAuthManagerValidateAccess",void 0,void 0,void 0,2E4).continueWith(Q=>{var O=Math.floor(u.a.Ud()-R),V=null;Q.Eh?Q="Canceled":Q.Tf?Q="Faulted":(V=Q.result,
Q=V.succeeded?"Completed":"Failed");O={["TaskResult"]:Q,["BrowserTokenDurationMS"]:L,["BrowserValidationDurationMS"]:O};V&&(O.HttpStatus=V.Lg.data.httpStatus,V.succeeded&&(V=m.a(V.Lg.data.Xd),O.ServerValidationDurationMS=V.ElapsedMilliseconds,O.ServerValidationResult=V.ValidatedToken,O.KMSI=V.KMSI,O.Scopes=V.Scopes,O.TokenExpirationS=Math.floor(parseInt(V.Expiration)-(new Date).getTime()/1E3)));c.ULS.sendTraceTag(520632322,3E3,"Completed"===Q?50:15,w.a.toJSON(O))})}}else e.Health.instance.recordKpiFailure("WacCorePFT",
J.ErrorCode,!1,!1,H)}).catch(J=>{var L=Math.floor(u.a.Ud()-D);L=Object.assign(new v.a,{durationMs:L,extendedProperties:G});e.Health.instance.recordKpiFailure("WacCorePFT","UNEXPECTED CATCH: "+J.toString(),!1,!1,L)})}}}}dispose(){}static main(){l.a.instance.Gi(new y)}static $8i(){l.a.instance.Gi(new y,0,!0)}}Object(n.a)(y,"OAuthPackage",null,[3,4]);a.d(C,"a",function(){return x});const x=B=>{Type.registerNamespace("Common.App.OAuth");B?y.$8i():y.main()}},1459:function(n,C,a){a.r(C);n=a(1271);C=a(1224);
a=a(1247);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Object(n.a)();Object(C.a)();Object(a.a)()},841:function(n,C,a){a.r(C);n=a(0);var c=a(15);const b=(K,na)=>{var P=K.Mlg;if(!P){P=[];for(var ka in K)"string"===typeof ka&&P.push({key:ka,value:K[ka]});P.sort((pa,Na)=>pa.value-Na.value);K.Mlg=P}P=[];for(ka=1;0<na;)na&1&&K[ka]&&P.push(K[ka]),ka<<=1,na>>=1;if(P.length&&0===na)return P.reverse().join(", ")};var d=a(923),f;(function(K){K[K.external=0]="external";
K[K.msa=1]="msa";K[K.aad=2]="aad"})(f||(f={}));Object(n.b)("AuthorityType",f);class e{}Object(n.a)(e,"OAuthResult",null,[]);class k{constructor(K){this.bug=K}initialize(){return Promise.resolve(0)}fkc(){return Promise.resolve(0)}CL(){c.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");return Promise.resolve(Object.assign(new e,{IsSuccess:!0,Token:this.bug}))}pBc(){return Promise.resolve(Object.assign(new e,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",
ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}Uzc(){return!1}Gwb(){return"MockAuthTokenStrategy"}}Object(n.a)(k,"MockAuthTokenStrategy",null,[385]);var l=a(947);class m{static get(K,na,P){if(!P)return K;let ka=0;return Promise.race([K,new Promise(pa=>{ka=window.setTimeout(()=>{pa(na)},P)})]).then(pa=>{window.clearTimeout(ka);return Promise.resolve(pa)}).catch(()=>{window.clearTimeout(ka);return Promise.resolve(na)})}}Object(n.a)(m,"PromiseWithTimeout",
null,[]);var u=a(4),t=a(731);class w{constructor(K,na,P,ka,pa){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=K;this.scope=na;this.silentLogin=P;this.options=ka;this.correlationId=pa}}Object(n.a)(w,"TokenRequestParameters",null,[401]);var r=a(27),v=a(83);class y{constructor(){this.Lke=null;let K=u.AFrameworkApplication.fa.Xa(u.AFrameworkApplication.R7),na=u.AFrameworkApplication.fa.Xa(u.AFrameworkApplication.ucg);this.cYa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",
K&&""!==K?K:"Unspecified",na&&""!==na?na:"Unspecified")}initialize(){return new Promise(K=>{v.a.instance.Ub("Common.App.WopiIdentity.IWopiIdentity").execute(na=>{this.Lke=na;K(0)})})}Ei(K){const na=["HTTPS:","API:"];let P=!1;const ka=K.toLocaleUpperCase();for(const pa of na)if(ka.startsWith(pa)){P=!0;break}return P||this.Kii(K)?K+"/.default":K}Kii(K){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(K)}fkc(){return Promise.resolve(0)}CL(K,na,P,ka,pa,
Na,Z){if(r.a.zxa){pa=t.a.YWj;if(!pa)return na=Object.assign(new e,{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",ErrorMessage:"No app list was found."}),Promise.resolve(na);if(!Array.contains(pa,K))return na=Object.assign(new e,{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+K}),Promise.resolve(na)}K=this.Ei(P);P=new w(P,K,!ka,null,u.AFrameworkApplication.userSessionId);return this.Lke.getAccessToken(P,na,Z).then(Ra=>Object.assign(new e,{IsSuccess:!0,Token:Ra.accessToken}),
Ra=>Object.assign(new e,{IsSuccess:!1,ErrorCode:Ra}))}pBc(){return Promise.resolve(Object.assign(new e,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}Uzc(){return!1}Gwb(){return this.cYa}}Object(n.a)(y,"ParentFrameTokenStrategy",null,[385]);var x=a(84),B=a(850),z=a(187);class A{constructor(){this.reject=this.resolve=null;this.startTime=0;this.mLf=this.Aue=null}}Object(n.a)(A,"PromiseWrapper",
null,[]);class I{constructor(K=0){this.$B=0;this.Kkb=!1;this.Im=new z.a;this._timeout=K}enqueue(K){return new Promise((na,P)=>{this.Im.add(Object.assign(new A,{mLf:K,resolve:na,reject:P}));this.process()})}process(){if(this.Kkb||this.$B===this.Im.count)return!1;const K=this.Im.na(this.$B++);try{this.Kkb=!0,K.mLf().then(na=>{this.Kkb=!1;this.t2c(K,na,null,!0)}).catch(na=>{this.Kkb=!1;this.t2c(K,null,na,!1)})}catch(na){this.Kkb=!1,this.t2c(K,null,na,!1)}return!0}t2c(K,na,P,ka){if(ka){const pa=()=>{K.resolve(na);
this.process()};0<this._timeout?window.setTimeout(()=>{pa()},this._timeout):pa()}else{const pa=()=>{K.reject(P);this.process()};0<this._timeout?window.setTimeout(()=>{pa()},this._timeout):pa()}}}Object(n.a)(I,"PromiseQueue",null,[]);class F{constructor(){this.correlationId=this.resolve=null}}Object(n.a)(F,"ResolveWithCorrelation",null,[]);var U=a(82),X=a(144),T=a(819),G=a(164);class D extends X.a{constructor(K,na,P,ka,pa,Na,Z){super(!1,!1,!0);this.s6d=this.n1=null;this.NX=K;this.Gvg=P;this.Lv=ka;
this.pzg=pa;this.UDa=Na;this.Ss=document.createElement("iframe");this.Ss.id="SharedAuthInteractiveFrame";this.Ss.setAttribute("name","SharedAuthInteractiveFrame");this.Ss.setAttribute("title","SharedAuthInteractiveFrame");this.Ss.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.Ss.style.border="0";this.Ss.style.height="48px";this.Ss.style.width="190px";$addHandler(this.Ss,"error",Object(x.a)(this,this.$Ri,"onSharedAuthFrameError"));K=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",
this.NX,na,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1","&WacUserType=",u.AFrameworkApplication.userType);Z&&(K+="&vnext=1");this.Ss.src=K;this.npg=new Promise(Ra=>{this.s6d=Ra});this.t6d=!1}iyc(){this.n1={["id"]:"SharedAuthConsentDialog",["bodyControls"]:{["promptMessage"]:this.Gvg,["errorText"]:CommonUIStrings.l_InternalError,["rtl"]:u.AFrameworkApplication.isRtl,["frameLoaded"]:!1,["createFrame"]:Object(x.a)(this,this.L7g,"createFrame"),["resolveDialogStyles"]:this.s6d}};
this.Rb=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(x.a)(this,this.rvj,"sharedAuthConsentDialogHandler"),this.n1)}ICc(K=!1,na=!1,P=5){this.n1&&this.n1.bodyControls&&(K!==Object(U.a)(Object,this.n1.bodyControls).frameLoaded&&(Object(U.a)(Object,this.n1.bodyControls).frameLoaded=K),na!==Object(U.a)(Object,this.n1.bodyControls).frameLoadSuccess&&(Object(U.a)(Object,this.n1.bodyControls).frameLoadSuccess=na),P!==this.n1.dialogButtonsOption&&(this.n1.dialogButtonsOption=null,this.Rb=P),this.update(this.n1))}IBj(K,
na){const P=new T.a(G.a.vvj);P.Values={["signInLabel"]:CommonUIStrings.l_SignIn,["cancelLabel"]:CommonUIStrings.l_DialogCancel,["rtl"]:u.AFrameworkApplication.isRtl,["messageCorrelationId"]:K,["dialogStyles"]:na};this.Lv.ZRa(P,this.Ss.contentWindow,this.NX)}DVe(){this.ICc(!0,!1,6)}get x2f(){return this.Ss}get ngh(){return this.npg.then(K=>{this.t6d=!0;return K})}get ogh(){return this.t6d}$Ri(){this.DVe()}L7g(){return this.Ss}rvj(K){0===K&&(this.pzg.reject(Object.assign(new e,{ErrorCode:"UserCancelled",
ErrorMessage:"The interactive flow was cancelled by the user"})),this.UDa(null))}}Object(n.a)(D,"SharedAuthConsentDialog",X.a,[400]);var J=a(1235),L=a(98),H=a(135),R=a(39),Q=a(173),O=a(188);class V{constructor(){this.Ss=null;this.CTb=0;this.Ujb=this.rYa=this.AFc=this.UDa=this.cM=this.Lje=null;this.Lv=new J.a(null,null);this.aYb=u.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",!1);this.cYa="SharedAuthTokenStrategy "+(this.aYb?"BrowserAuth 1.20210701.2/MSAL 2.11.0":
"BrowserAuth 1.20210426.1/MSAL 2.11.0");this.NX=t.a.tvj;this.Mhe=t.a.svj;this.d7d=t.a.enableConsoleLogging;this.Epg=u.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.Rxg=u.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",this.aYb);this.cra={};this.asg=new I(1500)}Gwb(){return this.cYa}initialize(){var {OAuthManager:K}=a(841);if("loadFrame"in this.cra)return this.cra.loadFrame.Aue;
if(!this.NX)return L.Health.instance.recordKpiFailure(K.kpiName,"SharedAuthFrameOriginNotSet",!1,!1,null),c.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),Promise.reject(1);K=this.Bzc("loadFrame");this.CTb=R.a.Ud();var na=this.NX+this.Mhe+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+u.AFrameworkApplication.userSessionId+"&WacUserType="+u.AFrameworkApplication.userType;this.aYb&&(na+="&vnext=1");this.Ss=document.createElement("iframe");
this.iai(this.Ss);this.Ss.style.cssText="height:0;width:0;display:none;";this.Ss.id="SharedAuthFrame";this.Ss.setAttribute("name","SharedAuthFrame");this.Ss.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.Ss.setAttribute("title","SharedAuthFrame");this.Ss.src=na;document.body.appendChild(this.Ss);na=R.a.Ud()-this.CTb;c.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",na,this.Ss.src);
return K}fkc(K){this.AFc=K;const na=new T.a(G.a.A2f);na.Values=this.bue(K);K=this.Bzc("initFrame");this.Lv.ZRa(na,this.Ss.contentWindow,this.NX);c.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");return K}CL(K,na,P,ka,pa,Na){const Z=new T.a(G.a.wvj),Ra=this.R2e();Z.Values=this.Pbg(K,na,P,ka,pa,Na,Ra);K=this.Bzc(Ra);ka&&u.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?this.asg.enqueue(()=>
new Promise(Da=>{this.ANj(Na,Z,Da,Ra)})):(this.Lv.ZRa(Z,this.Ss.contentWindow,this.NX),c.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",na));return K}ANj(K,na,P,ka){const pa=this.cra[ka];pa&&(this.rYa=na,this.UDa=Object.assign(new F,{resolve:P,correlationId:ka}),this.cM=new D(this.NX,this.Mhe,K,this.Lv,pa,P,this.aYb),this.cM.iyc())}R2e(){return Q.a.create().toString()}Pbg(K,na,P,ka,pa,Na,Z){const Ra={};Ra.appName=K;Ra.appId=na;Ra.target=P;Ra.withPopup=
ka;Ra.claims=pa;Ra.promptMessage=Na;Ra.messageCorrelationId=Z;return Ra}iai(K){$addHandler(K,"load",Object(x.a)(this,this.bNi,"onIFrameLoaded"));$addHandler(K,"error",Object(x.a)(this,this.Tnc,"onIFrameError"));this.Lv.OFa(this.NX);this.Lv.qo(G.a.D2f);this.Lv.$l(G.a.D2f,Object(x.a)(this,this.rRi,"onScriptLoaded"));this.Lv.qo(G.a.C2f);this.Lv.$l(G.a.C2f,Object(x.a)(this,this.qRi,"onScriptInitialized"));this.Lv.qo(G.a.y2f);this.Lv.$l(G.a.y2f,Object(x.a)(this,this.BMi,"onGetTokenResponse"));this.Lv.qo(G.a.E2f);
this.Lv.$l(G.a.E2f,Object(x.a)(this,this.tOi,"onLoginResponse"));this.Lv.qo(G.a.B2f);this.Lv.$l(G.a.B2f,Object(x.a)(this,this.wNi,"onInteractiveFlowReady"));this.Lv.qo(G.a.z2f);this.Lv.$l(G.a.z2f,Object(x.a)(this,this.UMi,"onHideDialog"));this.Lv.qo(G.a.w2f);this.Lv.$l(G.a.w2f,Object(x.a)(this,this.THi,"onCloseDialog"))}Bzc(K){const na=new A;na.startTime=R.a.Ud();const P=new Promise((ka,pa)=>{na.resolve=ka;na.reject=pa});na.Aue=P;this.cra[K]=na;return P}bNi(){const K=R.a.Ud()-this.CTb;c.ULS.sendTraceTag(572346566,
3E3,50,"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",K)}Tnc(K){const {OAuthManager:na}=a(841),P=R.a.Ud()-this.CTb,ka=Object.assign(new O.a,{durationMs:P});L.Health.instance.recordKpiFailure(na.kpiName,"SharedAuthWACOAuthAspxFrameError",!1,!0,ka);c.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",P,this.d7d?JSON.stringify(K):"")}rRi(K){const {OAuthManager:na}=a(841),P=this.cra.loadFrame;var ka=R.a.Ud()-P.startTime,pa=K.Values.AuthLibrary.toString();
K=K.Values.Success.toString();c.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",K,pa,ka);pa&&(this.cYa="SharedAuthTokenStrategy "+pa);pa=Boolean.parse(K);pa||(K=H.a.Ur(),void 0!==K&&null!==K&&(K.set("AuthLibrary",this.Gwb()),ka=Object.assign(new O.a,{durationMs:ka,extendedProperties:K}),L.Health.instance.recordKpiFailure(na.kpiName,"SharedAuthStrategyInitFailed",!1,!0,ka)));P.resolve(pa?0:1)}qRi(K){if(K.Values.interactive&&this.rYa&&
this.rYa.Values.messageCorrelationId){const P=this.rYa.Values.messageCorrelationId.toString();if(K.Values.interactive&&this.cM){this.cM.ngh.then(ka=>{this.Lv.ZRa(this.rYa,this.cM.x2f.contentWindow,this.NX);this.cM.IBj(P,ka);this.cM.ICc(!0,!0);this.rYa=null});return}}K=this.cra.initFrame;const na=R.a.Ud()-K.startTime;c.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",na);K.resolve(0)}BMi(K){if(K.Values.messageCorrelationId&&K.Values.messageCorrelationId.toString()){var na=
K.Values.messageCorrelationId.toString(),P=this.cra[na];if(P){var ka=R.a.Ud()-P.startTime;c.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",ka);K.Values.isSuccess&&K.Values.isSuccess?P.resolve(K.Values.response):P.reject(K.Values.response);this.dcg(na)}else c.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else c.ULS.sendTraceTag(573112904,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")}wNi(){if(this.cM.ogh)this.cM.DVe();
else if(this.AFc&&this.cM){const K=new T.a(G.a.A2f);K.Values=this.bue(this.AFc,!0);this.Lv.ZRa(K,this.cM.x2f.contentWindow,this.NX)}}UMi(){this.cM&&this.cM.Pxb()}THi(K){K.Values.cancelled&&K.Values.cancelled&&K.Values.messageCorrelationId&&this.dcg(K.Values.messageCorrelationId.toString());this.cM&&this.cM.hide()}bue(K,na=!1){const P={};P.appIds=this.OIh();P.upn=K.loginHint;P.authority=K.authority;P.authorityType=b(f,K.authorityType);P.tenantId=K.tenantId;P.correlationId=u.AFrameworkApplication.userSessionId;
P.enableConsoleLogging=this.d7d;P.enablePopupFlash=this.Epg;P.skipUpnCheck=this.Rxg;P.interactive=na;return P}OIh(){const K=[],na=t.a.SWc;for(let P in na)Array.add(K,na[P]);return K}pBc(K,na,P,ka,pa,Na){const Z=new T.a(G.a.uvj),Ra=this.R2e();Z.Values=this.Pbg(K,na,P,ka,pa,Na,Ra);this.Lje=Z;K=this.Bzc(Ra);c.ULS.sendTraceTag(555049437,3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",na);this.qzj();return K}Uzc(){return!0}qzj(){this.Ujb||(this.Ujb=new B.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,
CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,null),this.Ujb.id=16,this.Ujb.Ppd=!1,this.Ujb.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,()=>{c.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");this.Lv.ZRa(this.Lje,this.Ss.contentWindow,this.NX)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,!0),c.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))}tOi(K){if(K.Values.messageCorrelationId&&
K.Values.messageCorrelationId.toString()){var na=this.cra[K.Values.messageCorrelationId.toString()];if(na){var P=R.a.Ud()-na.startTime;c.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",P);K.Values.isSuccess&&K.Values.isSuccess?na.resolve(K.Values.response):na.reject(K.Values.response)}else c.ULS.sendTraceTag(555049440,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else c.ULS.sendTraceTag(555049439,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")}dcg(K){this.UDa&&
this.UDa.correlationId===K&&(this.UDa.resolve(null),this.UDa=null)}}Object(n.a)(V,"SharedAuthTokenStrategy",null,[385]);class W{constructor(K){this.QPc=K;this.cYa="UnsupportedAuthTokenStrategy Reason="+d.a[this.QPc]}initialize(){return Promise.resolve(0)}fkc(){return Promise.resolve(0)}CL(){return Promise.resolve(Object.assign(new e,{IsSuccess:!1,ErrorCode:d.a[this.QPc],ErrorMessage:"Unable to get a token. Reason: ["+d.a[this.QPc]+"]"}))}pBc(){return Promise.resolve(Object.assign(new e,{IsSuccess:!1,
ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}Uzc(){return!1}Gwb(){return this.cYa}}Object(n.a)(W,"UnsupportedAuthTokenStrategy",null,[385]);var da=a(720);a.d(C,"OAuthManager",function(){return ta});class ta{constructor(K=null){this.zS=0;this.$O=null;this.owg=0;const na=R.a.Ud();this.Rrg=this.Afh(K).then(P=>P?this.B9h():(c.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",
this.lv(),Math.floor(R.a.Ud()-na)),P=H.a.Ur(),void 0!==P&&null!==P&&(P.set("AuthLibrary",this.lv()),P=Object.assign(new O.a,{durationMs:Math.floor(R.a.Ud()-na),extendedProperties:P}),L.Health.instance.recordKpiFailure(ta.kpiName,"StrategyPickFailed",!1,!0,P)),Promise.resolve(1))).then(P=>0!==P?Promise.resolve(P):this.$si())}Bfh(){var K=t.a.pBi;K&&0<K.length?(this.zS=1,this.$O=new k(K)):u.AFrameworkApplication.fa.qa("IsO365ConsumerHost")||u.AFrameworkApplication.fa.qa("IsO365CommercialHost")?u.AFrameworkApplication.fa.qa("IsAnonymousUser")?
(this.zS=2,this.$O=new W(this.zS)):(K=l.a.getAuthContext().loginHint)&&K.length?t.a.Vxb?(this.zS=1,this.$O=new y):(this.zS=1,this.$O=new V):(this.zS=3,this.$O=new W(this.zS)):(this.zS=4,this.$O=new W(this.zS))}lv(){return this.$O?this.$O.Gwb()||"Unknown":"None"}Afh(K=null){c.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");const na=R.a.Ud();return u.AFrameworkApplication.fa.ffd().then(P=>{P?(this.Bfh(),K&&(this.$O=K),c.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",
t.a.clientVersion,t.a.appVersion,t.a.yih,this.lv(),Math.floor(R.a.Ud()-na))):c.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(R.a.Ud()-na));return Promise.resolve(P)},()=>{c.ULS.sendTraceTag(562128580,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(R.a.Ud()-na));return Promise.resolve(!1)})}B9h(){c.ULS.sendTraceTag(573390991,
3E3,50,"Initializing {0}",this.lv());const K=R.a.Ud();return m.get(this.$O.initialize(),2,t.a.KGd).then(na=>{if(0===na)c.ULS.sendTraceTag(42084353,3E3,50,"Initialization succeeded for {0} in {1} ms.",this.lv(),Math.floor(R.a.Ud()-K));else if(1===na){c.ULS.sendTraceTag(527827291,3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",this.lv(),Math.floor(R.a.Ud()-K));var P=H.a.Ur();void 0!==P&&null!==P&&(P.set("AuthLibrary",this.lv()),P=Object.assign(new O.a,{durationMs:Math.floor(R.a.Ud()-
K),extendedProperties:P}),L.Health.instance.recordKpiFailure(ta.kpiName,"StrategyInitFailed",!1,!0,P))}else 2===na&&(c.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",this.lv(),Math.floor(R.a.Ud()-K)),P=H.a.Ur(),void 0!==P&&null!==P&&(P.set("AuthLibrary",this.lv()),P=Object.assign(new O.a,{durationMs:Math.floor(R.a.Ud()-K),extendedProperties:P}),L.Health.instance.recordKpiFailure(ta.kpiName,"StrategyInitTimedOut",!1,!0,P)));
return Promise.resolve(na)},()=>{c.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.lv(),Math.floor(R.a.Ud()-K));return Promise.resolve(1)})}$si(){c.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.lv());const K=R.a.Ud();return m.get(this.$O.fkc(l.a.getAuthContext()),2,t.a.KGd).then(na=>{if(0===na)c.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",this.lv(),Math.floor(R.a.Ud()-K));else if(1===na){c.ULS.sendTraceTag(562128583,
3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.lv(),Math.floor(R.a.Ud()-K));var P=H.a.Ur();void 0!==P&&null!==P&&(P.set("AuthLibrary",this.lv()),P=Object.assign(new O.a,{durationMs:Math.floor(R.a.Ud()-K),extendedProperties:P}),L.Health.instance.recordKpiFailure(ta.kpiName,"StrategyLoadFailed",!1,!0,P))}else 2===na&&(c.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",this.lv(),Math.floor(R.a.Ud()-
K)),P=H.a.Ur(),void 0!==P&&null!==P&&(P.set("AuthLibrary",this.lv()),P=Object.assign(new O.a,{durationMs:Math.floor(R.a.Ud()-K),extendedProperties:P}),L.Health.instance.recordKpiFailure(ta.kpiName,"StrategyLoadTimedOut",!1,!0,P)));return Promise.resolve(na)},()=>{c.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.lv(),Math.floor(R.a.Ud()-K));return Promise.resolve(1)})}CL(K,na,P=null){return this.nBc(K,na,!1,null,"",P)}Qbg(K,na,
P,ka,pa=null){return this.nBc(K,na,!0,P,ka,pa)}nBc(K,na,P,ka,pa,Na,Z=0){Z+=1;c.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",K,this.FRa(K,na),this.lv(),Z);var Ra=H.a.Ur();void 0!==Ra&&null!==Ra&&(Ra.set("AuthLibrary",this.lv()),Ra.set("AppName",K),Ra.set("Target",this.FRa(K,na)),L.Health.instance.recordKpiUsage(ta.kpiName,0,"WacOAuthFC",Ra));if(!t.a.isEnabled){var Da;return this.Tud((Da=new e,Da.IsSuccess=!1,Da.Token=
null,Da.ErrorCode="NotEnabled",Da.ErrorMessage="OAuthManager is disabled.",Da),K)}const Ba=t.a.SWc[K];if(void 0===Ba||null===Ba){c.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",K);var ea;return this.Tud((ea=new e,ea.IsSuccess=!1,ea.Token=null,ea.ErrorCode="DisallowedApp",ea.ErrorMessage="Disallowed appName: "+K,ea),K)}const Y=R.a.Ud(),ja=this;Ra=this.Rrg.then(wa=>ja.jei(K,Ba,na,P,ka,pa,Na,wa));Da=P?0:t.a.KGd;
let ca;ea=(ca=new e,ca.IsSuccess=!1,ca.Token=null,ca.ErrorCode="authTokenStrategy_timeout",ca.ErrorMessage="Auth Strategy timed out after ["+Da+"] ms when fetching token",ca);let ba=this,ua=this;return m.get(Ra,ea,Da).then(wa=>Z<=ta.Yzi&&(wa.ErrorCode===ta.W$f||wa.ErrorCode===ta.hGj)?(c.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",Z,Math.floor(R.a.Ud()-Y)),ba.nBc(K,na,P,ka,pa,Na,Z)):wa.ErrorCode===ta.Ojf&&!P&&(c.ULS.sendTraceTag(561517645,3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",
Z,ta.cMe),ta.Elh&&ba.$O.Uzc()&&ba.$O.pBc(K,Ba,na,P,ka,pa).then(ia=>Promise.resolve(ba.wkc(ia,K,na,Ba,Y))).catch(()=>{let ia;const xa=(ia=new e,ia.IsSuccess=!1,ia.Token=null,ia.ErrorCode="authTokenStrategy_failure",ia.ErrorMessage="LoginPopup failed, GetToken could not be called",ia);return Promise.resolve(ba.wkc(xa,K,na,Ba,Y))}),ta.cMe)?ba.nBc(K,na,!0,ka,pa,Na,Z):Promise.resolve(ba.wkc(wa,K,na,Ba,Y))).catch(()=>{let wa;const ia=(wa=new e,wa.IsSuccess=!1,wa.Token=null,wa.ErrorCode="authTokenStrategy_failure",
wa.ErrorMessage="Auth Strategy failed with an unknown error",wa);return Promise.resolve(ua.wkc(ia,K,na,Ba,Y))})}jei(K,na,P,ka,pa,Na,Z,Ra){return 1===Ra||2===Ra?this.Tud(Object.assign(new e,{IsSuccess:!1,Token:null,ErrorCode:1===Ra?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),K):this.$O.CL(K,na,P,ka,pa,Na,Z).then(Da=>Promise.resolve(this.Ftf(Da,!0,K))).catch(Da=>Promise.resolve(this.Ftf(Da,!1,K)))}wkc(K,na,P,ka,pa){const Na={};pa=R.a.Ud()-pa;Na.IsSuccess=K.IsSuccess;
Na.ErrorCode=K.IsSuccess?"Success":K.ErrorCode||"";Na.ErrorMessage=K.IsSuccess?"Success":this.FRa(na,K.ErrorMessage||"");Na.Target=this.FRa(na,P||"");Na.TimeInMS=Math.floor(pa);Na.AuthLibrary=this.lv();Na.AppName=na;Na.AuthorityType=b(f,l.a.lac());Na.UserType=this.R_h(l.a.getAuthContext());Na.IsAuthSupportedInSession=d.a[this.zS];Na.RequestCount=++this.owg;Na.AppId=ka;c.ULS.sendTraceTag(593863640,3E3,50,JSON.stringify(Na));K.IsSuccess||(P=H.a.Ur(),void 0!==P&&null!==P&&(P.set("AppName",na),P.set("AuthLibrary",
this.lv()),P.set("ErrorCode",K.ErrorCode),P.set("ErrorMessage",this.FRa(na,K.ErrorMessage)),na=Object.assign(new O.a,{durationMs:pa,extendedProperties:P}),L.Health.instance.recordKpiFailure(ta.kpiName,"TryGetTokenFailure",!1,!0,na)));return K}Tud(K,na){c.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",na,this.FRa(na,K.ErrorMessage));const P=H.a.Ur();void 0!==P&&null!==P&&(P.set("AppName",na),P.set("AuthLibrary",this.lv()),P.set("ErrorCode",
K.ErrorCode),P.set("ErrorMessage",this.FRa(na,K.ErrorMessage)),na=Object.assign(new O.a,{extendedProperties:P}),L.Health.instance.recordKpiFailure(ta.kpiName,"FailureBeforeGetToken",!1,!0,na));return Promise.resolve(K)}Wef(K){return K===da.a.CAc}FRa(K,na){return this.Wef(K)&&na?"REDACTED":na}R_h(K){return u.AFrameworkApplication.fa.qa("IsAnonymousUser")?"anonymous":!K.loginHint||1>K.loginHint.length?"empty":-1<K.loginHint.indexOf("guest#")?"guest":-1<K.loginHint.indexOf("ext#")?"external":0>K.upn.indexOf("@")?
"no-at":"supported"}qMa(){return 1===this.zS}Ftf(K,na,P){let ka=null,pa=null,Na=null,Z=null;K?K.ErrorCode||K.ErrorMessage?(pa=K.ErrorCode?K.ErrorCode:ta.dSe,Na=K.ErrorMessage?K.ErrorMessage:"No message"):K.Token?na?ka=K.Token:(pa=ta.R9i,Na="A rejected promise returned a token."):(pa=ta.dSe,Na=JSON.stringify(K)):(pa=ta.MDi,Na="No result came from Auth Token Strategy");K&&K.Telemetry&&!this.Wef(P)&&(Z=K.Telemetry,c.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify(Z)));if(pa===ta.ABi||pa===ta.SKj)pa=
ta.W$f,Na="Auth Library Timed Out";pa===ta.eOg&&-1<Na.indexOf(ta.iAg)&&(pa=ta.Ojf);if(pa||Na)ka=null;return Object.assign(new e,{IsSuccess:!!ka,Token:ka,ErrorCode:pa,ErrorMessage:Na,Telemetry:Z})}static get cMe(){return u.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",!1)}static get Elh(){return u.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",!1)}}ta.SKj="token_renewal_error";ta.dSe=
"Exception";ta.MDi="NoResult";ta.R9i="RejectToken";ta.ABi="monitor_window_timeout";ta.W$f="Timeout";ta.hGj="authTokenStrategy_timeout";ta.eOg="login_required";ta.iAg="AADSTS50058";ta.Ojf="Cookies Disabled";ta.kpiName="OAuthManager";ta.Yzi=2;Object(n.a)(ta,"OAuthManager",null,[364])},923:function(n,C,a){a.d(C,"a",function(){return c});n=a(0);var c;(function(b){b[b.unknown=0]="unknown";b[b.supported=1]="supported";b[b.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";b[b.userUnsupportedNoLoginHint=
3]="userUnsupportedNoLoginHint";b[b.hostUnsupported=4]="hostUnsupported"})(c||(c={}));Object(n.b)("SupportStatus",c)}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.oauth.js.map/f1132d76426fc20eadffddc5b40624d7/EwaDSEsNext.oauth.js.map