'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[17],{1109:function(n,C,a){a.d(C,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertFile")}},1110:function(n,C,a){a.d(C,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertPicture")}},1112:function(n,C,a){a.d(C,"a",function(){return b});var c=a(510);const b=()=>{c.a.Qi(".insert-media-dialog-old{width:870px;float:left;margin-top:7px}.insert-media-dialog{width:870px;width:clamp(400px,870px,80vw);float:left;margin-top:7px}.app-rtl .insert-media-dialog{float:right}.insert-media-frame{width:100%;height:100%;visibility:visible}.insert-media-panel-old{height:550px}.insert-media-panel{height:550px;height:clamp(300px,550px,90vh)}.keep-focus-start{position:absolute;width:-1000px;top:-1000px}.keep-focus{position:absolute;width:-1000px;top:1000px}.display-none{display:none}.padding-zero{padding:0}")}},
1136:function(n,C,a){var c=a(0),b=a(7),d=a(15),f=a(222),e=a(30),k=a(27),l=a(349),m=a(173),u=a(263),t=a(352),w=a(4),r=a(1),v=a(38),y=a(8),x=a(284),B=a(14);class z extends x.a{constructor(M){super(M);this.i_g=()=>{d.ULS.sendTraceTag(537167827,0,50,"ClipboardReadPermissionAskDialog OK button pressed")};d.ULS.sendTraceTag(537167828,0,50,"ClipboardReadPermissionAskDialog.ClipboardReadPermissionAskDialog");this.Rb=0;this.rc(1,B.a.instance.ga(2256));M=B.a.instance.ga(2254);const $a=this.WM();this.initializeAndShow(M,
this.i_g,$a)}get uc(){return"ClipboardReadPermissionAskDialog"}WM(){const M={};M.id=this.uc;const $a=B.a.instance.ga(2255);M.DialogMessage=$a;return M}}Object(c.a)(z,"ClipboardReadPermissionAskDialog",x.a,[]);var A=a(51);const I=(M,$a,ob,Tb,Dc)=>{const ad=M.Stopwatch,ld={};ld.a=Dc;ld.e=ad.id;ld.c="RearrangeRowColumn";ld.b="mouse";ld.d=M.OperationId.toString();ld.f=ob.toString();ld.g=Tb.toString();ld.h=$a.toString();ld.i=M.DragDropIsShiftKeyDown;ld.j=!0;ld.o=ad.yc;ld.q=!1;ld.r=M.CopyPasteTargetType.toString();
ld.s=M.EncounteredDeploymentErrors;return ld};class F{constructor(M,$a){this.PFh=()=>{const ob={};ob.SourceItem=this.toString();return ob};this.sessionStateId=M;this.sessionId=$a;this.toJSON=this.PFh}oef(M){return M?this.sessionStateId===M.sessionStateId&&this.sessionId===M.sessionId:!1}isFromCurrentSession(M){return this.sessionId===M.ya.UserSessionId}}Object(c.a)(F,"SourceItem",null,[]);class U extends F{constructor(M,$a,ob,Tb,Dc){super(ob,Tb);this.activeFloatingObjectControlId=M;this.sheetName=
$a;this.type=Dc}isEqual(M){return M&&Object.getType(M)===U?this.oef(M)&&this.activeFloatingObjectControlId===M.activeFloatingObjectControlId&&this.sheetName===M.sheetName:!1}toString(){return this.type.toString()}}Object(c.a)(U,"ArtSourceItem",F,[]);var X;(function(M){M[M.valid=0]="valid";M[M.notPairwiseDisjoint=1]="notPairwiseDisjoint";M[M.cutNotSupportedInDiscontinuousSelection=2]="cutNotSupportedInDiscontinuousSelection";M[M.notValidForm=3]="notValidForm";M[M.temporarilyBlockedCopy=4]="temporarilyBlockedCopy"})(X||
(X={}));Object(c.b)("CopySourceValidationOptions",X);var T=a(43);class G extends F{constructor(M,$a,ob,Tb,Dc){super(Tb,Dc);d.ULS.shipAssertTag(537167645,0,!!$a&&0<$a.length,"RangeSourceItem.ctor: ranges should not be null or empty");this.$=M;this.ranges=$a;this.sheetName=ob}isEqual(M){return M&&Object.getType(M)===G?this.oef(M)&&T.Q(this.ranges,M.ranges)&&this.sheetName===M.sheetName:!1}toString(){return T.i(this.ranges,",",this.$,!1)}}Object(c.a)(G,"RangeSourceItem",F,[]);const D=M=>!!M&&Object.getType(M)===
G;class J{}J.ZUj="PasteError_FailedToReadFromClipboard_UserHashMismatchError";Object(c.a)(J,"ExpectedErrorNames",null,[]);class L{}L.plainText="text/plain";L.html="text/html";L.png="image/png";L.shadowWorkbook="data/shadow-workbook";L.Cji="metadata/is-last-copy-was-external";L.dgi="metadata/is-last-copy-was-external-XLO-source";L.EYg="metadata/chrome-extension-id";L.irb="copyId";L.sJg="metadata/additional-signature-data-attributes";Object(c.a)(L,"ClipboardDataFormat",null,[]);const H=M=>M.clipboardItems&&
(M=M.clipboardItems.getItem(L.Cji))&&"1"===M?!0:!1,R=M=>H(M)&&!(void 0===M.clipboardItems||null===M.clipboardItems)&&!!M.clipboardItems.getItem(L.png)&&!M.clipboardItems.getItem(L.plainText),Q=M=>M.clipboardItems&&(M=M.clipboardItems.getItem(L.dgi))&&"1"===M?!0:!1,O=M=>M&&(M=M.getCachedMetadata(),null===M||void 0===M?0:M.lastCopy)?M.lastCopy:null;var V=a(49),W=a(21),da=a(34);class ta{constructor(M,$a,ob,Tb){this.$=M;this.originalDestinations=$a;this.m9b=ob;this.bmg=Tb;this.Zvg=this.originalDestinations;
this.Upg=this.m9b;this.qtg="PasteRecoveryUI"}get rJg(){return this.bmg}get Zri(){return this.qtg}get f7i(){return this.Zvg}get vyh(){return this.Upg}rKa(){return ta.CXi}FNh(){return this.m9b&&1===this.m9b.length?this.GNh(this.m9b[0]):null}GNh(M){var $a=W.g(this.$);const ob=$a.ib.Oi(M);var Tb=$a.dg(M,ob);$a=$a.rtl;if(!Tb)return null;M=W.g(this.$).Hf(ob);const Dc=M.wm;if(!Dc.Bd(Tb))return null;Tb=Dc.Ie(Tb);const ad=Tb.topLeft.y;var ld=Tb.bottomRight.y;const md=$a?Tb.bottomRight.x:Tb.topLeft.x;Tb=$a?
Tb.topLeft.x:Tb.bottomRight.x;var Wb=new V.a(Tb+($a?-81:81),ld+38+6);if(Dc.Rha(Wb))return this.G4a(M,Dc,ob,Tb,ld,$a?12:-3,66);Wb=new V.a(Tb+($a?-81:81),ld);if(Dc.Rha(Wb))return this.G4a(M,Dc,ob,Tb,ld,$a?20:3,22);Wb=new V.a(Tb,ld+38+6);if(Dc.Rha(Wb))return this.G4a(M,Dc,ob,Tb,ld,-81+($a?18:0),66);Tb=new V.a(md+($a?81:-81),ld);if(Dc.Rha(Tb))return this.G4a(M,Dc,ob,md,ld,-81+($a?12:-6),22);ld=new V.a(md,ad-38-6);return Dc.Rha(ld)?this.G4a(M,Dc,ob,md,ad,$a?15:0,16):this.G4a(M,Dc,ob,$a?Dc.topLeft.x:Dc.bottomRight.x,
Dc.bottomRight.y,-81+($a?15:-6),22)}G4a(M,$a,ob,Tb,Dc,ad,ld){var md=W.g(this.$);const Wb=md.rtl;M=Sys.UI.DomElement.getLocation(M.domElement);Tb=new Sys.UI.Point(Tb+(Wb?0:M.x)-$a.topLeft.x,Dc+M.y-$a.topLeft.y);Wb&&(md=md.view.visibleArea,Tb.x=md.bottomRight.x-md.topLeft.x-Tb.x,2===ob||4===ob)&&(Tb.x+=$a.bottomRight.x);Tb=da.a(this.$).Ija(Tb);return new Sys.UI.Point(Tb.x+ad,Tb.y+ld)}}ta.CXi=["PasteRecoveryUI"];Object(c.a)(ta,"PasteRecoveryUI",null,[324]);var K=a(77),na=a(176);class P{}P.cBg="ActiveSelection";
P.shadowWorkbook="ShadowWorkbook";P.lkg="GVML";P.plainText="PlainText";P.html="Html";P.zPg="Bitmap";Object(c.a)(P,"PayloadType",null,[]);class ka{}ka.GCj="Slice4";ka.HCj="Slice5";ka.ICj="Slice6";Object(c.a)(ka,"SliceName",null,[]);class pa{}pa.ZDi="NotCalled";pa.success="Success";pa.failed="Failed";Object(c.a)(pa,"SucceededPopulatingSystemClipboardOptions",null,[]);var Na=a(356);const Z=(M,$a)=>M?$a&&$a.ya?M.sessionId!==$a.ya.UserSessionId:(d.ULS.shipAssertTag(537166209,0,!1,"ewaControl shouldn't be null"),
!1):(d.ULS.shipAssertTag(537166210,0,!1,"copyContext shouldn't be null"),!1),Ra=M=>{switch(M){case 0:return"None";case 2:return"Art";case 1:return"Range";default:return"Unknown"}},Da=M=>{if(!M)return"null";const $a=[];for(const ob of M.get())$a.push(`${ob.clipboardDataFormat}(${ob.data.length})`);$a.sort();return $a.join(",")};var Ba;(function(M){M[M.valid=0]="valid";M[M.destinationRangesIsEmpty=1]="destinationRangesIsEmpty";M[M.discontinuousSelectionNotSupportPasteFromExternal=2]="discontinuousSelectionNotSupportPasteFromExternal";
M[M.discontinuousSelectionNotSupportPasteCrossSession=3]="discontinuousSelectionNotSupportPasteCrossSession";M[M.multipleSourcesAndMultipleDestinationsAreNotSupported=4]="multipleSourcesAndMultipleDestinationsAreNotSupported";M[M.multipleDestinationsAreNotMultiplyOfSourceRange=5]="multipleDestinationsAreNotMultiplyOfSourceRange";M[M.sourceAndDestinationAreOverlapping=6]="sourceAndDestinationAreOverlapping";M[M.copySourceNotValid=7]="copySourceNotValid";M[M.cutNotSupportedInDiscontinuousSelection=
8]="cutNotSupportedInDiscontinuousSelection";M[M.pasteLinkNotSupportMultipleDestination=9]="pasteLinkNotSupportMultipleDestination";M[M.temporarilyBlockedPaste=10]="temporarilyBlockedPaste";M[M.unknown=100]="unknown"})(Ba||(Ba={}));Object(c.b)("PasteValidationOptions",Ba);var ea=a(50),Y=a(33),ja=a(145),ca=a(37),ba=a(153),ua=a(343),wa=a(29),ia=a(316),xa=a(11),gb=a(22),va=a(97),sa=a(125),ab=a(112),Ua=a(566),nb=a(99),Ha=a(55),sb=a(184),Qb=a(65),mb=a(341);class Pb extends v.a{constructor(M,$a,ob,Tb,Dc,
ad,ld,md,Wb=null){super();this.pasteShortcutManager=null;this.tdf=r.EwaSettings.xb();this.gxa=r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);this.y$f=null;this.A7a=!1;this.Ord=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6660890_Tag_aoi75RetryLoggingFix2");this.SBd=Nc=>{this.nwj(Nc)&&(this.Tp.Udc(),d.ULS.sendTraceTag(537167777,0,50,"CopyPasteInfrastructure.OnMetadataChanged: found that cut/copy operation was preformed in another session therefore removed the highlight in this session."))};
this.Gwi=(Nc,gd)=>{d.ULS.sendTraceTag(537167768,0,50,`CopyPasteInfrastructure.LogShortcutDialogAndRestoreFocus: Got shortcut dialog, user pressed [${Nc}]. userPressedExtensionLink=${gd}`);this.gridView.focus()};this.dd=(Nc,gd)=>{gd.pN||gd.fg||this.ur("OnWorkbookOpened",!1).catch(()=>{})};this.Ih=(Nc,gd)=>{Nc=O(this.GK);const Gd=this.Tp.xwb(Nc);Gd&&(gd.oa&&gd.oa.sheetName===Gd.sheetName&&Gd.isFromCurrentSession(this.$)?this.Tp.C9e(Gd.ranges,Nc.commandParameters.commandType):this.Tp.Udc())};this.Znc=
(Nc,gd)=>{Nc=O(this.GK);(Nc=this.Tp.xwb(Nc))&&gd.item&&gd.item.sheetName===Nc.sheetName&&Nc.isFromCurrentSession(this.$)&&this.ur("OnItemDeleting",!1).catch(()=>{})};this.FFb=(Nc,gd)=>{this.tdf?this.y$f(Nc,gd):this.REf()};this.rR=(Nc,gd)=>{1===gd.Vq&&gd.zf.operation.flags&2&&this.ur("OnQueueItemChanged/ItemRemoved",!1).catch(()=>{})};this.$=M;this.xg=ob;this.gridView=W.g(M);this.Tp=Dc;this.kci=ad;this.GK=$a;this.m4b=Tb;this.getStringifiedError=Wb||copyPasteInfra.getStringifiedError;this.U3f=1===md;
this.Bbd=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6713439_FixCloneRangeArray");this.Ij();this.copyPasteShortcutDialogFactory=this.$.da.za(85);d.ULS.shipAssertTag(537167825,0,!!this.copyPasteShortcutDialogFactory,"CopyPasteInfrastructure.ctor: this.copyPasteShortcutDialogFactory shouldn't be null.");ld||(d.ULS.sendTraceTag(537167824,0,50,"CopyPasteInfrastructure.ctor: userId is null, using default userId."),ld=Pb.Zdh);this.userHash=e.a.Zv(ld);this.IAi="CultureTag: "+B.a.instance.ssb+" HASH: ";
this.GK.addMetadataChangeListener(Pb.Jrf,this.SBd);this.yzi=na.a.fDb;this.pya=this.gxa?r.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",this.$.ya.CopyPasteMaxPayloadLength):y.a.pya;(this.Do=r.EwaSettings.getBooleanFeatureGate(na.a.fQa,!1))&&M.da.Za(478,Nc=>{this.pasteShortcutManager=Nc});this.tdf&&(this.y$f=ia.a(()=>{this.REf()},1,this.$.la,"CopyPasteInfrastructure.OnStartEditInternal",!0))}get pasteIndicationManager(){return this.$.da.za(373)}GHg(M){this.addHandler(Pb.QCd,
M)}xcj(M){this.removeHandler(Pb.QCd,M)}copy(M){M.stopwatch=this.$.Jb.Bc("UserAction",A.b().ij(M.ribbonCommandInfo.command)+"ClientSide");if(this.Do){const ad=ea.GetServiceTaskFactory.Sa(this.$.da,478,479,0);ca.TaskExtensions.Aa(ad,()=>{this.pasteShortcutManager=ad.result},this.la,3)}const $a=!!O(this.GK);r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!k.a.xz&&(this.A7a=!1);this.ur("Copy/before/"+l.a[M.ribbonCommandInfo.method],!1,void 0,!0,M.copyPasteTargetType).catch(()=>
{});var ob=-1985798686===M.ribbonCommandInfo.command;if(1===this.gridView.Me&&(ob=this.Tp.Gdf(this.gridView.ha.sa.selectedRanges,ob),0!==ob)){const ad=Pb.Q3g(ob);this.wza(ad,X[ob],!1);return Promise.reject(!1)}M.userHash=this.userHash;M.id=m.a.create().toString();let Tb=this,Dc=this;return this.m4b.onCopy(M).then(ad=>{ad.isAsyncCopy||M.stopwatch.stop();Tb.pasteIndicationManager.AKe();const ld=Na.d(M);d.ULS.sendTraceTag(24150883,0,50,`CopyPasteInfrastructure.OnCopy: Copy operation finished successfully. ${ld}`);
Tb.Gui(ad,$a);ad=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6591921_CheckTargetTypeForEnterToPaste")?1===M.copyPasteTargetType:!0;!M.isFormatPainter&&Tb.Do&&ad&&(Tb.pasteShortcutManager?Tb.pasteShortcutManager.Flh():d.ULS.shipAssertTag(537167823,0,!1,"Copy: pasteShortcutManager is null."));return Promise.resolve(!0)},ad=>{let ld=!1,md="none",Wb=Pb.psb,Nc=!0,gd=-1,Gd=Pb.copyErrorName+Pb.hJa,Zd=!1,xe=null;if(ad){xe=ad.copyContext;gd=ad.reason;Gd+=Pb.zKa(ad);ad.message&&(Wb=ad.message);var Re=Pb.P3g(ad);
if(Re)if(3===Re.copyErrorName)ld=!0,Wb=md="Async Copy canceled by the user.",Nc=!1;else if(wa.a.Dq(Re.ewaErrors))if(Wb=Dc.bbc(Re.ewaErrors),wa.a.lh(Re.ewaErrors,Pb.operationSucceededWithAlert))Zd=ld=!0;else if(wa.a.lh(Re.ewaErrors,Pb.pasteDataLimitHit)||wa.a.lh(Re.ewaErrors,Pb.copyThrottlingError))ld=!0;13===ad.reason?(ld=!0,Nc=!1):11===ad.reason&&(Nc=!1)}Re=ad?Dc.getStringifiedError(ad):"null";ld?(Re=Na.d(M),d.ULS.sendTraceTag(36304157,0,15,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an expected error. clearStateNeeded: ${Nc}, Friendly message: ${md}, Error Message: ${Wb}, CommandParameters: ${Re}`)):
d.ULS.sendTraceTag(24150912,0,10,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an unexpected error. clearStateNeeded: ${Nc}, Error Message: ${Re}, CommandParameters: ${Na.d(M)}`);Nc&&Dc.ur("Copy/fail/"+l.a[M.ribbonCommandInfo.method],!0,void 0,void 0,M.copyPasteTargetType).catch(()=>{});Dc.Fui(M,ld,Wb,Gd,gd,Zd,xe);return Promise.reject(ad)})}paste(M){M.stopwatch=this.$.Jb.Bc("UserAction",A.b().ij(M.ribbonCommandInfo.command)+"ClientSide");r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!k.a.xz&&(d.ULS.sendTraceTag(537167822,0,50,"CopyPasteInfrastructure.OnPaste: Cross-app shadow workbook paste is enabled"),this.A7a=!1,M.clipboardPicklingApiDataFormatsToRead=[L.shadowWorkbook]);W.g(this.$).Pi&&W.g(this.$).Pi.A7(this.ggd(M.ribbonCommandInfo.command),M.stopwatch.id);if(M.isPasteCommandFromRecoveryUI){var $a=this.$.da.za(406);var ob=this.Bbd?T.d($a.zjc):u.a.clone($a.zjc);$a=$a.dtd;M.pasteRecoveryCachedClipboardItems=$a?$a[Pb.PHf]:null}else ob=this.Bbd?T.d(this.gridView.ha.sa.selectedRanges):
u.a.clone(this.gridView.ha.sa.selectedRanges);M.originalDestinations=ob;M.expandDestinations=this.VZc(M.originalDestinations,M.commandType);if(this.h_c(M.commandType,M.expandDestinations)||this.JVg())return M.userHash=this.userHash,M.id=m.a.create().toString(),r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PerfImpactExperimentForAsyncApi",!1)&&!k.a.xz&&(M.clipboardReadPermissionPromptShown=!1,M.clipboardAsyncApiDataFormatsToRead=[L.plainText+"Async"],this.m4b.shouldShowClipboardReadPermissionDialog().then(Tb=>
{Tb&&(M.clipboardReadPermissionPromptShown=!0,new z(this.$));return Promise.resolve(!0)},()=>Promise.resolve(!0))),this.m4b.onPaste(M).then(Tb=>this.xoc(Tb,M),Tb=>this.sFb(M,Tb));this.$.fd(927125067,K.a.Gb,30,null);ob=T.i(M.expandDestinations,",",this.$,!1);d.ULS.sendTraceTag(24150913,0,15,`CopyPasteInfrastructure.OnPaste: paste was triggered but the estimated destination range is not editable, do nothing. ExpandDestinations: ${ob}, CommandType: ${M.commandType}, copyPasteTargetType="${M.copyPasteTargetType}"`);
return Promise.resolve(!0)}ggd(M){switch(M){case 1804571062:return 6;case -185374993:return 7;case 1766348718:return 8;default:return 3}}JVg(){return!!W.g(this.$).ha.Qa.activeFloatingObjectControlId&&this.$.Sp(null,!1,470)}KBb(){const M=O(this.GK);return M&&M.commandParameters?M.commandParameters.copyPasteTargetType:0}Bji(){return!!O(this.GK)&&Z(O(this.GK),this.$)}ur(M,$a,ob=!1,Tb=!1,Dc=0){try{this.Do&&this.pasteShortcutManager&&this.pasteShortcutManager.Q6b();let ad=Dc;const ld=this.Qqi();if(!Tb&&
2===ld)return d.ULS.sendTraceTag(537167821,0,50,`CopyPasteInfrastructure.ClearState clipboard won't be cleared as there's art in the clipboard. clearClipboardContent = '${$a}', isExplicit = '${ob}', isForce = '${Tb}', Current CCP operation copyPasteTargetType = '${Dc}', LastCopyPasteTargetType = '${ld}'`),Promise.reject(null);0===ad&&(ad=ld);const md=this.$.Jb.Bc("UserAction","ClearCopyState"),Wb=md.id;d.ULS.sendTraceTag(537167820,0,50,`CopyPasteInfrastructure.ClearState clear clipboard state. clearClipboardContent = '${$a}', isExplicit = '${ob}', isForce = '${Tb}', Current CCP operation copyPasteTargetType = '${Dc}', LastCopyPasteTargetType = '${ld}'`);
this.Tp.Udc();this.s4i();return this.m4b.onCancelCopy($a).then(()=>{$a&&r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!k.a.xz&&(this.A7a=!1);md.stop();this.hnf(M,Wb,!0,ob,$a,"","",md.yc,ad);return Promise.resolve(!0)},Nc=>{var gd=Nc?this.getStringifiedError(Nc):"null";d.ULS.sendTraceTag(24150915,0,15,`CopyPasteInfrastructure.ClearState: error during call to copyPasteFlowManager.OnClear(). error: ${gd}`);md.stop();gd=Pb.YVg+Pb.hJa;let Gd=Pb.psb;Nc&&(gd+=
Pb.zKa(Nc),Nc.message&&(Gd=Nc.message));this.hnf(M,Wb,!1,ob,$a,Gd,gd,md.yc,ad);return Promise.reject(Nc)})}catch(ad){return Promise.reject(null)}}d1c(M,$a,ob=!1,Tb=!1,Dc=0){return Tb||!r.EwaSettings.ma(651)||this.Fih()?this.ur(M,$a,ob,Tb,Dc):(d.ULS.sendTraceTag(537167819,0,50,"CopyPasteInfrastructure.ClearStateOnlyIfClipboardHasContentFromSameSession clipboard won't be cleared as there is no content in the clipboard from the current session"),Promise.reject(null))}wza(M,$a,ob){d.ULS.sendTraceTag(590705172,
0,50,`CopyPasteInfrastructure.PopupDiscontinuousSelectionErrorDialog: Blocked CCP due to discontinuous selection, reason: ${$a}`);const Tb=new nb.a;Tb.ia("reason",$a);Ua.a(sa.a.discontinuousSelectionBlocking,[ob?ab.a.vXi:ab.a.K4g],!0,!0,!1,!1,Tb);M=wa.a.Yc(1,1,756,M,0,371863010,"DiscontinuousSelectionBlocking");r.EwaSettings.Dz()?new ua.a(this.$,M):(M=new ba.ErrorDialog(this.$,M),M.initialize(),M.ig())}Qqi(){const M=O(this.GK);return M&&M.sourceItem?Object.getType(M.sourceItem)===U?2:1:0}dragDropCells(M,
$a,ob,Tb,Dc=!1){M.stopwatch=this.$.Jb.Bc("UserAction","DragDropClientSide");M.isDragDrop=!0;this.ur("DragDrop/before/"+l.a[M.ribbonCommandInfo.method],!1,void 0,void 0,M.copyPasteTargetType).catch(()=>{});const ad=Dc?2:1;let ld=0;ld=Dc?4:Tb?256:128;const md={encounteredDeploymentErrors:!1};md.commandParameters=M;M.userHash=this.userHash;M.id=m.a.create().toString();return this.Ord?this.Tp.pasteRange(M.ribbonCommandInfo,T.q($a,this.$),T.q(ob,this.$),ad,ld,[M.stopwatch],md,!1,()=>{d.ULS.sendTraceTag(537167818,
0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${M.copyPasteTargetType}"`);this.G8a(M,ad,$a,ob,md)},Wb=>{const Nc=Wb?this.getStringifiedError(Wb):"null";d.ULS.sendTraceTag(537167817,0,10,`CopyPasteInfrastructure.DragDropCells: ${Nc}, copyPasteTargetType="${M.copyPasteTargetType}"`);this.b$a(Wb,M,ad,$a,ob,md)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},Wb=>Promise.reject(Wb)):this.Tp.pasteRange(M.ribbonCommandInfo,T.q($a,this.$),T.q(ob,this.$),
ad,ld,[M.stopwatch],md,!1,null,null).then(()=>{d.ULS.sendTraceTag(521410075,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${M.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.G8a(M,ad,$a,ob,md);return Promise.resolve(!0)},Wb=>{const Nc=Wb?this.getStringifiedError(Wb):"null";d.ULS.sendTraceTag(521410074,0,10,`CopyPasteInfrastructure.DragDropCells: ${Nc}, copyPasteTargetType="${M.copyPasteTargetType}"`);this.b$a(Wb,M,ad,$a,ob,md);return Promise.reject(Wb)})}cjh(M,
$a,ob,Tb,Dc=!1){M.stopwatch=this.$.Jb.Bc("UserAction","DragDropReplaceClientSide");M.isDragDrop=!0;this.d1c("DragDropReplace/before/"+l.a[M.ribbonCommandInfo.method],!1,void 0,void 0,M.copyPasteTargetType).catch(()=>{});const ad=Dc?2:1;let ld=0;ld=Dc?4:Tb?256:128;const md={encounteredDeploymentErrors:!1};md.commandParameters=M;r.EwaSettings.getBooleanFeatureGate(na.a.x7b,!1)&&(M.isDragInsert=!1);M.userHash=this.userHash;M.id=m.a.create().toString();return this.Ord?this.Tp.pasteRange(M.ribbonCommandInfo,
T.q($a,this.$),T.q(ob,this.$),ad,ld,[M.stopwatch],md,!1,()=>{d.ULS.sendTraceTag(537167816,0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${M.copyPasteTargetType}"`);this.G8a(M,ad,$a,ob,md)},Wb=>{const Nc=Wb?this.getStringifiedError(Wb):"null";d.ULS.sendTraceTag(537167815,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${Nc}, copyPasteTargetType="${M.copyPasteTargetType}"`);return this.b$a(Wb,M,ad,$a,ob,md)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},
Wb=>Promise.reject(Wb)):this.Tp.pasteRange(M.ribbonCommandInfo,T.q($a,this.$),T.q(ob,this.$),ad,ld,[M.stopwatch],md,!1,null,null).then(()=>{d.ULS.sendTraceTag(521410073,0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${M.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.G8a(M,ad,$a,ob,md);return Promise.resolve(!0)},Wb=>{const Nc=Wb?this.getStringifiedError(Wb):"null";d.ULS.sendTraceTag(521410072,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${Nc}, copyPasteTargetType="${M.copyPasteTargetType}"`);
this.b$a(Wb,M,ad,$a,ob,md);return Promise.reject(Wb)})}bjh(M,$a,ob,Tb,Dc=!1){M.stopwatch=this.$.Jb.Bc("UserAction","DragDropInsertClientSide");this.d1c("DragDropInsert/before/"+l.a[M.ribbonCommandInfo.method],!1,void 0,void 0,M.copyPasteTargetType).catch(()=>{});const ad=Dc?2:1,ld=T.K(this.VZc([ob],ad));var md=this.$.ea.oa.sheetName;const Wb=this.$.ea.oa.sheetName,Nc=T.v($a,this.$);Nc.SheetName=md;md=T.v(ld,this.$);md.SheetName=Wb;Tb=ld.isRow||$a.isRow||Tb?1:0;const gd={encounteredDeploymentErrors:!1};
M.isDragInsert=!0;gd.commandParameters=M;M.userHash=this.userHash;M.id=m.a.create().toString();if(this.Ord)return Dc=this.Tp.HKe(gd,Nc,md,Dc,Tb,M.ribbonCommandInfo,()=>{d.ULS.sendTraceTag(537167814,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${M.copyPasteTargetType}"`);this.G8a(M,ad,$a,ob,gd)},Zd=>{const xe=Zd?this.getStringifiedError(Zd):"null";d.ULS.sendTraceTag(537167813,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${xe}, copyPasteTargetType="${M.copyPasteTargetType}"`);
this.b$a(Zd,M,ad,$a,ob,gd)}),sb.c(Dc.then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},Zd=>Promise.reject(Zd))).fp(()=>!0);Dc=this.Tp.HKe(gd,Nc,md,Dc,Tb,M.ribbonCommandInfo,null,null);let Gd=this;return sb.c(Dc.then(()=>{d.ULS.sendTraceTag(521410071,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${M.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.G8a(M,ad,$a,ob,gd);return Promise.resolve(!0)},Zd=>{const xe=Zd?Gd.getStringifiedError(Zd):
"null";d.ULS.sendTraceTag(521410070,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${xe}, copyPasteTargetType="${M.copyPasteTargetType}"`);Gd.b$a(Zd,M,ad,$a,ob,gd);return Promise.reject(Zd)})).fp(()=>!0)}jci(M,$a){var ob=O(this.GK);if(!ob)return d.ULS.sendTraceTag(537167812,0,50,"InsertCopiedCutCells: CopyContext must not be null or undefined"),Ha.Task.Ta(!1);if(!D(ob.sourceItem))return d.ULS.sendTraceTag(537167811,0,50,"InsertCopiedCutCells: CopyContext must be a Range"),Ha.Task.Ta(!1);var Tb=
ob.sourceItem;if(!Tb)return d.ULS.shipAssertTag(537167810,0,!!Tb,"InsertCopiedCutCells: rangeSourceItem must not be null or undefined"),Ha.Task.Ta(!1);if(!Tb.isFromCurrentSession(this.$))return d.ULS.sendTraceTag(537167809,0,50,"InsertCopiedCutCells: rangeSourceItem is from a different session"),Ha.Task.Ta(!1);if(1<Tb.ranges.length)return d.ULS.sendTraceTag(537167808,0,50,"InsertCopiedCutCells: multiple source ranges are not supported"),this.wza(2190,"InsertCopiedCutCells",!0),Ha.Task.Ta(!1);ob=T.K(Tb.ranges);
var Dc=this.gridView.ha.sa.Xc.clone();M=T.K(this.VZc([Dc],M));const ad=this.blf();Tb=Tb.sheetName;Dc=this.$.ea.oa.sheetName;const ld=T.v(ob,this.$);ld.SheetName=Tb;const md=T.v(M,this.$);md.SheetName=Dc;return(M.gf||ob.gf?Ha.Task.Ta(0):M.isRow||ob.isRow?Ha.Task.Ta(1):this.kci.C4b(this.$,W.g(this.$).rtl)).fp(Wb=>this.Tp.executeInsertCopiedCutCellsOperation(ld,md,ad,Wb.result,$a,null,null,r.EwaSettings.isChangeGateEnabled("OfficeVSO:7105498_UseInsertCopiedCutCellsV2forICCCOperation"))).continueWith(()=>
{ad?this.Tp.Udc():this.ur("InsertCopiedCutCells/success/"+l.a[$a.method],!0)})}qpd(){const M=O(this.GK),$a=this.gridView.ha.sa.Bg;return!!M&&D(M.sourceItem)&&$a&&1===M.sourceItem.ranges.length}blf(){return this.clf(-911352779)}yjc(){return this.clf(-1985798686)}h_c(M,$a){var ob=new ja.a(this.$.xa),Tb=36===M;const Dc=ob.Wd(4);M=2===this.KBb()&&ob.Wd(1);Tb=Tb&&Dc;ob=!ob.wi||!this.yjc()||!ja.a.l7b($a,W.g(this.$));return Tb||M||this.$.Sp($a,!0)&&ob}Lgc(M,$a){return this.Tp.Lgc(M,$a)}dispose(){super.dispose();
this.mk();this.GK.removeMetadataChangeListener(Pb.Jrf)}u7c(M,$a,ob,Tb,Dc,ad){if(!this.RZg(M.commandParameters.ribbonCommandInfo.command))return M.cseStatus=2,!1;if(ad&&$a.Bd(Tb))return M.cseStatus=4,!1;if(ob!==Dc)return M.cseStatus=6,!1;if(r.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests")&&(Tb.width%$a.width||Tb.height%$a.height))return M.cseStatus=16,!1;if(r.EwaSettings.getBooleanFeatureGate(na.a.HGe,!1)){if(ob=$a,Tb=Tb.Ie(this.gridView.mi),$a=null===$a.Ie(this.gridView.mi),
Dc=M.commandParameters.ribbonCommandInfo.command,$a&&1804571062!==Dc&&-185374993!==Dc||!Tb)return M.cseStatus=7,!1}else if(ob=$a.Ie(this.gridView.mi),Tb=Tb.Ie(this.gridView.mi),!ob||!Tb)return M.cseStatus=7,!1;$a=T.v(ob,this.$);$a=this.xg.AXi(this.gridView,$a,T.v(Tb,this.$),M.commandParameters.ribbonCommandInfo.command,M.commandParameters.stopwatch);1===$a&&(ad&&(this.xg.W0c(ob,!1),this.xg.W0c(ob,!0)),-185374993===M.commandParameters.ribbonCommandInfo.command&&W.g(this.$).d4i(),this.pasteIndicationManager.lkd(M.commandParameters.id),
this.Fvc(M.commandParameters.expandDestinations,M.commandParameters.isPasteCommandFromRecoveryUI),this.iAe("DoPasteClientEstimation/"+l.a[M.commandParameters.ribbonCommandInfo.method],M));M.cseStatus=$a;return 1===$a}$If(){this.copyPasteShortcutDialogFactory.create(this.$).showDialog(!0,!1,!1,this.Gwi)}Rnf(M,$a,ob,Tb){M=I(M,$a,ob,Tb,this.$.ya.UserSessionId);M.k=!0;A.b().Ne(45,M,!0)}LCf(M,$a,ob,Tb,Dc){var ad=!1,ld=!1,md=Pb.psb,Wb=Pb.DKe+Pb.hJa;M&&(Wb+=Pb.zKa(M),wa.a.Dq(M.ewaErrors)?(md=this.bbc(M.ewaErrors),
wa.a.lh(M.ewaErrors,[-103190598])&&(ad=!0)):M.message&&(md=M.message));ld||(ld=this.Iod(M));$a=I($a,ob,Tb,Dc,this.$.ya.UserSessionId);$a.k=!1;$a.l=ld;$a.n=md;$a.p=Wb;$a.q=ad;A.b().Ne(45,$a,!0);return Promise.reject(M)}RZg(M){switch(M){case 237279923:case 808159687:return na.a.Lki;case -185374993:return!0;case 1804571062:return!0;default:return!1}}clf(M){const $a=O(this.GK);if(!$a)return!1;const ob=$a.sourceItem;return ob&&!ob.isFromCurrentSession(this.$)?(d.ULS.sendTraceTag(537167779,0,50,"CopyPasteInfrastructure.LastOperationWasCopyCut: Last copy operation was from a different session."),
!1):$a.commandParameters.ribbonCommandInfo.command===M}Fih(){var M=O(this.GK);return M?(M=M.sourceItem)&&!M.isFromCurrentSession(this.$)?(d.ULS.sendTraceTag(537167778,0,50,"CopyPasteInfrastructure.DoesClipboardHaveCopiedOrCutContent: Last copy/cut operation was from a different session."),!1):!0:!1}nwj(M){return M&&M.lastCopy?Z(M.lastCopy,this.$):!0}EZe(M,$a,ob,Tb,Dc){const ad={};ad.a=this.$.ya.UserSessionId;ad.e=M.stopwatch.id;ad.c=A.b().ij(M.ribbonCommandInfo.command);ad.b=l.a[M.ribbonCommandInfo.method];
ad.d=M.id;ad.f=ob.toString();ad.g=Tb.toString();ad.h=$a.toString();ad.o=M.stopwatch.yc;ad.q=!1;ad.r=M.copyPasteTargetType.toString();ad.s=Dc.encounteredDeploymentErrors;r.EwaSettings.getBooleanFeatureGate(na.a.x7b,!1)&&(ad.i=Dc.commandParameters.dragDropIsShiftKeyDown,ad.j=Dc.commandParameters.isDragInsert);return ad}G8a(M,$a,ob,Tb,Dc){M=this.EZe(M,$a,ob,Tb,Dc);M.k=!0;A.b().Ne(45,M,!0)}Oui(M,$a,ob,Tb,Dc,ad,ld,md,Wb){M=this.EZe(M,$a,ob,Tb,Wb);M.k=!1;M.l=Dc;M.n=ad;M.p=ld;M.q=md;A.b().Ne(45,M,!0)}hnf(M,
$a,ob,Tb,Dc,ad,ld,md,Wb){const Nc={};Nc.a=this.$.ya.UserSessionId;Nc.b=$a;Nc.c=M;Nc.f=ob;Nc.e=Tb;Nc.d=Dc;Nc.g=ad;Nc.h=ld;Nc.i=md;Nc.j=Wb.toString();A.b().Ne(46,Nc,!0)}Gui(M,$a){M=this.aZe(M.commandParameters,M);M.l=!0;M.j=$a;A.b().Ne(43,M,!0)}Fui(M,$a,ob,Tb,Dc,ad,ld){M=this.aZe(M,ld);M.l=!1;M.m=$a;M.o=ob;M.y=Tb;M.x=Dc;M.z=ad;A.b().Ne(43,M,!0);d.ULS.sendTraceTag(537167776,0,15,`CopyPasteInfrastructure.LogCopyFailedTelemetry: ErrorName=${M.y},ErrorReason=${M.x},IsExpectedError=${M.m},IsSucceededWithAlert=${M.z},ErrorMessage=${M.o}`)}aZe(M,
$a){const ob={};ob.a=this.$.ya.UserSessionId;ob.f=M.stopwatch.id;ob.g=M.id;ob.c=A.b().ij(M.ribbonCommandInfo.command);ob.b=l.a[M.ribbonCommandInfo.method];ob.q=M.stopwatch.yc;ob.bd=Pb.pac();ob.bg=M.copyPasteHandlerName;ob.bj=void 0===M.ribbonCommandInfo.Re||null===M.ribbonCommandInfo.Re?null:t.a[M.ribbonCommandInfo.Re];ob.bq=M.uploadToClipService;ob.br=M.floatingObjectType;ob.s=M.copyPasteTargetType.toString();ob.bc=Ra(M.copyPasteTargetType);ob.z=!1;if($a){ob.bk=$a.id;ob.bl=$a.serverRequestTimeInMs;
$a.requestTelemetryData&&(ob.bm=$a.requestTelemetryData.EcsOperationDuration,ob.bn=$a.requestTelemetryData.EcsRequestDuration,ob.bo=$a.requestTelemetryData.WfeRequestDuration);ob.d=$a.sourceItem?$a.sourceItem.toString():null;ob.e=-1;if(D($a.sourceItem)){ob.e=0;M=$a.sourceItem.ranges;for(const Tb of M)ob.e+=Tb.dH}ob.h=$a.isAsyncCopy;ob.i=$a.isFromCache;ob.k=$a.isSelectionAllowed;ob.r=$a.plainTextPayloadSize;ob.u=$a.htmlPayloadSize;ob.v=$a.htmlSizeExceedsLimit;ob.w=$a.copyTotalSizeExceedsLimit;ob.t=
$a.shadowWorkbookPayloadSize;ob.p=$a.clientSideCopyTime;ob.ba=$a.encounteredDeploymentErrors;ob.bb=$a.shadowWorkbookSizeExceedsLimit;ob.be=$a.syncClipboardItemsKeys;ob.bf=$a.asyncClipboardItemsKeys;ob.bh=this.zDe($a.succeededPopulatingSystemClipboardSync);ob.bi=this.zDe($a.succeededPopulatingSystemClipboardAsync)}return ob}Fvc(M,$a=!1){if(!this.gridView.eb&&!this.gridView.Fi){var ob=this.gridView.ha.sa,Tb=!$a&&1===M.length&&T.Q(M,ob.selectedRanges),Dc=Tb?ob.activeCell:M[0].topLeft;M[0].contains(Dc)||
(d.ULS.shipAssertTag(537167775,0,!1,`CopyPasteInfrastructure.SelectPastedRange: SelectedRanges ${ob.selectedRanges}, IndexOfActiveRange ${ob.ls}, ActiveCell ${ob.activeCell}, calculatedDestinationRanges ${M}, keepThePreviousActiveCell ${Tb}, newActiveCell ${Dc}, isPasteCommandFromRecoveryUI ${$a}`),Dc=M[0].topLeft);this.gridView.ha.Xw(M,0,Dc,0,void 0,va.a.P4g)}}Y1e(M,$a){const ob={};ob.a=this.$.ya.UserSessionId;ob.g=M.stopwatch.id;ob.t=M.stopwatch.yc;ob.bz=!1;$a&&(ob.bv=$a.id,ob.bw=$a.serverRequestTimeInMs,
ob.n=$a.commandParameters.clipboardFormatReadTimes,ob.o=$a.commandParameters.clipboardFormatReadStatus,ob.p=$a.commandParameters.clipboardReadPermissionPromptShown,ob.q=$a.commandParameters.asyncApiReadTimedOut,$a.requestTelemetryData&&(ob.cb=$a.requestTelemetryData.EcsOperationDuration,ob.cc=$a.requestTelemetryData.EcsRequestDuration,ob.cd=$a.requestTelemetryData.WfeRequestDuration));ob.x=M.copyPasteTargetType.toString();ob.bl=Ra(M.copyPasteTargetType);ob.br=M.copyPasteHandlerName;ob.i=T.i(M.expandDestinations,
",",this.$,!1);ob.h=T.i(M.originalDestinations,",",this.$,!1);ob.e=M.id;ob.d=M.commandType;ob.c=A.b().ij(M.ribbonCommandInfo.command);ob.b=l.a[M.ribbonCommandInfo.method];ob.bf=!1;ob.bg=!1;ob.bp=Pb.pac();ob.bt=void 0===M.ribbonCommandInfo.Re||null===M.ribbonCommandInfo.Re?null:t.a[M.ribbonCommandInfo.Re];ob.cj=M.isPasteCommandFromEnterShortcut;if(ob.ca=M.isPasteCommandFromRecoveryUI)ob.cf=M.pasteRecoveryUndoStopwatch.id,ob.cg=M.pasteRecoveryUndoStopwatch.yc;if($a){if((M=$a.copyContextSnapshot)&&!$a.wasLastCopyExternal){ob.f=
M.commandParameters.id;ob.j=M.sourceItem.toString();ob.k=-1;if(D(M.sourceItem)){ob.k=0;const Tb=M.sourceItem.ranges;for(const Dc of Tb)ob.k+=Dc.dH}ob.bg=1===M.commandParameters.commandType}else $a.clipboardItems?ob.f=$a.clipboardItems.getItem(L.irb):d.ULS.sendTraceTag(537167774,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext.ClipboardItems is null");ob.bz=$a.pasteRecoveryUIDisplayed;ob.ci=$a.cseStatus}else d.ULS.sendTraceTag(537167773,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext is null");
return ob}Wvi(M,$a,ob,Tb,Dc,ad,ld,md,Wb){M=this.Y1e(M,md);M.l=!1;M.m=$a;M.s=ob;M.bc=Tb;M.be=Dc;M.bd=ad;M.bf=ld;md?(M.y=H(md)||!md.copyContextSnapshot,M.bi=!M.y&&Z(md.copyContextSnapshot,this.$),M.bj=md.shadowWorkbookSizeExceedsLimit,M.v=md.shadowWorkbookPayloadSize,M.w=md.htmlPayloadSize,M.bq=Da(md.clipboardItems),M.bb=md.activeSelectionType,M.bs=md.isSameSession,M.bn=md.payloadOrigin,M.bo=md.payloadType,M.bu=md.externalAppSource,M.bx=md.indicationDisplayScheduled,M.by=md.pasteIndicationDisplayStatus,
M.ck=md.pasteDestinationHasMergedCells):M.bi=Z(Wb,this.$);A.b().Ne(44,M,!0);d.ULS.sendTraceTag(537167772,0,15,`CopyPasteInfrastructure.LogPasteFailedTelemetry: ErrorName=${M.be},ErrorReason=${M.bd},IsExpectedError=${M.m},IsSucceededWithAlert=${M.bf},ErrorMessage=${M.s}`)}Xvi(M){const $a=this.Y1e(M.commandParameters,M);$a.y=M.wasLastCopyExternal;$a.l=!0;$a.u=M.plainTextPayloadSize;$a.v=M.shadowWorkbookPayloadSize;$a.w=M.htmlPayloadSize;$a.z=M.isClipboardDataContainShadowWorkbook;$a.ba=M.isShadowWorkbookParsedSuccessfully;
$a.bb=M.activeSelectionType;$a.bc=M.pasteResult;$a.bh=M.encounteredDeploymentErrors;$a.bj=M.shadowWorkbookSizeExceedsLimit;$a.bk=Q(M);$a.bq=Da(M.clipboardItems);$a.bs=M.isSameSession;$a.bn=M.payloadOrigin;$a.bo=M.payloadType;$a.bu=M.externalAppSource;$a.bx=M.indicationDisplayScheduled;$a.by=M.pasteIndicationDisplayStatus;$a.ck=M.pasteDestinationHasMergedCells;$a.bm=M.clipboardItems?M.clipboardItems.getItem(L.EYg):null;$a.bi=!M.isSameSession&&!M.wasLastCopyExternal;A.b().Ne(44,$a,!0)}Ij(){this.$.xa.Qf(this.Ih);
this.$.xa.PGg(this.Znc);this.$.userOperationManager.nr(this.rR);this.$.kl(this.dd);W.g(this.$).Xb.Vk(this.FFb)}mk(){this.$&&this.$.xa&&(this.$.xa.Eg(this.Ih),this.$.xa.Qbj(this.Znc));this.$&&this.$.userOperationManager&&this.$.userOperationManager.ho(this.rR);this.gridView&&this.gridView.Xb&&this.gridView.Xb.Ak(this.FFb)}sFb(M,$a){var ob=null;let Tb=!1;var Dc=null;let ad="UnknownFailure",ld=-1,md=Pb.psb,Wb=Pb.pasteErrorName+Pb.hJa,Nc=!1;this.pasteIndicationManager.lkd(M.id);this.pasteDestinationHasMergedCells(M.expandDestinations)&&
($a.pasteContext.pasteDestinationHasMergedCells=!0);const gd=O(this.GK);(M.clearStateOnFinish||M.clearSystemClipboard)&&this.ur("Paste/fail/"+l.a[M.ribbonCommandInfo.method],!0,void 0,void 0,M.copyPasteTargetType).catch(()=>{});if($a){ld=$a.reason;Wb+=Pb.zKa($a);$a.message&&(md=$a.message);if(ob=Pb.c4g($a))if(1===ob.pasteErrorName)Tb=!0,ad="CopyPasteLengthTooLongPopup",md=Dc="The pasted content is too long. Popup a dialog to the user.",d.ULS.sendTraceTag(25216992,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Dc}, copyPasteTargetType="${M.copyPasteTargetType}"`),
ob=wa.a.Yc(1,0,26,695,0,1306609195,"CopyPasteOversizeError"),r.EwaSettings.Dz()?new ua.a(this.$,ob):(ob=new ba.ErrorDialog(this.$,ob),ob.initialize(),ob.ig());else if(7===ob.pasteErrorName)Tb=!0,ad="No-Op",md=Dc="The shadow workbook is not ready yet and an async copy failed to populate the clipboard. Do nothing (by the spec)",d.ULS.sendTraceTag(33948251,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Dc}, copyPasteTargetType="${M.copyPasteTargetType}"`);else if(8===ob.pasteErrorName)Tb=!0,ad="UseShortcutsPopup",
md=Dc="Unable to paste content from the system clipboard. Popup dialog to the user.",d.ULS.sendTraceTag(25216994,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Dc}, copyPasteTargetType="${M.copyPasteTargetType}"`),this.$If();else if(18===ob.pasteErrorName){Tb=!0;ad="PasteExternalNotSupportMultipleSelectionPopup";md="Paste external not support multiple selection.";Dc="Unknown";var Gd=2190;100!==ob.validationFailureReason&&(Dc=Ba[ob.validationFailureReason],Gd=Pb.rDe(ob.validationFailureReason));this.wza(Gd,
Dc,!0)}else 20===ob.pasteErrorName||19===ob.pasteErrorName?(Tb=!0,20===ob.pasteErrorName?(ad="PasteAcrossSessionNotSupportMultipleSelectionPopup",md="Paste across session does not support multiple selection."):(ad="PasteInSameSessionNotSupportMultipleSelectionPopup",md="This kind of multiple selection is not supported for same session paste."),Dc="Unknown",Gd=2190,100!==ob.validationFailureReason&&(Dc=Ba[ob.validationFailureReason],Gd=Pb.rDe(ob.validationFailureReason)),ob=6===ob.validationFailureReason,
this.h_c(M.commandType,M.expandDestinations)&&ob&&this.Fvc(M.expandDestinations),this.wza(Gd,Dc,!0)):6===ob.pasteErrorName?(Tb=!0,ad="No-Op",md=Dc="Paste Formatting/Transpose is not yet a supported operation on System Clipboard based content",d.ULS.sendTraceTag(36263241,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Dc}, copyPasteTargetType="${M.copyPasteTargetType}"`)):17===ob.pasteErrorName?(Tb=!0,ad="No-Op",md=Dc="Paste text on Art is not yet a supported operation",d.ULS.sendTraceTag(0,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Dc}, copyPasteTargetType="${M.copyPasteTargetType}"`)):
16===ob.pasteErrorName?(Tb=!0,ad="No-Op",md=Dc="Paste has failed because the previous copy has failed",ob=this.getStringifiedError(ob),d.ULS.sendTraceTag(537167771,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Dc}, copyPasteTargetType="${M.copyPasteTargetType}", error=${ob}`)):wa.a.Dq(ob.ewaErrors)?(wa.a.W9(ob.ewaErrors)||wa.a.lh(ob.ewaErrors,wa.a.Ncc())?(Tb=!0,ad="CommunicationError",Dc=wa.a.xc(ob.ewaErrors),d.ULS.sendTraceTag(36304159,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${md} copyPasteTargetType="${M.copyPasteTargetType}"`)):
wa.a.lh(ob.ewaErrors,Pb.rkj)?(Tb=!0,ad="SavingWorkbookError",Dc=wa.a.xc(ob.ewaErrors),d.ULS.sendTraceTag(36304160,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${md} copyPasteTargetType="${M.copyPasteTargetType}"`)):wa.a.lh(ob.ewaErrors,Pb.operationSucceededWithAlert)&&(Nc=Tb=!0,ad="OperationSucceededWithAlert",Dc=wa.a.xc(ob.ewaErrors),d.ULS.sendTraceTag(36304161,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${md} copyPasteTargetType="${M.copyPasteTargetType}"`)),Tb||(md=this.bbc(ob.ewaErrors),Tb=this.Iod($a))):
11===ob.pasteErrorName&&(Tb=!0,ad="No-Op",md="Paste has failed because user try copy cross-session oart object");15===$a.reason&&(Tb=!0,ad="No-Op",md="Rejecting deferred paste there is metadata update without copy context. Usually it means that copy canceled before finished.");gb.a.equals(Wb,J.ZUj,!1)&&(Tb=!0,ad="No-Op",md="User hash of the copy is different then the user hash of the paste during cross-session copy-paste. Do nothing.")}Tb||(ob=$a?this.getStringifiedError($a):"null",d.ULS.sendTraceTag(24150916,
0,10,`CopyPasteInfrastructure.OnPasteFailed: ${ob}, copyPasteTargetType="${M.copyPasteTargetType}"`));this.Wvi(M,Tb,md,ad,Wb,ld,Nc,$a.pasteContext,gd);return Promise.reject($a)}xoc(M,$a){var ob;d.ULS.sendTraceTag(24150917,0,50,`CopyPasteInfrastructure.OnPasteSuccess: paste succeed. copyPasteTargetType="${$a.copyPasteTargetType}"`);this.pasteIndicationManager.lkd($a.id);if(this.FXi($a.copyPasteTargetType,M)){r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&
!k.a.xz&&M.wasLastCopyExternal&&M.payloadType===P.shadowWorkbook&&(this.A7a=!0);var Tb=null;(null===(ob=M.pastedRange)||void 0===ob?0:ob.Ranges)&&0<M.pastedRange.Ranges.length?Tb=T.g(M.pastedRange.Ranges):M.wasLastCopyExternal||(Tb=$a.expandDestinations);this.Zlj(M,Tb);if(this.jyj(M,Tb)){let Dc;this.Bbd?(ob=T.d($a.originalDestinations),Dc=1028===$a.commandType?T.d($a.expandDestinations):T.d(Tb)):(ob=u.a.clone($a.originalDestinations),Dc=1028===$a.commandType?u.a.clone($a.expandDestinations):u.a.clone(Tb));
let ad=null;M.wasLastCopyExternal&&($a.isKeyboardEvent||$a.isPasteCommandFromRecoveryUI)&&(ad={[Pb.PHf]:M.clipboardItems});this.pasteDestinationHasMergedCells($a.expandDestinations)&&(M.pasteDestinationHasMergedCells=!0);M.pasteRecoveryUIDisplayed=!0;const ld=new ta(this.$,ob,Dc,ad),md=ea.GetServiceTaskFactory.Sa(this.$.da,406,405,0);ca.TaskExtensions.Aa(md,()=>{const Wb=md.result;Wb.yPg(ld);Wb.wBj($a.ribbonCommandInfo.method)},this.la,8)}!M.pasteRecoveryUIDisplayed&&Tb.length&&(Tb=T.K(Tb),w.AFrameworkApplication.cI("XLS-SmartView-CutAndPaste-Treatment;XLS-SmartView-CutAndPaste-Control"),
r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.CutAndPasteEnabled",!1)&&Tb&&(ob=Qb.d(this.$.xa.oa),Tb=new mb.a(Tb,ob),this.vYd(Tb,"CutAndPaste")))}this.iAe("Paste/success/"+l.a[$a.ribbonCommandInfo.method],M);this.Xvi(M);this.U3f&&(!$a.isKeyboardEvent||Q(M))&&this.$.ea.Wg.get(66)&&(d.ULS.sendTraceTag(537167770,0,15,"CopyPasteInfrastructure.OnPasteSuccess: show localStorage disable notification"),this.U3f=!1,this.H5g());return Promise.resolve(!0)}jyj(M,$a){return!$a||1!==$a.length||
M.commandParameters.clearSystemClipboard||M.commandParameters.clearStateOnFinish||M.commandParameters.skipClipboardAccess?!1:H(M)&&($a=M.clipboardItems.getItem(L.plainText),M=M.clipboardItems.getItem(L.html),void 0===$a||null===$a||$a.length>this.yzi||void 0===M||null===M||M.length>this.pya)?(d.ULS.sendTraceTag(537167769,0,50,"CopyPasteInfrastructure.ShouldShowPasteRecoveryUI: Not showing PasteRecoveryUI for external copy."),!1):!0}FXi(M,$a){return 1===M||$a.payloadType===P.plainText||r.EwaSettings.ma(161)&&
$a.payloadType===P.html||r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!k.a.xz&&$a.payloadType===P.shadowWorkbook}pasteDestinationHasMergedCells(M){const $a=W.g(this.$).Ea.oF();if(!$a||!$a.length)return!1;for(const ob of $a)if(ob.qw(M[0]))return!0;return!1}iAe(M,$a){let ob;({pHa:ob}=this.bgi($a)).returnValue&&this.ur(M,ob,void 0,void 0,$a.commandParameters.copyPasteTargetType).catch(()=>{})}b$a(M,$a,ob,Tb,Dc,ad){var ld=M?this.getStringifiedError(M):
"null";d.ULS.sendTraceTag(24150918,0,10,`CopyPasteInfrastructure.OnDragAndDropCellsFailed: ${ld}`);let md=ld=!1,Wb=!1,Nc=Pb.psb,gd=Pb.DKe+Pb.hJa;M&&(gd+=Pb.zKa(M),wa.a.Dq(M.ewaErrors)?(Nc=this.bbc(M.ewaErrors),wa.a.lh(M.ewaErrors,Pb.operationSucceededWithAlert)&&(ld=!0),wa.a.lh(M.ewaErrors,Pb.dragDropNonEmptyRange)&&(md=Wb=!0)):M.message&&(Nc=M.message));Wb||(Wb=this.Iod(M));md?this.gridView.ha.selectionType=-1:this.Tp.i7i(Dc);this.Oui($a,ob,Tb,Dc,Wb,Nc,gd,ld,ad)}VZc(M,$a){let ob=M;const Tb=this.MRh();
if(null===Tb||void 0===Tb?0:Tb.ranges)ob=this.Tp.YUg($a,Tb.ranges,M);return ob}MRh(){const M=O(this.GK);return M&&D(M.sourceItem)?M.sourceItem:null}s4i(){this.raiseEvent(Pb.QCd,null)}Zlj(M,$a){const ob=M.commandParameters.originalDestinations;$a&&(T.Q(this.gridView.ha.sa.selectedRanges,ob)?(this.Fvc($a),M=xa.HelperMethods.uob($a),d.ULS.sendTraceTag(537167767,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range, range: ${M}`)):M.commandParameters.isPasteCommandFromRecoveryUI?
(this.Fvc($a,!0),d.ULS.sendTraceTag(537167766,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range for IsPasteCommandFromRecoveryUI, range: ${$a}, active cell: ${$a[0].topLeft}`)):(M=xa.HelperMethods.uob(ob),d.ULS.sendTraceTag(537167765,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: user change his selection during paste operation. don't change selection. originalPasteDestinations: ${M}`)))}bgi(M){if(M.isPlainTextPaste||M.isHtmlPaste||R(M)||M.commandParameters.isPasteCommandFromEnterShortcut)return{returnValue:!0,
pHa:!1};var $a=M.copyContextSnapshot;if(M.commandParameters.clearStateOnFinish)return{returnValue:!0,pHa:!0};if($a&&D($a.sourceItem)){var ob=$a.sourceItem;if(!ob.isFromCurrentSession(this.$))return{returnValue:!1,pHa:!0};$a=-1985798686===$a.commandParameters.ribbonCommandInfo.command;if(!(1<ob.ranges.length||1<M.commandParameters.expandDestinations.length)){const Tb=T.K(ob.ranges);M=T.K(M.commandParameters.expandDestinations);const Dc=this.$.ea.oa.sheetName;ob=ob.sheetName;if(ob===Dc&&M.equals(Tb))return{returnValue:!1,
pHa:!0};if(ob===Dc&&M.Ie(Tb))return{returnValue:!0,pHa:!1}}return{returnValue:$a,pHa:!0}}return{returnValue:!1,pHa:!0}}REf(){var M=O(this.GK);(M=this.Tp.xwb(M))&&M.isFromCurrentSession(this.$)&&this.ur("OnStartEdit",!1).catch(()=>{})}bbc(M){M=wa.a.tOh(M,Pb.hJa);return this.IAi+e.a.Zv(M).toString()}Iod(M){M=Pb.zKa(M);return!!M&&gb.a.w2a(M,Pb.HAi)}H5g(){const M=wa.a.Yc(1,2,332,333,k.a.yp?334:k.a.PH?335:336,530046625,"ActivateLocalStorage"),$a=ea.GetServiceTaskFactory.Sa(this.$.da,5,4,0);ca.TaskExtensions.Aa($a,
()=>{$a.result.Zf(43,M)},this.la,3)}zDe(M){return void 0===M||null===M?pa.ZDi:M?pa.success:pa.failed}static c4g(M){const $a=M.innerError;return $a&&0!==$a.pasteErrorName?M.innerError:null}static P3g(M){const $a=M.innerError;return $a&&0!==$a.copyErrorName?M.innerError:null}static zKa(M){let $a="";if(!M)return Pb.LHe;M.errorName&&($a=M.errorName,M.innerError&&($a+=Pb.hJa+Pb.zKa(M.innerError)));$a||($a=M&&M.name?M.name:Pb.LHe);return $a}static pac(){Pb.fS||(Y.a.ygf()?Pb.fS=ka.ICj:Y.a.Tpd()?Pb.fS=ka.HCj:
Pb.fS=ka.GCj);return Pb.fS}static rDe(M){switch(M){case 7:case 1:return 2197;case 5:return 2194;case 6:return 2193;case 8:case 3:case 2:case 4:case 9:case 10:return 2190;default:return d.ULS.shipAssertTag(537167764,0,!1,`CopyPasteInfrastructure.ConvertPasteValidationOptionToJsStringId: no case for validationOptions = ${M}`),2197}}static Q3g(M){switch(M){case 3:return 2191;case 1:return 2192;case 2:case 4:return 2190;default:return d.ULS.shipAssertTag(537167763,0,!1,`CopyPasteInfrastructure.ConvertCopySourceValidationOptionToJsStringId: no case for validationOptions = ${M}`),
2197}}vYd(M,$a){ca.TaskExtensions.Aa(ea.GetServiceTaskFactory.Sa(this.$.da,426,427,1),ob=>{void ob.result.sea(M,$a);d.ULS.sendTraceTag(512615303,0,50,"CopyPasteInfrastructure.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.la,3)}}Pb.Jrf="EwaJsMetadataChangeListenerId";Pb.QCd="cpiOSC";Pb.Zdh="cpiDID";Pb.psb="Unknown";Pb.LHe="UnknownError";Pb.hJa="_";Pb.DKe="DragAndDropError";Pb.pasteErrorName="PasteError";Pb.YVg="CancelError";Pb.copyErrorName="CopyError";
Pb.HAi="MergedCellOverlap";Pb.PHf="PasteRecoveryCachedClipboardItems";Pb.rkj=[1352631530,1679665408];Pb.operationSucceededWithAlert=[-103190598];Pb.pasteDataLimitHit=[1306609195];Pb.copyThrottlingError=[-386183710];Pb.dragDropNonEmptyRange=[563945982];Pb.fS=null;Object(c.a)(Pb,"CopyPasteInfrastructure",v.a,[304,305,10]);class gc{constructor(){this.w0a=this.uAe=null}}Object(c.a)(gc,"ClipboardPlatformInitializationResult",null,[]);var Xb=a(187),Ca=a(641),ra=a(554),ma=a(121),hb=a(5),vb=a(61);const Va=
(M,$a,ob,Tb,Dc,ad,ld,md,Wb,Nc=null)=>{Wb=M.Na(9,Wb);Wb.sourceRanges=$a;Wb.destinationRanges=ob;Wb.flags=Tb;return vb.g(M,"PasteRange",Wb,Dc,ad,ld,md,64,Nc)},db=(M,$a,ob,Tb,Dc,ad,ld,md=null)=>{ld=M.Na(1,ld);ld.pasteHtmlParameters=$a;return vb.g(M,"PasteHtmlContent",ld,ob,Tb,Dc,ad,64,md)},oa=(M,$a,ob,Tb,Dc,ad,ld,md,Wb=null)=>{md=M.Na(9,md);md.destinationRange=$a;md.source=ob;return vb.g(M,"PasteString",md,Tb,Dc,ad,ld,64,Wb)},Oa=(M,$a,ob,Tb,Dc,ad,ld=null,md=null)=>{ld=M.Na(1,ld);ld.copyParameters=$a;
return vb.g(M,"Copy",ld,ob,Tb,Dc,ad,0,md)},Wa=(M,$a,ob,Tb,Dc,ad,ld=null,md=null)=>{ld=M.Na(1,ld);ld.copyParameters=$a;return vb.g(M,"Cut",ld,ob,Tb,Dc,ad,0,md)},Sa=(M,$a,ob,Tb,Dc,ad,ld=null,md=null)=>{ld=M.Na(1,ld);ld.pasteParameters=$a;return vb.g(M,"Paste",ld,ob,Tb,Dc,ad,64,md)};class yb{constructor(M,$a,ob){this.destinationRange=this.sourceRange=null;this.pasteFlags=0;this.sourceRange=M;this.destinationRange=$a;this.pasteFlags=ob}}Object(c.a)(yb,"MacroRecorderPasteRangePayload",null,[115]);class Ma{constructor(M,
$a){this.content=this.destinationRange=null;this.destinationRange=M;this.content=$a}getContent(){return this.content}}Object(c.a)(Ma,"MacroRecorderPasteStringPayload",null,[115]);class Bb{constructor(M){this.pasteParameters=null;this.pasteParameters=M}}Object(c.a)(Bb,"MacroRecorderPastePayload",null,[115]);var Nb=a(585),Ia=a(762),jb=a(515),Ob=a(171),Jb=a(208),Kb=a(116),Qa=a(281);const ha=(M,$a,ob,Tb,Dc,ad,ld=null)=>{ld=M.Na(41,ld);ld.insertCopiedCutCellsParameters=$a;return vb.g(M,"InsertCopiedCutCells",
ld,ob,Tb,Dc,ad,4)},qa=(M,$a,ob,Tb,Dc,ad,ld=null)=>{ld=M.Na(41,ld);ld.insertCopiedCutCellsParameters=$a;return vb.g(M,"InsertCopiedCutCellsV2",ld,ob,Tb,Dc,ad,0)};class pb{constructor(M){this.parameters=null;this.parameters=M}getParameters(){return this.parameters}}Object(c.a)(pb,"MacroRecorderRangeCopyCutCellsInsertedPayload",null,[115]);var bb=a(370);class eb{constructor(M,$a,ob,Tb,Dc,ad,ld,md,Wb){this.destinationRange=M;this.irb=ob;this.yXi=Tb;this.Jd=Dc;this.JPb=ad;this.pasteContext=ld;this.E2b=
md;this.Gag=Wb}}Object(c.a)(eb,"PasteHtmlRequestParams",null,[]);class Fa{constructor(M,$a){this.ljc=this.FNa=null;this.NPa=na.a.NPa;this.eEd=na.a.eEd;this.fDb=na.a.fDb;this.hgc=r.EwaSettings.getBooleanFeatureGate(na.a.i5b,!1);this.rpd=na.a.rpd;this.fnd=!1;this.gxa=r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);this.Nz=(ob,Tb)=>{if(2===Tb.Vq)this.xv.clear(),this.FNa=null;else if(1===Tb.Vq&&this.xv&&this.xv.contains(Tb.zf)){ob=ma.a(Tb.zf.operation.operationName);
const Dc=Tb.zf.dequeueUtcTime.getTime()-Tb.zf.enqueueUtcTime.getTime();d.ULS.sendTraceTag(526758673,0,50,`CopyPasteUtils.OnQueueChanged: web method ${ob} returned, it took ${Dc} milliseconds to complete.`);this.xv.remove(Tb.zf);this.FNa=null}};this.$=M;this.gridView=$a;this.fnd&&(this.$.userOperationManager.nr(this.Nz),this.xv=new Xb.a)}get pya(){return this.gxa?r.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",this.$.ya.CopyPasteMaxPayloadLength):y.a.pya}copy(M,
$a,ob,Tb=null,Dc=null){const ad=this.$.pa.va.Tb();this.fnd&&this.RX();var ld=(md,Wb,Nc)=>{const gd={CopyPasteTargetType:1};gd.SourceRanges=M;gd.CopyOperationId=$a.id;d.ULS.sendTraceTag(537167756,0,50,`CopyPasteInfrastructure.Copy served from CopyPasteProxy : ${this.gxa}, CopyOperationId : ${gd.CopyOperationId}`);return this.FNa=this.gxa?Oa(this.$.pa.dw,gd,Qa.b(md,ob),Tb?Qa.a(Wb,Tb):Wb,Nc,$a.ribbonCommandInfo,ad,Dc):Oa(this.$.pa.va,gd,Qa.b(md,ob),Tb?Qa.a(Wb,Tb):Wb,Nc,$a.ribbonCommandInfo,ad,Dc)};this.ljc=
ad.ClientRequestId;ld=r.EwaSettings.$b()?new Ob.a(505,0,ld,80):new jb.a(505,0,ld,16);ld=this.$.userOperationManager.Wb(ld,$a.ribbonCommandInfo);this.fnd&&this.xv.add(ld)}OHf(M,$a,ob,Tb,Dc,ad){return new Promise((ld,md)=>{var Wb;const Nc=ad.commandParameters.stopwatch.yc;let gd=2;20===ad.commandParameters.commandType&&(gd=16);36===ad.commandParameters.commandType&&(gd=32);Y.a.Tpd()&&68===ad.commandParameters.commandType&&(gd=64);Y.a.usd(this.$)&&1028===ad.commandParameters.commandType&&(gd=1024);let Gd=
null;if(null===(Wb=ad.copyContextSnapshot)||void 0===Wb?0:Wb.commandParameters)Gd=ad.copyContextSnapshot.commandParameters.id;Fa.POd(this.$,M,Tb,$a,ob,null,Zd=>{Fa.ndc(Zd,ad,ld,md,Nc,this.$,null,!0,null,null)},Zd=>{ad.serverRequestTimeInMs=ad.commandParameters.stopwatch.yc-Nc;Zd=Kb.a.ff(Zd.data);md(new Ia.a(5,Zd))},Dc,gd,Gd,ad.commandParameters.id)})}pasteRange(M,$a,ob,Tb,Dc,ad,ld,md,Wb,Nc){return new Promise((gd,Gd)=>{const Zd=ld.commandParameters.stopwatch.yc;Fa.hnj(this.$,M,$a,ob,Tb|-5&Dc,xe=>
{Fa.ndc(xe,ld,gd,Gd,Zd,this.$,null,!0,Wb,Nc)},xe=>{ld.serverRequestTimeInMs=ld.commandParameters.stopwatch.yc-Zd;xe=Kb.a.ff(xe.data);xe=new Ia.a(5,xe);null===Nc||void 0===Nc?void 0:Nc(xe);Gd(xe)},ad,md)})}C1i(M,$a,ob,Tb,Dc,ad,ld){return(new Promise((md,Wb)=>{if($a)if($a.length>this.pya){var Nc=ld.clipboardItems.getItem(L.plainText);let gd=-1;void 0!==Nc&&null!==Nc&&(gd=Nc.length);na.a.Aef&&$a.length<this.eEd&&$a.length>this.NPa&&(this.TIf($a),this.OV=new eb(M,$a,ob,Tb,Dc,ad,ld,0,this.Zpc.length),
window.requestIdleCallback&&window.requestIdleCallback(()=>this.uEd()));d.ULS.sendTraceTag(42071712,0,15,`CopyPasteInfrastructure.ProcessPasteHtml copy paste length too long. clipboardHtml.Length: ${$a.length}, MaxHtmlImportLength: ${this.pya}, PlainTextLength: ${gd}`);Wb(new Ia.a(1))}else Nc=(gd,Gd,Zd)=>{this.$.Ay();const xe=ld.commandParameters.stopwatch.yc;gd=Qa.b(gd,Bf=>{Fa.ndc(Bf,ld,md,Wb,xe,this.$,$a,!1,null,null)});Gd=Qa.a(Gd,Bf=>{ld.serverRequestTimeInMs=ld.commandParameters.stopwatch.yc-
xe;Bf=Kb.a.ff(Bf.data);Wb(new Ia.a(3,Bf))});const Re=this.$.pa.va.Tb(),Ue=T.v(M,this.$),jf={};jf.SourceHtml=$a;jf.DestinationRanges=Ue?T.s(Ue):null;jf.CopyOperationId=ob;jf.PasteId=Tb;d.ULS.sendTraceTag(537167755,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.gxa}. PasteId : ${jf.PasteId}`);return this.gxa?db(this.$.pa.dw,jf,gd,Gd,Zd,null,Re,ad):db(this.$.pa.va,jf,gd,Gd,Zd,null,Re,ad)},Nc=r.EwaSettings.$b()?new Ob.a(204,0,Nc,65):new jb.a(204,0,Nc,1),this.$.userOperationManager.Wb(Nc,
Dc);else md("")})).then(()=>{na.a.Aef&&$a.length>this.NPa&&(this.TIf($a),this.OV=new eb(M,$a,ob,Tb,Dc,ad,ld,0,this.Zpc.length),window.requestIdleCallback&&window.requestIdleCallback(()=>this.uEd()))})}TIf(M){const $a=this.$.Jb.Bc("Task","pasteHtmlChunkOperation"),ob=Math.floor(M.length/this.NPa)+1;this.Zpc=Array(ob);let Tb=0;for(;Tb<ob;)this.Zpc[Tb]=M.substring(Tb*this.NPa,(Tb+1)*this.NPa),Tb++;d.ULS.sendTraceTag(523257954,0,50,`CopyPasteUtils.populatePasteChunks Time taken for chunking: ${$a.yc}`)}uEd(){this.xXi(this.OV.destinationRange,
this.Zpc[this.OV.E2b],this.OV.irb,this.OV.yXi,this.OV.Jd,this.OV.JPb,this.OV.pasteContext,this.OV.E2b,this.OV.Gag);this.OV.E2b++;this.OV.E2b<this.OV.Gag&&window.requestIdleCallback(()=>this.uEd())}xXi(M,$a,ob,Tb,Dc,ad,ld,md,Wb){var Nc=(gd,Gd,Zd)=>{const xe=ld.commandParameters.stopwatch.yc;gd=Qa.b(gd,()=>{d.ULS.sendTraceTag(512313415,0,15,`CopyPasteUtils.pasteHtmlServerCall succeeded serverRequestTimeInMs:${ld.commandParameters.stopwatch.yc-xe},
             pasteid:${Tb},
             chunkIndex:${md},
             totalChunks:${Wb}`)});Gd=Qa.a(Gd,()=>{ld.serverRequestTimeInMs=ld.commandParameters.stopwatch.yc-xe;d.ULS.sendTraceTag(512313414,0,15,`CopyPasteUtils.pasteHtmlServerCall failed serverRequestTimeInMs:${ld.serverRequestTimeInMs},
               pasteid:${Tb},
               chunkIndex:${md},
               totalChunks:${Wb}`)});const Re=this.$.pa.va.Tb();var Ue=T.v(M,this.$);Ue={SourceHtml:$a,DestinationRanges:Ue?T.s(Ue):null,CopyOperationId:ob,PasteId:`${Tb}_chunk_${md}`,ChunkIndex:md,TotalChunks:Wb};d.ULS.sendTraceTag(523257952,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.gxa}. PasteId : ${Ue.PasteId}`);return db(this.$.pa.dw,Ue,gd,Gd,Zd,null,Re,ad)};Nc=r.EwaSettings.$b()?new Ob.a(204,0,Nc,65):new jb.a(204,0,Nc,1);this.$.userOperationManager.Wb(Nc,
Dc)}D1i(M,$a,ob,Tb,Dc){return new Promise((ad,ld)=>{d.ULS.sendTraceTag(537167754,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: method start. pasteContext.Id=${Dc.id}`);$a&&($a=gb.a.trimEnd($a,"\n","\r"));d.ULS.sendTraceTag(537167753,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after clipboardText.TrimEnd. pasteContext.Id=${Dc.id}`);if($a)if($a.length>this.fDb)d.ULS.sendTraceTag(24150921,0,15,"CopyPasteInfrastructure.ProcessPasteText copy paste length too long. clipboardText.Length: {0}, MaxCopyPasteLength: {1}",
$a.length,this.fDb),ld(new Ia.a(1));else{let Wb,Nc;const gd=T.v(M,this.$);d.ULS.sendTraceTag(537167752,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before treatAsLink calculation. pasteContext.Id=${Dc.id}`);var md=!this.$.ea.isNamedObjectViewMode&&!$a.includes("\n")&&!$a.includes("\t");d.ULS.sendTraceTag(537167751,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before isLink check. pasteContext.Id=${Dc.id}. treatAsLink=${md}`);md=md&&gb.a.$ff($a);d.ULS.sendTraceTag(537167750,
0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after treatAsLink calculation. pasteContext.Id=${Dc.id}. treatAsLink=${md}`);const Gd=this.$.pa.va.Tb();if(md){Nc=526;d.ULS.sendTraceTag(537167749,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before FixUpUrl. pasteContext.Id=${Dc.id}`);const Zd=Jb.a.Dbd($a);d.ULS.sendTraceTag(537167748,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after FixUpUrl. pasteContext.Id=${Dc.id}`);const xe=T.s(gd);md=(Re,
Ue,jf)=>{const Bf=Dc.commandParameters.stopwatch.yc;Re=Qa.b(Re,Ae=>{d.ULS.sendTraceTag(537167747,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on ApplyHyperlink successCallback. pasteContext.Id=${Dc.id}`);Dc.requestTelemetryData=Ae.RequestTelemetryData;Dc.serverRequestTimeInMs=Dc.commandParameters.stopwatch.yc-Bf;Ae.Errors&&0<Ae.Errors.length?ld(new Ia.a(2,Ae.Errors)):ad($a)});Ue=Qa.a(Ue,Ae=>{Dc.serverRequestTimeInMs=Dc.commandParameters.stopwatch.yc-Bf;Ae=Kb.a.ff(Ae.data);ld(new Ia.a(2,
Ae))});this.$.Ay();d.ULS.sendTraceTag(537167746,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before ApplyHyperlink. pasteContext.Id=${Dc.id}`);return vb.b(this.$.pa.va,xe,$a,Zd,!1,!1,63,Re,Ue,jf,M,Gd,Tb)};Wb=()=>new Nb.a(xe,$a,Zd)}else Nc=180,md=(Zd,xe,Re)=>{this.$.Ay();const Ue=Dc.commandParameters.stopwatch.yc;Zd=Qa.b(Zd,jf=>{d.ULS.sendTraceTag(537167745,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on PasteString successCallback. pasteContext.Id=${Dc.id}`);
Fa.ndc(jf,Dc,ad,ld,Ue,this.$,$a,!1,null,null)});xe=Qa.a(xe,jf=>{Dc.serverRequestTimeInMs=Dc.commandParameters.stopwatch.yc-Ue;jf=Kb.a.ff(jf.data);ld(new Ia.a(4,jf))});d.ULS.sendTraceTag(537167744,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before PasteString. pasteContext.Id=${Dc.id}`);return oa(this.$.pa.va,gd,$a,Zd,xe,Re,null,Gd,Tb)},Wb=()=>new Ma(gd,$a);d.ULS.sendTraceTag(537167715,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before UserNonBlockingWebMethodOperation. pasteContext.Id=${Dc.id}`);
md=r.EwaSettings.$b()?new Ob.a(Nc,0,md,65,Wb):new jb.a(Nc,0,md,1,Wb);d.ULS.sendTraceTag(537167714,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: returning. pasteContext.Id=${Dc.id}`);this.$.userOperationManager.Wb(md,ob)}else ad("")})}C9e(M,$a){$a=[1===$a?4:5];this.gridView.ob.Ww(mb.a.mea(Qb.d(this.$.oa),M),$a,!0);this.gridView.ob.Jn($a);this.gridView.ob.update(!0)}Udc(){const M=[4,5];this.gridView.ob.Pg(M,!1,!1);this.gridView.ob.zi(null,M,!1);1===this.gridView.ha.Me&&this.gridView.Jn(!1,
!1);this.gridView.ob.update(!1,!1)}YUg(M,$a,ob){const Tb=[];for(const Dc of ob)Tb.push(this.aVg(M,$a,Dc));return Tb}RX(){if(this.xv)for(let M of this.xv)if(this.$&&this.$.userOperationManager){if(M.operation){const $a=ma.a(M.operation.operationName);d.ULS.sendTraceTag(526758675,0,50,`CopyPasteUtils.AbortOutstandingUserOperation: Trying to abort pending operation ${$a}.`)}this.WVg();this.$.userOperationManager.Rta(M)}}WVg(){if(this.FNa){const M=this.FNa.Yt;d.ULS.sendTraceTag(526758674,0,15,`Cancelling pending copy request with Id=${M}`);
Kb.a.Du(M);!r.EwaSettings.isChangeGateEnabled("OfficeVSO:6151555_DisableCancelCopyRequest")&&this.ljc&&vb.h(this.$.pa.va,this.ljc,null,null,null);this.ljc=this.FNa=null}}aVg(M,$a,ob){d.ULS.shipAssertTag(537167713,0,!!$a,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray shouldn't be null");d.ULS.shipAssertTag(537167712,0,0<$a.length,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray length shouldn't be zero");let Tb=0,Dc=0;var ad=new Set;const ld=new Set;for(const md of $a){$a=`${md.left}_${md.right}`;
const Wb=`${md.top}_${md.bottom}`;ld.has($a)||(ld.add($a),Dc+=md.width);ad.has(Wb)||(ad.add(Wb),Tb+=md.height)}if(36===M)return ob.isSingle?Fa.GSe(Dc,Tb,ob):ob.clone();516===M&&(M=Tb,Tb=Dc,Dc=M);M=!(ob.width%Dc)&&!(ob.height%Tb);ad=ob.VZ&&!(ob.height%Tb);ob.o5&&!(ob.width%Dc)||ad?ob=Fa.GSe(Dc,Tb,ob):M?ob=ob.clone():(ob=ob.clone(),ob.bottom=Math.min(y.a.eh,ob.top+Tb-1),ob.right=Math.min(y.a.ph,ob.left+Dc-1));return ob}CMg(M,$a,ob,Tb,Dc,ad,ld,md,Wb,Nc,gd){if(!Tb||!Tb.length)return 1;if(1<Tb.length){if(!this.hgc&&
ad)return 3;if(Nc)return 0;if(md)return 9;if(Wb)return 8;if(gd)return 2;if(1<$a.length)return 4;const Gd=$a[0];if(!ld&&!u.a.all(Tb,Zd=>Zd.isSingle||!(Zd.width%Gd.width)&&!(Zd.height%Gd.height)))return 5;if((!this.hgc||!ad)&&gb.a.equals(M,ob,!0))for(const Zd of Dc)if(Zd.Bd(Gd)&&!Zd.equals(Gd))return 6}else if($a&&0<$a.length){if(0!==this.Gdf($a,Wb))return 7;if(1<$a.length){if(!this.hgc&&ad)return 3;if((!this.hgc||!ad)&&gb.a.equals(M,ob,!0))for(const Gd of $a)if(M=Dc[0],Gd.Bd(M)&&!Gd.equals(M))return 6}}return 0}Gdf(M,
$a){if(!M||1>=M.length)return 0;if($a)return 2;if(!T.S(M))return 1;$a=new Ca.a(ra.a.Zk());for(const ob of M)for(const Tb of M){const Dc=ob.top===Tb.top&&ob.bottom===Tb.bottom,ad=ob.left===Tb.left&&ob.right===Tb.right,ld=Math.max(ob.left,Tb.left)<Math.min(ob.right,Tb.right);if(Math.max(ob.top,Tb.top)<Math.min(ob.bottom,Tb.bottom)&&!Dc||ld&&!ad)return 3;$a.add(`${ob.top}-${ob.bottom}-${Tb.left}-${Tb.right}`);$a.add(`${Tb.top}-${Tb.bottom}-${ob.left}-${ob.right}`)}for(const ob of M)$a.remove(`${ob.top}-${ob.bottom}-${ob.left}-${ob.right}`);
return 0<$a.count?3:0}i7i(M){const $a=this.gridView.ha;$a.updateSelection(M,M.topLeft,0);$a.selectionType=-1}xwb(M){if(null===M||void 0===M?0:M.sourceItem){if(!D(M.sourceItem))return null;if((M=M.sourceItem)&&T.cb(M.ranges,!0))return M}return null}Lgc(M,$a){d.ULS.shipAssertTag(537167711,0,!!M,"CopyPasteUtils.IsFromKeyboardShortcut: commandInfo shouldn't be null");return $a&&hb.a.nG in $a||M.tabName?!1:1===M.method}static hnj(M,$a,ob,Tb,Dc,ad,ld,md,Wb){const Nc=M.pa.va.Tb(Wb?{j_:!0,AZ:1}:{j_:!1,AZ:0});
Wb=(Gd,Zd,xe)=>{M.Ay();return Va(M.pa.va,ob,Tb,Dc,Qa.b(Gd,ad),Qa.a(Zd,ld),xe,null,Nc,md)};const gd=()=>new yb(ob,Tb,Dc);Wb=r.EwaSettings.$b()?new Ob.a(506,0,Wb,65,gd):new jb.a(506,0,Wb,1,gd);M.userOperationManager.Wb(Wb,$a)}static ndc(M,$a,ob,Tb,Dc,ad,ld=null,md,Wb,Nc){d.ULS.sendTraceTag(537167710,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: on HandlePasteResult start. pasteContext.Id=${$a.id}`);$a.requestTelemetryData=M.RequestTelemetryData;$a.serverRequestTimeInMs=$a.commandParameters.stopwatch.yc-
Dc;wa.a.ug(M.Errors)?wa.a.Wga(M.Errors)?($a&&($a.encounteredDeploymentErrors=!0),M=wa.a.xc(M.Errors),d.ULS.sendTraceTag(537167707,0,15,`CopyPasteUtils.HandlePasteServerResponse: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${M}`)):(M=new Ia.a(5,M.Errors),null===Nc||void 0===Nc?void 0:Nc(M),Tb(M)):M.Result?(Tb=!!M&&!!M.RequestTelemetryData,W.g(ad).Pi.vla($a.commandParameters.stopwatch.id,M.StateId,Tb?M.RequestTelemetryData.EcsOperationDuration:0,Tb?M.RequestTelemetryData.EcsRequestDuration:
0,Tb?M.RequestTelemetryData.WfeRequestDuration:0),$a.pastedRange=M.Result.SheetMultiRange,d.ULS.sendTraceTag(537167708,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise ewaResult.Result is not null. pasteContext.Id=${$a.id}`),null===Wb||void 0===Wb?void 0:Wb(),ob(!0),r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)&&md&&($a=$a.commandParameters.isDragDrop?9:6,(ad=ad.da.za(465))&&ad.R0($a,M))):
(d.ULS.sendTraceTag(537167709,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise when ewaResult.Result is null. pasteContext.Id=${$a.id}`),ob(ld||!0))}static POd(M,$a,ob,Tb,Dc,ad,ld,md,Wb,Nc,gd,Gd){const Zd=M.pa.va.Tb(),xe=Fa.I9g(ob,Tb,Dc,Nc,gd,Gd);ob=(Re,Ue,jf)=>{M.Ay();return Sa(M.pa.va,xe,Qa.b(Re,ld),Qa.a(Ue,md),jf,ad,Zd,Wb)};Tb=()=>new Bb(xe);ob=r.EwaSettings.$b()?new Ob.a(503,0,ob,65,Tb):new jb.a(503,0,ob,1,Tb);M.userOperationManager.Wb(ob,$a)}static I9g(M,$a,
ob,Tb,Dc,ad){const ld={};ld.ShadowWorkbookBase64=M.shadowWorkbookBase64;ld.SourceRanges={};ld.SourceRanges.Ranges=Array(1);ld.SourceRanges.Ranges[0]={};ld.SourceRanges.Ranges[0].FirstRow=M.rangeRowStart;ld.SourceRanges.Ranges[0].LastRow=M.rangeRowEnd;ld.SourceRanges.Ranges[0].FirstColumn=M.rangeColumnStart;ld.SourceRanges.Ranges[0].LastColumn=M.rangeColumnEnd;r.EwaSettings.getBooleanFeatureGate(na.a.i5b,!1)?ob?ld.DestinationRanges=T.u(ob.SheetName,ob.NamedObjectName,T.g(ob.Ranges)):(d.ULS.sendTraceTag(537167706,
0,15,"CopyPasteInfrastructure.CreatePasteParameters: multiRangeDestination is null"),ld.DestinationRanges=null):ld.DestinationRanges=$a?T.s($a):null;ld.CopyPasteTargetType=1;ld.PasteType=Tb;ld.CopyOperationId=Dc;ld.PasteId=ad;ld.SourceClientPath=M.sourceClientPath;ld.SourceSheetName=M.sourceSheetName;ld.SourceWorkbookName=M.sourceWorkbookName;if(!M.originalSourceRangesCountExceedsLimit&&M.originalSourceRanges&&0<M.originalSourceRanges.length&&1024===Tb){ld.OriginalSourceMultiRange={};$a=Array(M.originalSourceRanges.length);
for(ob=0;ob<$a.length;++ob)$a[ob]={},$a[ob].FirstRow=M.originalSourceRanges[ob][0],$a[ob].FirstColumn=M.originalSourceRanges[ob][1],$a[ob].LastRow=M.originalSourceRanges[ob][2],$a[ob].LastColumn=M.originalSourceRanges[ob][3];ld.OriginalSourceMultiRange.Ranges=$a}return ld}static GSe(M,$a,ob){ob=ob.clone();ob.height<$a&&(ob.bottom=Math.min(y.a.eh,ob.top+$a-1));ob.width<M&&(ob.right=Math.min(y.a.ph,ob.left+M-1));return ob}executeInsertCopiedCutCellsOperation(M,$a,ob,Tb,Dc,ad=null,ld=null,md=!1){const Wb=
{};Wb.InsertDirection=Tb;Wb.SourceRange=M;Wb.DestRange=$a;Wb.CopyCutOperation=ob?0:1;const Nc=this.$.pa.va,gd=this.$.pa.va.Tb(),Gd=()=>new pb(Wb);return bb.a(this.$.userOperationManager,(Zd,xe,Re)=>this.rpd&&md?qa(Nc,Wb,ad?Qa.b(Zd,ad):Zd,ld?Qa.a(xe,ld):xe,Re,gd):ha(Nc,Wb,ad?Qa.b(Zd,ad):Zd,ld?Qa.a(xe,ld):xe,Re,null),Zd=>new Ob.a(104,0,Zd,void 0,Gd),Dc)}HKe(M,$a,ob,Tb,Dc,ad,ld,md){return new Promise((Wb,Nc)=>{this.executeInsertCopiedCutCellsOperation($a,ob,Tb,Dc,ad,gd=>{M.requestTelemetryData=gd.RequestTelemetryData;
if(gd.Errors&&0<gd.Errors.length){const Gd=new Ia.a(21,gd.Errors);null===md||void 0===md?void 0:md(Gd);Nc(new Ia.a(21,gd.Errors))}else null===ld||void 0===ld?void 0:ld(),Wb(!0)},gd=>{gd=Kb.a.ff(gd.data);gd=new Ia.a(21,gd);null===md||void 0===md?void 0:md(gd);Nc(gd)},!0)})}}Object(c.a)(Fa,"CopyPasteUtils",null,[278]);var tb=a(492),dc;(function(M){M[M.range=0]="range";M[M.art=1]="art"})(dc||(dc={}));Object(c.b)("SourceItemType",dc);var jc=a(24),fb=a(90);class ec{constructor(M){this.o8f={["SourceItemType.Range"]:0,
["SourceItemType.Art"]:1};this.gNb={};this.k8f={["FloatingObjectType.Unknown"]:99,["FloatingObjectType.CardView"]:6,["FloatingObjectType.Chart"]:0,["FloatingObjectType.Group"]:7,["FloatingObjectType.Image"]:1,["FloatingObjectType.Ink"]:8,["FloatingObjectType.InteractiveReport"]:4,["FloatingObjectType.ModernOfficeExtension"]:3,["FloatingObjectType.Shape"]:5,["FloatingObjectType.Slicer"]:2,["FloatingObjectType.Unsupported"]:100};this.DXc={["99"]:"FloatingObjectType.Unknown",["6"]:"FloatingObjectType.CardView",
["0"]:"FloatingObjectType.Chart",["7"]:"FloatingObjectType.Group",["1"]:"FloatingObjectType.Image",["8"]:"FloatingObjectType.Ink",["4"]:"FloatingObjectType.InteractiveReport",["3"]:"FloatingObjectType.ModernOfficeExtension",["5"]:"FloatingObjectType.Shape",["2"]:"FloatingObjectType.Slicer",["100"]:"FloatingObjectType.Unsupported"};this.n8f={["RibbonCommand.Copy"]:-911352779,["RibbonCommand.Cut"]:-1985798686};this.XMd={["-911352779"]:"RibbonCommand.Copy",["-1985798686"]:"RibbonCommand.Cut"};this.m8f=
{["InputManager.InputMethod.NotDefined"]:-1,["InputManager.InputMethod.Unknown"]:0,["InputManager.InputMethod.Keyboard"]:1,["InputManager.InputMethod.Mouse"]:2,["InputManager.InputMethod.Touch"]:3,["InputManager.InputMethod.CrossSlide"]:9};this.nka={};this.l8f={["FrameMode.None"]:0,["FrameMode.Reading"]:1,["FrameMode.Edit"]:2};this.B3a={};this.p8f={["UILocation.Unknown"]:0,["UILocation.UpperRibbon"]:1,["UILocation.Ribbon"]:2,["UILocation.QAT"]:3,["UILocation.Jewel"]:4,["UILocation.NavigationPane"]:5,
["UILocation.KeyboardShortcut"]:6,["UILocation.StatusBar"]:7,["UILocation.Dialog"]:8,["UILocation.Floatie"]:9,["UILocation.NotificationBar"]:10,["UILocation.StandaloneCuiRoot"]:11,["UILocation.TaskPane"]:12,["UILocation.HeroDock"]:13,["UILocation.SingleLineRibbon"]:14,["UILocation.MultilineRibbon"]:15,["UILocation.Overflow"]:16,["UILocation.TellMe"]:17,["UILocation.FarPeripheralControls"]:18,["UILocation.ContextMenu"]:19,["UILocation.DialogMenu"]:20,["UILocation.Header"]:21,["UILocation.FileMenu"]:22,
["UILocation.Toolbar"]:26,["UILocation.Canvas"]:30};this.Lr={};this.$=M;this.nka.notDefined="InputManager.InputMethod.NotDefined";this.nka.unknown="InputManager.InputMethod.Unknown";this.nka.keyboard="InputManager.InputMethod.Keyboard";this.nka.mouse="InputManager.InputMethod.Mouse";this.nka.touch="InputManager.InputMethod.Touch";this.nka.crossSlide="InputManager.InputMethod.CrossSlide";this.B3a.none="FrameMode.None";this.B3a.reading="FrameMode.Reading";this.B3a.edit="FrameMode.Edit";this.Lr.unknown=
"UILocation.Unknown";this.Lr.upperRibbon="UILocation.UpperRibbon";this.Lr.ribbon="UILocation.Ribbon";this.Lr.QAT="UILocation.QAT";this.Lr.jewel="UILocation.Jewel";this.Lr.navigationPane="UILocation.NavigationPane";this.Lr.keyboardShortcut="UILocation.KeyboardShortcut";this.Lr.statusBar="UILocation.StatusBar";this.Lr.dialog="UILocation.Dialog";this.Lr.floatie="UILocation.Floatie";this.Lr.notificationBar="UILocation.NotificationBar";this.Lr.standaloneCuiRoot="UILocation.StandaloneCuiRoot";this.Lr.taskPane=
"UILocation.TaskPane";this.Lr.heroDock="UILocation.HeroDock";this.Lr.singleLineRibbon="UILocation.SingleLineRibbon";this.Lr.multilineRibbon="UILocation.MultilineRibbon";this.Lr.overflow="UILocation.Overflow";this.Lr.tellMe="UILocation.TellMe";this.Lr.farPeripheralControls="UILocation.FarPeripheralControls";this.Lr.header="UILocation.Header";this.Lr.fileMenu="UILocation.FileMenu";this.Lr.contextMenu="UILocation.ContextMenu";this.Lr.dialogMenu="UILocation.DialogMenu";this.Lr.toolbar="UILocation.Toolbar";
this.Lr.canvas="UILocation.Canvas";this.gNb.range="SourceItemType.Range";this.gNb.art="SourceItemType.Art"}serializeSourceItem(M){const $a={};if(M&&Object.getType(M)===G)$a.sheetName=M.sheetName,$a.topArray=u.a.map(M.ranges,ob=>ob.top),$a.leftArray=u.a.map(M.ranges,ob=>ob.left),$a.bottomArray=u.a.map(M.ranges,ob=>ob.bottom),$a.rightArray=u.a.map(M.ranges,ob=>ob.right),$a.sessionStateId=M.sessionStateId,$a.sessionId=M.sessionId,$a.sourceItemType=this.mZf(0);else if(M&&Object.getType(M)===U)$a.activeFloatingObjectControlId=
M.activeFloatingObjectControlId,$a.sheetName=M.sheetName,$a.sessionStateId=M.sessionStateId,$a.sessionId=M.sessionId,$a.floatingObjectType=this.Knj(M.type),$a.sourceItemType=this.mZf(1);else return d.ULS.shipAssertTag(537167705,0,!1,"EnvironmentSerializationHelper.SerializeSourceItem: sourceItem shouldn't be null."),null;return JSON.stringify($a)}serializeCommandParameters(M){if(!M)return d.ULS.shipAssertTag(537167704,0,!1,"EnvironmentSerializationHelper.Serialize: commandParameters shouldn't be null."),
null;const $a={};$a.id=M.id;$a.commandType=M.commandType;$a.copyPasteTargetType=M.copyPasteTargetType;M.ribbonCommandInfo&&($a.ribbonCommandName=this.Tnj(M.ribbonCommandInfo.command),$a.inputMethodName=this.Nnj(M.ribbonCommandInfo.method),$a.frameModeName=this.Lnj(M.ribbonCommandInfo.mode),$a.uiLocationName=this.Xnj(M.ribbonCommandInfo.Re),$a.tabName=M.ribbonCommandInfo.tabName);return JSON.stringify($a)}deserializeSourceItem(M){if(!M)return null;try{const $a=JSON.parse(M);if(!$a)return d.ULS.shipAssertTag(537167703,
0,!1,"EnvironmentSerializationHelper.Deserialize: Json.Parse return null result."),null;let ob=null;switch(this.dfh($a.sourceItemType)){case 0:ob=new G(this.$,this.afh($a),$a.sheetName,$a.sessionStateId,$a.sessionId);break;case 1:ob=new U($a.activeFloatingObjectControlId,$a.sheetName,$a.sessionStateId,$a.sessionId,this.Yeh($a.floatingObjectType))}return ob}catch($a){return d.ULS.sendTraceTag(537167702,0,10,`EnvironmentSerializationHelper.DeserializeSourceItem: got exception while try to JSON.Parse string length: ${M?
M.length:0}, errror: ${$a}`),null}}deserializeCommandParameters(M){if(!M)return null;try{const $a=JSON.parse(M);if(!$a)return d.ULS.shipAssertTag(537167701,0,!1,"EnvironmentSerializationHelper.DeserializeCommandParameters: Json.Parse return null result."),null;const ob=Na.a();ob.id=$a.id;ob.ribbonCommandInfo=this.cfh($a);ob.commandType=$a.commandType;ob.copyPasteTargetType=$a.copyPasteTargetType;return ob}catch($a){return d.ULS.sendTraceTag(537167700,0,10,`EnvironmentSerializationHelper.DeserializeCommandParameters: got exception while try to JSON.Parse string length: ${M?
M.length:0}, errror: ${$a}`),null}}afh(M){const $a=[];d.ULS.shipAssertTag(537167699,0,!!M.topArray&&0<M.topArray.length,`EnvironmentSerializationHelper.DeserializeRanges: TopArray shouldn't be ${M.topArray?"empty":"null"}.`);d.ULS.shipAssertTag(537167698,0,!!M.leftArray&&0<M.leftArray.length,`EnvironmentSerializationHelper.DeserializeRanges: LeftArray shouldn't be ${M.leftArray?"empty":"null"}.`);d.ULS.shipAssertTag(537167697,0,!!M.bottomArray&&0<M.bottomArray.length,`EnvironmentSerializationHelper.DeserializeRanges: BottomArray shouldn't be ${M.bottomArray?
"empty":"null"}.`);d.ULS.shipAssertTag(537167696,0,!!M.rightArray&&0<M.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: RightArray shouldn't be ${M.rightArray?"empty":"null"}.`);if(!(M.topArray&&M.leftArray&&M.bottomArray&&M.rightArray))return $a;d.ULS.shipAssertTag(537167695,0,M.topArray.length===M.bottomArray.length&&M.topArray.length===M.leftArray.length&&M.topArray.length===M.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: The length of TopArray(${M.topArray.length}), BottomArray(${M.bottomArray.length}), LeftArray(${M.leftArray.length}), RightArray(${M.rightArray.length}) should be the same.`);
const ob=Math.min(M.topArray.length,M.bottomArray.length,M.leftArray.length,M.rightArray.length);for(let Tb=0;Tb<ob;Tb++)$a.push(new jc.Range(M.topArray[Tb],M.leftArray[Tb],M.bottomArray[Tb],M.rightArray[Tb],!1,!1));return $a}cfh(M){return new fb.a(this.bfh(M.ribbonCommandName),this.$eh(M.inputMethodName),this.Zeh(M.frameModeName),this.ffh(M.uiLocationName),M.tabName)}Tnj(M){return void 0!==M&&null!==M&&M.toString()in this.XMd?this.XMd[M.toString()]:(d.ULS.shipAssertTag(537167694,0,!1,`EnvironmentSerializationHelper.SerializeRibbonCommand expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${M}`),
this.XMd["-911352779"])}bfh(M){return M&&M in this.n8f?this.n8f[M]:(d.ULS.shipAssertTag(537167693,0,!1,`EnvironmentSerializationHelper.DeserializeRibbonCommand: expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${M}`),-911352779)}Nnj(M){return void 0!==M&&null!==M&&l.a[M]in this.nka?this.nka[l.a[M]]:(d.ULS.shipAssertTag(537167692,0,!1,`EnvironmentSerializationHelper.SerializeInputMethod: got unexpected value ${M}`),this.nka.unknown)}$eh(M){return M&&M in
this.m8f?this.m8f[M]:(d.ULS.shipAssertTag(537167691,0,!1,`EnvironmentSerializationHelper.DeserializeInputMethod: got unexpected value ${M}`),0)}Lnj(M){return void 0!==M&&null!==M&&tb.a[M]in this.B3a?this.B3a[tb.a[M]]:(d.ULS.shipAssertTag(537167690,0,!1,`EnvironmentSerializationHelper.SerializeFrameMode: got unexpected value ${M}`),this.B3a.edit)}Zeh(M){return M&&M in this.l8f?this.l8f[M]:(d.ULS.shipAssertTag(537167689,0,!1,`EnvironmentSerializationHelper.DeserializeFrameMode: got unexpected value ${M}`),
2)}mZf(M){return void 0!==M&&null!==M&&dc[M]in this.gNb?this.gNb[dc[M]]:(d.ULS.shipAssertTag(537167688,0,!1,`EnvironmentSerializationHelper.SerializeSourceItemType: got unexpected value ${M}`),this.gNb.range)}dfh(M){return M&&M in this.o8f?this.o8f[M]:(d.ULS.shipAssertTag(537167687,0,!1,`EnvironmentSerializationHelper.DeserializeSourceItemType: got unexpected value ${M}`),0)}Knj(M){return void 0!==M&&null!==M&&M.toString()in this.DXc?this.DXc[M.toString()]:(d.ULS.shipAssertTag(537167686,0,!1,`EnvironmentSerializationHelper.SerializeArtSourceItemType: got unexpected value ${M}`),
this.DXc["99"])}Yeh(M){return M&&M in this.k8f?this.k8f[M]:(d.ULS.shipAssertTag(537167685,0,!1,`EnvironmentSerializationHelper.DeserializeArtSourceItemType: got unexpected value ${M}`),99)}Xnj(M){return void 0!==M&&null!==M&&t.a[M]in this.Lr?this.Lr[t.a[M]]:(d.ULS.shipAssertTag(36229129,0,!1,`EnvironmentSerializationHelper.SerializeUILocation: got unexpected value ${M}`),this.Lr.ribbon)}ffh(M){return M&&M in this.p8f?this.p8f[M]:(d.ULS.shipAssertTag(537167684,0,!1,`EnvironmentSerializationHelper.DeserializeUILocation: got unexpected value ${M}`),
2)}}Object(c.a)(ec,"EnvironmentSerializationHelper",null,[]);class lb{}lb.EWf="SameSession";lb.IGe="CrossSession";lb.Llf="LegacyCrossSession";lb.external="External";Object(c.a)(lb,"PayloadOrigin",null,[]);const ac=M=>M?M.shadowWorkbookSizeExceedsLimit&&void 0!==M.shadowWorkbookBlockedSize&&null!==M.shadowWorkbookBlockedSize?M.shadowWorkbookBlockedSize:M.shadowWorkbookBase64?M.shadowWorkbookBase64.length:0:0,Gb=M=>M.shadowWorkbookSizeExceedsLimit?!0:ac(M)>y.a.jlc;class wb{constructor(M,$a){this._name=
$a;this.$=M;this.Xm=B.a.instance;this.Tp=new Fa(M,W.g(M))}get name(){return this._name}get GXc(){return this.Xm.Va(5)}shouldWaitForCopyToComplete(){return!1}onDeferredPasteStarted(){}onDeferredPasteCompleted(){}beforePaste(){}PNj(M){let $a;$a=null;try{const ob=M.getItem(L.shadowWorkbook);if(!ob)return{returnValue:!1,x0:$a};$a=JSON.parse(ob);return{returnValue:this.Roi($a),x0:$a}}catch(ob){return d.ULS.sendTraceTag(537167835,0,50,"BaseCopyPasteHandler.TryParseRangeShadowWorkbookPayload: Exception caught: "+
ob),{returnValue:!1,x0:$a}}}Roi(M){return!!M&&(!!M.shadowWorkbookBase64||M.shadowWorkbookSizeExceedsLimit)&&void 0!==M.rangeRowStart&&void 0!==M.rangeRowEnd&&void 0!==M.rangeColumnStart&&void 0!==M.rangeColumnEnd}Xpc(M){M.wasLastCopyExternal=!0;if(r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!k.a.xz&&516!==M.commandParameters.commandType&&1028!==M.commandParameters.commandType){var $a=null;if(({x0:$a}=this.PNj(M.clipboardItems)).returnValue)return M.isShadowWorkbookParsedSuccessfully=
!0,this.wXi(M,$a)}if(516!==M.commandParameters.commandType&&36!==M.commandParameters.commandType){if(r.EwaSettings.ma(161)&&20!==M.commandParameters.commandType&&(null===this.$.shortcutKeyManager||this.$.shortcutKeyManager.lgc)&&($a=M.clipboardItems.getItem(L.html),void 0!==$a&&null!==$a&&$a&&$a.trim()!==this.GXc&&($a.startsWith("<")||k.a.Uf&&$a.startsWith("\n<")))){const ob=M.clipboardItems.getItem(L.irb);return this.uXi(M,$a,void 0===ob?null:ob)}return this.KHf(M)}return Promise.reject(new Ia.a(6))}wXi(M,
$a){d.ULS.sendTraceTag(537167834,0,50,"BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: Pasting shadow workbook from system clipboard");M.pasteResult="SystemClipboardShadowWorkbookPaste";M.payloadType=P.shadowWorkbook;M.payloadOrigin=lb.external;M.shadowWorkbookPayloadSize=ac($a);M.shadowWorkbookSizeExceedsLimit=Gb($a);let ob=null,Tb=null;const Dc=M.commandParameters.originalDestinations;r.EwaSettings.getBooleanFeatureGate(na.a.i5b,!1)?ob=T.r(Dc,this.$):Tb=T.v(T.K(Dc),this.$);$a.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&
(M.originalSourceRangesCountExceedsLimit=$a.originalSourceRangesCountExceedsLimit);if(M.shadowWorkbookSizeExceedsLimit)return d.ULS.sendTraceTag(537167833,0,15,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: shadow workbook length(${M.shadowWorkbookPayloadSize}) is over the limit(${y.a.jlc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${$a.shadowWorkbookSizeExceedsLimit}`),Promise.reject(new Ia.a(1));d.ULS.sendTraceTag(537167832,0,50,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: trigger Paste request. PasteOperationId=${M.commandParameters.id}`);
return this.Tp.OHf(M.commandParameters.ribbonCommandInfo,Tb,ob,$a,[M.commandParameters.stopwatch],M)}KHf(M){var $a=M.clipboardItems.getItem(L.plainText);if(void 0!==$a&&null!==$a&&$a.trim()===this.GXc)return Promise.reject(new Ia.a(7));void 0!==$a&&null!==$a&&(M.plainTextPayloadSize=$a.length);M.isPlainTextPaste=!0;M.pasteResult="SystemClipboardPaste";M.payloadOrigin=Q(M)?lb.Llf:lb.external;M.payloadType=P.plainText;d.ULS.sendTraceTag(537167831,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: trigger ProcessPasteText request. pasteContext.Id=${M.id}, PasteOperationId=${M.commandParameters.id}`);
$a=this.Tp.D1i(T.K(M.commandParameters.originalDestinations),$a,M.commandParameters.ribbonCommandInfo,[M.commandParameters.stopwatch],M);d.ULS.sendTraceTag(537167830,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: returned from ProcessPasteText. pasteContext.Id=${M.id}`);return $a}uXi(M,$a,ob){M.htmlPayloadSize=$a.length;M.isHtmlPaste=!0;M.pasteResult="SystemClipboardHtmlPaste";M.payloadType=P.html;M.payloadOrigin=Q(M)?lb.Llf:lb.external;d.ULS.sendTraceTag(42071711,0,50,`BaseRangeCopyPasteHandler.PasteByHtml: trigger ProcessPasteHtml request. PasteOperationId=${M.commandParameters.id}`);
return this.Tp.C1i(T.K(M.commandParameters.originalDestinations),$a,ob,M.commandParameters.id,M.commandParameters.ribbonCommandInfo,[M.commandParameters.stopwatch],M)}gGe(M){const $a={};M&&($a.shadowWorkbookBase64=M.ShadowWorkbookBase64,$a.shadowWorkbookSizeExceedsLimit=M.ShadowWorkbookSizeExceedsLimit,$a.originalSourceRangesCountExceedsLimit=M.OriginalSourceRangesCountExceedsLimit,$a.originalSourceRangesCount=M.OriginalSourceRangesCount,$a.shadowWorkbookBlockedSize=M.ShadowWorkbookBlockedSize);return $a}Mgg(M,
$a){const ob=H(M),Tb=32===(M.commandParameters.commandType&32),Dc=1024===(M.commandParameters.commandType&1024);let ad=!1,ld=null,md=null,Wb=!1;if(!ob){ad=-1985798686===M.commandParameters.ribbonCommandInfo.command;var Nc=M.copyContextSnapshot;if($a)Wb=!Nc.sourceItem.isFromCurrentSession(this.$);else if(Nc=this.Tp.xwb(Nc))ld=Nc.ranges,md=Nc.sheetName,Wb=!M.isSameSession}return this.Tp.CMg(md,ld,this.$.oa.sheetName,M.commandParameters.originalDestinations,M.commandParameters.expandDestinations,Wb,
Tb,Dc,ad,$a,ob)}}Object(c.a)(wb,"BaseCopyPasteHandler",null,[311,312,313]);class qc{constructor(M){this.clipboardItems=this.key=null;this.v$=M}Uva(M){return this.key&&this.key.isEqual(M)?this.createClipboardItems(this.clipboardItems):null}setValue(M,$a){this.key=M;this.clipboardItems=this.createClipboardItems($a)}createClipboardItems(M){const $a=this.v$.create();var ob=M.getItem(L.plainText);ob&&$a.setItem(L.plainText,ob);(ob=M.getItem(L.shadowWorkbook))&&$a.setItem(L.shadowWorkbook,ob);(M=M.getItem(L.html))&&
$a.setItem(L.html,M);return $a}}Object(c.a)(qc,"CopyCache",null,[]);var Ya=a(75);class xb extends wb{constructor(M,$a,ob,Tb,Dc=null){super(M,Tb);this.O4g=$a;this.v$=ob;this.t3c=Dc||new qc(this.v$);this.gridView=W.g(M);this.ha=this.gridView.ha;this.clipboardRangeFactory=M.da.za(169)}getSourceItem(){const M=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6713439_FixCloneRangeArray")?T.d(this.gridView.ha.sa.selectedRanges):u.a.clone(this.gridView.ha.sa.selectedRanges);return new G(this.$,M,this.$.ea.oa.sheetName,
this.$.ea.Je,this.$.ya.UserSessionId)}beforeSerialize(M){M.isSelectionAllowed=!1;M.isAsyncCopy=!1;M.isFromCache=!1;M.encounteredDeploymentErrors=!1;M.plainTextPayloadSize=0;M.shadowWorkbookPayloadSize=0;M.htmlPayloadSize=0;M.clientSideCopyTime=0;const $a=new ja.a(this.$.xa),ob=M.sourceItem;M.isSelectionAllowed=u.a.all(ob.ranges,Tb=>this.isSelectionAllowed($a,Tb));M.isSelectionAllowed&&this.Tp.C9e(ob.ranges,M.commandParameters.commandType)}ZMa(M){return this.gridView.Ea.K4()&&W.i(this.gridView,M)}UXi(M,
$a,ob,Tb){let Dc=!1,ad=1===$a.commandParameters.commandType,ld=Tb[0].dH;1===ob.ranges.length&&1===Tb.length?r.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests1")&&ad&&1!==ld&&ld!==ob.ranges[0].dH?M.cseStatus=17:Dc=this.O4g.u7c(M,T.K(ob.ranges),ob.sheetName,T.K(M.commandParameters.expandDestinations),this.$.ea.oa.sheetName,ad):M.cseStatus=5;Dc&&W.g(this.$).Pi.D0(M.commandParameters.stopwatch.id,Ya.BasicTelemetryCalculator.NQ);return this.DXi(M,ob,T.u(this.$.oa.sheetName,null,
Tb),$a.commandParameters.commandType,Dc)}isSelectionAllowed(M,$a){return M.IAb($a,this.gridView)}DXi(M,$a,ob,Tb,Dc){$a=T.u($a.sheetName,null,$a.ranges);M.pasteResult="SameSessionPaste";M.payloadOrigin=lb.EWf;M.payloadType=P.cBg;d.ULS.sendTraceTag(537167829,0,50,`BaseRangeCopyPasteHandler.PasteSameSession: trigger PasteRange request. PasteOperationId=${M.commandParameters.id}`);return this.Tp.pasteRange(M.commandParameters.ribbonCommandInfo,$a,ob,Tb,M.commandParameters.commandType,[M.commandParameters.stopwatch],
M,Dc,null,null)}}Object(c.a)(xb,"BaseRangeCopyPasteHandler",wb,[]);var wc=a(35);class Oc{constructor(M){this.lU=new wc.a(!0);this.$=M}onDeferredPasteStarted(M){this.lU.lb(M.id)||this.lU.add(M.id,!0);if(0<this.lU.count){const $a=ea.GetServiceTaskFactory.Sa(this.$.da,5,4,0);ca.TaskExtensions.Aa($a,()=>{$a.result.Zf(28,null)},this.$.la,3)}}onDeferredPasteCompleted(M){const $a=0<this.lU.count;this.lU.lb(M.id)&&this.lU.remove(M.id);if($a&&!this.lU.count){const ob=ea.GetServiceTaskFactory.Sa(this.$.da,
5,4,0);ca.TaskExtensions.Aa(ob,()=>{ob.result.removeEntry(28)},this.$.la,3)}}}Object(c.a)(Oc,"DeferredPasteTracker",null,[]);var Cb;(function(M){M[M.none=0]="none";M[M.loadClipboardFromServerFailed=1]="loadClipboardFromServerFailed";M[M.loadCopiedDataFromServerFailed=2]="loadCopiedDataFromServerFailed";M[M.asyncCopyCanceled=3]="asyncCopyCanceled";M[M.loadCopiedArtDataFromServerFailed=4]="loadCopiedArtDataFromServerFailed"})(Cb||(Cb={}));Object(c.b)("CopyErrorType",Cb);var Ib=a(925),fc=a(1111);class vc extends Ib.a{constructor(M,
$a=null){super(Cb[M]);this.copyErrorName=0;this.ewaErrors=null;this.copyErrorName=M;this.ewaErrors=$a;if(null===$a||void 0===$a?0:$a.length)this.innerError=new fc.a($a,null)}}Object(c.a)(vc,"CopyInnerError",Ib.a,[]);class Cc extends xb{constructor(M,$a,ob,Tb=null){super(M,$a,ob,"AcrossSessionRangeCopyPasteHandler",Tb);this.lU=new Oc(M)}serialize(M){const $a=M.sourceItem,ob={};let Tb=this.t3c.Uva($a);if(Tb)ob.synchronousResult=Tb,M.isFromCache=!0,M.clientSideCopyTime=M.commandParameters.stopwatch.yc;
else{let ad=null;var Dc=T.F($a.ranges);if(!Y.a.uff()&&this.ZMa(Dc)){d.ULS.sendTraceTag(537167936,0,50,"AcrossSessionRangeCopyPasteHandler.Serialize: All data is loaded prepare the data in the client side.");Dc=this.clipboardRangeFactory.create(Dc);try{ad=Dc.toString(),Tb=this.v$.create(),Tb.setItem(L.plainText,ad),this.t3c.setValue($a,Tb),ob.synchronousResult=Tb,M.clientSideCopyTime=M.commandParameters.stopwatch.yc}finally{Dc&&Dc.dispose()}}else M.isAsyncCopy=!0,ob.synchronousResult=this.v$.create(),
ob.synchronousResult.setItem(L.plainText,this.GXc);ob.asynchronousResult=this.ied(M,$a,ad)}M.syncClipboardItemsKeys=Da(ob.synchronousResult);return ob}shouldWaitForCopyToComplete(M){if(!M||!M.copyContextSnapshot)return d.ULS.sendTraceTag(537167907,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: pasteContext or pasteContext.CopyContextSnapshot is not define, return false."),!1;d.ULS.shipAssertTag(537167906,0,!!this.$.ya,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: this.EwaControl.BootstrapContext shouldn't be null");
if(M.copyContextSnapshot.sessionId===this.$.ya.UserSessionId)return d.ULS.sendTraceTag(537167905,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: Same session copy scenario, return false."),!1;d.ULS.sendTraceTag(537167904,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted(M){this.lU.onDeferredPasteStarted(M)}onDeferredPasteCompleted(M){this.lU.onDeferredPasteCompleted(M)}deserialize(M){M.isClipboardDataContainShadowWorkbook=
!(void 0===M.clipboardItems.getItem(L.shadowWorkbook)||null===M.clipboardItems.getItem(L.shadowWorkbook));if(W.g(this.$).ha.Me&326)return H(M)&&(M.wasLastCopyExternal=!0),Promise.reject(new Ia.a(17));var $a=this.Mgg(M,!1);if(0!==$a)return Promise.reject(new Ia.a(H(M)?18:M.isSameSession?19:20,void 0,void 0,void 0,$a));var ob=M.copyContextSnapshot,Tb=this.Tp.xwb(ob);if(H(M))return this.Xpc(M);$a=M.commandParameters.originalDestinations;if(Tb&&M.isSameSession)return this.UXi(M,ob,Tb,$a);if(516!==M.commandParameters.commandType){if(({x0:ob}=
this.ONj(M.clipboardItems)).returnValue){M.isShadowWorkbookParsedSuccessfully=!0;let Dc=Tb=null;r.EwaSettings.getBooleanFeatureGate(na.a.i5b,!1)?Tb=T.r($a,this.$):Dc=T.v(T.K($a),this.$);return this.sXi(M,Dc,Tb,ob)}if(M.isClipboardInaccessible)return Promise.reject(new Ia.a(8));if(36!==M.commandParameters.commandType)return this.KHf(M)}return Promise.reject(new Ia.a(6))}beforePaste(M){this.$.da.za(373).Mkj(M);M.indicationDisplayScheduled=!0}fNj(M){let $a;if(!(M&&M.SourceRanges&&M.SourceRanges.Ranges&&
M.SourceRanges.Ranges.length&&(M.OriginalSourceRangesCountExceedsLimit||M.OriginalSourceMultiRange&&M.OriginalSourceMultiRange.Ranges&&M.OriginalSourceMultiRange.Ranges.length)))return{returnValue:!1,x0:null};var ob=M.SourceRanges.Ranges[0];if(!M.ShadowWorkbookBase64&&!M.ShadowWorkbookSizeExceedsLimit)return{returnValue:!1,x0:null};$a=this.gGe(M);$a.rangeRowStart=ob.FirstRow;$a.rangeRowEnd=ob.LastRow;$a.rangeColumnStart=ob.FirstColumn;$a.rangeColumnEnd=ob.LastColumn;$a.sourceClientPath=M.SourceClientPath;
$a.sourceSheetName=M.SourceSheetName;$a.sourceWorkbookName=M.SourceWorkbookName;if(!M.OriginalSourceRangesCountExceedsLimit)for(M=M.OriginalSourceMultiRange.Ranges,$a.originalSourceRanges=Array(M.length),ob=0;ob<M.length;++ob)$a.originalSourceRanges[ob]=[M[ob].FirstRow,M[ob].FirstColumn,M[ob].LastRow,M[ob].LastColumn];return{returnValue:!0,x0:$a}}ONj(M){let $a;$a=null;M=M.getItem(L.shadowWorkbook);if(!M)return{returnValue:!1,x0:$a};$a=JSON.parse(M);return{returnValue:this.Qoi($a),x0:$a}}Qoi(M){return!!M&&
(!!M.shadowWorkbookBase64||M.shadowWorkbookSizeExceedsLimit)&&void 0!==M.rangeRowStart&&void 0!==M.rangeRowEnd&&void 0!==M.rangeColumnStart&&void 0!==M.rangeColumnEnd}sXi(M,$a,ob,Tb){d.ULS.shipAssertTag(537167903,0,!!Tb,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadowWorkbookPayload shouldn't be null");w.AFrameworkApplication.uN("Microsoft.Office.Excel.Server.Flighting.IDenyListNewCopyPasteExperienceAcrossSessions");M.pasteResult="CrossSessionPaste";M.payloadOrigin=lb.IGe;M.payloadType=
P.shadowWorkbook;M.shadowWorkbookPayloadSize=ac(Tb);M.shadowWorkbookSizeExceedsLimit=Gb(Tb);Tb.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&(M.originalSourceRangesCountExceedsLimit=Tb.originalSourceRangesCountExceedsLimit);if(M.shadowWorkbookSizeExceedsLimit)return d.ULS.sendTraceTag(34415003,0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadow workbook length(${M.shadowWorkbookPayloadSize}) is over the limit(${y.a.jlc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${Tb.shadowWorkbookSizeExceedsLimit}`),
Promise.reject(new Ia.a(1));if(1028===M.commandParameters.commandType&&M.originalSourceRangesCountExceedsLimit)return d.ULS.sendTraceTag(572617859,0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: Original source ranges count(${Tb.originalSourceRangesCount}) is over the limit(${y.a.zzi}). Reject the paste request. OriginalSourceRangesCountExceedsLimit: ${Tb.originalSourceRangesCountExceedsLimit}`),Promise.reject(new Ia.a(1));d.ULS.sendTraceTag(537167902,0,50,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: trigger Paste request. PasteOperationId=${M.commandParameters.id}`);
return this.Tp.OHf(M.commandParameters.ribbonCommandInfo,$a,ob,Tb,[M.commandParameters.stopwatch],M)}ied(M,$a,ob){d.ULS.shipAssertTag(537167901,0,!!M,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: copyContext shouldn't be null");const Tb=M.commandParameters.stopwatch.yc;return new Promise((Dc,ad)=>{d.ULS.sendTraceTag(26035421,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data for copy Id: ${M.id}`);const ld=T.u($a.sheetName,
null,$a.ranges);this.Tp.copy(ld,M.commandParameters,md=>{M.requestTelemetryData=md.RequestTelemetryData;M.serverRequestTimeInMs=M.commandParameters.stopwatch.yc-Tb;if(wa.a.ug(md.Errors))if(wa.a.Wga(md.Errors))M.encounteredDeploymentErrors=!0,md=wa.a.xc(md.Errors),d.ULS.sendTraceTag(537167898,0,15,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${md}. copy Id: ${M.id}`);else{var Wb=wa.a.xc(md.Errors);
d.ULS.sendTraceTag(26035419,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Wb}. copy Id: ${M.id}`);ad(new vc(2,md.Errors))}else if(d.ULS.sendTraceTag(537167900,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeed for copy Id: ${M.id}`),M.markForCancellation)ad(new vc(3,md.Errors));else{Wb=md.Result;var Nc=Wb.PlainTextResult;void 0!==ob&&null!==ob&&(Nc=ob);void 0!==Nc&&null!==Nc&&(M.plainTextPayloadSize=
Nc.length);var gd=this.v$.create();if(({x0:Gd}=this.fNj(Wb)).returnValue){M.shadowWorkbookPayloadSize=ac(Gd);M.shadowWorkbookSizeExceedsLimit=Gb(Gd);M.originalSourceRangesCountExceedsLimit=Wb.OriginalSourceRangesCountExceedsLimit;var Gd=JSON.stringify(Gd);gd.setItem(L.shadowWorkbook,Gd)}gd.setItem(L.plainText,Nc);Y.a.uff()&&(Nc=Wb.HtmlResult,M.htmlSizeExceedsLimit=Wb.HtmlSizeExceedsLimit,void 0!==Nc&&null!==Nc&&(M.htmlPayloadSize=Nc.length),gd.setItem(L.html,Nc));M.copyTotalSizeExceedsLimit=Wb.CopyTotalSizeExceedsLimit;
gd.setItem(L.irb,M.commandParameters.id);this.t3c.setValue($a,gd);M.asyncClipboardItemsKeys=Da(gd);Dc(gd);r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)&&(Wb=1===M.commandParameters.commandType?8:7,(gd=this.$.da.za(465))&&gd.R0(Wb,md))}},md=>{M.serverRequestTimeInMs=M.commandParameters.stopwatch.yc-Tb;md=Kb.a.ff(md.data);const Wb=wa.a.xc(md);d.ULS.sendTraceTag(537167897,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Wb}. copy Id: ${M.id}`);
ad(new vc(2,md))},[M.commandParameters.stopwatch])})}}Object(c.a)(Cc,"AcrossSessionRangeCopyPasteHandler",xb,[]);class fd{constructor(M,$a,ob,Tb,Dc,ad=null,ld=null){this.floatingObjectId=M;this.commandParameters=$a;this.It=ob;this.ich=Tb;this.naa=ad;this.JPb=ld;this.E4g=Dc}}Object(c.a)(fd,"CopyArtRequest",null,[]);class od{constructor(M,$a,ob,Tb,Dc,ad,ld,md,Wb){this.promise=null;this.ribbonCommandInfo=M;this.destination=$a;this.yIe=ob;this.JPb=Dc;this.x0=ad;this.item=ld;this.pasteContext=md;this.lOa=
ob||$a.FirstRow+"_"+$a.FirstColumn;this.Pff=!0;this.rAe=Wb}}Object(c.a)(od,"PasteArtRequest",null,[]);class Ub{constructor(M,$a){this.zJb=new nb.a;this.$Za=M;this.$=$a;this.c2i=ob=>Promise.resolve(ob);this.sFb=ob=>Promise.reject(ob)}l4h(M){if(this.Mki(M.lOa)){d.ULS.sendTraceTag(537167681,5,50,`PasteArtRequestManager.HandleRequest: Enqueued paste request as a result of rapid paste on same destination: ${M.lOa}`);const $a=this.zJb.na(M.lOa);this.zJb.ia(M.lOa,M);const ob=$a.promise;$a.Pff=!1;return this.bmh(M,
ob)}this.zJb.ia(M.lOa,M);return this.Rri(M)}Mki(M){return this.zJb.lb(M)}Rri(M){return new Promise(($a,ob)=>{M.promise=this.$Za.JHf(M).then(Tb=>{$a(null);return this.xoc(M,Tb)},Tb=>{ob(null);return this.sFb(Tb)})})}bmh(M,$a){return new Promise((ob,Tb)=>{M.promise=$a.then(Dc=>{this.YSj(M,Dc);return this.$Za.JHf(M).then(ad=>{ob(null);return this.xoc(M,ad)},ad=>{Tb(null);return this.sFb(ad)})},Dc=>this.sFb(Dc))})}xoc(M,$a){M.Pff&&(this.nZg(M.lOa),this.sOd(M,$a));return this.c2i($a)}nZg(M){this.zJb.remove(M)}sOd(M,
$a){const ob=this.rXh();M.lOa===ob&&this.$Za.sOd(M.destination,$a,M.item.type)}rXh(){var M=W.g(this.$).ha.Qa.activeFloatingObjectControlId;M||(M=T.v(W.g(this.$).ha.sa.activeCell,this.$),M=M.FirstRow+"_"+M.FirstColumn);return M}YSj(M,$a){M.destination=null;M.yIe=$a}}Object(c.a)(Ub,"PasteArtRequestManager",null,[]);var Fc=a(198),$b=a(122),zc=a(104);class Wc extends wb{constructor(M,$a,ob,Tb,Dc=null){super(M,"ArtCopyPasteHandler");this.j_g="XLO";this.k_g="3";this.lU=new Oc(M);this.v$=$a;this.$Za=ob;
this.ha=W.g(M).ha;this.s3c=Dc||new qc(this.v$);this.tXi=new Ub(ob,M);this.wob=Tb}getSourceItem(){d.ULS.shipAssertTag(537167896,0,!!this.ha.Qa.activeFloatingObjectControlId,"Expecting a floating object to be currently selected for copy");d.ULS.sendTraceTag(537167895,0,50,`ArtCopyPasteHandler.GetSourceItem: Creating ArtSourceItem with FloatingObjectId=[${this.ha.Qa.activeFloatingObjectControlId}]`);return new U(this.ha.Qa.activeFloatingObjectControlId,this.$.ea.oa.sheetName,this.$.ea.Je,this.$.ya.UserSessionId,
this.ha.Qa.dc.floatingObject.type)}beforeSerialize(M){M&&M.commandParameters?(M?(M.isAsyncCopy=!1,M.isSelectionAllowed=!1,M.isFromCache=!1,M.plainTextPayloadSize=0,M.shadowWorkbookPayloadSize=0,M.htmlPayloadSize=0,M.htmlSizeExceedsLimit=!1,M.clientSideCopyTime=0,M.encounteredDeploymentErrors=!1,M.shadowWorkbookSizeExceedsLimit=!1,M.originalSourceRangesCountExceedsLimit=!1,M.copyTotalSizeExceedsLimit=!1):d.ULS.sendTraceTag(537167826,0,10,"CommonCopyPasteUtils.InitializeCopyContext: copyContext is null."),
M.commandParameters.copyPasteTargetType=2):d.ULS.sendTraceTag(537167894,0,10,"ArtCopyPasteHandler.BeforeSerialize: copyContext or copyContext.CommandParameters is null.")}serialize(M){const $a=M.sourceItem,ob={};if(!$a)return d.ULS.sendTraceTag(537167893,0,10,"ArtCopyPasteHandler.Serialize: artSourceItem should not be null"),ob;if(!this.Fni())return d.ULS.sendTraceTag(36824456,0,50,"ArtCopyPasteHandler.Serialize: Unsupported floating object type. This will clear the clipboard"),ob;d.ULS.sendTraceTag(537167892,
0,50,`ArtCopyPasteHandler.Serialize: Serializing ArtSourceItem with FloatingObjectId=[${$a.activeFloatingObjectControlId}]`);this.oFd();let Tb=this.s3c.Uva($a);if(Tb)ob.synchronousResult=Tb,M.isFromCache=!0,M.isAsyncCopy=!1,M.clientSideCopyTime=M.commandParameters.stopwatch.yc,1===M.commandParameters.commandType&&this.$.fd(2045211913,M.commandParameters.ribbonCommandInfo.method,M.commandParameters.ribbonCommandInfo.Re,null);else{M.isFromCache=!1;M.isAsyncCopy=!0;Tb=this.v$.create();if(M.commandParameters.uploadToClipService){const Dc=
{};Dc["data-clipservice-ccpid"]=M.commandParameters.id;Dc["data-pkey"]=M.commandParameters.pKey;Dc["data-clipservice-type"]=M.commandParameters.clipServiceDataType;Dc["data-clipservice-count"]=M.commandParameters.objectCount.toString();Dc["data-clipservice-dc"]=M.commandParameters.clipServiceDataCenter;Dc["data-clipservice-client"]=this.j_g;Dc["data-TimeStamp"]=(new Date).toUTCString();Dc["data-clipservice-version"]=this.k_g;Tb.setItem(L.sJg,JSON.stringify(Dc))}ob.synchronousResult=this.MCg(Tb);ob.asynchronousResult=
this.ied(M,$a,Tb)}M.syncClipboardItemsKeys=Da(ob.synchronousResult);return ob}MCg(M){d.ULS.shipAssertTag(537167891,0,!!this.ha.Qa.dc,"Expecting a floating object to be currently selected for copy");M||(M=this.v$.create());const $a=this.ha.Qa.dc.avb();$a&&M.setItem(L.html,`<img src='${$a}'>`);return M}oFd(){const M=this.ha.Qa.dc;this.wob.oFd($b.a.vqb(M.floatingObject),$b.a.m_g(M.iu))}shouldWaitForCopyToComplete(){d.ULS.sendTraceTag(537167890,0,50,"ArtCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");
return!0}onDeferredPasteStarted(M){this.lU.onDeferredPasteStarted(M)}onDeferredPasteCompleted(M){this.lU.onDeferredPasteCompleted(M)}deserialize(M){var $a=H(M),ob=null;let Tb=null;var Dc=!1;if(!$a){ob=M.copyContextSnapshot;Tb=ob.sourceItem;if(!Tb)return Promise.reject(new Ia.a(10));Dc=Tb.isFromCurrentSession(this.$)}var ad=this.Mgg(M,!0);if(0!==ad)return Promise.reject(new Ia.a($a?18:Dc?19:20,void 0,void 0,void 0,ad));if($a)return this.Xpc(M);if(!Dc&&!Wc.Ggi(Tb))return M=`User attempted to paste art of type [${Tb.type}] between sessions.`,
d.ULS.sendTraceTag(537167889,0,50,M),Promise.reject(new Ia.a(11,void 0,void 0,M));if(ob.isAsyncSerializeFailed)return Promise.reject(new Ia.a(16,void 0,void 0,"Last async serialize failed, therefore no current shadow workbook payload to paste"));let ld;try{const md=M.clipboardItems.getItem(L.shadowWorkbook);ld=JSON.parse(md)}catch(md){return M=copyPasteInfra.getStringifiedError(md),d.ULS.sendTraceTag(537167888,0,10,`ArtCopyPasteHandler.Deserialize: Failed to parse shadow workbook JSON with exception: ${M}`),
Promise.reject(new Ia.a(12,void 0,md))}ld.floatingObjectId!==Tb.activeFloatingObjectControlId?d.ULS.sendTraceTag(537167887,0,10,`ArtCopyPasteHandler.Deserialize: FloatingObjectId mismatch! Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${Tb.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${ld.floatingObjectId}]`):d.ULS.sendTraceTag(537167886,0,50,`ArtCopyPasteHandler.Deserialize: Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${Tb.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${ld.floatingObjectId}]`);
if(!ld||!ld.shadowWorkbookBase64)return Promise.reject(new Ia.a(13,void 0,void 0,`shadowWorkbookPayload is null = ${!ld}`));M.isShadowWorkbookParsedSuccessfully=!0;M.shadowWorkbookPayloadSize=ac(ld);M.shadowWorkbookSizeExceedsLimit=Gb(ld);M.payloadOrigin=Dc?lb.EWf:lb.IGe;M.payloadType=P.lkg;if(Gb(ld))return M=`Shadow workbook size [${M.shadowWorkbookPayloadSize}] is over the limit [${y.a.jlc}]. ShadowWorkbookSizeExceedsLimit: ${ld.shadowWorkbookSizeExceedsLimit}`,d.ULS.sendTraceTag(36304156,0,15,
`ArtCopyPasteHandler.Deserialize: ${M}`),Promise.reject(new Ia.a(1,void 0,void 0,M));ob=$a=null;W.g(this.$).ha.Me&326?ob=W.g(this.$).ha.Qa.activeFloatingObjectControlId:$a=this.$.oa&&this.$.oa.activeCell?T.v(this.$.oa.activeCell,this.$):T.v(T.K(M.commandParameters.originalDestinations),this.$);Dc=null;if(this.wob.w3f(Tb))try{Dc=this.wob.u7c()}catch(md){ad=copyPasteInfra.getStringifiedError(md),d.ULS.sendTraceTag(537167885,0,10,`ArtCopyPasteHandler.Deserialize: Exception encountered while performing client-side estimation. Exception: ${ad}`)}return this.tXi.l4h(new od(M.commandParameters.ribbonCommandInfo,
$a,ob,M.commandParameters.commandType,[M.commandParameters.stopwatch],ld,Tb,M,Dc))}Xpc(M){M.wasLastCopyExternal=!0;if(M.clipboardItems.getItem("image/png")){const $a=M.commandParameters.stopwatch.yc;M.payloadType=P.zPg;return sb.b(this.$.fd(1403967063,M.commandParameters.ribbonCommandInfo.method,M.commandParameters.ribbonCommandInfo.Re,{["dataUrl"]:M.clipboardItems.getItem("image/png")})).then(ob=>{M.serverRequestTimeInMs=M.commandParameters.stopwatch.yc-$a;return ob?Promise.resolve(null):Promise.reject(new Ia.a(15))},
()=>{M.serverRequestTimeInMs=M.commandParameters.stopwatch.yc-$a;return Promise.reject(new Ia.a(15))})}d.ULS.shipAssertTag(537167884,0,!1,"Should not paste external content that is not image via ArtCopyPasteHandler");return super.Xpc(M)}Fni(){const M=W.g(this.$).ha;return M.Qa.activeFloatingObjectControlId&&M.Qa.dc&&M.Qa.dc.floatingObject?M.Qa.dc.floatingObject.TVd():!1}ied(M,$a,ob){return new Promise((Tb,Dc)=>{const ad=M.commandParameters.stopwatch.yc;d.ULS.sendTraceTag(41562516,0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data...");
this.$Za.G4g(new fd($a.activeFloatingObjectControlId,M.commandParameters,ld=>{M.requestTelemetryData=ld.RequestTelemetryData;M.serverRequestTimeInMs=M.commandParameters.stopwatch.yc-ad;if(wa.a.ug(ld.Errors))if(wa.a.Wga(ld.Errors))M.encounteredDeploymentErrors=!0,ld=wa.a.xc(ld.Errors),d.ULS.sendTraceTag(537167879,0,15,`ArtCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${ld}`);else{var md=wa.a.xc(ld.Errors);d.ULS.sendTraceTag(36229122,
0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${md}`);Dc(new vc(4,ld.Errors))}else if(d.ULS.sendTraceTag(537167883,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeeded for FloatingObjectId=[${$a.activeFloatingObjectControlId}].`),M.markForCancellation)Dc(new vc(3,ld.Errors));else{if(wa.a.Dq(ld.Errors)){var Wb=wa.a.xc(ld.Errors);d.ULS.sendTraceTag(537167882,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Server messages present. Errors: ${Wb}`)}if(Wb=
ld.Result){Wb=this.gGe(Wb);Wb.floatingObjectId=$a.activeFloatingObjectControlId;M.shadowWorkbookPayloadSize=ac(Wb);M.shadowWorkbookSizeExceedsLimit=Gb(Wb);try{md=JSON.stringify(Wb)}catch(Nc){Dc(new Ia.a(14,void 0,Nc,`Failed to stringify shadow workbook: copyContext.ShadowWorkbookPayloadSize: [${M.shadowWorkbookPayloadSize}], shadowWorkbookPayload.FloatingObjectId: [${Wb.floatingObjectId}]`));return}d.ULS.shipAssertTag(537167881,0,!!ob,"Expecting syncClipboardItems to be defined");ob.setItem(L.shadowWorkbook,
md);1===M.commandParameters.commandType&&(this.L_i($a.type,$a.activeFloatingObjectControlId,ld.StateId),this.deleteFloatingObject($a.activeFloatingObjectControlId,$a.type));this.s3c.setValue($a,ob);M.asyncClipboardItemsKeys=Da(ob);Tb(ob)}else d.ULS.sendTraceTag(537167880,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Result form server returned null, copied item id: ${$a.activeFloatingObjectControlId}`),Tb(this.s3c.Uva($a))}},M.commandParameters.commandType,$a.type,ld=>{M.serverRequestTimeInMs=
M.commandParameters.stopwatch.yc-ad;ld=Kb.a.ff(ld.data);1===M.commandParameters.commandType&&this.$Za.OOj($a.type,$a.activeFloatingObjectControlId);const md=wa.a.xc(ld);d.ULS.sendTraceTag(537167878,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${md}`);Dc(new vc(4,ld))},[M.commandParameters.stopwatch]))})}deleteFloatingObject(M,$a){M=Fc.a.lz($a,M);if(M=zc.a(this.$).Gq(M))zc.a(this.$).deleteFloatingObject(M,14,!0),W.g(this.$).ha.Qa.$A=null}L_i(M,$a,ob){const Tb=
this.$.da.za(277);if(Tb){let ad=null;M=Fc.a.lz(M,$a);M=zc.a(this.$).Gq(M);if(null===M||void 0===M?0:M.$i)ad=M.$i.block;if(ad){var Dc=M.floatingObject.Og();Tb.lZb(()=>!ad.Ni.lb(Dc),ob,"CutArt")}}}static Ggi(M){return 1===M.type||5===M.type}}Object(c.a)(Wc,"ArtCopyPasteHandler",wb,[]);var yc=a(58);class pd extends Bb{constructor(M,$a,ob,Tb){super(M);this.isFromCurrentSession=!1;this.left=this.top=0;this.isFromCurrentSession=$a;this.top=ob;this.left=Tb}}Object(c.a)(pd,"MacroRecorderPasteArtPayload",
Bb,[]);class xd{constructor(M,$a){this.$=M;this.wob=$a}F9h(M,$a,ob,Tb,Dc,ad=null,ld=null){const md=this.$.pa.va.Tb();let Wb=null;const Nc={CopyPasteTargetType:2};Nc.FloatingObjectId=M;Nc.CopyOperationId=ob.id;ob.floatingObjectType=$a;Nc.UploadToClipService=ob.uploadToClipService;Nc.PKey=ob.pKey;Nc.ClipServiceDataCenter=ob.clipServiceDataCenter;let gd=0;2===Dc?(Dc=505,gd=16,Wb=(Gd,Zd,xe)=>Oa(this.$.pa.va,Nc,Qa.b(Gd,Tb),ad?Qa.a(Zd,ad):Zd,xe,ob.ribbonCommandInfo,md,ld)):(Dc=179,Wb=(Gd,Zd,xe)=>{this.fih($a,
M);this.$.Ay();return Wa(this.$.pa.va,Nc,Qa.b(Gd,Tb),ad?Qa.a(Zd,ad):Zd,xe,ob.ribbonCommandInfo,md,ld)});r.EwaSettings.$b()?this.$.userOperationManager.Wb(new Ob.a(Dc,0,Wb,gd|64),ob.ribbonCommandInfo):this.$.userOperationManager.Wb(new jb.a(Dc,0,Wb,gd),ob.ribbonCommandInfo)}fih(M,$a){var ob=Fc.a.lz(M,$a);(ob=zc.a(this.$).Gq(ob))?(W.g(this.$).ha.Qa.lH(ob),ob.isVisible=!1):d.ULS.sendTraceTag(537167876,0,50,`ArtCopyPasteUtils.DoCutClientEstimation: floatingObjectcontrol is null. FloatingObjectType : ${M}, FloatingObjectId: ${$a}`)}OOj(M,
$a){M=Fc.a.lz(M,$a);if(M=zc.a(this.$).Gq(M))M.isVisible=!0}G4g(M){this.F9h(M.floatingObjectId,M.E4g,M.commandParameters,M.It,M.ich,M.naa,M.JPb)}f$h(M,$a,ob,Tb,Dc,ad,ld,md=null,Wb=!0){return new Promise((Nc,gd)=>{const Gd=ad.commandParameters.stopwatch.yc;this.POd(M,Dc,$a,ob,Zd=>{ad.requestTelemetryData=Zd.RequestTelemetryData;ad.serverRequestTimeInMs=ad.commandParameters.stopwatch.yc-Gd;if(wa.a.Wga(Zd.Errors))ad&&(ad.encounteredDeploymentErrors=!0),Zd=wa.a.xc(Zd.Errors),d.ULS.sendTraceTag(537167875,
0,15,`ArtCopyPasteUtils.PasteArt: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Zd}`);else if(wa.a.ug(Zd.Errors)){var xe=wa.a.xc(Zd.Errors);d.ULS.sendTraceTag(36459652,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${xe}`);gd(new Ia.a(9,Zd.Errors))}else Zd.Result?(xe=Zd.Result,d.ULS.sendTraceTag(537167874,0,50,"ArtCopyPasteUtils.PasteArt: PasteArt succeeded."),this.$_i(ld,xe.FloatingObjectId,Zd.StateId),Nc(xd.rld(xe.FloatingObjectId))):(d.ULS.sendTraceTag(537167873,
0,10,"ArtCopyPasteUtils.PasteArt: PasteArt failed, result returned from server is null."),gd(new Ia.a(9,Zd.Errors)))},Zd=>{ad.serverRequestTimeInMs=ad.commandParameters.stopwatch.yc-Gd;Zd=Kb.a.ff(Zd.data);d.ULS.sendTraceTag(537167872,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${wa.a.xc(Zd)}`);gd(new Ia.a(9,Zd))},Tb,md,Wb)})}$_i(M,$a,ob){const Tb=this.$.da.za(277);if(Tb){const Dc=Fc.a.lz(M,xd.rld($a));Tb.lZb(()=>!!zc.a(this.$).Gq(Dc),ob,"PasteArt")}}cZd(M,$a){$a&&this.wob.cZd(M,Fc.a.lz(M.type,
$a))}JHf(M){return this.f$h(M.ribbonCommandInfo,M.destination,M.yIe,M.JPb,M.x0,M.pasteContext,M.item.type,M.rAe,M.item.isFromCurrentSession(this.$)).then($a=>$a,$a=>{this.cZd(M.item,M.rAe);return Promise.reject($a)})}sOd(M,$a,ob){M||(M=T.v(W.g(this.$).ha.sa.activeCell,this.$));W.g(this.$).Xhc(T.D(M),1)?zc.a(this.$).ona(ob,$a,!0):W.g(this.$).ha.Qa.lHa(M,$a,ob).continueWith(Tb=>{Tb.result?d.ULS.sendTraceTag(537167843,5,50,`ArtCopyPasteUtils.SelectPastedObject: Selection succeeded in async manner for object ID [${$a}]`):
d.ULS.sendTraceTag(537167842,5,10,`ArtCopyPasteUtils.SelectPastedObject: Selection failed in async manner for object ID [${$a}]`)})}POd(M,$a,ob,Tb,Dc,ad,ld,md,Wb=!0){const Nc=this.$.pa.va.Tb(),gd={};gd.ShadowWorkbookBase64=$a.shadowWorkbookBase64;gd.FloatingObjectId=Tb;gd.DestinationRanges=ob?T.s(ob):null;gd.CopyPasteTargetType=2;gd.ClientEstimationFloatingObjectId=md;ob=(Gd,Zd,xe)=>{md||this.$.Ay();return Sa(this.$.pa.va,gd,Qa.b(Gd,Dc),Qa.a(Zd,ad),xe,null,Nc,ld)};Tb=()=>{if(Wb){let Gd;Gd=yc.a.$h(yc.a.kc(gd));
Gd.FloatingObjectId=$a.floatingObjectId;gd.DestinationRanges||(Gd.DestinationRanges=T.p(this.$.xa.oa.sheetName,"",0,0,0,0));return new pd(Gd,Wb,0,0)}return new pd(gd,Wb,0,0)};ob=r.EwaSettings.$b()?new Ob.a(503,0,ob,void 0,Tb):new jb.a(503,0,ob,void 0,Tb);ob.flags=r.EwaSettings.$b()?65:1;this.$.userOperationManager.Wb(ob,M)}static rld(M){return`${M.length+2}.{${M.toUpperCase()}}`}}Object(c.a)(xd,"ArtCopyPasteUtils",null,[299]);var Vb=a(215);class Uc{constructor(M){this.q3c=this.mta=null;this.dab=15;
this.$=M}oFd(M,$a){this.mta=M;this.q3c=$a}u7c(){if(!this.mta||!this.q3c)return d.ULS.sendTraceTag(537167841,0,15,"ArtPasteClientEstimation.DoPasteClientEstimation: copiedFloatingObjectControl and/or copiedEffectsExtents is null, aborting client side estimation."),"";const M=$b.a.vqb(new Fc.a(this.mta));M.Id=xd.rld(m.a.create().toString());M.Version=-1;M.Name="";M.IsClientEstimation=!0;var $a=this.sai(M);if(!$a)return null;const ob=new Fc.a(M);$a.block.Ni.add(ob);ob.EJb();const Tb=zc.a(this.$);Tb.A4b(ob,
$a);$a=Tb.Gq(Fc.a.qQh(M));!$a||$a.floatingObject.KMa||$a.floatingObject.fNa||$a.gSa(this.q3c);Tb.ona(M.Type,M.Id,!0);return M.Id}w3f(M){return r.EwaSettings.ma(222)&&M.isFromCurrentSession(this.$)&&!W.g(this.$).rtl&&!W.g(this.$).ib.tj}cZd(M,$a){this.w3f(M)&&(M=zc.a(this.$).Gq($a))&&(d.ULS.sendTraceTag(537167840,5,50,`ArtPasteClientEstimation.UndoPasteClientEstimation: undoing client-side estimation. Removing floating object with ID: [${$a}] of type [${M.floatingObject.type}]`),zc.a(this.$).deleteFloatingObject(M,
15,!0),M.$i&&M.Bbb(M.$i,!1))}sai(M){if(!M)return d.ULS.sendTraceTag(537167839,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: Called with null FloatingObjectData."),null;if(W.g(this.$).ha.Qa.activeFloatingObjectControlId){var $a=W.g(this.$).ha.Qa.$A.floatingObject;M.OriginDeltaX=$a.offsetX+this.dab;M.OriginDeltaY=$a.offsetY+this.dab;M.AbsoluteLeft+=this.dab;M.AbsoluteTop+=this.dab;M.AbsoluteRight+=this.dab;M.AbsoluteBottom+=this.dab;M.ZOrder=$a.WB+1;return W.g(this.$).ha.Qa.$A.$i}if(!this.$.oa||
!this.$.oa.activeCell)return d.ULS.sendTraceTag(537167838,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: ActiveItem/ActiveCell is null - cannot perform estimation for grid paste."),null;var ob=this.$.oa.activeCell;$a=W.g(this.$).b1(ob);if(!$a)return d.ULS.sendTraceTag(537167837,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: gridViewBlock for range ${ob.toString()} is null.`),null;const Tb=xa.HelperMethods.lwb($a.domElement,$a.xj.domElement);ob=$a.gridView.dg(ob,
2);if(!Tb||!ob)return d.ULS.sendTraceTag(537167836,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: blockPositionRelativeToGridOrigin is null: ${!Tb}. cellPositionRelativeToGridOrigin is null: ${!ob} .`),null;M.OriginDeltaX=ob.topLeft.x-Tb.x;M.OriginDeltaY=ob.topLeft.y-Tb.y;M.AbsoluteLeft=ob.topLeft.x;M.AbsoluteTop=ob.topLeft.y;M.AbsoluteRight=M.AbsoluteLeft+Math.abs(this.mta.AbsoluteRight-this.mta.AbsoluteLeft);M.AbsoluteBottom=M.AbsoluteTop+Math.abs(this.mta.AbsoluteBottom-this.mta.AbsoluteTop);
M.ZOrder=this.mta.ZOrder+100;return new Vb.a($a.gridView.Ea.Ql($a.hashCode),$a.hashCode)}}Object(c.a)(Uc,"ArtPasteClientEstimation",null,[298]);class ud{create(){const M=window.clipboardPlatform;return M?M.createClipboardItems():null}}Object(c.a)(ud,"ClipboardItemsFactory",null,[297]);class Vc{}Vc.undefined="Undefined";Object(c.a)(Vc,"CCPTelemetryConsts",null,[]);class yd{}yd.cells="Cells";yd.floatingObject="FloatingObject";yd.unknown="Unknown";Object(c.a)(yd,"ActiveSelection",null,[]);class Sd{}
Sd.rhh="DisplayNotInvoked";Sd.m7c="Displayed";Sd.j0i="PrerequisitesNotReady";Object(c.a)(Sd,"PasteIndicationDisplayStatus",null,[]);var Wd=a(109);class Hd{constructor(M){this.yFc=this.HPc=null;this.$=M}get vHd(){if(!this.HPc){const M=this.$.da.za(254,!0);M&&(this.HPc=new Cc(this.$,M,new ud))}return this.HPc}get CXc(){if(!this.yFc&&this.$.da.za(254,!0)){const M=new Uc(this.$);this.yFc=new Wc(this.$,new ud,new xd(this.$,M),M)}return this.yFc}getCopyFlowHandler(M){const $a=this.mMh(W.g(this.$).Me);M.commandParameters.copyPasteHandlerName=
$a.name;return $a}getPasteFlowHandler(M){var $a=M.copyContextSnapshot;$a=R(M)?this.CXc:H(M)?this.vHd:(null===$a||void 0===$a?0:$a.sourceItem)&&Object.getType($a.sourceItem)===U?this.CXc:this.vHd;M.commandParameters.copyPasteHandlerName=$a.name;return $a}initializePasteContext(M){if(M&&(M.isSameSession=!1,M.isShadowWorkbookParsedSuccessfully=!1,M.pasteResult=Vc.undefined,M.payloadOrigin=Vc.undefined,M.payloadType=Vc.undefined,M.encounteredDeploymentErrors=!1,M.shadowWorkbookSizeExceedsLimit=!1,M.originalSourceRangesCountExceedsLimit=
!1,M.activeSelectionType=this.cIh(),M.indicationDisplayScheduled=!1,M.pasteDestinationHasMergedCells=!1,M.pasteIndicationDisplayStatus=Sd.rhh,M.copyContextSnapshot)){var $a=M.copyContextSnapshot;const ld=D($a.sourceItem);var ob=$a.sourceItem;var Tb=!!ob&&Object.getType(ob)===U;ob=0;var Dc=!1;ld?(Dc=$a.sourceItem,M.isSameSession=Dc.isFromCurrentSession(this.$),ob=1,Dc=this.Nki(Dc,M)):Tb&&(M.isSameSession=$a.sourceItem.isFromCurrentSession(this.$),ob=2);if(M.copyContextSnapshot.commandParameters){const md=
-1985798686===$a.commandParameters.ribbonCommandInfo.command;Tb=M.commandParameters;var ad=this.$;$a?ad&&ad.ya?$a=$a.sessionId===ad.ya.UserSessionId:(d.ULS.shipAssertTag(537166211,0,!1,"ewaControl shouldn't be null"),$a=!1):(d.ULS.shipAssertTag(537166212,0,!1,"copyContext shouldn't be null"),$a=!1);Tb.clearSystemClipboard=$a&&md&&ld&&!Dc;M.commandParameters.copyPasteTargetType=ob}}}getSessionId(){return this.$.ya.UserSessionId}Nki(M,$a){const ob=Wd.b(M.ranges,Tb=>Tb.gf)&&Wd.b($a.commandParameters.originalDestinations,
Tb=>1!==Tb.top);return Wd.b(M.ranges,Tb=>Tb.isRow)&&Wd.b($a.commandParameters.originalDestinations,Tb=>1!==Tb.left)||ob}mMh(M){switch(M){case 1:return this.vHd;case 64:case 4:case 2:case 256:return this.CXc;default:throw Error.invalidOperation("Unsupported selection");}}cIh(){return W.g(this.$).ha.Me&470?yd.floatingObject:1===W.g(this.$).ha.Me?yd.cells:yd.unknown}getDialogResponse(){}}Object(c.a)(Hd,"ExcelCopyPasteApplicationHost",null,[277]);var le=a(155);class Le extends x.a{constructor(M,$a){super(M);
this.kp=null;this.lci=(ob,Tb)=>{1===ob?(ob=Le.Bgh[Tb[Le.Agh]],d.ULS.sendTraceTag(537167683,0,50,`InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler OK button pressed with valid input, shift direction = ${0===ob?"Horizontal":"Vertical"}`),this.kp.setResult(ob)):(d.ULS.sendTraceTag(537167682,0,50,"InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler cancel button pressed"),this.kp.Ht())};this.Ag($a)}get uc(){return"InsertCopiedCutCellsDialog"}Ag(M){this.kp=new le.a;const $a=B.a.instance.ga(16);
M=this.WM(M);this.initializeAndShow($a,this.lci,M)}WM(M){return{[Le.dv]:this.uc,[Le.qmi]:M}}}Le.Agh="direction";Le.qmi="isRtl";Le.Bgh={["Vertical"]:1,["Horizontal"]:0};Object(c.a)(Le,"InsertCopiedCutCellsDialog",x.a,[]);class Md{C4b(M,$a){return(new Le(M,$a)).kp.task}}Object(c.a)(Md,"InsertCopiedCutCellsDialogFactory",null,[276]);var ke=a(86),ve=a(47),ge=a(45);class we{constructor(M){this.A5b="";this.g2=this.ft=null;this.Nqc=!1;this.e9e=($a=null,ob=null)=>{this.hide($a,ob)};this.gridView=W.g(M);this.gridView.ha.YG(this.e9e)}AKe(){this.Nqc||
(d.ULS.sendTraceTag(537167680,0,50,"PasteIndicationManager.DownloadPrerequisitesIfNeeded: Trying to get appChrome"),this.gridView.$.Yx(M=>{M.Baa(0).then(()=>{this.Nqc=!0})}))}Mkj(M){var $a=M.commandParameters.id;d.ULS.sendTraceTag(537167651,0,50,`PasteIndicationManager.ScheduleDisplay: pasteCommandId = ${$a}, cancelCtx is null = ${!this.ft}, PrerequisitesDownloaded = ${this.Nqc}`);this.AKe();this.A5b=$a;$a=!this.ptf();if(!this.ft||$a)this.Hxe(),this.ft=ve.a.instance.create(()=>{this.qhh(M)},void 0===
M.timeoutToShowSpinnerInMs||null===M.timeoutToShowSpinnerInMs?100:M.timeoutToShowSpinnerInMs,ge.a.zXi);this.g2=M.commandParameters.originalDestinations}qhh(M){this.Nqc?(this.display(M.commandParameters.originalDestinations),M.pasteIndicationDisplayStatus=Sd.m7c):(d.ULS.sendTraceTag(537167650,0,50,"PasteIndicationManager.DisplayIfPossible: Prerequisites were not ready, skipping display"),this.hide(),M.pasteIndicationDisplayStatus=Sd.j0i)}display(M){d.ULS.sendTraceTag(537167649,0,50,"PasteIndicationManager.Display: started");
this.gridView.ob.Ww(mb.a.mea(Qb.d(this.gridView.$.oa),M),we.Ypc,!0);this.gridView.ob.Jn(we.Ypc)}lkd(M){d.ULS.sendTraceTag(537167648,0,50,`PasteIndicationManager.HideForPasteId: pasteCommandId = ${M}, currentPasteCommandId = ${this.A5b}`);M&&gb.a.equals(M,this.A5b,!1)&&this.hide()}hide(M=null){this.g2&&M&&this.ptf()&&d.ULS.sendTraceTag(537167647,0,15,"PasteIndicationManager.Hide: Triggered by a SelectionChanged event while indication is (or will be) active but active range did not change");this.A5b=
"";this.Hxe();this.g2=null;this.gridView.ob.Pg(we.Ypc);this.gridView.ob.zi(null,we.Ypc)}ptf(){return T.Q(this.gridView.ha.sa.selectedRanges,this.g2)}Hxe(){this.ft&&(ke.a.Ia(this.ft),this.ft=null)}dispose(){this.hide();this.gridView.ha.cG(this.e9e)}}we.Ypc=[30];Object(c.a)(we,"PasteIndicationManager",null,[273,10]);var De=a(979),ib=a(53),Yb=a(699);class pc extends f.a{constructor(M){super();this.$=M;this.Xm=B.a.instance;this.Eb()}create(){const M=ib.a.bR([75,76],4,this.fb,void 0,void 0,void 0,pc.sna),
$a=ea.GetServiceTaskFactory.create(this.$.da,18,this.$.la,this.fb);ca.TaskExtensions.Aa(ca.TaskExtensions.Td([$a,M],this.la),()=>{const ob=new De.a;let Tb=null;this.f2g(ob).then(Dc=>{Tb=Dc.uAe;const ad=copyPasteInfra.createCopyPasteInfra(Tb,new Hd(this.$),ob,this.$);d.ULS.shipAssertTag(537167762,0,!!this.$.ya,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext should not be null");d.ULS.shipAssertTag(537167761,0,!!this.$.ya&&!!this.$.ya.DocumentHostInfo,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext.DocumentHostInfo should not be null");
const ld=Tb.getMetadataManager();var md=Object(Yb.b)(this.$.da,254,()=>new Pb(this.$,ld,$a.result,ad,new Fa(this.$,W.g(this.$)),new Md,this.$.ya.DocumentHostInfo.UserId,Tb.getInitializationError()));this.pb(md);if(Dc.w0a){md=Pb.pac();const Wb=JSON.stringify(Dc.w0a.dataClipboardCapabilities),Nc=Dc.w0a.clipboardStrategiesToInitialize[0].clipboardStrategyType===Dc.w0a.dataClipboardStrategyType,gd=void 0===window.bsqmXLSPageLoadStartTime||null===window.bsqmXLSPageLoadStartTime?"-1":(Date.now()-window.bsqmXLSPageLoadStartTime.getTime()).toString();
d.ULS.sendTraceTag(41731933,0,50,`CopyPasteInfrastructureFactory.Create: Initialize CCP infra succeed. SliceName=${md}, StrategyType=${Dc.w0a.dataClipboardStrategyType}, StrategyCapabilities=${Wb}, IsBestStrategyTypeInitialized=${Nc}, InfraLoadTimeMS=${gd}`)}else d.ULS.shipAssertTag(537167760,0,!1,"CopyPasteInfrastructureFactory.Create: initResult.ClipboardPlatformEnvironmentInitializationInfo should not be null")},Dc=>{const ad=Pb.pac();Dc=Dc?copyPasteInfra.getStringifiedError(Dc):"null";d.ULS.shipAssertTag(38847436,
0,!1,`CopyPasteInfrastructureFactory.Create: error during call to clipboardPlatformEnvironment.Init(). Copy Paste operations will not be available in this session. SliceName: ${ad} error: ${Dc}`)})},this.la,3)}dispose(){super.dispose()}f2g(M){let $a=null;var ob=window.clipboardPlatform;ob&&($a=ob.getClipboardPlatformEnvironment());if(!$a)return d.ULS.shipAssertTag(537167759,0,!1,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: getClipboardPlatformEnvironment should have returned a valid object"),
Promise.reject(null);ob=this.$.ya;const Tb=[ob.OfficeOnlineChromeExtensionId,ob.ChromeClipboardAccessExtensionId],Dc=this.Xm.Va(5);var ad=this.$.pe.get(57);let ld=!ad&&this.$.pe.get(5);const md=this.$.ea.jc;md&&(md.inWebPart||md.inViewerFromWebPart||md.isDivSyndicated)&&(ld=!1);ad=this.kLh(ld,!ad);d.ULS.shipAssertTag(537167758,0,!!ob.DocumentHostInfo,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: bootstrapContext.DocumentHostInfo should not be null");return $a.init(this.$,
M,Tb,ob.SharedClipboardHostingApp,ob.SharedClipboardHostingApps,ob.SharedClipboardHostingEnvironments,ob.SharedClipboardOverrideOrigin,ob.SharedClipboardSchemaVersion,ob.SharedClipboardExpirationInMinutes,ob.ClipboardPromiseTimeoutInMinutes,Dc,ob.MachineCluster,new ec(this.$),ad,ob.DocumentHostInfo.UserId,ob.ClipboardTtlInMS,r.EwaSettings.ma(310),ob.UserSessionId).then(Wb=>Object(b.a)(new gc,{uAe:$a,w0a:Wb}),Wb=>Promise.reject(Wb))}kLh(M,$a){const ob=[];M&&$a&&ob.push(this.Hah());$a&&(ob.push(this.X4c(7)),
ob.push(this.X4c(0)));M&&ob.push(this.nFe());ob.push({clipboardStrategyType:4});const Tb=ob?ob.map(Dc=>JSON.stringify(Dc)).join(","):"[]";d.ULS.sendTraceTag(39978242,0,50,`CopyPasteInfrastructureFactory.GetClipboardStrategiesInitList: create clipboard stratgy initialization list: isBrowserStorageAllowed=${M}, isSystemClipboardAllowed=${$a}, result = ${Tb}`);return ob}nFe(){const M=this.$.ya,$a={clipboardStrategyType:5};$a.sessionId=M.UserSessionId;$a.useSharedClipboardIframe=!0;$a.sharedClipboardHostingApp=
M.SharedClipboardHostingApp;$a.sharedClipboardHostingApps=M.SharedClipboardHostingApps;$a.sharedClipboardHostingEnvironments=M.SharedClipboardHostingEnvironments;$a.sharedClipboardOverrideOrigin=M.SharedClipboardOverrideOrigin;$a.sharedClipboardSchemaVersion=M.SharedClipboardSchemaVersion;$a.sharedClipboardExpirationInMinutes=M.SharedClipboardExpirationInMinutes;$a.wacCluster=M.MachineCluster;return $a}Hah(){const M={clipboardStrategyType:6};M.localStorageStrategyParameters=this.nFe();M.systemClipboardStrategyParameters=
this.X4c(0);return M}X4c(M){const $a={};$a.clipboardStrategyType=M;$a.skipFilesIfPlainTextExists=!0;return $a}static ka(M){M.da.Ga(373,new we(M));M.da.Ga(pc.sna,new pc(M))}}pc.sna=255;Object(c.a)(pc,"CopyPasteInfrastructureFactory",f.a,[]);var Jc=a(9);a.d(C,"a",function(){return Xc});const Xc=()=>{Jc.a.Fa(M=>{pc.ka(M)})}},1151:function(n,C,a){n=a(0);var c=a(15),b=a(684),d=a(554),f=a(84),e=a(82),k;(function(Da){Da[Da.applicationFeatureHelperHandler=0]="applicationFeatureHelperHandler";Da[Da.cloudPolicySettings=
1]="cloudPolicySettings";Da[Da.alternateAuthToken=2]="alternateAuthToken"})(k||(k={}));Object(n.b)("ApplicationFeatureHelperRequestType",k);class l{constructor(){this.message=null;this.tec=0}}Object(n.a)(l,"HttpRequstToPromiseRejectData",null,[]);var m=a(98),u=a(80),t=a(238);class w{constructor(Da,Ba){this.nb=Da;this.zh=Ba}l4c(Da,Ba,ea,Y=null,ja=null,ca=null,ba=null,ua=null){const wa=k[ea],ia=wa+"RequestFailure";m.Health.instance.recordKpiUsage(ia,0,"jpittsdirects",null);return new Promise((xa,gb)=>
{c.ULS.sendTraceTag(50622688,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Initializing HttpRequest {0}.",wa);const va=null!=ba?ba:this.nb.qd("ApplicationFeatureHelperRequestQueueTimeout",15E3),sa=null!=ua?ua:this.nb.qd("ApplicationFeatureHelperRequestSentTimeout",3E4);this.zh.z9(Da,1,null,this.BQh(ea,Y),ca,!1,1,ab=>{c.ULS.sendTraceTag(50622689,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} Succeeded.",wa);try{if(void 0===ab||null===ab||void 0===
ab.data||null===ab.data||void 0===ab.data.Xd||null===ab.data.Xd){m.Health.instance.recordKpiFailure(ia,"Invalid RequestSucceededEventArgs",!1,!0,null);let nb=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data or args.Data.ResponseData is null or undefined request {0}",wa);gb(this.ywb(nb,ab))}else if(ab.data.httpStatus!==t.a.VO){m.Health.instance.recordKpiFailure(ia,"HttpStatusCode_"+ab.data.httpStatus.toString(),!1,!0,null);let nb=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: ApplicationFeatureHelper Service token generation returned unexpected response code {0}, request {1}",
ab.data.httpStatus,wa);gb(this.ywb(nb,ab))}else{void 0!==ja&&null!==ja&&void 0!==ab.data.responseHeaders&&null!==ab.data.responseHeaders&&ja(ab.data.responseHeaders);var Ua=Ba(ab.data.Xd);if(Ua)c.ULS.sendTraceTag(50622690,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Successfully parsed response for request {0}",wa),xa(Ua);else{m.Health.instance.recordKpiFailure(ia,"Parse Failure",!1,!0,null);let nb=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Failed to parse response for request {0}",
wa);gb(this.ywb(nb,ab))}}}catch(nb){m.Health.instance.recordKpiFailure(ia,"Unexpected Failure",!1,!0,null),Ua=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Exception {0} for request {1}",nb,wa),gb(this.ywb(Ua,ab))}},ab=>{let Ua;ab.data?(m.Health.instance.recordKpiFailure(ia,"HttpStatusCode_"+ab.data.httpStatus.toString(),!1,!0,null),Ua=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Request Failed: HttpStatus - {0}, ResponseData - {1} for Request - {2}",
ab.data.httpStatus,ab.data.Xd||"No Data",wa)):(m.Health.instance.recordKpiFailure(ia,"Invalid RequestFailedEventArgs",!1,!0,null),Ua=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data is null or undefined for request {0}",wa));gb(this.ywb(Ua,ab))},null,void 0,void 0,va,sa)})}ywb(Da,Ba){const ea=new l;ea.message=Da;ea.tec=Ba&&Ba.data?Ba.data.httpStatus:-1;return ea}BQh(Da,Ba){const ea={};ea["x-UserDataSignature"]=this.nb.Xa("UserDataSignature");ea["x-LicensingIsEnabled"]=
this.nb.qa("LicensingIsEnabled").toString();ea["x-CacheIsEnabled"]=this.nb.qa("LicensingRedisIsEnabled").toString();ea["x-OcpsIsEnabled"]=this.nb.qa("OcpsIsEnabled").toString();ea["x-LicensingAADIdIsEnabled"]=this.nb.qa("LicensingAadIdIsEnabled").toString();0===Da&&(ea["x-LicenseCheckOnTenantEnabled"]=this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SafeLinksLicenseCheck",!1).toString(),ea["x-SupportUserConsentDependentFeatures"]="true",ea["x-AFHUserConsentGroupValue"]="0",ea["x-UseShellServiceForUserConsentGroup"]=
"true",ea["x-SMBUserLicensingEnabled"]="true",ea["x-AFHPIPLComplianceEnabled"]=u.a.oz(window.location.href,"wd_afhpipl")||"false");if(Ba)for(let Y of Ba.keys)ea[Y]=Ba.na(Y);return ea}}Object(n.a)(w,"HttpRequestToPromiseUtility",null,[]);var r=a(4),v;(function(Da){Da[Da.loki=0]="loki";Da[Da.augloopACLP=1]="augloopACLP"})(v||(v={}));Object(n.b)("AlternateAuthSupportApp",v);var y=a(731),x=a(41);class B{constructor(){this.Token=null;this.ExpirationTime=0}}Object(n.a)(B,"WacAlternateAuthToken",null,[]);
class z{constructor(Da,Ba){this.RKj=3E5;if(void 0===Da||null===Da||void 0===Ba||null===Ba)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.nb=Da;this.ZQb=new b.a(d.a.Zk());this.Zib=new w(Da,Ba);void 0!==y.a.Evd&&null!==y.a.Evd&&void 0!==y.a.Ekc&&null!==y.a.Ekc&&0<y.a.Ekc&&(Da=new B,Da.Token=y.a.Evd,Da.ExpirationTime=y.a.Ekc,this.ZQb.ia("loki",Da))}JIh(){let Da=null;this.ZQb.lb(v[0])&&(Da=this.ZQb.na(v[0]));return void 0===Da||null===Da||this.Urd(Da)?this.Fzh():Promise.resolve(Da.Token)}Urd(Da){return Da.ExpirationTime-
Date.now()<this.RKj}Fzh(){const Da=new b.a(d.a.Zk());Da.ia("X-AlternateAuthApp",v[0]);return this.Zib.l4c(this.wva("/afhs/AlternateAuthHelperHandler.ashx"),Object(f.a)(this,this.JWi,"parseAlternateAuthTokenResponse"),2,Da).then(Ba=>{c.ULS.sendTraceTag(545821456,3004,50,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Retrieved WacAlternateAuthToken for {0}",v[0]);this.ZQb.ia(v[0],Ba);return Ba.Token},Ba=>{Ba=Object(e.a)(l,Ba);c.ULS.sendTraceTag(545604827,3004,10,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Error: {0}, status code: {1}",
Ba.message,Ba.tec);return null})}JWi(Da){let Ba=null;({fu:Ba}=x.d(Da));c.ULS.sendTraceTag(545821457,3004,Ba?50:10,"ParseAlternateAuthTokenResponse: fetched WacAlternateAuthToken from {0}",Da);return Ba}wva(Da){return String.format("{0}{1}?{2}",this.nb.Xa("WebServiceBase"),Da,r.AFrameworkApplication.qj)}}Object(n.a)(z,"AlternateAuthHelper",null,[217]);var A=a(455);class I{constructor(Da,Ba,ea){this.featureName=null;this.isEnabled=!1;this.tierName=0;this.featureName=Da;this.isEnabled=Ba;this.tierName=
ea}}Object(n.a)(I,"FeatureStateChangeArgs",null,[]);var F=a(135),U=a(251),X=a(27),T=a(111),G=a(173),D;(function(Da){Da[Da.Enabled=0]="Enabled";Da[Da.Disabled=1]="Disabled"})(D||(D={}));Object(n.b)("FeatureState",D);var J=a(83),L=a(25),H=a(188);class R{constructor(Da,Ba,ea=null,Y=null,ja=null){this.Kua=this.oWb=this.gge=this.Cqa=this.qXb=null;this.Zib=new w(Da,Ba);this.nb=Da;this.vtg=Da.qd("LicensingMaxRetryAttempts",0);this.HLc=Da.qa("IsO365ConsumerHost");this.GLc=Da.qa("IsO365CommercialHost");this.aUb=
Da.qa("PremiumUpsellIsEnabled");this.Q4d=ea;this.pke=Y;this.La=ja;this.Bqa=Da.qa("LicensingIsEnabled");this.BEa=Da.qa("OcpsIsEnabled")&&this.GLc;this.eTc=Da.qa("ShowPrivacyDialog")&&!!Y;this.U9d=Da.qa("IsAnonymousUser");this.wad=new Promise(ca=>{ca(!1)});this.KBa=new Promise(ca=>{ca(!0)});this.Jua=new b.a(d.a.Zk());this.cYb=!0;this.xbe=this.YRh();this.Ypd()&&!this.U9d?(void 0!==r.AFrameworkApplication.ta&&null!==r.AFrameworkApplication.ta&&(this.qXb=r.AFrameworkApplication.ta.ZD,void 0!==this.qXb&&
null!==this.qXb&&(this.Cqa=this.qXb.Rg("WebServiceCall","ApplicationFeatureHelperService"))),this.Kua=this.LYd()):this.Kua=new Promise(ca=>{ca({})});this.Kua.catch(ca=>{c.ULS.sendTraceTag(42513088,3004,10,JSON.stringify(ca))});this.cYb&&(this.aUb=!1,this.isFeatureEnabled("FreemiumUpsell",!0).then(ca=>{this.aUb=this.nb.qa("PremiumUpsellIsEnabled")&&ca;return null}))}YRh(){const Da=this.nb.wo("AllLicensedFeatures")?this.nb.ow("AllLicensedFeatures"):[],Ba=new A.a;for(let ea=0;ea<Da.length;ea++)Ba.add(Da[ea]);
return Ba}Ypd(){return this.GLc||this.HLc}LYd(Da=0,Ba=!1){c.ULS.sendTraceTag(51185368,3004,50,"ApplicationFeatureHelper_TryInitializeLicensing: forceRefresh = {0}",Ba);const ea=F.a.Ur();ea&&(ea.set("retryAttempt",Da.toString()),ea.set("forceRefresh",Ba.toString()),ea.set("isO365ConsumerHost",this.HLc.toString()),ea.set("isO365CommercialHost",this.GLc.toString()),ea.set("isFreemiumUpsellEnabled",this.aUb.toString()));m.Health.instance.recordKpiUsageForAlertableKpi("AFHSLicensingFailedRequest","waclicensing",
ea);m.Health.instance.recordKpiUsage("AFHSLicensingSuccessfulRequest",1,"waclicensing",ea);void 0!==this.Cqa&&null!==this.Cqa&&this.Cqa.start();let Y=null;Ba&&(Y=new b.a(d.a.Zk()),Y.ia("x-LicensingForceRefresh","true"));this.gge=new Date;return(this.Bqa?this.Zib.l4c(this.wva("/afhs/ApplicationFeatureHelperHandler.ashx"),Object(f.a)(this,this.MWi,"parseApplicationFeatureHelperResponse"),0,Y,Object(f.a)(this,this.f1i,"processApplicationFeatureHelperResponseHeaders"),["Date"]):Promise.resolve({})).then(ja=>
{const ca=Object.assign(new H.a,{durationMs:this.K7f()});ca.extendedProperties=ea;ca.extendedProperties&&ja&&(ca.extendedProperties.set("featureCount",T.a.count(ja).toString()),ca.extendedProperties.set("licensingTestFeatureEnabled",("LicensingTestFeature"in ja).toString()),ca.extendedProperties.set("msoPremiumBadgeEnabled",("MsoPremiumBadge"in ja).toString()),this.oWb&&ca.extendedProperties.set("fromCache",(this.oWb<this.gge).toString()));m.Health.instance.recordKpiSuccess("AFHSLicensingSuccessfulRequest",
ca);return ja},ja=>{const ca=Object.assign(new H.a,{durationMs:this.K7f()}),ba=Object(e.a)(l,ja);if(!ba)return c.ULS.sendTraceTag(51491471,3004,10,"ApplicationFeatureHelper_TryInitializeLicensing: Invalid cast to HttpRequestToPromiseRejectData"),m.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","InvalidCastToHttpRequestToPromiseRejectData",!1,!0,ca),new Promise((ua,wa)=>{wa(ja)});ca.extendedProperties=ea;ca.extendedProperties&&ca.extendedProperties.set("status",ba.tec.toString());m.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest",
"RequestFailed",!1,!0,ca);return 408===ba.tec&&++Da<=this.vtg?this.LYd(Da):new Promise((ua,wa)=>{wa(ba)})})}MWi(Da){(Da=x.b(Da))?(c.ULS.sendTraceTag(50436170,3004,50,"ParseApplicationFeatureHelperResponse: Successfully fetched features"),c.ULS.sendTraceTag(50938594,3004,50,"{0}",Da)):c.ULS.sendTraceTag(50436171,3004,10,"ParseApplicationFeatureHelperResponse: ApplicationFeatureHelper Service returned a null feature set");return Da.Features}wva(Da){var Ba=String.format("{0}{1}",this.nb.Xa("WebServiceBase"),
Da);this.nb.wo("ApplicationFeatureHelperHttpCachingEnabled")&&this.nb.qa("ApplicationFeatureHelperHttpCachingEnabled")&&(Da=R.vbc(this.nb))&&0<Da.length&&(this.cYb&&(Da+="ucbf"),Ba=new U.QueryStringBuilder(Ba),Ba.Zi("afhskey",Da),Ba=Ba.toString());return Ba}isFeatureEnabled(Da,Ba){if(!this.BEa&&!this.eTc&&!this.Bqa)return this.KBa;c.ULS.sendTraceTag(42513091,3004,50,"ApplicationFeatureHelper.IsFeatureEnabled: Call made to check if feature: {0} is enabled.",Da);if("ConnectedServices"===Da){var ea=
this.BEa?this.Q4d.pF("ControllerConnectedServicesEnabled"):this.KBa;const ca=this.eTc?this.pke.getSettings().then(ba=>2!==ba.du,()=>Ba):this.KBa;return ea.then(ba=>ba?ca:this.wad)}ea=null;ea=this.BEa?this.Q4d.isFeatureEnabled(Da):this.KBa;let Y=null;Y=this.Bqa?this.Nhi(Da,Ba):this.KBa;let ja=null;ja=this.eTc?this.pke.isFeatureEnabled(Da):this.KBa;return ea.then(ca=>ca?ja.then(ba=>ba?Y:this.wad):this.wad).then(ca=>{this.snf(Da,ca,!0);return ca},()=>{this.snf(Da,Ba,!1);return Ba})}snf(Da,Ba,ea){c.ULS.sendTraceTag(526713106,
3004,50,"FeatureName={0}, IsEnabled={1}, IsSuccess={2}",Da,Ba,ea)}getFeatureTier(Da,Ba){if(!this.Bqa)return new Promise(ea=>{ea(2)});c.ULS.sendTraceTag(42804871,3004,50,"ApplicationFeatureHelper.GetFeatureTier: Call made to get Feature's Tier.",Da);return this.Kua.then(ea=>this.ycc(Da,ea,Ba),()=>Ba)}isFreemiumUpsellEnabled(){return this.aUb&&this.HLc&&!this.U9d}launchUpsellExperience(Da,Ba=null){c.ULS.sendTraceTag(594564814,3004,50,String.format("ApplicationFeatureHelper_LaunchUpsellExperience: Launching upsell experience for experienceId: {0}",
Da));var ea=F.a.Ur();ea&&(ea.set("experienceId",Da),Ba&&ea.set("campaignId",Ba));m.Health.instance.recordKpiUsage("AFHCLaunchUpsellSuccess",1,"waclicensing",ea);if(ea=J.a.instance.yh("Common.IInProductMessagingUIManager")){const Y=Object(f.a)(this,this.A2h,"handleDimeTaskComplete");ea.Blf(Da,Y,Ba)}else c.ULS.sendTraceTag(594367561,3004,15,"InProductMessaging was not initialized"),m.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","InProductMessagingNotInitialized",!1,!0,null),this.La.de(L.a.K$b,
2,{["experience"]:Da})}Mma(Da,Ba){if(!this.Bqa)return null;if(!Da||!Ba)return c.ULS.sendTraceTag(594564813,3004,10,"ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: Invalid input."),null;const ea=G.a.create().toString();this.Jua.lb(Da)||this.Jua.ia(Da,new b.a(d.a.Zk()));this.Jua.na(Da).add(ea,Ba);c.ULS.sendTraceTag(594564812,3004,50,String.format("ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: registered callback {0} for feature {1}",ea,Da));return ea}DJd(Da,Ba){this.Bqa&&
(Da&&this.Jua.lb(Da)?Ba&&G.a.isValid(Ba)?this.Jua.na(Da).lb(Ba)?(c.ULS.sendTraceTag(594564808,3004,50,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: Removing callback {0} for feature {1}",Ba,Da)),this.Jua.na(Da).remove(Ba)):c.ULS.sendTraceTag(594564809,3004,15,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: callbackId {0} not registered for feature {1} ",Ba,Da)):c.ULS.sendTraceTag(594564810,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid callbackId {0} for feature {1}",
Ba,Da)):c.ULS.sendTraceTag(594564811,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid or non registered featureName {0}",Da)))}ycc(Da,Ba,ea){return this.cYb?Da in Ba?Ba[Da].LicenseTier:ea:Da in Ba?this.iXi(Ba[Da],ea):ea}iXi(Da,Ba){switch(Da.toLowerCase()){case "unknown":return 0;case "basic":return 1;case "premium":return 2;default:return Ba}}A2h(){c.ULS.sendTraceTag(594367560,3004,50,"ApplicationFeatureHelper_HandleDimeTaskComplete");this.Kua.then(Da=>{this.aPf(Da)}).catch(()=>
{this.aPf({})})}aPf(Da){c.ULS.sendTraceTag(594051087,3004,50,"ApplicationFeatureHelper_RefreshLicensingAndNotifyUpdatedFeatures");const Ba=this.LYd(0,!0);Ba.then(ea=>{this.Kua=Ba;T.a.count(ea)>T.a.count(Da)?m.Health.instance.recordKpiSuccess("AFHCLaunchUpsellSuccess",null):m.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","FeatureCountNotIncreased",!1,!0,null);for(let Y of this.Jua.keys)if(Y in ea){const ja=this.ycc(Y,ea,0);Y in Da?this.ycc(Y,Da,0)!==ja&&this.szd(Y,!0,ja):this.szd(Y,!0,
ja)}else Y in Da&&this.szd(Y,!1,this.ycc(Y,Da,0))}).catch(ea=>{m.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","LicensingRefreshFailed",!1,!0,null);c.ULS.sendTraceTag(594051086,3004,10,JSON.stringify(ea))})}szd(Da,Ba,ea){c.ULS.sendTraceTag(594051085,3004,50,"ApplicationFeatureHelper_NotifyFeatureStateChanged: Notify feature state changed callbacks for feature {0}, {1}, {2}",Da,Ba,ea);Ba=new I(Da,Ba,ea);ea=this.Jua.na(Da);for(let Y of ea)try{Y.value(Ba)}catch(ja){c.ULS.sendTraceTag(594051084,
3004,10,String.format("ApplicationFeatureHelper_NotifyFeatureStateChanged: Exception when calling registered callback: feature: {0} callbackId: {1}, exception {2}",Da,Y.key,ja.message))}}Wd(Da,Ba){if(this.Bqa){const ea=this.xbe.contains(Da);let Y=!0,ja="",ca=!1;return this.Kua.then(ba=>{Da in ba?(ba=ba[Da],ja=D[ba.FeatureState],Y=1!==ba.FeatureState):Y=!ea;this.Bnf(Da,ea,ja,ca,Ba,Y);return Y},()=>{ca=!0;ea&&(Y=Ba);this.Bnf(Da,ea,ja,ca,Ba,Y);return Y})}return this.KBa}Bnf(Da,Ba,ea,Y,ja,ca){c.ULS.sendTraceTag(557389507,
3004,50,"featureName : {0}, isLicenseControlledFeature={1}, encounteredError = {2}, featureData={3}, fallbackValue={4}, isAllowed={5}",Da,Ba,Y,ea,ja,ca)}Nhi(Da,Ba){if(this.cYb)return this.Wd(Da,Ba);if(this.Bqa){if(this.xbe.contains(Da))return this.Kua.then(ea=>Da in ea,()=>Ba);c.ULS.sendTraceTag(590385821,3004,50,"ApplicationFeatureHelper_IsFeatureAllowedByUserLicense: Feature '{0}' requested while not in the licensed features set.",Da)}return this.KBa}f1i(Da){try{Da&&"Date"in Da&&(this.oWb=new Date(Da.Date),
c.ULS.sendTraceTag(578863817,3004,50,"ProcessApplicationFeatureHelperResponseHeaders Date {0}",this.oWb.toString()))}catch(Ba){c.ULS.sendTraceTag(578863818,3004,10,"ProcessApplicationFeatureHelperResponseHeaders Exception {0}",Ba)}}K7f(){if(void 0!==this.Cqa&&null!==this.Cqa){const Da=this.Cqa.yc;this.Cqa.stop();return Da}return null}static vbc(Da){try{if(X.a.dHj){const Ba=Da.Xa("UserDataSignature").split(".");if(1<Ba.length){const ea=window.self.atob(Ba[1]),Y=JSON.parse(ea).LocalStorageKey;if(void 0!==
Y&&null!==Y&&0<Y.length)return Y}}}catch(Ba){c.ULS.sendTraceTag(578863816,3004,10,"GetLocalStorageCacheKey exception {0}",Ba.toString())}return null}}Object(n.a)(R,"ApplicationFeatureHelper",null,[218]);var Q=a(187);class O{constructor(Da,Ba){this.PolicySettings=null;this.ExpirationTime=0;this.PolicySettings=Da.PolicySettings;Da=new Date;Da.setMinutes(Da.getMinutes()+Ba);this.ExpirationTime=Da.getTime()}}Object(n.a)(O,"CloudPolicySettingsCacheData",null,[]);var V=a(816),W=a(373),da=a(227);class ta{static V5f(){return r.AFrameworkApplication.fa.qa("SideCarIsEnabled")?
ta.rvc&&ta.pod?new Promise(Da=>{Da(!0)}):new Promise((Da,Ba)=>{ta.rvc=da.a.create(r.AFrameworkApplication.fa.Xa("SideCarUrl"));W.a.yia(ta.rvc);ta.rvc.D9((ea,Y)=>{(ta.pod=Y.succeeded)?Da(Y.succeeded):Ba(Y.succeeded)})}):new Promise(Da=>{Da(!1)})}}ta.pod=!1;ta.rvc=null;Object(n.a)(ta,"SideCarLoader",null,[]);class K{constructor(){this.ControllerConnectedServicesFeatureNames=this.PolicySettings=null}}Object(n.a)(K,"CloudPolicySettingsData",null,[]);class na{constructor(Da,Ba){this.AGc=0;this.f3b=null;
this.Zib=new w(Da,Ba);this.nb=Da;Ba=Da.Xa("HostAuthType");this.BEa=Da.qa("OcpsIsEnabled")&&Da.qa("IsO365CommercialHost")&&!(void 0===Ba||null===Ba)&&"aad"===Ba.toLowerCase();this.Bde=x.b(Da.Xa("OcpsDefaultSettings")||"{}");this.Mjb=this.vbc();Ba=this.nb.wo("ServicesControlsMicrosoftControllerServicesList")?this.nb.ow("ServicesControlsMicrosoftControllerServicesList")||[]:[];this.$Rb=new A.a;for(let ea=0;ea<Ba.length;ea++)this.$Rb.add(Ba[ea]);this.BEa&&!Da.qa("IsAnonymousUser")&&Da.qa("SideCarIsEnabled")?
this.f3b=this.FNj():this.f3b=this.Coa(this.BEa,this.wva("/afhs/CloudPolicySettings.ashx"),Object(f.a)(this,this.NWi,"parseCloudPolicySettingsResponse"));this.f3b.then(()=>null).catch(ea=>{c.ULS.sendTraceTag(50622685,3004,10,JSON.stringify(ea))})}pF(Da,Ba=!0){if(!this.BEa){const ca=this;return new Promise(ba=>{ba(ca.kwb(Da))})}let ea=this,Y=this;const ja=this.f3b.then(ca=>{try{let ba=null;ca.PolicySettings&&"unknown"in ca.PolicySettings&&(ba=ca.PolicySettings.unknown);if(ba){if(Da in ba&&void 0!==
ba[Da]&&null!==ba[Da])return new Promise(wa=>{wa("0"!==ba[Da])});const ua=Da.toLowerCase();if(ua in ba&&void 0!==ba[ua]&&null!==ba[ua])return new Promise(wa=>{wa("0"!==ba[ua])});c.ULS.sendTraceTag(51512667,3004,50,"Policy"+Da+" not found, using default");return new Promise(wa=>{wa(ea.kwb(Da))})}return new Promise(ua=>{ua(ea.kwb(Da))})}catch(ba){return c.ULS.sendTraceTag(50622686,3004,10,"Failed to get "+Da+" policy value. Error Message: {0}",ba.message),ea.handleError(ba.toString(),Ba,ea.kwb(Da))}},
ca=>Y.handleError(ca,Ba,Y.kwb(Da)));ja.then(ca=>{c.ULS.sendTraceTag(50651667,3004,50,"CloudPolicySettingsHelper.GetBooleanPolicySetting: policy: {0}, value: {1}",Da,ca);return null});return ja}isFeatureEnabled(Da,Ba=!0){if(this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseApplicationFeatureHelperAPIForFeedbackAndSurvey",!1))return this.Phi(Da,Ba);let ea=new Promise(ja=>{ja(!0)}),Y="";this.$Rb.contains(Da)&&(Y="ControllerConnectedServicesEnabled",ea=this.pF(Y,Ba));ea.then(ja=>{c.ULS.sendTraceTag(50651668,
3004,50,"CloudPolicySettingsHelper.IsFeatureEnabled: Feature: {0}, enabled or not: {1}, by policy: {2}",Da,ja,Y);return null});return ea}Phi(Da,Ba=!0){let ea=new Promise(ja=>{ja(!0)}),Y="";"mso_sendASmile"===Da?Y="Enabled":"Survey"===Da||"FloodgateSurvey"===Da?Y="SurveyEnabled":this.$Rb.contains(Da)&&(Y="ControllerConnectedServicesEnabled");""!==Y&&(ea=this.pF(Y,Ba));ea.then(ja=>{c.ULS.sendTraceTag(558187080,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabledV2: Feature: {0}, enabled or not: {1}, by policy: {2}",
Da,ja,Y);return null});return ea}handleError(Da,Ba,ea){return Ba?new Promise(Y=>{Y(ea)}):new Promise((Y,ja)=>{ja(Da)})}Coa(Da,Ba,ea){if(!Da)return Promise.resolve(new K);let Y=!1,ja=null;m.Health.instance.recordKpiUsage("GetCloudPolicySettings",1,"jpittsdirects",null);let ca=this.K3c("GetCloudPolicySettings");return(new Promise((ba,ua)=>{if(void 0!==this.Mjb&&null!==this.Mjb&&0<this.Mjb.length){const wa=this.oNj();if(void 0!==wa&&null!==wa){Y=!0;ba(wa);return}}this.Zib.l4c(Ba,ea,1,null,Object(f.a)(this,
this.j1i,"processCloudPolicySettingsResponseHeaders"),["CheckIn-Interval"],this.nb.qd("CloudPolicySettingsRequestQueueTimeout",15E3),this.nb.qd("CloudPolicySettingsRequestSentTimeout",3E4)).then(wa=>{c.ULS.sendTraceTag(51662933,3004,50,"Retrieved CloudPolicySettingsData from OCPS");this.eOj(wa);ba(wa);return wa},wa=>{ua(wa);return null})})).then(ba=>{({stopwatch:ca,returnValue:ja}=this.tzc(ca));var ua=F.a.Ur();ua&&ua.set("FromCache",Y.toString());ua=Object.assign(new H.a,{durationMs:ja,extendedProperties:ua});
m.Health.instance.recordKpiSuccess("GetCloudPolicySettings",ua);return ba})}FNj(){return ta.V5f().then(()=>{c.ULS.sendTraceTag(593282845,3004,50,"CloudPolicySettingsHelper - Retrieving CloudPolicySettingsData Promise from Sidecar");return sidecar.cloudPolicy.GetCloudPolicySettingsData()})}wva(Da){return String.format("{0}{1}",this.nb.Xa("WebServiceBase"),Da)}NWi(Da){let Ba=null;({fu:Ba}=x.d(Da));c.ULS.sendTraceTag(50622687,3004,Ba?50:10,"ParseCloudPolicySettingsResponse: fetched CloudPolicySettingsData from {0}",
Da);return Ba}j1i(Da){try{if(void 0!==Da&&null!==Da&&"CheckIn-Interval"in Da){const Ba=parseInt(Da["CheckIn-Interval"]);void 0!==Ba&&null!==Ba&&0<Ba&&(this.AGc=Ba)}}catch(Ba){c.ULS.sendTraceTag(51662934,3004,10,"ProcessCloudPolicySettingsResponseHeaders Exception {0}",Ba)}}kwb(Da){return Da in this.Bde?"0"!==this.Bde[Da]:!0}oNj(){try{const Da=V.a.instance.getItem(this.Mjb);if(void 0===Da||null===Da)return c.ULS.sendTraceTag(51662936,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null"),
null;c.ULS.sendTraceTag(51662937,3004,50,"TryGetCloudPolicySettingsDataFromCache retrieved data {0} from LocalStorage",Da);const Ba=JSON.parse(Da);if(void 0===Ba||null===Ba)return c.ULS.sendTraceTag(51662938,3004,15,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null after parsing"),null;if(void 0===Ba.ExpirationTime||null===Ba.ExpirationTime)return c.ULS.sendTraceTag(51662939,3004,15,"TryGetCloudPolicySettingsDataFromCache ExpirationTime from LocalStorage is null after parsing"),
null;if((new Date(Ba.ExpirationTime)).getTime()<Date.now())return c.ULS.sendTraceTag(51662940,3004,50,"TryGetCloudPolicySettingsDataFromCache Cache is expired"),null;const ea=new K;ea.PolicySettings=Ba.PolicySettings;ea.ControllerConnectedServicesFeatureNames=new Q.a;this.nb.wo("ServicesControlsMicrosoftControllerServicesList")&&this.nb.ow("ServicesControlsMicrosoftControllerServicesList");for(let Y of this.$Rb)ea.ControllerConnectedServicesFeatureNames.add(Y);c.ULS.sendTraceTag(51662941,3004,50,
"TryGetCloudPolicySettingsDataFromCache data from LocalStorage retrieved");return ea}catch(Da){return c.ULS.sendTraceTag(51662942,3004,10,"TryGetCloudPolicySettingsDataFromCache exception {0}",Da.toString()),null}}eOj(Da){try{if(void 0===Da||null===Da||void 0===Da.PolicySettings||null===Da.PolicySettings)c.ULS.sendTraceTag(51662944,3004,15,"TrySetCloudPolicySettingsDataIntoCache data/PolicySettings is null");else if(0>=this.AGc)c.ULS.sendTraceTag(51662945,3004,15,"TrySetCloudPolicySettingsDataIntoCache _checkInInterval is Invalid");
else{const Ba=new O(Da,this.AGc),ea=JSON.stringify(Ba);c.ULS.sendTraceTag(51662946,3004,50,"TrySetCloudPolicySettingsDataIntoCache data to cache {0}",ea);V.a.instance.setItem(this.Mjb,ea);c.ULS.sendTraceTag(51662947,3004,50,"TrySetCloudPolicySettingsDataIntoCache set data to cache")}}catch(Ba){c.ULS.sendTraceTag(51662976,3004,10,"TrySetCloudPolicySettingsDataIntoCache exception {0}",Ba.toString())}}vbc(){const Da=R.vbc(this.nb);return Da&&0<Da.length?"OCPS"+Da:null}K3c(Da){const Ba=J.a.instance.yh("Microsoft.Office.Telemetry.Usage.IStopwatchBuilder");
return void 0!==Ba&&null!==Ba?Ba.Bc("WebServiceCall",Da):null}tzc(Da){if(void 0!==Da&&null!==Da){const Ba=Da.yc;Da.stop();return{returnValue:Ba,stopwatch:null}}return{returnValue:null,stopwatch:Da}}}Object(n.a)(na,"CloudPolicySettingsHelper",null,[215]);class P{constructor(){this.uKe=this.kgg=this.du=0;this.vKe=this.lgg=this.OHa="";this.ORc=this.Hea=2}clone(){const Da=new P;Da.du=this.du;Da.kgg=this.kgg;Da.uKe=this.uKe;Da.OHa=this.OHa;Da.lgg=this.lgg;Da.vKe=this.vKe;Da.Hea=this.Hea;Da.ORc=this.src;
return Da}get src(){return this.ORc}serialize(Da=null){const Ba={};if(!Da||Da.contains(P.ROa))Ba[P.ROa]=this.du;if(!Da||Da.contains(P.mEb))Ba[P.mEb]=this.OHa;if(!Da||Da.contains(P.nEb))Ba[P.nEb]=this.Hea;return JSON.stringify(Ba)}static create(Da,Ba=null){const ea=new P;ea.ORc=Da;void 0!==Ba&&null!==Ba&&(P.ROa in Ba&&(ea.du=Ba[P.ROa]),P.mEb in Ba&&(ea.OHa=Ba[P.mEb]),P.nEb in Ba&&(ea.Hea=Ba[P.nEb]));return ea}static deserialize(Da,Ba){try{const ea=JSON.parse(Da);if(void 0!==ea&&null!==ea)return P.create(Ba,
ea);c.ULS.sendTraceTag(50860946,306,10,"UserPrivacySettings Deserialize: Unable to convert {0} to dict",Da);throw Error.argument("settingsData");}catch(ea){throw c.ULS.sendTraceTag(50860947,306,10,"UserPrivacySettings Deserialize Exception = {0}",ea.toString()),ea;}}}P.ROa="CCS";P.mEb="CCSTime";P.nEb="OfficePrivacyRoamedNoticeShown";Object(n.a)(P,"UserPrivacySettings",null,[]);var ka=a(129);class pa{constructor(Da,Ba){if(void 0===Da||null===Da||void 0===Ba||null===Ba)throw Error.argumentNull("appSettingsManager/clientRequestManager");
this.nb=Da;this.zh=Ba;this.eRc=this.oe=null}wva(Da){var Ba=String.format("{0}RoamingServiceHandler.ashx?action=",this.nb.appSettings.RoamingServiceHandlerWebServiceBase||"");Ba=new Sys.StringBuilder(Ba);Ba.append(Da);Ba.append("&");Ba.append(r.AFrameworkApplication.qj);return Ba.toString()}executeRequest(Da,Ba,ea,Y=null){return this.zh.nnb(Da,Ba,Y,null,ea,"33",!1,null,6E4)}saveSettings(Da){return new Promise((Ba,ea)=>{try{if(void 0===this.oe||null===this.oe||void 0===Da||null===Da)c.ULS.sendTraceTag(51258443,
3004,15,"SaveUserPrivacySettings: Can't determine setting changes to save"),ea("Can't determine setting changes to save");else{var Y=this.oe.du!==Da.du;if(2===this.oe.src&&Y)this.ekj(Da),Ba(!0);else{var ja=this.Unj(Da);if(void 0===ja||null===ja||!ja.length)c.ULS.sendTraceTag(50917389,3004,15,"SaveUserPrivacySettings: returning since nothing changed"),ea("No changes to save");else if(1===this.oe.src)Ba(this.ecg(ja));else if(0===this.oe.src){c.ULS.sendTraceTag(51258444,3004,50,"UserPrivacySettingsHelper: SaveSettings to Roaming {0}",
ja);const ca=this.executeRequest(this.wva("saveUserPrivacySettings"),2,"SaveUserPrivacySettingsRequest",ja);ca.continueWith(()=>{if(ca.Eh||ca.Tf)c.ULS.sendTraceTag(50860929,3004,10,"SaveUserPrivacySettings: Roaming Request Cancelled/Failed"),Ba(!1);else{var ba=ca.result;void 0!==ba.Lg&&null!==ba.Lg&&void 0!==ba.Lg.data&&null!==ba.Lg.data&&ba.Lg.data.httpStatus===t.a.VO?(c.ULS.sendTraceTag(51258445,3004,50,"SaveUserPrivacySettings: Roaming Request Succeeded"),Ba(!0)):(c.ULS.sendTraceTag(51258446,3004,
10,"SaveUserPrivacySettings: Roaming Request Failed"),Ba(!1))}})}}}}catch(ca){c.ULS.sendTraceTag(50860930,3004,10,"SaveUserPrivacySettings: Exception = {0}",ca.toString()),Ba(!1)}})}Unj(Da){if(void 0===this.oe||null===this.oe||void 0===Da||null===Da)throw Error.invalidOperation("User Privacy settings have not been initialized");const Ba=new Q.a;0===Da.src?(this.oe.du!==Da.du&&(Ba.add(P.ROa),Ba.add(P.mEb)),this.oe.Hea!==Da.Hea&&Ba.add(P.nEb)):1===Da.src&&this.oe.du!==Da.du&&Ba.add(P.ROa);return Ba.count?
Da.serialize(Ba):(c.ULS.sendTraceTag(50860931,3004,50,"SaveUserPrivacySettings: returning since nothing changed"),null)}getSettings(){if(!this.eRc){const Da=this;this.eRc=new Promise(Ba=>{try{Da.oe?Ba(Da.oe.clone()):Da.xNj().then(ea=>{Da.oe=ea;Ba(Da.oe.clone());return null},()=>{Da.vNj().then(ea=>{Da.oe=ea;Ba(Da.oe.clone());return null},()=>{Da.wNj().then(ea=>{Da.oe=ea;Ba(Da.oe.clone());return null},()=>{c.ULS.sendTraceTag(50967430,3004,10,"UserPrivacySettings TryGetSettingsFromQueryParams returned an error)");
Da.oe=new P;Ba(Da.oe.clone());return null});return null});return null})}catch(ea){c.ULS.sendTraceTag(50860932,3004,10,"UserPrivacySettings GetSettings: Exception = {0}",ea.toString()),Da.oe=new P,Ba(Da.oe.clone())}})}return this.eRc}xNj(){return new Promise((Da,Ba)=>{try{const Y=-1!==window.location.href.indexOf("&wd_pn=2");if(this.nb.qa("PrivacyDialogShouldCheckRoaming")||Y){var ea=this.executeRequest(this.wva("getUserPrivacySettings"),1,"GetUserPrivacySettingsRequest");ea.continueWith(()=>{try{if(ea.Eh||
ea.Tf)c.ULS.sendTraceTag(50860934,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Request failure");else{const ja=ea.result;if(ja&&ja.Lg&&ja.Lg.data)if(ja.Lg.data.httpStatus!==t.a.VO)c.ULS.sendTraceTag(50860936,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Received error response {0}",ja.Lg.data.httpStatus);else{if(ja.Lg.data.Xd){Da(pa.parse(ja.Lg.data.Xd,0));c.ULS.sendTraceTag(51258447,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Success, Settings {0}",ja.Lg.data.Xd);
return}c.ULS.sendTraceTag(50860937,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: ResponseData is null")}else c.ULS.sendTraceTag(50860935,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Data is null");Ba("UserPrivacySettings TryGetSettingsFromRoaming Request Faillure")}}catch(ja){c.ULS.sendTraceTag(50860938,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming Exception handling request {0}",ja.toString()),Ba("UserPrivacySettings TryGetSettingsFromRoaming Request Exception")}})}else c.ULS.sendTraceTag(50860933,
3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Roaming should not be used"),Ba("Roaming should not be used")}catch(Y){c.ULS.sendTraceTag(50860939,3004,10,"TryGetSettingsFromRoaming Exception = {0}",Y.toString()),Ba("UserPrivacySettings TryGetSettingsFromRoaming Exception")}})}vNj(){return new Promise((Da,Ba)=>{try{const ea=ka.a.get("WacUPToggleState");let Y=null;void 0!==ea&&null!==ea&&0<ea.length&&(Y=decodeURIComponent(ea));if(void 0!==Y&&null!==Y&&0<Y.length){const ja=pa.parse(Y,1);c.ULS.sendTraceTag(51258448,
3004,50,"TryGetSettingsFromCookie: UserPrivacySettings retrieved from cookie {0}",ja.toString());Da(ja)}else{const ja=P.create(1),ca=new Q.a;ca.add(P.ROa);const ba=ja.serialize(ca);this.ecg(ba)?(c.ULS.sendTraceTag(51258449,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings initialized and retrieved from cookie {0}",ba),Da(ja)):(c.ULS.sendTraceTag(51258450,3004,15,"TryGetSettingsFromCookie: Failure initializing cookie with settings {0}",ba),Ba("UserPrivacySettings TryGetSettingsFromCookie Failure in TrySaveSettingsToCookie"))}}catch(ea){c.ULS.sendTraceTag(50860941,
3004,10,"TryGetSettingsFromCookie from Cookie Exception = {0}",ea.toString()),Ba("UserPrivacySettings TryGetSettingsFromCookie Eception")}})}wNj(){return new Promise(Da=>{try{var Ba=-1!==window.location.href.indexOf("&wdccsoff=1");let ea=P.create(2);Ba?(ea.du=2,r.AFrameworkApplication.dJe(),c.ULS.sendTraceTag(51258451,3004,50,"TryGetSettingsFromQueryParams: Retrieved from query param {0}",ea.toString())):(ea.du=1,c.ULS.sendTraceTag(51258452,3004,50,"TryGetSettingsFromQueryParams: Initialized with query param as data source for {0}",
ea.toString()));Da(ea)}catch(ea){c.ULS.sendTraceTag(50967431,3004,50,"TryGetSettingsFromCookie from Query Params Exception = {0}",ea.toString()),Ba=P.create(2),Ba.du=1,Da(Ba)}})}ekj(Da){c.ULS.sendTraceTag(51258453,3004,50,"UserPrivacySettingsHelper: SaveSettingsToQueryParam");2===Da.du?r.AFrameworkApplication.dJe():r.AFrameworkApplication.Alh();c.ULS.sendTraceTag(51258454,3004,50,"SaveSettingsToQueryParam saved settings = {0}",Da)}ecg(Da){try{c.ULS.sendTraceTag(51258455,3004,50,"UserPrivacySettingsHelper: TrySaveSettingsToCookie Saving settings {0}",
Da);const Ba=this.nb.Xa("PrivacyCookieDomain")||"";if(!Ba||!Ba.length)throw Error.invalidOperation("PrivacyCookieDomain is null or empty");c.ULS.sendTraceTag(51258456,3004,50,"SaveUserPrivacySettings to Cookie {0}",Da);return ka.a.QQd("WacUPToggleState",Da,ka.a.zV,"/",Ba)}catch(Ba){return c.ULS.sendTraceTag(50860942,3004,50,"SaveUserPrivacySettings to Cookie Exception = {0}",Ba.toString()),!1}}isFeatureEnabled(Da){return this.getSettings().then(Ba=>{const ea=this.nb.wo("ServicesControlsMicrosoftControllerServicesList")?
this.nb.ow("ServicesControlsMicrosoftControllerServicesList"):[],Y=new A.a;for(let ja=0;ja<ea.length;ja++)Y.add(ea[ja]);return Y.contains(Da)?2!==Ba.du:!0},()=>{c.ULS.sendTraceTag(50860945,3004,10,"Failed to get privacy setting for feature {0}",Da);return!0})}static parse(Da,Ba){try{return c.ULS.sendTraceTag(50860943,3004,50,"Parsing user privacy settings {0} from {1}",Da,Ba),P.deserialize(Da,Ba)}catch(ea){throw c.ULS.sendTraceTag(50860944,3004,10,"GetUserPrivacySettings Exception = {0}",ea.toString()),
ea;}}}Object(n.a)(pa,"UserPrivacySettingsHelper",null,[216]);var Na=a(247);class Z{constructor(){this.gb=null}get name(){return"Common.App.ApplicationFeatureHelper.ApplicationFeatureHelperPackage"}Wh(Da){this.gb=Da;this.gb.register(215,"Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper").wc().Fc(()=>new na(r.AFrameworkApplication.fa,r.AFrameworkApplication.yd));this.gb.register(216,"Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper").wc().Fc(()=>new pa(r.AFrameworkApplication.fa,
r.AFrameworkApplication.yd));this.gb.register(217,"Common.App.ApplicationFeatureHelper.IAlternateAuthHelper").wc().Fc(()=>new z(r.AFrameworkApplication.fa,r.AFrameworkApplication.yd));this.gb.register(218,"Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").wc().Fc(()=>new R(r.AFrameworkApplication.fa,r.AFrameworkApplication.yd,this.gb.resolve("Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper"),this.gb.resolve("Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper"),
r.AFrameworkApplication.vb))}init(){r.AFrameworkApplication.fa.qv(()=>{const Da=this.gb.resolve("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");r.AFrameworkApplication.fa.qa("LicensingIsEnabled")&&(Da.isFeatureEnabled("LicensingTestFeature",!1).then(Ba=>{c.ULS.sendTraceTag(42513092,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned IsFeatureEnabled as {0}. IsAnonymousUser : {1}.",Ba,r.AFrameworkApplication.fa.Xa("IsAnonymousUser"));return null}),Da.getFeatureTier("LicensingTestFeature",
0).then(Ba=>{c.ULS.sendTraceTag(42804872,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned GetFeatureTier as {0}. IsAnonymousUser : {1}.",Ba,r.AFrameworkApplication.fa.Xa("IsAnonymousUser"));return null}));this.gb.resolve("Common.App.ApplicationFeatureHelper.IAlternateAuthHelper");this.xIj()})}dispose(){}xIj(){try{r.AFrameworkApplication.fa.qa("SideCarIsEnabled")&&ta.V5f().then(Da=>{c.ULS.sendTraceTag(594057429,3004,50,"Sidecar Loader attempted to load Sidecar.  SideCarIsAvailable:{0}",
Da);return Da})}catch(Da){}}static main(){Na.a.instance.Gi(new Z)}}Object(n.a)(Z,"ApplicationFeatureHelperPackage",null,[3,4]);a.d(C,"a",function(){return Ra});const Ra=()=>{Type.registerNamespace("Common");Type.registerNamespace("Common.App.ApplicationFeatureHelper");Z.main()}},1154:function(n,C,a){var c=a(9);n=a(0);var b=a(222),d=a(15),f=a(1353),e=a(637),k=a(550),l=a(27),m=a(86),u=a(30),t=a(155),w=a(8),r=a(58),v=a(153),y=a(343),x=a(47),B=a(45),z=a(29),A=a(1),I=a(22),F=a(14),U=a(104),X=a(82),T=a(84),
G=a(144),D=a(4),J=a(13),L=a(94),H=a(44),R=a(1074);class Q extends G.a{constructor(Qb,mb=!0){super(!1,!1,Q.Gu);this.AXa=null;this.H7d=!1;this.fn=[];this.Oj=null;this.WXb=Qb;this.dxg=mb;this.Nv=this.eje=!1;this.uga=null;this.MIc=!1;this.mg=this.egh;this.Ce="InsertFileDialog";this.rc(1,this.uYb);Q.Gu?(this.AXa={["id"]:this.Ce,["bodyControls"]:{["uploadButtonProps"]:{["label"]:CommonUIStrings.l_DialogChooseFile,["onExecute"]:Object(T.a)(this,this.STi,"onUploadButtonClick")}},["uploadStatusLabel"]:CommonUIStrings.l_DialogNoFileChosen,
["onFrameReady"]:Object(T.a)(this,this.HKi,"onFrameReady")},this.initializeAndShow(this.titleText,Object(T.a)(this,this.ifc,"insertDialogHandler"),this.AXa),this.ASb=!0):(this.showDialog(this.titleText,Object(T.a)(this,this.ifc,"insertDialogHandler")),mb&&this.L1f(),(Qb=this.cK(1))&&this.fn.push(Qb),(Qb=this.cK(0))&&this.fn.push(Qb),this.Meg(),this.ASb=!1)}get BUj(){return this.WXb}validate(){this.Oj.iF||d.ULS.sendTraceTag(25798091,322,10,"UploadFrame.FileInputElement is null");return this.Oj.iF.value?
!0:(Q.bA(CommonUIStrings.l_FileUploadNoFileSpecified),!1)}HKi(Qb){this.dxg&&(this.Oj=this.K1f(Qb,this.WXb))}STi(){this.Oj&&this.Oj.iF&&(this.H7d||(this.Oj.V8i(Object(T.a)(this,this.fBd,"onFileChosen")),this.H7d=!0),this.Oj.xTe())}fBd(Qb){this.AXa.uploadStatusLabel=Qb;this.rUa(this.titleText,Object(T.a)(this,this.ifc,"insertDialogHandler"),this.AXa)}ifc(Qb){1===Qb&&this.isEnabled()?Q.Gu&&this.Oj.iF&&!this.Oj.iF.value?(this.AXa.uploadStatusLabel=CommonUIStrings.l_FileUploadNoFileSpecified,this.rUa(this.titleText,
Object(T.a)(this,this.ifc,"insertDialogHandler"),this.AXa)):(this.Pxb(),this.WXb.finalizeUpload(this.Oj,Object(T.a)(this,this.dispose,"dispose"))):0===Qb&&this.hide()}L1f(){this.MIc=!1;this.Oj=this.K1f(document.getElementById("uploadFrameContainer"),this.WXb);D.AFrameworkApplication.fa.qa("InsertPictureDialogFocusLoopFixIsEnabled")&&(this.uga=Object(T.a)(this,this.ZCd,"onUploadFrameLoad"),H.a.addHandler(this.Oj.iFrame,"load",this.uga));this.Oj.iF||d.ULS.sendTraceTag(25798092,322,15,"UploadFrame.FileInputElement is null");
this.UKf()}ZCd(){this.UKf()}UKf(){if(this.Oj&&!this.MIc){var Qb=this.Oj.iF;Qb&&(H.a.addHandler(Qb,J.a.Qb,Object(T.a)(this,this.onKeyDown,"onKeyDown")),Qb=[Qb],this.fn=Qb.concat.apply(Qb,this.fn),this.Meg(),this.MIc=!0)}}dispose(){if(this.Oj&&!Q.Gu){const Qb=this.Oj.iF;Qb&&H.a.removeHandler(Qb,J.a.Qb,Object(T.a)(this,this.onKeyDown,"onKeyDown"));this.uga&&H.a.removeHandler(this.Oj.iFrame,"load",this.uga)}this.Oj=null;super.dispose()}Meg(){if(0<this.fn.length){const Qb=new R.a(this.fn),mb=L.FocusManager.instance().wQ();
mb&&(this.fn[0].focus(),mb.jf=Qb,mb.h_=!0)}}onKeyDown(Qb){4!==L.FocusManager.instance().WKf(Qb)&&Qb.preventDefault()}static get Gu(){return D.AFrameworkApplication.ta.Oa.vv&&D.AFrameworkApplication.ta.Oa.ohf}static bA(Qb){const mb=document.getElementById("errorText");mb.innerText=Qb;mb.style.display="inline-block"}}Object(n.a)(Q,"InsertFileDialog",G.a,[]);class O{static get mg(){return G.a.Yp(O.ml,CommonUIStrings.l_ImageUploadDialogText,CommonUIStrings.l_ImageUploadNoFileSpecified)}}O.ml="<div class='WACDialogRow' id='block1'> <label id='labelText' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRowNoBreak' id='block2'> <div id='uploadFrameContainer'></div> <div class='WACDialogError' id='errorText' role='alert'>{1}</div> </div>";
Object(n.a)(O,"InsertImageDialogHtml",null,[]);class V extends Q{constructor(Qb,mb=!0){super(Qb,mb)}get uYb(){return CommonUIStrings.l_ImageUploadButtonText}get titleText(){return CommonUIStrings.l_ImageUploadingTitle}get egh(){return O.mg}validate(){this.Oj.iF||d.ULS.sendTraceTag(25798095,322,10,"UploadFrame.FileInputElement is null");const Qb=Object(X.a)(f.a,this.BUj),mb=Qb.Kgg(this.Oj.iF.value);return 0!==mb?(Q.bA(Qb.RZe(mb)),!1):!0}}Object(n.a)(V,"InsertImageDialog",Q,[]);var W=a(555);const da=
(Qb,mb,Pb)=>{if(Qb){var gc=0;do{try{Qb();break}catch(Xb){if(d.ULS.sendTraceTag(50946190,306,10,"RetryOnException: [Retries: {0}] [Caller: {1}] [Exception: {2}] [Callstack: {3}].",gc,Pb,Xb.message,Xb.stack),gc>=mb)break}gc++}while(1)}};var ta=a(107),K=a(88),na=a(41),P=a(251),ka=a(199),pa=a(80),Na=a(462),Z=a(173);class Ra{constructor(Qb,mb,Pb,gc,Xb,Ca,ra,ma,hb=!0,vb=null,Va=!1){this.DTe="FileUpload.ashx";this.lo=null;this._initialized=!1;this.Jg=this.tib=this.LIc=this.uga=this.$Sb=this.hr=this.Qs=null;
this.Fm=!1;this.gE=this.aTb=this.aTc=null;this._parent=Qb;this.Trg=mb;this.uwg=Pb;this.m8d=Xb;this.bRc=ra;this.x2d=ma;this.t4d=vb;this.$Sc=!1;this.psg=gc.qa("CanaryRenewalForFileUploadIsEnabled");this.Zfg=!1;(this.Sqa=Va)||this.B5g(Ca);hb&&this.gbf()}get $Uf(){return this.uwg}get sessionId(){return this.bRc}get iFrame(){return this.lo}get iF(){return this.hr}get u9a(){return D.AFrameworkApplication.fa?D.AFrameworkApplication.fa.qa("NativeFileOpenDialogIsEnabled"):!1}get yTe(){return D.AFrameworkApplication.fa?
D.AFrameworkApplication.fa.qa("FileInputDescriptionAccessibilityIsEnabled"):!1}get Gji(){return this.Sqa?!1:ka.b(this.lo.contentWindow.location.pathname,this.DTe,0)}get wKg(){return!l.a.Dka&&D.AFrameworkApplication.fa.qa("AllowMultipleImageInsertFromLocalDevice")}gbf(){this.gE=Z.a.create().toString();this.Sqa?this.V8c():this.yLg()}B5g(Qb){this.lo=document.createElement("iframe");this.lo.className=Qb;this.lo.id=Qb;this.m8d&&(this.lo.style.visibility="visible",this.lo.style.height="30px",this.lo.setAttribute("frameborder",
"0"));this.uga=Object(T.a)(this,this.ZCd,"onUploadFrameLoad");H.a.addHandler(this.lo,"load",this.uga)}j7b(Qb=null){D.AFrameworkApplication.ta.Lqc();if(!this.hr)return d.ULS.sendTraceTag(25798093,322,50,"_fileInput is null"),"";H.a.addHandler(this.hr,"change",()=>{this.$zh(Qb)});da(Object(T.a)(this,this.xTe,"fileInputClick"),1,"DoFileOpenDialog");return this.hr.value}$zh(Qb){Qb&&Qb(this.hr.value)}aAh(){this.$Sb&&(this.$Sb.innerText=this.i0e())}V8i(Qb){H.a.addHandler(this.hr,"change",()=>{Qb(this.i0e())})}i0e(){let Qb=
null;if(this.hr.value){const mb=this.hr.value,Pb=mb.lastIndexOf("\\");0<Pb&&(Qb=mb.substring(Pb+1,mb.length))}return Qb?Qb:""}xTe(){try{d.ULS.sendTraceTag(35939520,322,50,"UploadFrame.FileInputClick - Clicking on File input element."),this.hr.click()}catch(Qb){throw d.ULS.sendTraceTag(36783331,322,10,"UploadFrame.FileInputClick Exception: {0}",Qb.message),Qb;}}qGj(){this.Nmi()?this.A8f():(this.A_d(),this.Qs.submit())}Nmi(){return(this.psg||this.Sqa)&&!(void 0===window.self.FormData||null===window.self.FormData)}eZf(Qb){if(Qb){const mb=
this.XDe();this.Jg=new XMLHttpRequest;this.Jg.open("POST",mb);this.Jg.setRequestHeader("X-CorrelationId",this.gE);this.cvi(Qb);this.Jg.onreadystatechange=Object(T.a)(this,this.Poa,"uploadResponseReceived");this.Jg.send(Qb)}}cvi(Qb){if(!l.a.Dka&&Qb.get){var mb=Qb.get("ImageId");Qb=window.self.navigator;mb={["CorrelationId"]:this.gE,["Canary"]:D.AFrameworkApplication.canary,["ImageNodeId"]:mb};Qb&&(Qb=Qb.connection?Qb.connection:Qb.mozConnection?Qb.mozConnection:Qb.webkitConnection?Qb.webkitConnection:
null)&&(mb.effectiveType=Qb.effectiveType,mb.downlink=Qb.downlink,mb.type=Qb.type,mb.rtt=Qb.rtt);d.ULS.sendTraceTag(573345858,322,50,"LogFileUploadStatistics: FileUpload {0}",mb)}}A8f(){try{this.A_d();d.ULS.sendTraceTag(594888409,322,50,"SubmitFormWithRequest is preparing to send an upload request");const Qb=new (Type.parse("FormData"))(this.Qs);this.eZf(Qb)}catch(Qb){d.ULS.sendTraceTag(594888407,322,10,"SubmitFormWithRequest failed to send the request with exception "+Qb.message),this.G$a(null)}}z8f(Qb){try{if(this.A_d(),
d.ULS.sendTraceTag(594888406,322,50,"SubmitFormWithBlob is preparing to send an upload request"),this.MVj(Qb)){this.aTb=Qb;this.Qs.contains(this.hr)&&this.Qs.removeChild(this.hr);var mb=new (Type.parse("FormData"))(this.Qs);mb.append("applicationfileInput",Qb.blob,Qb.filename);this.eZf(mb)}else this.G$a(null)}catch(Pb){d.ULS.sendTraceTag(591267743,322,10,"SubmitFormWithBlob failed to send the request with exception "+Pb.message),this.G$a(null)}}MVj(Qb){return Qb&&void 0!==Qb.blob&&null!==Qb.blob&&
void 0!==Qb.filename&&null!==Qb.filename&&""!==Qb.filename?void 0===window.self.FormData||null===window.self.FormData?(d.ULS.sendTraceTag(578380442,322,10,"FormData isn't supported"),!1):!0:(Qb=Qb?String.format("[isNull: false] [blobIsNullorEmpty: {0}] [filenameIsNullOrEmpty: {1}]",void 0===Qb.blob||null===Qb.blob,void 0===Qb.filename||null===Qb.filename||""===Qb.filename):"[isNull: true] [blobIsNullorEmpty: false] [filenameIsNullOrEmpty: false]",d.ULS.sendTraceTag(578380441,322,10,String.format("Content of the blob is empty {0}",
Qb)),!1)}Poa(){if(4===this.Jg.readyState)if(200===this.Jg.status){d.ULS.sendTraceTag(594888405,322,50,"UploadResponseReceived received a successful response. CorrelationId: {0}",this.gE);const Qb=this.Jg.getResponseHeader("X-NewKey"),mb=this.Jfi(this.Jg);let Pb=!1;if(void 0!==Qb&&null!==Qb&&mb&&(Pb=this.CVj(Qb),!this.$Sc&&Pb)){d.ULS.sendTraceTag(594888404,322,50,"UploadResponseReceived resubmitting the upload request with a fresh canary. correlationId: {0}",this.gE);this.$Sc=!0;void 0!==this.aTb&&
null!==this.aTb?this.z8f(this.aTb):this.A8f();return}d.ULS.sendTraceTag(594888403,322,50,"UploadResponseReceived processing the response [retried: {0}] [canaryInvalid: {1}] [gotNewCanary: {2}] [canaryRenewed: {3}] [CorrelationId: {4}]",this.$Sc,mb,!(void 0===Qb||null===Qb),Pb,this.gE);this.G$a(this.Jg.responseText)}else d.ULS.sendTraceTag(42874946,322,15,"Upload request failed with status: {0} [isResponseNull: {1}] [correlationId: {2}]",this.Jg.status,this.Jg.responseText?!1:!0,this.gE),this.G$a(null)}Jfi(Qb){try{const mb=
na.a(Qb.responseText).Responses;if(void 0!==mb&&null!==mb&&1===mb.length){const Pb=mb[0];if(void 0!==Pb&&null!==Pb&&2===Pb.length&&28===Pb[1].StatusCode)return!0}}catch(mb){}return!1}CVj(Qb){Na.a.Odg(Qb);return D.AFrameworkApplication.canary!==Qb?!1:!0}A_d(){this.aTc||(this.aTc=new Date)}dispose(){this.Fm||(this.Sqa?this._parent.removeChild(this.Qs):(this._parent.removeChild(this.lo),H.a.removeHandler(this.lo,"load",this.uga),this.uga=null),this.LIc&&(H.a.removeHandler(this.hr,"change",this.LIc),
this.LIc=null),this.yTe&&(this.tib&&(H.a.removeHandler(this.hr,"change",this.tib),this.tib=null),this.$Sb=null),this.hr=this.Qs=this._parent=this.lo=null,this.Fm=!0,this.aTc=null,d.ULS.sendTraceTag(25798094,322,50,"UploadFrame disposed"))}delayedDispose(){this.dispose()}d8g(Qb){if(this.Qs){var mb;(mb=this.Qs.querySelector("input[name=__REQUESTDIGEST]"))?mb.value=Qb:(mb=this.o4c(),mb.type="hidden",mb.id="__REQUESTDIGEST",mb.name="__REQUESTDIGEST",mb.value=Qb,this.Qs.appendChild(mb))}}o4c(){return this.Sqa?
document.createElement("input"):this.lo.contentWindow.document.createElement("input")}ZCd(){try{if(!this.lo.contentWindow.document.body)return}catch(mb){this.R4h();return}if(!(this._initialized||this.u9a&&l.a.JF))this.V8c();else if(!this.u9a||!l.a.JF||this.Gji){let mb;mb=l.a.pu?this.lo.contentWindow.document.body.innerText:this.Zfg?this.lo.contentWindow.document.body.firstChild.innerText:this.lo.contentWindow.document.body.firstChild.innerHTML;var Qb=this.lo.contentWindow.document.body.innerText.toLowerCase();
const Pb=0<=Qb.indexOf("responses")||0<=Qb.indexOf("wopisrc");Qb=0<=Qb.indexOf("http error");!Pb&&Qb&&d.ULS.sendTraceTag(42551183,322,15,"Couldn't obtain a valid response but the frame contains: "+this.lo.contentWindow.document.body.innerText);this.G$a(mb)}}V8c(){if(!this._initialized){var Qb=this.ga("uploadForm");const mb=this.ga("fileInput"),Pb=this.XDe();this.J7g();this.Qs.id=Qb;this.Qs.method="post";this.Qs.encoding="multipart/form-data";this.Qs.action=Pb;this.hr.type="file";this.x2d&&(this.hr.accept=
this.x2d,this.t4d&&(this.hr.capture=this.t4d));this.hr.id=mb;this.hr.name=mb;this.wKg&&(this.hr.multiple=!0);!this.yTe||l.a.pu||l.a.PH||(this.tib=Object(T.a)(this,this.aAh,"fileInputChangedHandleAccessibility"),H.a.addHandler(this.hr,"change",this.tib),this.$Sb=K.a.Lre(this.Qs,this.hr,"InputFileDescription"));this.m8d&&(this.Sqa||(Qb=this.lo.contentWindow.document.body,Qb.style.margin="0",Qb.style.overflow="hidden"),Qb=D.AFrameworkApplication.ta,this.hr.style.fontFamily=Qb.T0,this.hr.style.fontSize=
Qb.vBc,this.hr.style.margin="0");(Qb=document.getElementById("__REQUESTDIGEST"))&&this.d8g(Qb.value);this.Qs.appendChild(this.hr);this._initialized=!0;this.Trg(this)}}J7g(){if(this.Sqa)this.Qs=document.createElement("form"),this._parent.appendChild(this.Qs),this.hr=document.createElement("input");else{this.Qs=this.lo.contentWindow.document.createElement("form");const Qb=this.lo.contentWindow.document;Qb.body.appendChild(this.Qs);this.hr=Qb.createElement("input")}}yLg(){this._parent.appendChild(this.lo);
this.u9a&&l.a.JF&&this.V8c()}XDe(){var Qb=new P.QueryStringBuilder(this.DTe);D.AFrameworkApplication.SYa(Qb);this.Loj(Qb);Qb=Qb.toString();if(l.a.Uf||l.a.JF||l.a.PH)Qb=pa.a.fXe(Qb);return Qb}zme(){const Qb=new ta.a(2,1,0,Object(T.a)(this,this.delayedDispose,"delayedDispose"),4);D.AFrameworkApplication.Hi.Fg(Qb)}}Object(n.a)(Ra,"UploadFrame",null,[10]);var Da=a(43),Ba=a(116),ea=a(21);class Y extends Ra{constructor(Qb,mb,Pb,gc,Xb,Ca,ra=!1){super(Qb,mb,Pb,gc,Xb,"UploadFrame",Ca.ea.sessionId,"image/*",
!1,null,ra);this.$=Ca;this.Zfg=!0;this.gbf()}ga(Qb){return Qb}Loj(Qb){d.ULS.shipAssertTag(526399105,0,!!this.sessionId,"SessionId shouldn't be null.");Ba.a.YWc(Qb,this.$.ya);Qb.y9(w.a.sessionId,this.sessionId);var mb=ea.g(this.$).ha;mb=Da.o(mb.sa.b4,this.$);Qb.y9(w.a.z2i,this.$.xa.oa.name);Qb.y9(w.a.y2i,mb.FirstRow.toString());Qb.y9(w.a.x2i,mb.FirstColumn.toString())}R4h(){this.$Uf("ServerUploadError")}G$a(Qb){this.$Uf(Qb)}static Lhi(Qb){return!Qb||I.a.equals(Qb,"ServerUploadError",!1)}}Object(n.a)(Y,
"UploadFrameWrapper",Ra,[]);class ja extends V{constructor(Qb,mb,Pb){super(Qb,!1);this.CU=null;this.nBa=!1;this.xnc=()=>{this.MZd("");this.JBc();return!1};this.$=mb;this.UCc=Qb;this.LQ=W.a.instance;this.fa=Pb;this.L1f();this.imd();this.$.rb.iy=!0}K1f(Qb,mb){return new Y(Qb,Object(T.a)(mb,mb.OFb,"onUploadFrameInitialized"),Object(T.a)(mb,mb.Poa,"uploadResponseReceived"),this.fa,!0,this.$)}dispose(){this.JBc();this.LQ=this.UCc=null;super.dispose()}hide(){super.hide();this.$.rb.iy=!1}validate(){var Qb=
this.UCc.g0d(this.Oj.iF.value,this.UCc.Lbg(this.Oj));return 0!==Qb?(Qb=this.UCc.Ged(Qb).Description,this.MZd(Qb),this.IVd(),!1):!0}isEnabled(){return!0}MZd(Qb){this.CU.innerHTML=Qb}imd(){this.CU=document.getElementById("errorText");this.CU.style.display="inline-block";this.nBa=!1;this.MZd("");this.DIa.style.maxWidth=this.DIa.currentStyle.minWidth}IVd(){this.LQ.ra(J.a.click,this.Oj.iF,this.xnc);this.LQ.ra(J.a.Qb,this.Oj.iF,this.xnc);this.nBa=!0}JBc(){this.nBa&&(this.LQ.Ba(J.a.click,this.Oj.iF,this.xnc),
this.LQ.Ba(J.a.Qb,this.Oj.iF,this.xnc),this.nBa=!1)}}Object(n.a)(ja,"InsertImageDialogWrapper",V,[]);var ca=a(51),ba=a(55);class ua extends f.a{constructor(Qb,mb,Pb,gc,Xb=!0){super(null,mb,Pb);this.maa=this.It=null;this.M7a=!1;this.CEd=null;this.Poa=Ca=>{this.Z0d.stop();this.w0b.cancel();if(Y.Lhi(Ca))this.LAc?this.x6e(4):(Ca=new e.a(0,2,null,null,!1,null,null,null),Ca.status=8,this.kYd(new k.a(Ca),null,"InsertPictureWebMethod")),d.ULS.sendTraceTag(526399121,0,50,`Http Error occurred, isTimeoutError: ${this.LAc}`);
else{const ra=ua.QVj(Ca);0!==ra?(d.ULS.sendTraceTag(526399122,0,50,`Server returned error, response: ${Ca}`),this.x6e(ra)):this.F4h(Ca)}this.ipc();this.dispose()};this.cKi=Ca=>{this.fCa(Ca,this.Oj)&&this.finalizeUpload(this.Oj,null)};this.OFb=Ca=>{d.ULS.sendTraceTag(526399120,0,50,"Upload frame initialized");this.Oj=Ca;if(!this.X1a){if(this.J_d){if(this.rxe()||this.u9a&&l.a.JF){Ca.j7b(this.cKi);return}const ra=Ca.j7b(null);if(!this.fCa(ra,Ca))return}this.finalizeUpload(Ca,null)}};this.oTi=()=>{this.LAc=
!0};this.jb=Qb;this.Z0d=Qb.Jb.Rg("WebServiceCall","InsertPictureOperation");this.w0b=x.a.instance.create(this.oTi,1E5,B.a.XOg,!1);this.LAc=!1;this.glc=this.$.ya.InsertPictureMaxFileSizeBytes;gc&&(this.M7a="TestOnly"in gc);Xb&&this.showDialog()}get $(){return this.jb}get qzi(){return this.glc/1024/1024}dispose(){m.a.Ia(this.w0b);this.Oj&&this.Oj.zme();this.Oj=this.w0b=this.jb=null}Y5i(Qb){if(!this.$)return d.ULS.sendTraceTag(526399119,0,50,"ReadPictureAsDataURLTask: EwaControl is null"),ba.Task.Ta(!0);
if(!this.$.Cba)return ba.Task.Ta(!0);const mb=new t.a,Pb=new FileReader;Qb=Qb.iF.files[0];const gc=()=>{mb.$w(!0)};Pb.onload=()=>{this.CEd=Pb.result;mb.$w(!0)};Pb.onerror=gc;Pb.onabort=gc;Pb.readAsDataURL(Qb);return mb.task}Lbg(Qb){let mb=-1;Qb=Qb.iF;(null===Qb||void 0===Qb?0:Qb.files)&&0<Qb.files.length&&(mb=Qb.files[0].size);return mb}g0d(Qb,mb){let Pb=ua.x4g(f.a.fCa(Qb));0===Pb?-1!==mb&&(d.ULS.sendTraceTag(526399118,0,50,`Validating picture, pictureSize: ${mb}, maxAllowedSize: ${this.glc}, remainingWorkbookSize: ${this.$.ea.hlf}`),
mb>this.glc?Pb=3:mb>this.$.ea.hlf&&(Pb=7)):6===Pb&&this.exi(Qb);d.ULS.sendTraceTag(526399117,0,50,`Validated file on client, validation result: ${Pb}`);return Pb}fCa(Qb,mb){Qb=this.g0d(Qb,this.Lbg(mb));return 0!==Qb?(this.X1a||1===Qb||this.pTd(Qb),!1):!0}fbg(Qb){Qb.qGj()}Ged(Qb){let mb=0,Pb=1,gc=-1100324317,Xb="InsertPictureUnknownError",Ca=null;switch(Qb){case 1:mb=1756;Pb=0;gc=940870981;Xb="InsertPictureNoFileSelected";break;case 3:Pb=0;gc=1250467391;Xb="InsertPicturePictureTooBig";Ca=String.format(F.a.instance.mb(181),
this.qzi.toLocaleString());break;case 6:mb=1760;Pb=0;gc=1380041209;Xb="InsertPictureUnsupportedFormat";break;case 7:mb=1757;Pb=0;gc=-903115058;Xb="InsertPictureExceedWorkbookSize";break;case 4:mb=1758;Pb=0;gc=1218352119;Xb="InsertPictureUploadTimeout";break;case 5:mb=1759,Pb=0,gc=1979899005,Xb="InsertPictureServiceNonDeterministicError"}Qb=ua.Yc(mb,Pb,gc,Xb);Ca&&(Qb.Description=Ca);return Qb}showDialog(){this.rxe()?(this.X1a=!1,this.Oj=new Y(this.$.domElement,this.OFb,this.Poa,this.fa,!1,this.$,!0)):
(d.ULS.sendTraceTag(526399115,0,50,"Showing Insert Picture dialog"),!this.M7a&&(l.a.tv||l.a.JF&&72>l.a.yze)?(this.X1a=!1,this.Oj=new Y(this.$.domElement,this.OFb,this.Poa,this.fa,!1,this.$)):(this.X1a=!0,this.Oj=(new ja(this,this.$,this.fa)).Oj))}F4h(Qb){let mb={};try{if(mb=r.a.$h(Qb),ca.b().KA(this.Z0d.id,mb.ServerCorrelationId,"actions","ServerActions"),!z.a.ug(mb.Errors)&&mb.Result){this.$.ea.ZW(mb.StateId,"BasePictureUploaderWrapper.UploadResponseReceived");const Pb=mb.Result;U.a(this.$).ona(1,
Pb);const gc=this.$.da.za(277);gc&&gc.PUc(this.$,1,mb.Result,mb,"InsertPicture");d.ULS.sendTraceTag(526399114,0,50,"Insert picture completed successfully :)")}}catch(Pb){d.ULS.sendTraceTag(526399113,0,50,`BasePictureUploaderWrapper.HandleSuccessCallback: got exception while try to JSON.Parse string length: ${Qb?Qb.length:-1}, errror: ${Pb}`)}this.jBc(mb,null,"InsertPictureWebMethod")}x6e(Qb){Qb=this.Ged(Qb);const mb={};mb.Errors=[Qb];this.jBc(mb,null,"InsertPictureWebMethod")}jBc(Qb,mb,Pb){this.It(Qb,
mb,Pb)}kYd(Qb,mb,Pb){this.maa(Qb,mb,Pb)}pTd(Qb){Qb=this.Ged(Qb);A.EwaSettings.Dz()?new y.a(this.$,Qb):(new v.ErrorDialog(this.$,Qb)).ig()}exi(Qb){const mb=this.$.ya.InsertPicturUnsupportedExtensionsForLogging;Qb=u.a.sl(Qb);for(let Pb=0;Pb<mb.length;++Pb)if(Qb.endsWith(mb[Pb])){d.ULS.sendTraceTag(526399112,0,50,`Insert picture blocked invalid extension: ${mb[Pb]}`);break}}static QVj(Qb){return!Qb||I.a.equals(Qb,w.a.insertPictureUnknownError,!0)?2:I.a.equals(Qb,w.a.insertPictureNoFileSelectedError,
!0)?1:I.a.equals(Qb,w.a.vci,!0)?3:I.a.equals(Qb,w.a.wci,!0)?5:0}static Yc(Qb,mb,Pb,gc){return z.a.Yc(1,0,0,Qb,mb,Pb,gc)}static x4g(Qb){switch(Qb){case 1:return 1;case 2:return 6}return 0}rxe(){return this.M7a||void 0===window.self.FormData||null===window.self.FormData?!1:!0}}Object(n.a)(ua,"BasePictureUploaderWrapper",f.a,[10]);class wa extends ua{constructor(Qb,mb,Pb,gc,Xb,Ca=!0){super(Qb,mb,Pb,gc,!1);this.fAh=Xb;this.J9b=Qb.Jb.Rg("LoadResource","FileReaderUploaderLoadResource");Ca&&this.showDialog()}$zj(){this.glc=
28E5;this.pTd(3)}Yad(Qb){d.ULS.sendTraceTag(526399111,0,50,"FileReaderUploaderWrapper.finalizeUploadImpl - Start function.");const mb=new FileReader;Qb=Qb.iF.files;if(0==Qb.length)d.ULS.sendTraceTag(526399110,0,15,"FileReaderUploaderWrapper.finalizeUploadImpl - No image file found.");else{var Pb=Qb[0];mb.onload=()=>{this.J9b.stop();this.fAh.KSi(mb.result,this);d.ULS.sendTraceTag(526399109,0,50,`FileReaderUploaderWrapper.finalizeUploadImpl - End function. Type:${Pb.type}, Size:${Pb.size.toString()}`)};
mb.onerror=()=>{this.J9b.stop();d.ULS.sendTraceTag(526399108,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Can't read image. Type:${Pb.type}, Size:${Pb.size.toString()}`)};mb.onabort=()=>{this.J9b.stop();d.ULS.sendTraceTag(526399107,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Aborted read image. Type:${Pb.type}, Size:${Pb.size.toString()}`)};this.J9b.start();mb.readAsDataURL(Pb)}}finalizeUpload(Qb,mb){this.Yad(Qb,mb)}}Object(n.a)(wa,"FileReaderUploaderWrapper",ua,[288]);var ia=a(515),
xa=a(370),gb=a(171);class va{constructor(Qb,mb){this.dataUri=this.sheetName=null;this.sheetName=Qb;this.dataUri=mb}getSheetName(){return this.sheetName}}Object(n.a)(va,"MacroRecorderPictureInsertedPayload",null,[115]);class sa extends ua{constructor(Qb,mb,Pb,gc,Xb,Ca=!0){super(Qb,Pb,gc,Xb,!1);this.Jd=mb;Ca&&this.showDialog()}Yad(Qb,mb){super.finalizeUpload(Qb,mb);xa.a(this.$.userOperationManager,(Pb,gc)=>{this.It=Pb;this.maa=gc;this.Z0d.start();this.w0b.lq();this.LAc=!1;this.fbg(Qb);return this.Y5i(Qb)},
Pb=>{var gc={};this.$.gk(gc);const Xb=gc.SheetName;gc=()=>new va(Xb,this.CEd?this.CEd:"");Pb=A.EwaSettings.$b()?new gb.a(510,0,Pb,72,gc):new ia.a(510,0,Pb,8,gc);Pb.Cna(()=>!0);Pb.Jd=this.Jd;return Pb},this.Jd)}finalizeUpload(Qb,mb){this.Yad(Qb,mb)}}Object(n.a)(sa,"PictureUploaderWrapper",ua,[]);class ab{constructor(Qb,mb){this.filename=Qb;this.blob=mb}}Object(n.a)(ab,"UploadBlobParameters",null,[]);class Ua extends sa{constructor(Qb,mb,Pb,gc,Xb,Ca,ra){super(Qb,mb,Pb,gc,Xb,!1);this.J_d=!1;this.J0=
ra;this.Eec=Ua.aGh(Ca);Qb=this.g0d(this.Eec.name,this.Eec.size);0!==Qb?(this.pTd(Qb),this.J0.setException(Error.create("DataUrlUploaderWrapper: Invlid data url")),this.dispose()):this.Oj=new Y(this.$.domElement,this.OFb,this.Poa,gc,!1,this.$)}kYd(Qb,mb,Pb){super.kYd(Qb,mb,Pb);this.J0.setException(Error.create("DataUrlUploaderWrapper.TriggerFailedCallback: File upload request failed"))}jBc(Qb,mb,Pb){super.jBc(Qb,mb,Pb);z.a.ug(Qb.Errors)?this.J0.setException(Error.create(`DataUrlUploaderWrapper.TriggerSuccessCallback: File upload request returned with errors: ${z.a.xc(Qb.Errors)}`)):
this.J0.setResult(!0)}fbg(Qb){const mb=new ab(this.Eec.name,this.Eec);Qb.z8f(mb)}static aGh(Qb){var mb=Qb.split(",");Qb=mb[0].includes("base64")?window.self.atob(mb[1]):window.self.decodeURI(mb[1]);mb=mb[0].split(":")[1].split(";")[0];const Pb=new Uint8Array(Qb.length);for(let gc=0;gc<Qb.length;gc++)Pb[gc]=Qb.charCodeAt(gc);Qb=new Blob([Pb],{type:mb});Qb.name="Image.png";return Qb}}Object(n.a)(Ua,"DataUrlUploaderWrapper",sa,[]);class nb{constructor(){}gbi(Qb,mb,Pb,gc,Xb){new sa(Qb,mb,Pb,gc,Xb,!0)}dai(Qb,
mb,Pb,gc,Xb,Ca){new Ua(Qb,null,mb,Pb,gc,Xb,Ca)}pai(Qb,mb,Pb,gc,Xb){new wa(Qb,mb,Pb,gc,Xb,!0)}}Object(n.a)(nb,"UploaderCreator",null,[262]);class Ha extends b.a{constructor(Qb){super();this.$=Qb;this.Eb()}static ka(Qb){Qb.da.Ga(485,new Ha(Qb))}create(){var Qb;this.pb(null!==(Qb=this.$.da.za(484))&&void 0!==Qb?Qb:this.$.da.Ga(484,new nb))}}Object(n.a)(Ha,"UploaderCreatorFactory",b.a,[]);a.d(C,"a",function(){return sb});const sb=()=>{c.a.Fa(Qb=>{Ha.ka(Qb)})}},1187:function(n,C,a){var c=a(9);n=a(0);var b=
a(694),d=a(155),f=a(103),e=a(4),k=a(183),l=a(15),m=a(1353),u=a(30),t=a(98),w=a(83),r=a(558),v=a(173),y=a(43),x=a(370),B=a(171),z=a(283),A=a(29),I=a(282),F=a(11),U=a(14),X=a(281),T=a(104),G=a(21),D=a(144),J=a(88),L=a(94),H=a(164),R=a(180),Q=a(96),O=a(153),V=a(343),W=a(1),da=a(1235),ta=a(80);class K extends da.a{constructor(ba,ua){super(ba,ta.a.Oaa(ua))}tsc(ba,ua){this.isEnabled()&&this.OFa(this.targetOrigin)&&(this.qo(ba),this.$l(ba,ua))}}Object(n.a)(K,"InsertMediaCrossDocumentMessenger",da.a,[306,
307,10]);var na=a(7);class P{}Object(n.a)(P,"OnlineMediaSearchResult",null,[]);var ka=a(313);class pa extends D.a{constructor(ba,ua,wa,ia,xa,gb){super();this.Zgc=!1;this.SNa=this.yR=this.Bwa=null;this.aHi=()=>{this.Iua(this.D_a)};this.Xsd=va=>{va.keyCode===Sys.UI.Key.tab&&("KeepFocusDiv"!==va.target.id||va.shiftKey?"KeepFocusStartDiv"===va.target.id&&va.shiftKey&&(va.preventDefault(),document.getElementById("KeepFocusDiv").focus()):(va.preventDefault(),document.getElementById("KeepFocusStartDiv").focus()))};
this.dOi=()=>{this.aob&&(this.aob.launchUpsellExperience("stockimages"),l.ULS.sendTraceTag(537155807,0,50,"OnLaunchM365Upsell: Launched Dime Upsell flow"))};this.Nl=gb;this.$=ba;this.wbf=ua;this.aob=wa;this.wAa=[];this.prf=ia;this.fgh=xa;this.Gqe=this.$.ya.InsertOnlinePictureMaxCountOfImagesToInsert;this.mg=this.r8g()}AAj(ba){this.Zgc=!1;this.showDialog(this.Nl,null);this.Bwa=document.getElementById(this.ni("InsertMediaFrame"));if(!this.Bwa)throw this.Iua(this.D_a),Error.invalidOperation("Couldn't get InsertMediaIframe.");
var ua=document.getElementById(this.ni("WACDialogPanel"));ua&&ua.setAttribute(J.a.Kd,J.a.VZa);ua=document.createElement("div");ua.id="KeepFocusStartDiv";ua.tabIndex=0;ua.className="keep-focus-start";this.Bwa.parentNode.insertBefore(ua,this.Bwa.parentNode.firstChild);ua=document.createElement("div");ua.id="KeepFocusDiv";ua.tabIndex=0;ua.className="keep-focus";this.Bwa.parentNode.appendChild(ua);$addHandler(this.DIa,"keydown",this.Xsd);this.Bwa.src=this.wbf;this.Bwa.frameBorder="0";ua=document.getElementById(this.ni("WACDialogButtonPanel"));
if(!ua)throw Error.invalidOperation("Couldn't get WACDialogButtonPanel.");ua.className="display-none";ua=document.getElementById(this.ni("WACDialogTitleText"));if(!ua)throw Error.invalidOperation("Couldn't get WACDialogTitleText.");ua.className="display-none";2===this.prf&&(document.getElementById(this.ni("WACDialogTitlePanel")).className="display-none",document.getElementById(this.ni("WACDialogBodyPanel")).className="padding-zero");L.FocusManager.instance().wQ().scope.sN=!0;this.yR=new K(this.Bwa.contentWindow,
this.wbf);this.yR.tsc(H.a.SCg,wa=>{this.UFi(wa,ba.Poa)});this.yR.tsc(H.a.insert,()=>{this.sNi(ba.Poa)});this.yR.tsc(H.a.p_c,this.aHi);2===this.prf&&0===this.fgh&&(this.yR.tsc(H.a.Gri,this.dOi),this.SNa=this.aob.Mma("MsoPremiumStockImages",wa=>{l.ULS.sendTraceTag(537155811,0,50,"OnCompleteM365Upsell: Upsell completed from stock images");wa.isEnabled?this.yR.Mj(H.a.vUj,{["LicenseTier"]:wa.toString()}):l.ULS.sendTraceTag(537155810,0,10,"OnCompleteM365Upsell: Upsell completed but license tier didn't upgrade.")}))}dispose(){this.wAa=
null;this.aob&&this.SNa&&this.aob.DJd("MsoPremiumStockImages",this.SNa);this.yR&&(this.yR.dispose(),this.yR=null);super.dispose()}hide(){super.hide();Q.a.Jwc(this.$)}get c4(){return R.a.F6b+"/InsertMediaDialog"}get nY(){return!1}UFi(ba,ua){ba=ba&&ba.Values?(ba=ba.Values)?Object(na.a)(new P,{Action:ba.action||"",Caption:ba.caption||"",ContentType:ba.contentType||"",FileExtension:ba.extension||"",PageUrl:ba.pageUrl||"",SourceUrl:ba.sourceUrl||"",ThumbnailUrl:ba.thumbnailUrl||"",LicenseUrl:ba.licenseUrl||
"",LicenseDisplayName:ba.licenseDisplayName||"",Height:ba.height||0,Width:ba.width||0}):null:null;ba&&(this.wAa.push(ba),this.Zgc&&(l.ULS.sendTraceTag(537155809,0,50,"InsertMediaDialog.OnAddItem: Insert Message handling was pending"),ua(this.wAa),this.Zgc=!1,this.Iua(this.D_a)))}sNi(ba){this.wAa&&0<this.wAa.length?this.wAa.length<=this.Gqe?(ba(this.wAa),this.Iua(this.D_a)):(this.bA(),l.ULS.sendTraceTag(537155808,0,10,"OnInsert : Tried to insert more than allowed limit of items."),this.wAa.length=
0):this.Zgc=!0}r8g(){const ba=document.createElement("div");ba.id="InsertMediaDialog";ba.className=W.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixHorizonalScroll",!0)?"insert-media-dialog":"insert-media-dialog-old";const ua=document.createElement("div");ua.id="InsertMediaPanel";ua.className=W.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixCancelButton",!0)?"insert-media-panel":"insert-media-panel-old";const wa=document.createElement("iframe");
wa.id="InsertMediaFrame";wa.className="insert-media-frame";ba.appendChild(ua);ua.appendChild(wa);return ka.b(ba)}bA(){const ba=A.a.Yc(1,0,0,0,0,466721363,"InsertPictureExceededAllowedCount");ba.Description=String.format(U.a.instance.mb(206),this.Gqe.toLocaleString());W.EwaSettings.Dz()?new V.a(this.$,ba):(new O.ErrorDialog(this.$,ba)).ig()}}Object(n.a)(pa,"InsertMediaDialog",D.a,[]);var Na=a(459),Z=a(376);class Ra extends m.a{constructor(ba,ua,wa,ia,xa,gb){super(null,wa,ia);this.Kof=0;this.Poa=va=>
{if(va){var sa=Array(va.length);for(var ab=0;ab<va.length;ab++){const Ha=va[ab];sa[ab]={};sa[ab].SourceUrl=Ha.SourceUrl;u.a.ixa(Ha.LicenseUrl)&&u.a.ixa(Ha.PageUrl)&&(sa[ab].LicenseUrl=Ha.LicenseUrl,sa[ab].LicenseDisplayName=Ha.LicenseDisplayName,sa[ab].PageUrl=Ha.PageUrl);sa[ab].AltText=-2053056795===this.Jd.command?Ha.Caption:""}var Ua=-2009825598===this.Jd.command?"bing":"M365";ab=G.g(this.$);var nb=y.o(ab.ha.sa.activeCell,this.$);x.a(this.$.userOperationManager,(Ha,sb,Qb)=>z.q(this.$.pa.va,nb,
sa,Ua,X.b(Ha,this.PPi),X.a(sb,this.OPi),Qb,null),Ha=>new B.a(595,0,Ha),this.Jd);F.HelperMethods.OZ?(ab=new Map,ab.set("MediaProvider",Ua),ab.set("ImagesCount",va.length.toString()),ab.set("TimeTakenToOpenDialog",this.Kof.toString()),t.Health.instance.recordKpiUsage(Z.a.sci,1,Na.a.$9f,ab)):l.ULS.sendTraceTag(537155805,0,15,"OnlinePictureUploaderWrapper.UploadResponseReceived: KPI Usage not supported.");this.ipc()}else l.ULS.sendTraceTag(537155806,0,10,"OnlinePictureUploaderWrapper.UploadResponseReceived: Response is null")};
this.PPi=va=>{I.a(va)?l.ULS.sendTraceTag(537155799,0,10,`OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded with errors. Errors: ${A.a.xc(va.Errors)}`):(l.ULS.sendTraceTag(537155801,0,50,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded."),va.Result?T.a(this.$).ona(1,va.Result):l.ULS.sendTraceTag(537155800,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess:Result.result is null"))};this.OPi=()=>{l.ULS.sendTraceTag(537155798,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadFailed: Operation failed")};
this.$=ba;this.Jd=ua;this.J0=gb;this.sre=w.a.instance.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");this.showDialog()}dispose(){this.$=null}showDialog(){let ba=null;ba=this.$.Jb.Bc("UserAction","showOnlineImagesDialogTimeStopwatch");switch(this.Jd.command){case -2009825598:this.Kzj();break;case -2053056795:this.sre.execute(ua=>{ua.isFeatureEnabled("MsoPremiumStockImages",!1).catch(wa=>l.ULS.sendTraceTag(557200643,0,10,`OnlinePictureUploaderWrapper::ShowDialog - Failed to load the premium state from application feature helper: ${wa}`)).then(wa=>
{this.Lzj(wa);return null})})}ba.stop();this.Kof=ba.yc}Kzj(){let ba=this.$.ya.BingPictureEndpoint;const ua=r.a.fK(e.AFrameworkApplication.lcid),wa=v.a.create();ba?(ba=0<ba.search(RegExp("insertmedia.bing.office.net","gi"))?String.format(ba,1,1):String.format(ba,1,e.AFrameworkApplication.lcid,ua?ua.name:"en-us",e.AFrameworkApplication.buildVersion,wa.toString(),1,this.$.ya.DocumentHostInfo.LoggableUserId),this.C4b(ba,1,-1,U.a.instance.ga(1762))):(l.ULS.sendTraceTag(537155804,0,10,"OnlinePictureUploaderWrapper::ShowDialogForBingPictures - Can't access the Bing service endpoint"),
this.J0.setException(Error.create("Failed to access the Bing service endpoint")))}Lzj(ba){var ua=this.$.ya.M365PictureEndpoint,wa=v.a.create();if(ua){var ia=this.$.ya.DocumentHostInfo.UserId;ia=ia?u.a.Zv(ia).toString():"0";var xa=this.sre.instance.isFreemiumUpsellEnabled();ba=ba?1:xa?0:-1;wa=wa.toString();xa=r.a.fK(e.AFrameworkApplication.lcid).name;ua=String.format(ua,e.AFrameworkApplication.lcid,xa,e.AFrameworkApplication.buildVersion,wa,1,ia,ba,1);this.C4b(ua,2,ba,U.a.instance.ga(1761))}else l.ULS.sendTraceTag(537155803,
0,10,"OnlinePictureUploaderWrapper::ShowDialogForStockImages - Can't access the M365 service endpoint"),this.J0.setException(Error.create("Failed to access the M365 service endpoint"))}C4b(ba,ua,wa,ia){try{(new pa(this.$,ba,w.a.instance.yh("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),ua,wa,ia)).AAj(this),this.J0.setResult(!0)}catch(xa){l.ULS.sendTraceTag(537155802,0,10,`OnlinePictureUploaderWrapper::CreateAndShowDialog failed [Exception : ${xa}] [MediaProvider : ${ua}] [DialogLicenseTier : ${wa}]`),
this.J0.setException(xa)}}}Object(n.a)(Ra,"OnlinePictureUploaderWrapper",m.a,[10]);var Da=a(55);class Ba{constructor(ba,ua){this.$=ba;this.uploaderCreator=ua}executeCommand(ba,ua,wa){ba=ua.command;switch(ba){case 1403967063:if(wa&&"dataUrl"in wa)return ua=new d.a,this.uploaderCreator&&this.uploaderCreator.dai(this.$,f.a.instance,e.AFrameworkApplication.fa,wa,wa.dataUrl,ua),ua.task;this.uploaderCreator&&this.uploaderCreator.gbi(this.$,ua,f.a.instance,e.AFrameworkApplication.fa,wa);return Da.Task.Ta(!0);
case -2053056795:case -2009825598:return ba=new d.a,new Ra(this.$,ua,f.a.instance,e.AFrameworkApplication.fa,wa,ba),ba.task;default:return k.a(ba)}}Ac(ba,ua){if(ba=this.$.isEditMode)switch(ua.command){case 1403967063:ba=!0;break;case -2053056795:ba=!0;break;case -2009825598:ba=!0;break;default:ba=!1}return ba}Oc(){return!1}Lc(){return!1}}Object(n.a)(Ba,"PictureCommandHandler",null,[164]);var ea=a(37),Y=a(50);class ja extends b.a{constructor(ba){super(ba)}vd(){ea.TaskExtensions.Aa(Y.GetServiceTaskFactory.Sa(this.$.da,
484,485,1),ba=>{this.$c([new Ba(this.$,ba.result)])},this.$.la,3)}static ka(ba){b.a.Od(90,new ja(ba))}}Object(n.a)(ja,"PictureCommandHandlerFactory",b.a,[]);a.d(C,"a",function(){return ca});const ca=()=>{c.a.Fa(ba=>{ja.ka(ba)})}},1211:function(n,C,a){var c=a(9);n=a(0);var b=a(222),d=a(15),f=a(510),e=a(38),k=a(4),l=a(61);class m{}m.Zed="GetFontPreviewData";Object(n.a)(m,"FontWebServiceMethods",null,[]);const u=(A,I,F,U,X=null)=>{const T=m.Zed;X=A.Na(5,X);X.locale=k.AFrameworkApplication.uiCulture;
return l.g(A,T,X,I,F,U,null,644)};var t=a(11),w=a(1),r=a(46);const v={xlyellow:"xlyellow"};class y extends e.a{constructor(A,I){super();this.$=A;this.hv=I;this.Wua={};this.yO={};this.Yse=!1;this.styles=null;this.BKi=(F,U,X)=>{d.ULS.sendTraceTag(520710152,1,50,`FontServiceManager.onFontPreviewRequestComplete: Attempt to request FontUrl method: ${X} has succeeded.`);this.P_i(F);this.Yse=!0;d.ULS.sendTraceTag(512340116,1,50,"FontServiceManager.onFontPreviewRequestComplete: timeFromAppInteractive to fonts download {0} ms",
r.PageLoadTrackingInfo.instance.Mva(new Date));this.H3i()};this.CKi=(F,U,X)=>{d.ULS.sendTraceTag(520710151,1,10,`FontServiceManager.onFontPreviewRequestFailed: Encountered errors for ${X}.`)};this.Cfj=()=>{this.Bl&&this.Zed(this.BKi,this.CKi)};this.Bl=w.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FontServiceIntegration",!1);this.Cfj()}P_i(A){if(this.Joi(A)){var I=t.HelperMethods.Q5(()=>{const F=A.Result;this.styles=`@font-face{font-family:"msofpNew";font-style:normal;font-weight:normal;src:url('${F.PreviewUrl}') format('truetype')}`;
const U=F.FontFacePropertiesList;let X,T,G;F.FontNameList.forEach((D,J)=>{this.Wua[D]=U[J].Codepoint;let L=`https://fs.microsoft.com/fs/${F.CatalogVersion}/rawguids/${U[J].FontGuid}`;this.styles=this.Kre(this.styles,D,L,U[J].FontWeight);this.yO[D]=U[J].LocalizedFontName;"Segoe UI Semibold"===D&&(X=U[J].FontFamily,T=L,G=U[J].FontWeight)});X&&(this.styles=this.Kre(this.styles,X,T,G));f.a.Qi(this.styles)});10<I&&d.ULS.sendTraceTag(520710159,1,50,`FontServiceManager.prepareFontCodepointMap: Duration for prepareFontCodepointMap the model, duration=${I}`)}}Joi(A){if(!A.Result)return d.ULS.sendTraceTag(520710158,
1,15,"FontServiceManager.isValidFontPreviewData: Result in EwaResult is Null."),!1;A=A.Result;return A?A.PreviewUrl?A.FontFacePropertiesList?A.FontNameList?0===A.FontFacePropertiesList.length||A.FontFacePropertiesList.length!==A.FontNameList.length?(d.ULS.sendTraceTag(520710153,1,15,"FontServiceManager.isValidFontPreviewData: Mismatch in length of FontFacePropertiesList and FontNameList in fontListPreviewData."),!1):!0:(d.ULS.sendTraceTag(520710154,1,15,"FontServiceManager.isValidFontPreviewData: FontNameList in fontListPreviewData is Null."),
!1):(d.ULS.sendTraceTag(520710155,1,15,"FontServiceManager.isValidFontPreviewData: FontFacePropertiesList in fontListPreviewData is Null."),!1):(d.ULS.sendTraceTag(520710156,1,15,"FontServiceManager.isValidFontPreviewData: PreviewUrl in fontListPreviewData is Null."),!1):(d.ULS.sendTraceTag(520710157,1,15,"FontServiceManager.isValidFontPreviewData: fontListPreviewData is Null."),!1)}Kre(A,I,F,U){return A+`@font-face{font-family:"${I}";src:url('${F}');font-weight:${U};}`}Zed(A,I){return u(this.hv,
A,I,null,this.hv.Tb())}H3i(){this.Hgc&&this.raiseEvent(y.yVe)}get Qzc(){return this.yO}get GDh(){return this.Wua}get Hgc(){return this.Yse}isFontSupported(A){return this.Bl&&this.yO&&(!!this.yO[A]||!!v[A.replace(/\s/g,"").toLowerCase()])}$oe(A){this.addHandler(y.yVe,A)}}y.yVe="fsmFD";Object(n.a)(y,"FontServiceManager",e.a,[236]);var x=a(699);class B extends b.a{constructor(A){super();this.$=A;this.Eb()}static ka(A){A.da.Ga(505,new B(A))}create(){this.pb(Object(x.b)(this.$.da,504,()=>new y(this.$,
this.$.pa.hv)))}}Object(n.a)(B,"FontServiceManagerFactory",b.a,[]);a.d(C,"a",function(){return z});const z=()=>{c.a.Fa(A=>{B.ka(A)})}},1248:function(n,C,a){n=a(0);var c=a(108),b=a(222),d=a(15),f=a(13),e=a(38),k=a(176),l=a(90),m=a(1),u=a(21),t=a(5);class w extends e.a{constructor(B,z,A){super();this.statusBarManager=null;this.kJe=()=>{this.Q6b()};this.Jgh=()=>{this.Q6b()};this.jJe=I=>{10===I&&this.Q6b()};this.onKeyDown=I=>13===I.Ca.keyCode?(I=new l.a(237279923,1,2,6,null),this.$.Ka.Lb(I,{[t.a.skipClipboardAccess]:!0,
[t.a.bNe]:!0}),!0):!1;this.$=B;this.Pq=z;this.Bm=A;this.g9c=!1;(this.V3f=m.EwaSettings.getBooleanFeatureGate(k.a.fQa,!1))&&this.$.da.Za(29,I=>{this.statusBarManager=I;I.uJ(this)})}dispose(){this.mk();this.Bm=this.Pq=this.$=null;this.statusBarManager&&(this.statusBarManager.aG(this),this.statusBarManager=null)}vn(){return this.V3f}ds(B,z){if("QueryPasteShortcutEnabledLabel"!==B&&!w.FFj.includes(B))return!1;const A=this.Do();"QueryPasteShortcutEnabledLabel"===B?(z.Visible=A,d.ULS.sendTraceTag(537167636,
0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${A} for commandId ${B}`)):(z.Visible=!A,d.ULS.sendTraceTag(537167635,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${!A} for commandId ${B}`));return!0}Flh(){this.Ij();this.raiseEvent("pasteShortcutStatusChanged")}Q6b(){this.mk();this.raiseEvent("pasteShortcutStatusChanged")}Do(){return this.g9c}Cq(B){this.addHandler("pasteShortcutStatusChanged",B)}Yq(B){this.removeHandler("pasteShortcutStatusChanged",B)}Ij(){if(!this.Do()){this.g9c=
!0;u.g(this.$).Li.Vk(this.kJe);this.Bm.ka("blur",this.Jgh);const B=this.$.da.za(65);B&&B.a3&&B.a3.registerForCommentEvents(this.jJe);this.Pq.Dt(f.a.Qb,this.$.$u,this.onKeyDown,!0)}}mk(){if(this.Do()){this.g9c=!1;u.g(this.$).Li.Ak(this.kJe);this.Bm.detach("blur");const B=this.$.da.za(65);B&&B.a3&&B.a3.unregisterForCommentEvents(this.jJe);this.Pq.Mt(f.a.Qb,this.$.$u,this.onKeyDown,!0)}}}w.FFj=["QuerySheetNumberButton","QueryWorkbookStatisticsButton"];Object(n.a)(w,"PasteShortcutManager",e.a,[272,160,
161,10]);var r=a(128);class v extends b.a{constructor(B){super();this.$=B;this.Eb()}create(){const B=this.$;this.pb(B.da.za(478)||this.$.da.Ga(478,new w(B,c.KeyInputManager.instance,r.a.instance.iH())))}static ka(B){B.da.Ga(479,new v(B))}}Object(n.a)(v,"PasteShortcutManagerFactory",b.a,[]);var y=a(9);a.d(C,"a",function(){return x});const x=()=>{y.a.Fa(B=>{v.ka(B)})}},1249:function(n,C,a){var c=a(9);n=a(0);var b=a(108),d=a(222),f=a(128),e=a(7),k=a(15),l=a(4),m=a(1392),u=a(13),t=a(5),w=a(902),r=a(47),
v=a(28),y=a(21),x=a(1),B=a(43),z=a(65),A=a(341),I=a(37),F=a(50);class U{constructor(G,D,J,L){this.recoveryUI=null;this.Rya=()=>{this.exa()&&(this.grid.WIb(this.Rya),this.gbg())};this.gbg=()=>{if(y.g(this.$).Fb.g5(this.pasteRange))k.ULS.sendTraceTag(526758983,306,50,"RecoveryUIController:triggerHandRaiseAfterConsistentGrid Last paste was a table. Table hand raise is not triggered.");else if(y.g(this.$).Fb.e5(this.pasteRange))k.ULS.sendTraceTag(526758982,306,50,"RecoveryUIController:triggerHandRaiseAfterConsistentGrid Last paste was a pivot table. Table hand raise is not triggered.");
else{var H=z.d(this.$.xa.oa);H=new A.a(this.pasteRange,H);this.vYd(H)}};this.cfg=()=>{this.recoveryUI&&(this.M0d=v.a.Pa.me.m,this.hide(),r.a.instance.create(()=>{this.fTj()},250,"RecoveryUI.UpdatePositionOnVisibleAreaChanged",void 0,!0))};this.yJe=H=>{10===H&&this.$ta()};this.ahh=()=>{if(this.recoveryUI){const H=document.getElementById("PasteRecoveryUI");H&&t.a.tk===H.getAttribute(t.a.fY)&&H.click();this.documentHidden=!0;this.$ta()}};this.zJe=()=>{this.$ta()};this.AJe=()=>{this.$ta()};this.onKeyUp=
H=>{if(this.recoveryUI){if(this.c_)return!1;if(17===H.Ca.keyCode&&this.n9b){H=document.getElementById("PasteRecoveryUI");if(!H)return k.ULS.shipAssertTag(537154070,0,!1,"RecoveryUIController.OnKeyUp: recoveryUIElement is null."),!1;const R=H.getAttribute(t.a.fY)||"";if(t.a.rr===R)return H.click(),!0}}return!1};this.onKeyDown=H=>{if(this.recoveryUI){this.n9b=!1;this.c_=H.ctrlKey;H=H.Ca.keyCode;if(27===H)return this.$ta(),x.EwaSettings.isChangeGateEnabled("OfficeVSO:6022397_ClearStateWhileHidingRecoveryUI")&&
(H=this.$.da.za(254))&&H.ur("RecoveryUIController.onKeyDown",!0,!0).catch(()=>{}),!0;if(17===H)return this.n9b=!0}return!1};this.nR=(H,R)=>{this.xBb=H=R.Jd;if(x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)){switch(H.command){case -1027730316:case -1059615499:if(R.properties&&R.properties.launcherId===this.D0e())return;break;case -847286761:if(R.properties&&(13===R.properties.CalloutName||18===R.properties.CalloutName))return}this.$ta()}else-1027730316!==
H.command&&-1059615499!==H.command?this.$ta():(R=R.properties)&&R.launcherId!==this.D0e()&&this.$ta()};this.$=G;this.Orc=D;this.Pq=J;this.Bm=L;this.zjc=this.xBb=this.dtd=null;this.c_=this.n9b=this.V6b=this.Vdc=!1;this.M0d=0;this.documentHidden=!1;this.grid=y.g(this.$);this.pasteRange=null;x.EwaSettings.ll()||this.$.da.Ga(406,this)}dispose(){this.Xcg();this.cdg();this.zjc=this.dtd=this.recoveryUI=this.Bm=this.Pq=this.Orc=this.$=null;this.M0d=0}yPg(G){this.recoveryUI=G;this.dtd=G.rJg;this.zjc=G.f7i}$ta(){this.recoveryUI&&
(this.pasteRange=B.K(this.recoveryUI.vyh),this.tDj(),this.hide(),this.Xcg(),this.recoveryUI=null)}tDj(){const G=[1868184698,-1985798686,753331043,2137617149,237279923,1804571062,1766348718,42074747,-875588320,-958589048,-185374993,-111689794,-1502853784,-1096627081,1441131127,-1027730316,-847286761];l.AFrameworkApplication.cI("XLS-SmartView-OnPasteEnabled-Control;XLS-SmartView-OnPasteEnabled-Treatment");x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.OnPasteEnabled",!1)&&this.pasteRange&&
(k.ULS.sendTraceTag(523622037,0,50,"RecoveryUIController:smartViewOnPaste RecoveryUI is being dismissed."),null!=this.xBb&&G.includes(this.xBb.command)?(k.ULS.sendTraceTag(526758984,306,50,`RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. Last command was ${w.a[this.xBb.command]}`),this.xBb=null):this.documentHidden?(k.ULS.sendTraceTag(523833603,306,50,"RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. User clicked outside of document."),this.documentHidden=
!1):this.exa()?this.gbg():(k.ULS.sendTraceTag(520725721,306,50,"RecoveryUIController:smartViewOnPaste Grid is not in consistent state."),this.grid.xnb(this.Rya)))}exa(){return this.grid.Ea.xK(4,this.$.oa)}Nli(){return!!this.recoveryUI&&this.Orc.Zhi}wBj(G){this.recoveryUI?this.show(G):k.ULS.shipAssertTag(537154072,0,!1,"RecoveryUIController.ShowRecoveryUI: recoveryUI is null.")}D0e(){return this.recoveryUI?this.recoveryUI.Zri:null}show(G){const D=this.recoveryUI.FNh();D?(this.Orc.showFloatie(Object(e.a)(new m.a,
{x:D.x,y:D.y}),this.recoveryUI.rKa(),G),this.Ij()):k.ULS.sendTraceTag(537154071,0,100,"RecoveryUIController.Show: point is null.")}hide(){this.Nli()&&this.Orc.XC();this.cdg()}Ij(){if(!this.V6b){var G=y.g(this.$);G.view.Xs(this.cfg);G.Li.Vk(this.zJe);this.Bm.ka("blur",this.ahh);this.$.Ka.WFa(this.nR);this.$.xa.Qf(this.AJe);(G=this.$.da.za(65))&&G.a3&&G.a3.registerForCommentEvents(this.yJe);this.V6b=!0}this.Vdc||(this.Pq.Dt(u.a.Qb,this.$.domElement,this.onKeyDown,!0),this.Pq.Dt(u.a.Ed,this.$.domElement,
this.onKeyUp,!0),this.Vdc=!0)}Xcg(){if(this.V6b){var G=y.g(this.$);G.view.Zq(this.cfg);G.Li.Ak(this.zJe);this.Bm.detach("blur");this.$.Ka.aAa(this.nR);this.$.xa.Eg(this.AJe);(G=this.$.da.za(65))&&G.a3&&G.a3.unregisterForCommentEvents(this.yJe);this.V6b=!1}}cdg(){this.Vdc&&(this.Pq.Mt(u.a.Qb,this.$.domElement,this.onKeyDown,!0),this.Pq.Mt(u.a.Ed,this.$.domElement,this.onKeyUp,!0),this.Vdc=this.c_=this.n9b=!1)}fTj(){this.recoveryUI&&250<=v.a.Pa.me.m-this.M0d&&this.show(-1)}vYd(G){I.TaskExtensions.Aa(F.GetServiceTaskFactory.Sa(this.$.da,
426,427,1),D=>{void D.result.sea(G,"Paste");k.ULS.sendTraceTag(523622036,0,50,"RecoveryUIController.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.la,3)}}Object(n.a)(U,"RecoveryUIController",null,[397,10]);class X extends d.a{constructor(G){super();this.$=G;this.Eb()}create(){if(x.EwaSettings.ll())this.oDi();else{const G=this.$;G.Yx(D=>{D.Qec().then(J=>{this.pb(this.$.da.za(406)||new U(G,J,b.KeyInputManager.instance,f.a.instance.iH()))})})}}oDi(){const G=
this.$;let D=this.$.da.za(406);D?this.pb(D):G.Yx(J=>{J.Qec().then(L=>{D=new U(G,L,b.KeyInputManager.instance,f.a.instance.iH());this.$.da.Ga(406,D);this.pb(D)})})}static ka(G){G.da.Ga(405,new X(G))}}Object(n.a)(X,"RecoveryUIControllerFactory",d.a,[]);a.d(C,"a",function(){return T});const T=()=>{c.a.Fa(G=>{X.ka(G)})}},1353:function(n,C,a){n=a(0);var c=a(15),b=a(84);a(107);var d=a(27);class f{constructor(w,r,v){this.Oj=this.YCd=null;this.WEa=this.jra=0;this.bTb=null;this.GS=w;this.he=r;this.nb=v;this.X1a=
!1;this.J_d=!0;this.ugj();this.u9a=this.fa.qa("NativeFileOpenDialogIsEnabled")}get context(){return this.GS}get fa(){return this.nb}get retryCount(){return this.jra}get SMd(){return this.WEa}OFb(w){this.Oj=w;if(!this.X1a){if(this.J_d){if(this.u9a&&d.a.JF){this.bTb=w.j7b(Object(b.a)(this,this.fBd,"onFileChosen"));return}this.bTb=w.j7b(null);if(!this.fCa(this.bTb,w))return}this.finalizeUpload(w,null)}}fBd(w){if(this.fCa(w,this.Oj)){if(d.a.JF||d.a.Uf)this.bTb=w;this.finalizeUpload(this.Oj,null)}}ipc(){this.YCd&&
this.YCd()}ugj(){this.jra=0;this.WEa=this.fa.qd("Box4UploadRetryDelayStart",200);this.Oj&&(this.Oj.dispose(),this.Oj=null)}}Object(n.a)(f,"FileUploader",null,[]);var e=a(4),k=a(318),l=a(783),m=a(134),u=a(30);a.d(C,"a",function(){return t});class t extends f{constructor(w,r,v){super(w,r,v);this.GVb=this.Dra=null}get xO(){return e.AFrameworkApplication.ta.ZD}RZe(w){switch(w){case 1:return CommonUIStrings.l_ImageUploadNoFileSpecified;case 2:return CommonUIStrings.l_ImageUploadUnsupportedFileType;default:return""}}Kgg(w){return t.fCa(w,
this.V_h())}V_h(){return t.tke}fCa(w,r=null){w=this.Kgg(w);return 0!==w?(r&&r.zme(),2===w&&this.uj(0,this.RZe(w)),!1):!0}finalizeUpload(w,r){c.ULS.sendTraceTag(36783360,322,50,"PictureUploader.FinalizeUpload");this.YCd=r;this.IAj();k.a.mark(5576);this.GVb=this.xO.Bc("LoadResource","PictureUploadTime")}uj(w,r){const v=new m.StandardDialog;v.Rb=0;v.bA(w,CommonUIStrings.l_ImageUploadFailedTitle,r,null)}ipc(){c.ULS.sendTraceTag(36783361,322,50,"PictureUploader.OnUploadComplete");super.ipc();this.GVb&&
(this.GVb.stop(),this.GVb=null);this.v_g()}IAj(){this.Dra=(new l.a).create();this.Dra.message=CommonUIStrings.l_ImageUploadWait;this.Dra.Rb=5;this.Dra.ut=!1;this.Dra.aBa(null,null,null)}v_g(){this.Dra&&(this.Dra.close(),this.Dra=null)}static X5h(w,r){w=u.a.sl(w);for(let v=0;v<r.length;++v)if(w.endsWith(r[v]))return!0;return!1}static fCa(w,r=null){r||(r=t.tke);return w?t.X5h(w,r)?0:2:1}}t.tke=".jpg .jpeg .png .gif .bmp .tif .tiff".split(" ");Object(n.a)(t,"PictureUploader",f,[])},1426:function(n,C,
a){a.r(C);var c=a(1151),b=a(0),d=a(15),f=a(4),e=a(120),k=a(395);class l extends k.a{constructor(Wb){super(Wb)}get r4b(){return!1}createElement(){const Wb=document.createElement("link");Wb.setAttribute("rel","stylesheet");Wb.setAttribute("type","text/css");Wb.setAttribute("href",this.Et);return Wb}j4c(){return null}Esc(){this.element.setAttribute("href","");this.element.setAttribute("href",this.Vz.Et)}}Object(b.a)(l,"CssResource",k.a,[]);var m=a(373),u=a(227),t=a(30),w=a(55);class r{constructor(){this.MVb=
this.gTb=null}hti(){this.gTb||(d.ULS.sendTraceTag(21030598,324,50,"InProductMessagingDependenciesLoad usage"),this.gTb=w.Task.WAA(r.mti(),r.eti()),this.gTb.continueWith(Wb=>{d.ULS.sendTraceTag(21030599,324,10,"{0}",t.a.Hed(Wb.exception))},5));return this.gTb}jti(){if(!this.MVb)try{d.ULS.sendTraceTag(39978390,324,50,"InProductMessagingFreemiumDependenciesLoad usage"),this.MVb=w.Task.WAA(r.O8c(u.a.create(f.AFrameworkApplication.fa.Xa("DimeUrl"),null,null))),this.MVb.continueWith(Wb=>{d.ULS.sendTraceTag(39978391,
324,10,"{0}",t.a.Hed(Wb.exception))},5)}catch(Wb){d.ULS.sendTraceTag(594874951,324,10,"{0}",t.a.Hed(Wb))}return this.MVb}static mti(){var Wb=r.Acc("inproductmessaging.js");Wb=u.a.create(Wb,null,null);return r.O8c(Wb)}static eti(){var Wb=r.Acc("inproductmessaging.css");Wb=new l(Wb);return r.O8c(Wb)}static Acc(Wb){return e.a.x3b(String.format("ipm/{0}",Wb))}static O8c(Wb){m.a.yia(Wb);return Wb.F8a}}Object(b.a)(r,"DependencyDownloader",null,[697]);class v{}v.XVi="inProductMessagingOverlayDiv";v.MYi=
"PlayButtonImage";v.uej="ReplayButtonImage";Object(b.a)(v,"Constants",null,[]);class y{constructor(){this.jie=this.Hce=this.x3d=!0;this.vej=this.NYi=null;this.oCi=!1;this.locale=null;this.vcg={}}get oue(){return this.x3d}set oue(Wb){this.x3d=Wb}get asf(){return this.Hce}set asf(Wb){this.Hce=Wb}get W4f(){return this.jie}set W4f(Wb){(this.jie=Wb)&&this.lsj()}lsj(){this.Qne(v.MYi,this.NYi);this.Qne(v.uej,this.vej)}Qne(Wb,Nc){Nc&&(this.vcg[Wb]=Nc)}}Object(b.a)(y,"FirstRunExperienceUISettings",null,[695]);
class x{constructor(){this.completed=this.Z9i=!1}}Object(b.a)(x,"FirstRunExperienceViewData",null,[569]);var B=a(84),z=a(177),A=a(106),I=a(25);class F{constructor(Wb,Nc,gd){this.La=Wb;this.af=Nc;this.KTb=gd}Ig(){this.La.Le(I.a.tCh,A.a.frame,Object(B.a)(this,this.rCh,"firstRunExperienceHandler"),64);this.La.Nb(I.a.JUe,A.a.frame,Object(B.a)(this,this.S8h,"inProductMessagingTabHandler"));this.La.Nb(I.a.IUe,A.a.frame,Object(B.a)(this,this.R8h,"inProductMessagingShiftTabHandler"));this.La.Nb(I.a.wgh,A.a.frame,
Object(B.a)(this,this.xgh,"dimeLaunchHandler"));this.La.Nb(I.a.pTf,A.a.frame,z.ActionManager.ng);this.La.Nb(I.a.Sej,A.a.frame,z.ActionManager.ng);this.La.Nb(I.a.Tej,A.a.frame,z.ActionManager.ng);this.af&&this.af.updateCommandUI()}rCh(Wb,Nc,gd,Gd,Zd){2===gd&&this.KTb.Eri(Zd);return 32}xgh(Wb,Nc,gd,Gd,Zd){2===gd&&this.KTb.Bri(Zd);return 32}S8h(Wb,Nc,gd){return 2===gd?this.KTb.Pxd():32}R8h(Wb,Nc,gd){return 2===gd?this.KTb.Nxd():32}}Object(b.a)(F,"InProductMessagingActor",null,[]);var U=a(82);class X{constructor(){this.UPf=
this.RUf=this.N9f=this.Ojc=this.instance=null}}Object(b.a)(X,"DimeExperienceUISettings",null,[]);var T=a(159),G=a(464);class D{constructor(Wb,Nc,gd,Gd,Zd){this.J$b=!1;this.Csb=null;this.La=Wb;this.qFa=Nc;this.lWb=gd;this.g1=Gd;this.qFc=Zd}Gai(Wb){T.b("getHeaderApi")?Wb.isFeatureEnabled("MsoPremiumBadge",!0).then(Nc=>{const gd=Wb.isFreemiumUpsellEnabled();gd&&(appChrome.getHeaderApi().then(Gd=>{Gd.updatePremiumStatus(Nc,gd);return null}),Wb.Mma("MsoPremiumBadge",Gd=>{appChrome.getHeaderApi().then(Zd=>
{Zd.updatePremiumStatus(Gd.isEnabled,gd);return null})}));return null}):d.ULS.sendTraceTag(593859840,324,10,"getHeaderApi not available")}Eri(Wb){this.lWb.hti().continueWith(()=>{this.qFa.XBj(Wb)})}Bri(Wb){let Nc="gopremium",gd=null,Gd=()=>{};Wb?(Wb.experience&&""!==Object(U.a)(String,Wb.experience)&&(Nc=Object(U.a)(String,Wb.experience)),Wb.onTaskComplete&&(Gd=Wb.onTaskComplete),Wb.campaignId&&""!==Object(U.a)(String,Wb.campaignId)&&(gd=Object(U.a)(String,Wb.campaignId))):d.ULS.sendTraceTag(51675402,
324,50,"Experience not given, using default experience");this.Blf(Nc,Gd,gd)}Blf(Wb,Nc,gd=null){if(this.J$b&&this.Csb){const Gd={};Gd.experience=Wb||"gopremium";Gd.campaignId=gd||G.b(this.g1,this.qFc,Object(U.a)(String,Gd.experience),!0);this.La.processAction(I.a.pTf,2);d.ULS.sendTraceTag(51675403,324,50,"Launching Freemium Upsell dialog: "+Gd.experience);try{const Zd=Object.assign(new X,{instance:this.Csb,Ojc:Gd,N9f:Nc||(()=>{}),RUf:xe=>{d.ULS.sendTraceTag(51675405,324,50,"Dime launch result: "+xe.status)},
UPf:()=>{d.ULS.sendTraceTag(51675406,324,10,"Dime launch error");this.J$b=!1;this.Csb=null}});this.qFa.kAj(Zd)}catch(Zd){d.ULS.sendTraceTag(51675407,324,10,"Dime launch error: "+Zd.message),this.J$b=!1,this.Csb=null,this.La.de(I.a.K$b,2,{["experience"]:Gd.experience})}}else d.ULS.sendTraceTag(39978392,324,10,"FreemiumUpsellDialogDependencies not loaded"),this.La.de(I.a.K$b,2,{["experience"]:Wb})}pmf(){this.lWb.jti().continueWith(()=>{try{var Wb=t.a.sl(f.AFrameworkApplication.uiCulture);const Gd=G.c(this.g1);
if(Gd){var Nc={};Nc.partnerId=Gd;Nc.language=Wb;Nc.sessionId=f.AFrameworkApplication.userSessionId;Nc.authHint=f.AFrameworkApplication.fa.Xa("UserPrincipalName");var gd=f.AFrameworkApplication.fa.Xa("Puid")||"";""!==gd&&(Wb={},Wb.puid=gd,Nc.userInfo=Wb);this.Csb=new Dime(Nc);this.J$b=!0;d.ULS.sendTraceTag(592721856,324,50,"Dime initialized")}else d.ULS.sendTraceTag(51675409,324,15,"App not supported")}catch(Gd){d.ULS.sendTraceTag(51675410,324,10,"FreemiumUpsellDialogDependencies failed: "+Gd.message)}},
3)}Pxd(){return this.qFa.Pxd()}Nxd(){return this.qFa.Nxd()}}Object(b.a)(D,"InProductMessagingUIManager",null,[692]);class J{constructor(){this.Kje=0;this.ZWa=Array(5);this.ZWa[0]=10;this.ZWa[1]=15;this.ZWa[2]=50;this.ZWa[3]=100;this.ZWa[4]=200}Init(Wb){this.Kje=Wb}SendTrace(Wb,Nc){d.ULS.sendTraceTag(34182235,this.Kje,this.ZWa[Wb],"{0}",Nc)}}Object(b.a)(J,"DefaultNetworkingManager",null,[673]);var L=a(260),H=a(314),R=a(94);class Q{constructor(Wb){this.Zb=Wb}XBj(Wb){Wb&&(InProductMessaging.Networking.NetworkingMgr=
new J,InProductMessaging.Networking.NetworkingMgr.Init(387),InProductMessaging.Init(Wb.W4f,Wb.asf,Wb.oue,Wb.oCi,Wb.locale,Object(B.a)(this,this.jJi,"onDismissFirstRunExperience"),Wb.vcg),this.lSa(v.XVi,!0))}kAj(Wb){if(Wb&&Wb.instance&&Wb.Ojc){let Nc=document.getElementById("wacDimeContainer");Nc||(Nc=document.createElement("div"),Nc.id="wacDimeContainer",document.body.appendChild(Nc));f.AFrameworkApplication.fa.qa("DimeFocusManagerIsEnabled")&&this.lSa("wacDimeContainer",!1);Wb.Ojc.parentElementId=
"wacDimeContainer";Wb.instance.launch(Wb.Ojc,Wb.N9f).then(gd=>{this.CIb();document.body.removeChild(Nc);Wb.RUf(gd)}).catch(gd=>{this.CIb();document.body.removeChild(Nc);Wb.UPf(gd)})}else throw Error.argument("DimeExperienceUISettings");}lSa(Wb,Nc){if(this.Zb&&Wb&&(Wb=document.getElementById(Wb),this.wai(Wb),Wb=this.Zb.XM("InProductMessagingFocusId"))){const gd=this.Zb.ii;gd&&"InProductMessagingFocusId"===gd.name||this.Zb.AR("InProductMessagingFocusId",!1);Nc&&this.eOf(Wb.scope)}}wai(Wb){var Nc=this.Zb.Ei("InProductMessagingFocusId");
Nc.parent=L.AFrame.zT;const gd=new H.DOMFocusListing(()=>Wb);gd.Abb=!1;gd.ro(3);gd.ro(2);gd.ro(4);Nc=this.Zb.Csa(()=>Wb,Nc,gd);Nc.uIb();Nc.h_=!0;Nc.HHa=!0}eOf(Wb){Wb.Ck(R.FocusManager.instance().X1);Wb.Ck(R.FocusManager.instance().Y1);Wb.bindAction(R.FocusManager.instance().X1,I.a.JUe);Wb.bindAction(R.FocusManager.instance().Y1,I.a.IUe)}CIb(){this.Zb&&(this.Zb.Oca("InProductMessagingFocusId"),this.Zb.SQa("InProductMessagingFocusId"))}jJi(Wb,Nc){this.CIb();Wb=Object.assign(new x,{completed:Wb,Z9i:Nc});
f.AFrameworkApplication.vb.de(I.a.qCh,2,Wb)}Pxd(){const Wb=document.activeElement,Nc=this.Zb.wQ();return Wb&&Nc&&Nc.jf&&Wb===Nc.jf.yw?(Nc.jf.Il(Wb),Nc.uya()?32:8):4}Nxd(){const Wb=document.activeElement,Nc=this.Zb.wQ();return Wb&&Nc&&Nc.jf&&Wb===Nc.jf.firstElement?(Nc.jf.Il(Wb),Nc.HOa()?32:8):4}}Object(b.a)(Q,"InProductMessagingUIWrapper",null,[535]);var O=a(137),V=a(247),W=a(27);class da{constructor(){this.gb=null}get name(){return"Common.App.InProductMessaging"}Wh(Wb){Wb.register(r,"Common.App.InProductMessaging.DependencyDownloader").as("Common.App.InProductMessaging.IDependencyDownloader").wc().Fc(()=>
new r);Wb.register(Q,"Common.App.InProductMessaging.InProductMessagingUIWrapper").as("Common.IInProductMessagingUIWrapper").wc().Fc(()=>new Q(R.FocusManager.instance()));Wb.register(D,"Common.App.InProductMessaging.InProductMessagingUIManager").as("Common.IInProductMessagingUIManager").wc().Fc(()=>new D(f.AFrameworkApplication.vb,Wb.resolve("Common.IInProductMessagingUIWrapper"),Wb.resolve("Common.App.InProductMessaging.IDependencyDownloader"),f.AFrameworkApplication.ta.Oa.Dj,f.AFrameworkApplication.ta.Oa.a6));
Wb.register(F,"Common.App.InProductMessaging.InProductMessagingActor").wc().Fc(()=>new F(f.AFrameworkApplication.vb,f.AFrameworkApplication.ta,Wb.resolve("Common.IInProductMessagingUIManager")));Wb.register(y,"Common.App.InProductMessaging.FirstRunExperienceUISettings").as("Common.IFirstRunExperienceUISettings").wc().Fc(()=>new y);Wb.register(x,"Common.App.InProductMessaging.FirstRunExperienceViewData").as("Common.IFirstRunExperienceViewData").wc().Fc(()=>new x);this.gb=Wb}init(){this.gb.resolve("Common.App.InProductMessaging.InProductMessagingActor").Ig();
f.AFrameworkApplication.fa.qv(()=>{f.AFrameworkApplication.ta.Oa.ps&&O.a.get_instance().yk(15,()=>{this.gb.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(Wb=>{this.gb.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").Gai(Wb)})});f.AFrameworkApplication.fa.qa("FreemiumUpsellShowDialogIsEnabled")&&G.a()&&!W.a.Dka&&1!==f.AFrameworkApplication.ta.Oa.Dj&&this.gb.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(Wb=>{Wb.isFeatureEnabled("MsoPremiumBadge",
!0).then(Nc=>{!Nc&&Wb.isFreemiumUpsellEnabled()&&this.gb.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").pmf();return null})})})}dispose(){}static main(){V.a.instance.Gi(new da)}}Object(b.a)(da,"InProductMessagingPackage",null,[3,4]);var ta=a(187),K=a(41);class na{constructor(Wb,Nc,gd,Gd=null,Zd=null){this.Qv=Wb;this.Nib=Nc;this.Jib=gd;this.cfe=Gd;this.Rkb=Zd}g9b(Wb){const Nc=new Sys.StringBuilder(this.Qv.XJb);Nc.append("RoamingServiceHandler.ashx?action=");Nc.append("getFirstRunExperienceSettings");
Nc.append("&");Nc.append(this.Bgd(Wb));Nc.append("&");Nc.append(f.AFrameworkApplication.qj);f.AFrameworkApplication.yd.Jm(Nc.toString(),1,null,null,!0,2,Object(B.a)(this,this.Jja,"getRequestSuccessCallback"),Object(B.a)(this,this.i4,"getRequestFailureCallback"),null)}V2a(Wb){var Nc=new Sys.StringBuilder(this.Qv.XJb);Nc.append("RoamingServiceHandler.ashx?action=");Nc.append("saveFirstRunExperienceSettings");Nc.append("&");Nc.append(f.AFrameworkApplication.qj);Nc=Nc.toString();Wb=K.c(Wb);f.AFrameworkApplication.yd.Jm(Nc,
2,Wb,null,!0,4,Object(B.a)(this,this.k_i,"postRequestSuccessCallback"),Object(B.a)(this,this.VV,"postRequestFailureCallback"),null)}Jja(Wb){let Nc=!1,gd=null;try{if(0<Wb.data.Xd.length){const Gd=Object(U.a)(Object,K.a(Wb.data.Xd)),Zd=Gd?Gd[this.Qv.TWc]:null;Zd&&(gd=Object(U.a)(Object,K.a(Zd.toString())))}Nc=!0}catch(Gd){this.i4(null)}Nc&&this.Nib&&this.Nib(Wb.data,gd)}i4(Wb){this.Jib&&this.Jib(Wb?Wb.data:null)}k_i(Wb){this.cfe&&this.cfe(Wb?Wb.data:null)}VV(Wb){this.Rkb&&this.Rkb(Wb?Wb.data:null)}Bgd(Wb){const Nc=
new Sys.StringBuilder("requestedsettings=");for(let gd=0;gd<Wb.count;gd++)Nc.append(Wb.na(gd)),gd<Wb.count-1&&Nc.append(";");return Nc.toString()}}Object(b.a)(na,"FirstRunExperienceRequestHandler",null,[]);var P=a(230),ka=a(83);class pa{constructor(){this.Aib=this.hTb=this.Qv=null}jTd(Wb){Wb?(this.Qv=Wb,this.Tji()&&(d.ULS.sendTraceTag(51675532,306,50,"Initiating call to get FRE data for current user from Roaming Settings Service"),Wb=new ta.a,Wb.add(this.Qv.TWc),this.hTb=new na(this.Qv,Object(B.a)(this,
this.Jja,"getRequestSuccessCallback"),Object(B.a)(this,this.i4,"getRequestFailureCallback"),null,Object(B.a)(this,this.VV,"postRequestFailureCallback")),this.hTb.g9b(Wb)),(this.Qv.M7a||f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUITest",!1))&&this.kTd()):d.ULS.sendTraceTag(51675531,306,10,"Invalid launcherSettings")}Tji(){try{if(this.Qv.M7a)return!0;if(!f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceEnabled",
!0)||f.AFrameworkApplication.fa.qa("IsAnonymousUser"))return!1;if(this.Qv.Sgi||this.Qv.O7a||f.AFrameworkApplication.fa.qa("IsO365ConsumerHost"))return!0;const Wb=f.AFrameworkApplication.fa.Xa("FlightId");return-1!==(Wb?Wb.toString().toLowerCase():"").indexOf("firstrunexperienceui")}catch(Wb){d.ULS.sendTraceTag(576582624,306,10,"Error checking setting {0}",Wb?Wb.toString():null)}return!1}VWf(Wb){const Nc={},gd={};gd.FREDisplayedDate=(new Date).toUTCString();gd.VersionDisplayed=Wb;gd.RemindMeLater=
!1;Nc[this.Qv.TWc]=K.c(gd);d.ULS.sendTraceTag(51675533,306,50,"Initiating call to save FRE data for current user from Roaming Settings Service");this.hTb&&this.hTb.V2a(Nc)}Jja(Wb,Nc){Wb=Wb?+Wb.c3-+Wb.BF:-1;Wb>this.Qv.NVf?d.ULS.sendTraceTag(51675534,306,50,"Call to Roaming Settings Service took {0}ms. This is more than the {1}ms threshold. A new attempt will be made next time the user starts a new session.",Wb,this.Qv.NVf):Nc?this.Zyj(Nc)?(d.ULS.sendTraceTag(51675536,306,50,"FRE data already exists for current user. FRE UI should be displayed again. User selected 'Remind me later' option more than {0} hours ago.",
this.Qv.Rrf),this.kTd()):(this.h7c(!1),d.ULS.sendTraceTag(51675537,306,100,"Current user has already seen this version of the FRE. No further action required.")):(d.ULS.sendTraceTag(51675535,306,50,"No FRE data found for current user. FRE UI should be displayed."),this.kTd())}i4(Wb){this.h7c(!1);d.ULS.sendTraceTag(51675541,306,10,"First Run Experience failed to GET data from Roaming Settings Service with status: {0}",Wb?Wb.httpStatus:-1)}VV(Wb){d.ULS.sendTraceTag(51675542,306,10,"First Run Experience failed to POST data to Roaming Settings Service with status: {0}",
Wb?Wb.httpStatus:-1)}kTd(){this.h7c(!0);var Wb=ka.a.instance.yh("Common.ISystemInitiatedFeedback");Wb?this.J4f(Wb):(d.ULS.sendTraceTag(51675543,306,50,"Error resolving ISystemInitiatedFeedback"),f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUIResolveFuture",!0)&&((Wb=ka.a.instance.Ub("Common.ISystemInitiatedFeedback"))?Wb.execute(Nc=>{this.J4f(Nc)}):d.ULS.sendTraceTag(539494111,306,50,"Error resolving ISystemInitiatedFeedback Future")))}J4f(Wb){if(Wb){var Nc=
this.Qv.ECh;Nc&&(f.AFrameworkApplication.Yxa(Nc),f.AFrameworkApplication.cI(Nc));d.ULS.sendTraceTag(51675544,306,50,"Attempting to display First Run Experience UI using floodgate.",Nc);Wb.logActivity("ShowFirstRunExperienceUIV2",null);window.addEventListener?(this.Aib=Object(B.a)(this,this.iKi,"onFirstRunExperienceCampaignEvent"),window.addEventListener("FGWebSurfaceEvent",this.Aib,!0),window.addEventListener("FRELaunchedEvent",this.Aib,!0)):(d.ULS.sendTraceTag(51675545,306,50,"FRE V2 UI triggered. Attempting to save FRE data."),
this.VWf(this.Qv.currentVersion))}else d.ULS.sendTraceTag(539494112,306,50,"Invalid ISystemInitiatedFeedback")}iKi(Wb){if(Wb){var Nc=Wb.detail;Wb=Wb.type;var gd=this.Qv&&this.Qv.campaignId?this.Qv.campaignId.split("-")[0]:null;if("FRELaunchedEvent"===Wb||gd&&Nc&&Nc.id&&-1!==Nc.id.indexOf(gd))Nc.success&&(d.ULS.sendTraceTag(51675546,306,50,"FRE V2 UI has been launched. Attempting to save FRE data."),this.VWf(this.Qv.currentVersion)),window.removeEventListener&&(window.removeEventListener("FGWebSurfaceEvent",
this.Aib,!0),window.removeEventListener("FRELaunchedEvent",this.Aib,!0))}}Zyj(Wb){if("RemindMeLater"in Wb&&"FREDisplayedDate"in Wb){if("true"===Wb.RemindMeLater.toString()&&(+new Date-+new Date(Wb.FREDisplayedDate.toString()))/36E5>this.Qv.Rrf)return!0}else if(f.AFrameworkApplication.fa.qa("WacShowVersionBasedFREToAllUsers")&&"VersionDisplayed"in Wb&&Wb.VersionDisplayed<this.Qv.currentVersion)return d.ULS.sendTraceTag(528262853,306,50,"Current version is higher so FRE V2 UI should be displayed again."),
!0;return!1}h7c(Wb){f.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DispatchFREDecisionEvent")&&P.a.dispatch("FREDecisionEvent",{["show"]:Wb})}}Object(b.a)(pa,"FirstRunExperienceLauncher",null,[512]);class Na{constructor(){this.gb=null}get name(){return"Common.App.FirstRunExperienceLauncher"}Wh(Wb){this.gb=Wb;this.gb.register(512,"Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher").wc().Fc(()=>new pa)}init(){}dispose(){}static main(){V.a.instance.Gi(new Na)}}
Object(b.a)(Na,"FirstRunExperienceLauncherPackage",null,[3,4]);var Z=a(1109),Ra=a(1110),Da=a(1136),Ba=a(1248),ea=a(9),Y=a(222);class ja{constructor(Wb){this.$=Wb}get TWc(){return"Excel"}get campaignId(){return"aed9de6b-d4e7-4878-988a-9dfec66fed9e"}get version(){return 1}get currentVersion(){return 0}get Sgi(){return this.isEnabled()&&this.$.ma(336)}get O7a(){return this.isEnabled()&&this.$.ma(338)}get M7a(){return this.$.ma(337)}get ECh(){return null}get Rrf(){return 24}get NVf(){return 4E3}get XJb(){return this.$.ya.WebServiceBase||
""}isEnabled(){if(f.AFrameworkApplication.fa?f.AFrameworkApplication.fa.qa("IsAnonymousUser"):1)return!1;const Wb=f.AFrameworkApplication.Mb?Object(U.a)(String,f.AFrameworkApplication.Mb.AudienceGroup):"";return"Unknown"!==Wb&&"Automation"!==Wb}}Object(b.a)(ja,"FirstRunExperienceLauncherSettings",null,[534]);class ca{constructor(Wb,Nc){this.KUe=Wb;this.sCh=Nc}jTd(){this.KUe&&this.KUe.jTd(this.sCh)}}Object(b.a)(ca,"FirstRunExperienceManager",null,[533]);var ba=a(699);class ua extends Y.a{constructor(Wb){super();
this.$=Wb;this.Eb()}create(){const Wb=Object(ba.a)(this.$.da,311,()=>this.D7g());this.pb(Wb)}D7g(){var Wb=new ja(this.$);Wb=new ca(ka.a.instance.resolve("Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher"),Wb);Wb.jTd();return Wb}static ka(Wb){Wb.da.Ga(312,new ua(Wb))}}Object(b.a)(ua,"FirstRunExperienceManagerFactory",Y.a,[]);var wa=a(59);class ia extends Y.a{constructor(Wb){super();this.Bld=null;this.$=Wb;this.Eb()}create(){const Wb=Object(ba.a)(this.$.da,361,()=>this.o8g());this.pb(Wb)}o8g(){this.Bld=
ka.a.instance.yh("Common.IInProductMessagingUIManager");wa.a.wg.ps?O.a.get_instance().yk(16,()=>{this.jbf()}):this.jbf();return this.Bld}jbf(){ka.a.instance.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(Wb=>{Wb.isFeatureEnabled("MsoPremiumBadge",!0).then(Nc=>{!Nc&&Wb.isFreemiumUpsellEnabled()&&this.Bld.pmf();return null})})}static ka(Wb){Wb.da.Ga(362,new ia(Wb))}}Object(b.a)(ia,"InProductMessagingManagerFactory",Y.a,[]);var xa=a(1187),gb=a(1112),va=a(47),sa=a(414),ab=
a(78),Ua=a(1),nb=a(528),Ha=a(21),sb=a(577);class Qb extends nb.a{constructor(Wb){super(1);this.Dfa=!1;this.mwf=()=>{this.refresh()};this.nwf=()=>{this.refresh()};this.gridView=Ha.g(Wb);this.gridView.Xb.Vk(this.nwf);this.gridView.Xb.lm(this.mwf);this.refresh()}get iI(){return this.xlc(this.Dfa)}VQd(Wb){this.Dfa!==Wb&&(this.Dfa=Wb,this.CHb())}get name(){return sb.a.cellEdit}dispose(){this.gridView.Xb.Ak(this.nwf);this.gridView.Xb.Fl(this.mwf);this.gridView=null;super.dispose()}CHb(){this.rHd(this.Dfa)}refresh(){this.VQd(!this.gridView.eb)}}
Object(b.a)(Qb,"CellEditSafeStatePublisher",nb.a,[]);var mb=a(38),Pb=a(109);class gc{constructor(Wb,Nc){this.handler=null;this.publisher=Wb;this.iI=Nc}}Object(b.a)(gc,"SafeStatePublisherState",null,[]);var Xb=a(611);const Ca=Wb=>Wb?`${Wb.Current} / ${Wb.Pending} @${Wb.SuspensionStartTimestamp}`:null,ra=Wb=>(null===Wb||void 0===Wb?void 0:Wb.SuspensionStartTimestamp)&&Wb.Pending>Wb.Current;class ma extends mb.a{constructor(Wb,Nc){super();this.jlf=null;this.n8a=!1;this.fFb=(gd,Gd)=>{3===Gd.Drf&&this.n8a&&
d.ULS.sendTraceTag(520480204,0,15,"ClientStateMonitor.onMergeDidntOccur: Aborted merge occurred after another aborted merge.");this.n8a=!0;this.abb()};this.DRa=new ta.a;this.qya=Wb;this.vma=Nc;this.pzb=Ua.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);this.s7a=Ua.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1);this.pzb&&(this.vma.kZa(this.Wya.bind(this)),this.s7a?this.qya.Roe(this.fFb):this.qya.hHg(this.aBf.bind(this)))}get PPj(){return Pb.f(Pb.c(this.DRa.toArray(),
Wb=>0!=Wb.iI),Wb=>Wb.publisher.name)}e_b(Wb){this.addHandler(ma.CRa,Wb)}ytc(Wb){this.removeHandler(ma.CRa,Wb)}Xza(Wb,Nc){const gd=new gc(Wb,Nc);this.DRa.add(gd);Nc=(Gd,Zd)=>{gd.iI=Zd.iI;this.abb()};Wb.e_b(Nc);gd.handler=Nc;this.abb()}sZd(Wb){let Nc=null;for(let gd of this.DRa)if(gd.publisher===Wb){this.sdg(gd);Nc=gd;break}Nc&&(this.DRa.remove(Nc),this.abb())}dispose(){for(let Wb of this.DRa)this.sdg(Wb);this.DRa.clear();this.pzb&&(this.vma.Obb(this.Wya.bind(this)),this.s7a?this.qya.$Rf(this.fFb):
this.qya.hcj(this.aBf.bind(this)));super.dispose()}iac(){let Wb=fc.iac(this.DRa.toArray().map(Nc=>Nc.iI));return this.n8a&&1===Wb?2:Wb}sdg(Wb){Wb.publisher.ytc(Wb.handler)}abb(){const Wb=this.iac();Wb!==this.jlf&&(this.raiseEvent(ma.CRa,new Xb.a(Wb)),this.jlf=Wb)}aBf(){this.n8a&&d.ULS.sendTraceTag(523317957,0,15,"ClientStateMonitor.onMergeWasAborted: Aborted merge occurred after another aborted merge.");this.n8a=!0;this.abb()}Wya(Wb,Nc){Wb=Nc.ica;(Nc=!ra(Wb))||(Nc=this.Vqi,Nc=(null===Wb||void 0===
Wb?void 0:Wb.SuspensionStartTimestamp)!==(null===Nc||void 0===Nc?void 0:Nc.SuspensionStartTimestamp));Nc&&(this.n8a=!1);this.Vqi=Wb;this.abb()}}ma.CRa="SSC";Object(b.a)(ma,"ClientStateMonitor",mb.a,[]);var hb=a(6),vb=a(68);class Va extends nb.a{constructor(Wb,Nc=null){super(1);this.Dfa=!1;this.HN=()=>{this.refresh()};this.rxf=()=>{this.refresh()};this.$=Wb;this.k9d=Nc||vb.a(Wb).uQ(hb.a.idle);vb.a(Wb).vVc(this.rxf);this.L5a.Cq(this.HN);this.refresh()}get iI(){return this.xlc(this.Dfa)}VQd(Wb){Wb!==
this.Dfa&&(this.Dfa=Wb,this.CHb())}get name(){return sb.a.L5a}get L5a(){return this.k9d}dispose(){vb.a(this.$).dtc(this.rxf);this.L5a.Yq(this.HN);this.k9d=null;super.dispose()}CHb(){this.rHd(this.Dfa)}refresh(){this.VQd(1===this.L5a.ju||vb.a(this.$).hi===this.L5a)}}Object(b.a)(Va,"IdleActivitySafeStatePublisher",nb.a,[]);var db=a(315),oa=a(3),Oa=a(22);class Wa extends ab.a{constructor(){super()}Lc(){return!1}executeCommand(){return w.Task.Ta(!0)}Ac(Wb,Nc){return 1905775613===Nc.command}Oc(){return!1}}
Object(b.a)(Wa,"ToggleMergeSuspensionSafeState",ab.a,[164]);class Sa extends mb.a{constructor(Wb,Nc){super();this.statusBarManager=null;this.Syd=!1;this.Wya=(gd,Gd)=>{gd=`${Gd.ica.Current===Gd.ica.Pending?"\u26ad":"\u26ae"}${Gd.ica.Current}`;Oa.a.equals(this.emc,gd,!1)||(this.emc=gd,this.Jz())};this.oPa=(gd,Gd)=>{gd=0==Gd.iI;this.Syd!==gd&&(this.Syd=gd,this.Jz())};this.mergeSuspensionManager=Nc;this.mergeSuspensionManager.vma.kZa(this.Wya);this.emc="";db.a.v9(1905775613,oa.a.oc,0,1);this.Ka=Wb.Ka;
this.sOb=new Wa;Wb.da.Za(29,gd=>{this.mergeSuspensionManager&&(this.statusBarManager=gd,gd.uJ(this),this.mergeSuspensionManager.Eha.e_b(this.oPa))});this.Ka.k2(this.sOb)}Cq(Wb){this.addHandler(Sa.uxd,Wb)}Yq(Wb){this.removeHandler(Sa.uxd,Wb)}Jz(){this.raiseEvent(Sa.uxd)}vn(Wb){return Wb===Sa.G2i&&!!this.mergeSuspensionManager}ds(Wb,Nc){if(!this.vn(Wb))return!1;this.mergeSuspensionManager&&(Nc.LabelText=this.emc,Nc.On=this.Syd);return!0}dispose(){this.sOb&&(this.Ka.Dbb(this.sOb),this.sOb.dispose(),
this.sOb=null);this.mergeSuspensionManager&&(this.mergeSuspensionManager.vma.Obb(this.Wya),this.mergeSuspensionManager.Eha.ytc(this.oPa),this.mergeSuspensionManager=null);this.statusBarManager&&(this.statusBarManager.aG(this),this.statusBarManager=null);this.emc=null;super.dispose()}}Sa.uxd="MSMSC";Sa.G2i="QueryMergeSuspensionStatus";Object(b.a)(Sa,"MergeSuspensionIndicatorManager",mb.a,[160,161,10]);var yb=a(7),Ma=a(877);class Bb extends Sys.EventArgs{constructor(Wb){super();this.nxa=Wb}}Object(b.a)(Bb,
"TogglePendingMergeBlockedByClientEventArgs",Sys.EventArgs,[]);class Nb{}Object(b.a)(Nb,"SuspensionState",null,[]);class Ia extends Nb{constructor(Wb){super();this.Eqe=!1;this.Eqe=Wb}}Object(b.a)(Ia,"ReadyForPendingMergeState",Nb,[]);const jb=new Nb,Ob=new Nb,Jb=new Ia(!1),Kb=new Ia(!0);var Qa=a(878);class ha extends Qa.a{constructor(Wb,Nc,gd){super(Wb);this.xKg=Nc;this.zCj=gd}}Object(b.a)(ha,"ReadyForPendingMergesUpdatedEventArgs",Qa.a,[]);class qa extends mb.a{constructor(Wb,Nc,gd){super();this.Wya=
(Gd,Zd)=>{Gd=this.getState();const xe=this.n_;this.n_=Zd.ica;Zd=this.getState();this.Zvi(Gd,Zd,xe);this.raiseEvent(qa.pxd);this.uUe(Gd,Zd)};this.oPa=(Gd,Zd)=>{Gd=this.getState();this.iI=Zd.iI;Zd=this.getState();this.uUe(Gd,Zd)};this.fFb=(Gd,Zd)=>{this.s7a&&4===Zd.Drf&&(d.ULS.sendTraceTag(520480203,0,50,"MergeSuspensionStateHandler.onMergeDidntOccur: Retry DoPendingMerge after bailout. Current merge counter: {0}, Response merge counter: {1}",Ca(this.n_),Ca(Zd.n_)),this.CMf(this.getState(),!0))};this.pzb=
Ua.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);this.s7a=Ua.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1);this.Eha=Wb;this.Eha.e_b(this.oPa);this.vma=Nc;this.vma.kZa(this.Wya);this.s7a&&(this.qya=gd,this.qya.Roe(this.fFb));this.n_=Object(yb.a)(new Ma.a,{Pending:0,Current:0,SuspensionStartTimestamp:null});this.iI=this.V9h()}V9h(){return Object(sa.a)(ma,this.Eha)?Object(U.a)(ma,this.Eha).iac():1}j_b(Wb){this.addHandler(qa.wXd,
Wb)}Ctc(Wb){this.removeHandler(qa.wXd,Wb)}XHg(Wb){this.addHandler(qa.cId,Wb)}Lcj(Wb){this.removeHandler(qa.cId,Wb)}gHg(Wb){this.addHandler(qa.pxd,Wb)}gcj(Wb){this.removeHandler(qa.pxd,Wb)}t4i(){this.oHd(this.getState()===Ob)}dispose(){this.Eha.ytc(this.oPa);this.Eha=null;this.vma.Obb(this.Wya);this.vma=null;this.s7a&&(this.qya.$Rf(this.fFb),this.qya=null);super.dispose()}Qfd(){return Object(yb.a)(new Ma.a,{Current:this.n_.Current,Pending:this.n_.Pending,SuspensionStartTimestamp:this.n_.SuspensionStartTimestamp})}getState(){return ra(this.n_)?
0==this.iI?Kb:this.pzb&&1==this.iI?Jb:Ob:jb}uUe(Wb,Nc){Wb!==Nc&&(Nc===Ob?this.oHd(!0):Wb===Ob&&this.oHd(!1));this.CMf(Nc)}CMf(Wb,Nc=!1){Wb instanceof Ia&&this.raiseEvent(qa.cId,new ha(this.n_,Wb.Eqe||!this.pzb,Nc))}Zvi(Wb,Nc,gd){Wb===jb&&Nc!==jb?(Wb=Nc===Ob,Nc=Nc===Jb,d.ULS.sendTraceTag(252760283,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: Pending changes exist. IsBlocking: ${Nc} publisher: ${Nc||Wb?this.Eha.PPj.join(","):""} counter: ${Ca(this.n_)} isBlockingAllMerges: ${Wb}`)):
Wb!==jb&&Nc===jb&&d.ULS.sendTraceTag(252760284,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: No pending changes. counter: ${Ca(gd)}`)}oHd(Wb){this.raiseEvent(qa.wXd,new Bb(Wb))}}qa.wXd="TPMBBC";qa.cId="RFPMU";qa.pxd="MCC";Object(b.a)(qa,"MergeSuspensionStateHandler",mb.a,[]);class pb extends mb.a{constructor(Wb){super();this.G1=null;this.ujc=0;this.oCa=(Nc,gd)=>{var Gd;if(null===(Gd=null===gd||void 0===gd?void 0:gd.ed)||void 0===Gd?0:Gd.MergeCount)Oa.a.equals(gd.ed.SessionId,this.$.ea.sessionId,
!1)?this.Vya(gd.ed.MergeCount,pb.$sb):d.ULS.sendTraceTag(579737049,0,50,`Stale merge counter (${gd.ed.MergeCount.Current}/${gd.ed.MergeCount.Pending})`)};this.lDb=(Nc,gd)=>{(null===gd||void 0===gd?0:gd.ica)&&this.Vya(gd.ica,pb.b1d)};this.lwc=()=>{this.FUf();this.sMf(this.G1,pb.lgj)};this.d$a=(Nc,gd)=>{gd.Nqb&&this.G1.SuspensionStartTimestamp&&d.ULS.sendTraceTag(17318084,0,50,`PendingMergeMonitor.OnEditCellEnded: committed with counter ${Ca(this.G1)}`)};this.FUf();this.$=Wb;this.$.ea.rk(this.lwc);
this.$.ea.jM(this.lwc);Ha.g(this.$).Xb.lm(this.d$a);Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:6329027_UpdateMergeCountWhenWebMethodReturnsWithErrors")||this.$.pa.pr(this.oCa);this.$.da.Za(292,Nc=>{Nc.kZa(this.lDb);d.ULS.sendTraceTag(588276809,0,50,"PendingMergeMonitor initialized")})}kZa(Wb){this.addHandler("MCU",Wb)}Obb(Wb){this.removeHandler("MCU",Wb)}get n_(){return this.G1}Vya(Wb,Nc=""){const gd=this.G1.Current<Wb.Current||this.G1.Pending<Wb.Pending;if(Wb.SuspensionStartTimestamp&&this.ujc!==
Wb.SuspensionStartTimestamp){if(this.ujc>Wb.SuspensionStartTimestamp){gd&&d.ULS.sendTraceTag(553736149,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: skipping a higher stale counter received via ${Nc}. S: ${pb.kDb(Wb)}, C: ${pb.kDb(this.G1)}`);return}gd||d.ULS.sendTraceTag(553736148,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: recovering from a potentially stale counter. S: ${pb.kDb(Wb)}, C: ${pb.kDb(this.G1)}`)}else if(!gd)return;this.G1=Wb;this.sMf(Wb,Nc)}dispose(){this.$.ea.Pk(this.lwc);
this.$.ea.GR(this.lwc);Ha.g(this.$).Xb.Fl(this.d$a);Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:6329027_UpdateMergeCountWhenWebMethodReturnsWithErrors")||this.$.pa.Fs(this.oCa);const Wb=this.$.da.za(292);Wb&&Wb.Obb(this.lDb);super.dispose()}sMf(Wb,Nc=""){ra(Wb)&&Wb.SuspensionStartTimestamp>this.ujc&&(d.ULS.sendTraceTag(537155416,0,50,`PendingMergeMonitor.RaiseMergeCounterUpdated: Merge suspension requested. MergeCounter: ${Ca(Wb)}, Origin: ${Nc}`),this.ujc=Wb.SuspensionStartTimestamp);this.raiseEvent("MCU",
new Qa.a(Wb))}FUf(){d.ULS.sendTraceTag(588276808,0,50,`PendingMergeMonitor.ResetMergeCounter : Last counter was ${pb.kDb(this.G1)}`);this.G1=Object(yb.a)(new Ma.a,{Pending:0,Current:0,SuspensionStartTimestamp:null})}static kDb(Wb){return Wb?`(${Wb.Current}/${Wb.Pending} @${Wb.SuspensionStartTimestamp})`:"null"}}pb.b1d="PMM.RTC";pb.$sb="PMM.EwaResult";pb.lgj="PMM.resetMergeCounter";Object(b.a)(pb,"PendingMergeMonitor",mb.a,[]);class bb{}Object(b.a)(bb,"ClientRevisions",null,[]);var eb=a(45),Fa=a(61);
const tb=(Wb,Nc,gd,Gd,Zd,xe,Re,Ue=null)=>{Ue=Wb.Na(1,Ue);Ue.viewportState=Nc;Ue.allowViewAdjustment=gd;return Fa.g(Wb,"DoPendingMerge",Ue,Gd,Zd,xe,Re,0)},dc=(Wb,Nc,gd,Gd,Zd,xe,Re=null)=>{Re=Wb.Na(1,Re);Re.suspensionStartTimestamp=Nc;return Fa.g(Wb,"KeepBlockingPendingMerges",Re,gd,Gd,Zd,xe,0)};class jc extends mb.a{constructor(Wb,Nc,gd,Gd){super();this.LIa=null;this.lBb=0;this.mBb=this.c8a=null;this.KCf=(Zd,xe)=>{this.LIa.WNg(xe.ica,xe.xKg,xe.zCj)};this.KFb=(Zd,xe)=>{xe.nxa?this.REj():this.wzc()};
this.$Af=()=>{this.lBb=0};this.VYf=()=>{const Zd=this.R5.Qfd();dc(this.va,null!=Zd.SuspensionStartTimestamp?Zd.SuspensionStartTimestamp:0,null,()=>{this.QNi(Zd)},null,null,this.va.Tb())};this.pCa=(Zd,xe)=>{if(xe){xe.Rnb.MergeCount=this.R5.Qfd();let Re;({min:Zd,max:Re}=Ha.g(this.$).XAi());Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:5524817_LogOnMergeRaceCondition2")?xe.Rnb.ClientRevisions=Object(yb.a)(new bb,{Min:Zd,Max:Re,MaxFromBlockCache:Ha.g(this.$).Ea.brf}):xe.Rnb.ClientRevisions=Object(yb.a)(new bb,
{Min:Zd,Max:Re})}};this.$=Wb;this.c_a=gd;this.R5=Nc;this.R5.XHg(this.KCf);this.R5.j_b(this.KFb);this.R5.gHg(this.$Af);this.$.pa.Pga(this.pCa);this.va=this.$.pa.va;this.SLd=this.$.ya.MergeSuspensionRequestThrottlingTimeInMs;this.pqi=this.$.ya.KeepBlockingPendingMergesRequestIntervalMs;this.LIa=Gd;d.ULS.sendTraceTag(588276807,0,50,"RequestController initialized")}dispose(){this.$.pa.Wma(this.pCa);this.wzc();this.R5.Lcj(this.KCf);this.R5.Ctc(this.KFb);this.R5.gcj(this.$Af);this.R5=null;super.dispose()}REj(){this.wzc();
if(this.YIe()){const Wb=this.R5.Qfd();d.ULS.sendTraceTag(537155414,0,50,`RequestController.StartKeepBlockingPendingMergesTimer: Prevented starting StartKeepBlockingPendingMergesTimer because of repeated failure in counter ${Ca(Wb)} fail count: ${this.lBb}`)}else this.mBb=this.c_a.create(this.VYf,this.SLd,eb.a.mBb),this.c8a=this.c_a.WE(this.VYf,this.pqi,eb.a.c8a)}wzc(){this.c8a&&(this.mBb.cancel(),this.c8a.cancel(),this.c8a=this.mBb=null)}QNi(Wb){let Nc;Nc=" fail count: "+this.lBb;this.lBb++;this.YIe()&&
this.wzc();d.ULS.sendTraceTag(542229773,0,10,`RequestController.OnKeepBlockingPendingMergesRequestFailed: request failed ${Ca(Wb)}${Nc}`)}YIe(){return this.lBb>jc.Hzi}}jc.Hzi=5;Object(b.a)(jc,"RequestController",mb.a,[]);var fb=a(155),ec=a(195),lb=a(28),ac=a(281);class Gb extends Sys.EventArgs{constructor(Wb,Nc){super();this.Drf=Wb;this.n_=Nc}}Object(b.a)(Gb,"MergeDidntOccurEventArgs",Sys.EventArgs,[]);class wb extends mb.a{constructor(Wb,Nc,gd=null,Gd=null,Zd=null){super();this.tjc=null;this.eDd=
0;this.documentVisibilityObserver=null;this.Bkf=!1;this.va=Wb;this.SLd=Nc.ya.MergeSuspensionRequestThrottlingTimeInMs;const xe=Nc.ya.GetRangeContentPrefetchDelayForMergeInMs;this.Ay=()=>{Nc.DXf(xe)};this.Oh=gd||lb.a.Pa;this.tgg=0;this.xL=Gd;this.xAa=Zd;Nc.da.Za(291,Re=>{this.documentVisibilityObserver=Re})}get jMa(){return 0<this.eDd}hHg(Wb){this.addHandler(wb.vxd,Wb)}hcj(Wb){this.removeHandler(wb.vxd,Wb)}Roe(Wb){this.addHandler(wb.qxd,Wb)}$Rf(Wb){this.removeHandler(wb.qxd,Wb)}get isDocumentHidden(){return!!this.documentVisibilityObserver&&
this.documentVisibilityObserver.vi}WNg(Wb,Nc,gd=!1){this.vMb(Wb,Nc,gd)?(new fb.a).setResult(!0):(Nc=this.RXi(Wb,Nc),this.tjc=Wb,this.eDd++,Nc.continueWith(()=>{this.nJi()},0,ec.a.none,this.xL))}RXi(Wb,Nc){this.tgg=this.Oh.Iea;this.Bkf=Nc;d.ULS.sendTraceTag(554767493,0,50,`DoPendingMergeSender.performDoPendingMergeInternal: Sending DoPendingMerge ${Wb.Current} / ${Wb.Pending} @${Wb.SuspensionStartTimestamp}. allowSelectionAdjustment: ${Nc}`);this.isDocumentHidden||this.Ay();return this.Omj(Nc,Wb)}vMb(Wb,
Nc,gd=!1){if(this.xAa&&!Nc&&!this.xAa.uni())return d.ULS.sendTraceTag(523317956,0,50,"DoPendingMergeSender.shouldThrottle: We can't retrieve selection and selection adjustments are disallowed."),!0;if(!this.tjc||Wb.SuspensionStartTimestamp>this.tjc.SuspensionStartTimestamp)return this.jMa&&d.ULS.sendTraceTag(523551556,0,50,`DoPendingMergeSender.shouldThrottle: Allowing request for new suspension while previous is ongoing, new counter: ${Wb.Current} / ${Wb.Pending} @${Wb.SuspensionStartTimestamp}`),
!1;if(this.jMa)return!0;if(gd)return!1;gd=this.tjc;const Gd=this.Oh.Iea-this.tgg<this.SLd;Nc=this.Bkf===Nc;return(Wb||gd?Wb&&gd?Wb.Current===gd.Current&&Wb.Pending===gd.Pending&&Wb.SuspensionStartTimestamp===gd.SuspensionStartTimestamp:!1:!0)&&Gd&&Nc}Omj(Wb,Nc){const gd=this.va.Tb(),Gd=()=>{d.ULS.sendTraceTag(588276806,0,10,`DoPendingMergeSender.sendDoPendingMergeRequest: request failed ${Nc.Current} / ${Nc.Pending} @${Nc.SuspensionStartTimestamp}`)};return this.xAa?this.xAa.qjj(this.INh(Wb,Gd,gd)):
this.dxe(null,!0,void 0,Gd,gd)}INh(Wb,Nc,gd){return(Gd,Zd,xe)=>{let Re=void 0;d.ULS.shipAssertTag(523317955,0,null!=Gd||Wb,"!allowSelectionAdjustment requires a non-null initialViewportState.");Re=this.oJi.bind(this);Zd&&(Re=ac.b.call(null,Ue=>{const jf=Ue.Result;let Bf=null===jf||void 0===jf?void 0:jf.AdjustedViewportState;3===(null===jf||void 0===jf?void 0:jf.MergeResultState)&&(Bf=void 0);Zd(Bf,Ue.StateId)},Re));xe&&(Nc=ac.a.call(null,xe,Nc));return this.dxe(Gd,Wb,Re,Nc,gd)}}dxe(Wb,Nc,gd,Gd,Zd){return tb(this.va,
Wb,Nc,gd,Gd,null,null,Zd)}oJi(Wb){var Nc=Wb.Result;void 0!=Nc&&(Nc=Nc.MergeResultState,Ua.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1)&&2!==Nc?this.V3i(Nc,Wb.MergeCount):3===Nc&&(d.ULS.sendTraceTag(523317954,0,50,"DoPendingMergeSender.onDoPendingMergeSucceeded: Aborted merge."),this.W3i()))}W3i(){this.raiseEvent(wb.vxd,new Sys.EventArgs)}V3i(Wb,Nc){this.raiseEvent(wb.qxd,new Gb(Wb,Nc))}nJi(){this.eDd--}}wb.vxd="MWA";wb.qxd="MDO";Object(b.a)(wb,"DoPendingMergeSender",
mb.a,[567,568]);class qc{constructor(Wb=!1){this.divergenceOnResponse=this.adjustedDidntChangeWithDivergence=this.editBoxDivergence=this.differentSheetAdjust=this.parallel=this.errors=this.nonContinuous=this.divergenceOnViewportReady=this.adjusted=this.adjustedDidntChange=0;this.P8h=Wb}get reportName(){return this.P8h?"SelectionAdjustInHiddenDocument":"SelectionAdjust"}}Object(b.a)(qc,"SelectionAdjustSessionEndsReport",null,[241]);var Ya=a(43),xb=a(97);class wc{constructor(Wb,Nc,gd,Gd,Zd,xe){this.iJ=
void 0;this.jb=Wb;this.CG=Nc;this.j9=gd;this.TWb=Gd;this.H2d=Zd;Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:6592063_GetIndexOfActiveRangeFromInitialSelection_V2")&&(this.iJ=xe)}get activeCell(){return this.CG}get selectedRanges(){return this.j9}get ls(){let Wb=!1;if(null===this.iJ||void 0===this.iJ)Wb=!0;else if(this.iJ>=this.selectedRanges.length||!this.selectedRanges[this.iJ].contains(this.activeCell))d.ULS.sendTraceTag(521200010,0,50,`SelectionState.indexOfActiveRange: the index of the adjusted active range has changed. indexOfActiveRange: ${this.iJ}, selectedRangesLength: ${this.selectedRanges.length}`),
Wb=!0;Wb&&(this.iJ=this.RUg());return this.iJ}get activeRange(){return 0>this.ls?this.activeCell:this.selectedRanges[this.ls]}get sheetName(){return this.TWb}get activeItemName(){return this.H2d}get vkg(){return 1===this.selectedRanges.length}thg(Wb){let Nc=this.selectedRanges.map(gd=>this.mNj(gd,this.H2d));for(let gd of Nc)if(gd)for(let Gd of gd)if(Gd.Kk&&Gd.qe.Revision<Wb)return!1;return!0}uKj(){var Wb;return{SheetName:this.sheetName,ActiveCell:null===(Wb=this.activeCell)||void 0===Wb?void 0:Wb.toString(),
TopLeft:void 0,SelectedRanges:Ya.r(this.selectedRanges,this.jb)}}toString(){var Wb,Nc;return`active cell: ${null!==(Nc=null===(Wb=this.activeCell)||void 0===Wb?void 0:Wb.toString())&&void 0!==Nc?Nc:"null"} selection: ${Pb.f(this.selectedRanges,gd=>{var Gd;return null!==(Gd=null===gd||void 0===gd?void 0:gd.toString())&&void 0!==Gd?Gd:"null"}).join(",")}`}equals(Wb){return Wb?this.activeCell.equals(Wb.activeCell)&&Ya.Q(this.selectedRanges,Wb.selectedRanges)&&this.sheetName===Wb.sheetName:!1}RUg(){for(let [Wb,
Nc]of this.selectedRanges.entries())if(null===Nc||void 0===Nc?0:Nc.contains(this.activeCell))return Wb;return-1}mNj(Wb,Nc){var gd;const Gd=Ha.g(this.jb).Ea.V3a(Wb,Nc);Gd||d.ULS.sendTraceTag(522803340,0,50,`SelectionState.tryGetBlockCacheItemsFromRange: no items found. range: ${null!==(gd=null===Wb||void 0===Wb?void 0:Wb.toString())&&void 0!==gd?gd:"null"} ; activeItemNameIsDefined: ${!!Nc}`);return Gd}}Object(b.a)(wc,"SelectionState",null,[]);var Oc=a(201),Cb=a(737);class Ib{constructor(Wb){this.rzc=
0;this.MA=this.yF=null;this.X2d=new qc;this.Y2d=new qc(!0);this.YH=0;this.CIj=!1;this.aBi=1E4;this.dd=()=>{this.dGe()};this.Ej=()=>{this.VXc(!0,!1)};this.V9a=()=>{this.VXc(!1,!1)};this.$=Wb;this.gridView=Ha.g(this.$);this.gridView.Ea.Wv(this.Ej);this.gridView.Ea.Ws(this.V9a);this.gridView.Ea.aoe(this.V9a);this.gridView.Ea.Mga(this.V9a);Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:6385622_SelectionAdjustImplementsCustomReportManager")&&this.$.kl(this.dd);this.dGe()}qjj(Wb){let Nc=null,gd=null,Gd=
()=>{this.WFi()};this.Ecf()?(this.uP.parallel++,d.ULS.sendTraceTag(526390086,0,15,`SelectionAdjustManager.runRequestWithSelectionAdjust: Skipping parallel request. Current adjustedSelection is defined : ${!!this.MA}`)):(Nc=(Zd,xe)=>{this.XFi(Zd,xe)},gd=this.qsj());return null===Wb||void 0===Wb?void 0:Wb(gd,Nc,Gd)}uni(){return!this.Ecf()&&this.Faa().vkg}qsj(){var Wb;d.ULS.shipAssertTag(525135961,0,0===this.YH,"SelectionAdjustManager.setPreRequestState: unexpected state");this.MA&&(this.uP.errors++,
d.ULS.sendTraceTag(526960090,0,10,`SelectionAdjustManager.setPreRequestState: About to ignore a defined Adjusted selection: ${this.MA.toString()}`));this.MA=null;this.yF=this.Faa();let Nc=null;const gd=null===(Wb=this.yF)||void 0===Wb?void 0:Wb.uKj();gd&&(Nc={ActiveSheetName:this.yF.sheetName,SheetViewportStateChanges:[gd]});this.YH=1;return Nc}WFi(){d.ULS.shipAssertTag(525135960,0,1===this.YH,"SelectionAdjustManager.onAdjustedRequestFailed: unexpected state");this.uP.errors++;this.YH=2;this.ur()}XFi(Wb,
Nc){try{d.ULS.shipAssertTag(525135959,0,1===this.YH,"SelectionAdjustManager.onAdjustedSelectionReady: unexpected state"),this.rzc=Nc,Nc=2,this.yF?Wb?(this.MA=this.Nvj(Wb))?(Nc=7,this.yF.equals(this.MA)?this.yF.equals(this.Faa())?(this.uP.adjustedDidntChange++,Nc=4):(this.uP.adjustedDidntChangeWithDivergence++,Nc=5):this.yF.sheetName!=this.MA.sheetName?(this.uP.differentSheetAdjust++,Nc=10):this.yF.equals(this.Faa())||(this.uP.divergenceOnResponse++,Nc=6,this.kTf())):this.uP.errors++:(this.uP.errors++,
d.ULS.sendTraceTag(537155412,0,15,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted returned null, initialSelection: ${this.yF.toString()}`)):(this.uP.errors++,d.ULS.sendTraceTag(537155413,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted selection results returned when not waiting for them, adjusted:  ActiveCell: ${null===Wb||void 0===Wb?void 0:Wb.ActiveCell}`)),this.YH=Nc}catch(gd){this.YH=12,d.ULS.sendTraceTag(525135958,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: caught Exception ${gd}`)}finally{7!=
this.YH?this.ur():this.VXc(!1,!0)}}dispose(){this.gridView.Ea.Rw(this.Ej);this.gridView.Ea.Xq(this.V9a);this.gridView.Ea.nRf(this.V9a);this.gridView.Ea.Hbb(this.V9a);Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:6385622_SelectionAdjustImplementsCustomReportManager")&&this.$.Hl(this.dd)}Ecf(){return 1===this.YH||7===this.YH}Nvj(Wb){let Nc;if(!({range:Nc}=Ya.Z(Wb.ActiveCell,this.$.xa)).returnValue)return d.ULS.sendTraceTag(537155411,0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: Unable to extract active cell ${Wb.ActiveCell}`),
null;let gd=[];const Gd=this.$.oa,Zd=!!Gd&&2===Gd.mG;if(Wb.SelectedRanges)gd=Ya.g(Wb.SelectedRanges.Ranges);else if(!Zd)return d.ULS.sendTraceTag(522826913,0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: SelectedRanges is null, active sheet exists: ${!!Gd}`),null;return new wc(this.$,Nc,gd,Wb.SheetName,this.yF.activeItemName,this.yF.ls)}Faa(){const Wb=this.$.oa;if((null===Wb||void 0===Wb?0:Wb.activeCell)&&Wb.selectedRanges&&Wb.sheetName)return new wc(this.$,Wb.activeCell,Wb.selectedRanges,
Wb.sheetName,this.$.activeItemName,Wb.ls);d.ULS.sendTraceTag(525135957,0,15,`SelectionAdjustManager.getCurrentSelection: invalid activeItem. activeItem null: ${!Wb}, activeCell null: ${!(null===Wb||void 0===Wb?0:Wb.activeCell)}, selectedRanges null: ${!(null===Wb||void 0===Wb?0:Wb.selectedRanges)}, sheetName null: ${!(null===Wb||void 0===Wb?0:Wb.sheetName)}`);return null}dGe(){this.$.da.Za(276,()=>{const Wb=Oc.a(this.$);Wb.$X(this.X2d);Wb.$X(this.Y2d)})}VXc(Wb,Nc){var gd;if(this.Ili(Wb))if(8===this.YH)d.ULS.sendTraceTag(523106438,
0,15,"SelectionAdjustManager.attemptAdjustSelection: skipping as was already adjusted");else{Nc&&d.ULS.sendTraceTag(524039250,0,50,"SelectionAdjustManager.attemptAdjustSelection: viewport ready on response");try{d.ULS.shipAssertTag(525135956,0,7===this.YH,"SelectionAdjustManager.attemptAdjustSelection: unexpected state"),this.yF.equals(this.Faa())?(null===(gd=this.gridView)||void 0===gd?0:gd.eb)?(this.uP.editBoxDivergence++,this.YH=11):(Wb=0,Wb=this.MA.ls,-1==Wb?(this.uP.errors++,d.ULS.sendTraceTag(522826912,
0,10,"SelectionAdjustManager.attemptAdjustSelection: invalid indexOfActiveRange")):(this.uP.adjusted++,this.YH=8,Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:6413876_AdjustSelectionWithoutCallingGoto")?this.gridView.ha.Xw(this.MA.selectedRanges,Wb,this.MA.activeCell,0,void 0,xb.a.FYf):this.gridView.rZ(this.MA.selectedRanges,Wb,this.MA.sheetName,null,this.MA.activeCell,null,null,0,xb.a.FYf))):(this.uP.divergenceOnViewportReady++,this.kTf(),this.YH=9)}catch(Gd){this.YH=12,d.ULS.sendTraceTag(525135955,
0,10,`SelectionAdjustManager.attemptAdjustSelection: caught Exception ${Gd}`)}finally{this.ur()}}}Ili(Wb){if(!this.MA)return!1;if(!this.yF)return d.ULS.sendTraceTag(537155409,0,10,`SelectionAdjustManager.attemptAdjustSelection: initialSelection is null while adjustedSelection isn't null, adjustedSelection: ${this.MA.toString()}`),!1;if(Ha.g(this.$).Ea.brf<this.rzc)return!1;if(Wb||this.CIj)d.ULS.sendTraceTag(528590295,0,15,"SelectionAdjustManager.attemptAdjustSelection: got to blockCacheConsistent while pending for selection adjust");
else if(!this.yF.thg(this.rzc)||!this.MA.thg(this.rzc))return!1;return!0}ur(){this.yF=this.MA=null;this.YH=0}kTf(){const Wb=this.Faa();d.ULS.sendTraceTag(537155408,0,50,`SelectionAdjustManager.ReportDivergence: initial: ${this.yF.toString()} current: ${Wb?Wb.toString():""} adjusted: ${this.MA.toString()} sheetSameBetweenInitialAndAdjusted: ${this.yF.sheetName===this.MA.sheetName} sheetSameBetweenInitialAndCurrent: ${this.yF.sheetName===(Wb?Wb.sheetName:null)}`)}get uP(){return Cb.a.lD(this.aBi)?this.Y2d:
this.X2d}}Object(b.a)(Ib,"SelectionAdjustManager",null,[565,10]);class fc extends ab.a{constructor(Wb,Nc,gd=null){super();this.YCa=this.Nec=this.M5a=this.f0a=null;d.ULS.sendTraceTag(537155417,0,50,"MergeSuspensionManager.ctor started");this.$=Wb;this.sXa=new pb(Wb);this.xAa=new Ib(this.$);this.LIa=new wb(this.$.pa.va,this.$,void 0,void 0,this.xAa);this.p$h(Wb,gd);this.Kfa=new qa(this.YCa,this.sXa,this.LIa);this.NLd=new jc(Wb,this.Kfa,Nc,this.LIa);Ua.EwaSettings.ma(254)&&(this.Nec=new Sa(Wb,this));
d.ULS.sendTraceTag(588276810,0,50,"MergeSuspensionManager created")}j_b(Wb){this.Kfa.j_b(Wb)}Ctc(Wb){this.Kfa&&this.Kfa.Ctc(Wb)}get Eha(){return this.YCa}get vma(){return this.sXa}get R5(){return this.Kfa}Xza(Wb,Nc){this.YCa.Xza(Wb,Nc)}sZd(Wb){this.YCa.sZd(Wb)}Vya(Wb,Nc=""){this.sXa.Vya(Wb,Nc)}dispose(){this.Nec&&(this.Nec.dispose(),this.Nec=null);this.xAa&&this.xAa.dispose();this.LIa.dispose();this.NLd&&(this.NLd.dispose(),this.NLd=null);this.Kfa&&(this.Kfa.dispose(),this.Kfa=null);this.sXa.dispose();
this.sXa=null;this.YCa.dispose();this.YCa=null;this.f0a&&(this.f0a.dispose(),this.f0a=null);this.M5a&&(this.M5a.dispose(),this.M5a=null);this.$=null;super.dispose()}CHb(){this.Kfa.t4i()}static iac(Wb){let Nc=0;for(let gd of Wb){if(2==gd)return 2;1==gd&&(Nc=1)}return Nc}p$h(Wb,Nc){this.YCa=new ma(this.LIa,this.sXa);Nc?Object(sa.a)(Va,Nc)?this.Xza(Nc,Object(U.a)(Va,Nc).iI):Object(sa.a)(Qb,Nc)?this.Xza(Nc,Object(U.a)(Qb,Nc).iI):this.Xza(Nc,0):(this.f0a=new Qb(Wb),this.M5a=new Va(Wb),this.Xza(this.f0a,
this.f0a.iI),this.Xza(this.M5a,this.M5a.iI))}}Object(b.a)(fc,"MergeSuspensionManager",ab.a,[531,10]);class vc extends Y.a{constructor(Wb){super();this.Jc=Wb;this.Eb()}create(){d.ULS.sendTraceTag(537155419,0,50,"MergeSuspensionFactory.Create");this.pb(this.Jc.da.za(343)||this.Jc.da.Ga(343,new fc(this.Jc,va.a.instance)))}static ka(Wb){d.ULS.sendTraceTag(537155418,0,50,"MergeSuspensionFactory.Attach");Wb.da.Ga(344,new vc(Wb))}}Object(b.a)(vc,"MergeSuspensionFactory",Y.a,[]);var Cc=a(50),fd=a(37),od=
a(86),Ub=a(98),Fc=a(58),$b=a(14);class zc{}zc.Wsi=3;zc.connected=0;Object(b.a)(zc,"ConnectionStateConstants",null,[]);var Wc=a(110),yc=a(118),pd=a(42);class xd{constructor(Wb,Nc,gd){var Gd;this.type=0;this.startTime=null;this.blockedOperationsCount=this.durationMs=0;this.blockedActions=null;this.blockedUserOperationsWhileToastShown=this.durationUntilToastShownMs=0;this.toastRaiser=null;this.wasUserActiveOnPIEnd=this.wasUserActiveOnPIStart=this.hasTabbedOut=this.isToastShown=!1;this.durationUntilUserInactive=
-1;this.isTaskPaneCollapsed=this.isTaskPaneShown=this.isDialogShown=!1;this.Xvf=(Zd,xe)=>{this.blockedOperationsCount++;Zd=`${xe.componentName}_${xe.actionName}_${xe.details})`;this.blockedActions[Zd]=this.blockedActions[Zd]?this.blockedActions[Zd]+1:1;this.isToastShown&&this.blockedUserOperationsWhileToastShown++};this.aDd=Zd=>{this.durationUntilUserInactive=Wc.getElapsedSeconds(this.startTime,lb.a.Pa.zb);Zd.TKd(this.aDd)};this.f6=()=>{this.hasTabbedOut=!0};this.Aca=(Zd,xe)=>{xe.DHf!==this.type||
this.isToastShown||(this.durationUntilToastShownMs=yc.a(lb.a.Pa,this.startTime),this.toastRaiser=xe.toastRaiser,this.isToastShown=!0)};this.startTime=Wb;this.durationUntilToastShownMs=0;this.blockedActions={};this.isToastShown=gd;if(null===(Gd=Nc.ea)||void 0===Gd?0:Gd.pf)this.wasUserActiveOnPIStart=Nc.ea.pf.rs;this.Ij(Nc);this.isDialogShown=0<Nc.rb.uR;Wb=Nc.da.za(183);this.isTaskPaneShown=!!Wb&&Wb.isVisible&&!Wb.isCollapsed;this.isTaskPaneCollapsed=!!Wb&&Wb.isVisible&&Wb.isCollapsed}I_f(){this.durationMs=
yc.a(lb.a.Pa,this.startTime)}iCd(Wb){var Nc;this.I_f();pd.a(Wb).wtc(this.Xvf);pd.a(Wb).Wf.xtc(this.Aca);Wb.da.Za(291,gd=>{gd.Jbb(this.f6)});if(null===(Nc=Wb.ea)||void 0===Nc?0:Nc.pf)Wb.ea.pf.TKd(this.aDd),this.wasUserActiveOnPIEnd=Wb.ea.pf.rs}Ij(Wb){pd.a(Wb).$Zb(this.Xvf);this.isToastShown?this.toastRaiser="Immediate":pd.a(Wb).Wf.PVc(this.Aca);Wb.da.Za(291,Nc=>{this.hasTabbedOut=Nc.vi;Nc.dZa(this.f6)});this.wasUserActiveOnPIStart&&Wb.ea.pf.Epe(this.aDd)}}Object(b.a)(xd,"PartialInteractivityData",
null,[]);var Vb=a(1113);class Uc extends xd{constructor(Wb,Nc,gd,Gd,Zd,xe){super(Wb,Nc,Gd);this.swappedOffline=this.swappedByOffline=!1;this.lastFailedRequestToOnlineTimeGapSec=this.longestDurationBetweenFailedRequestsSec=this.averageDurationBetweenFailedRequestsSec=0;this.errorDataDuringConnectivityIssuesMode=this.disconnectionSource=null;this.failedRequests=[];this.triggeringRequest=null;this.type=4;this.swappedOffline=gd;this.disconnectionSource=Enum.toString(Vb.a,Zd);this.triggeringRequest=xe}kIi(Wb,
Nc){this.swappedByOffline=Nc;this.iCd(Wb)}hqj(Wb){this.errorDataDuringConnectivityIssuesMode=Wb}F6i(Wb){10>this.failedRequests.length&&(Wb=Wb+"_"+Wc.getElapsedSeconds(this.startTime,lb.a.Pa.zb).toString(),this.failedRequests.push(Wb))}}Object(b.a)(Uc,"ConnectivityIssuesData",xd,[]);var ud=a(157),Vc=a(125),yd=a(112);class Sd{}Sd.Gjh="DuringWork";Sd.connectivityIssues="ConnectivityIssues";Sd.offline="Offline";Object(b.a)(Sd,"UnavailabilityTypes",null,[]);var Wd=a(51);class Hd{constructor(Wb){this.ojc=
this.data=null;this.tad=0;this.LCe=null;this.hxf=(Nc,gd)=>{gd.dM?(this.data=new Uc(lb.a.Pa.zb,this.$,5===gd.joa,0!==gd.joa,this.$.Sf.disconnectionSource,this.LCe),this.ojc=this.$.Sf.rlf,this.tad=1,this.$.pa.Sf.ZIg(this.co),ud.a(this.$).wVc(this.TWf)):(this.data.kIi(this.$,5===gd.joa),this.$.pa.Sf.vSf(this.co),this.data.lastFailedRequestToOnlineTimeGapSec=Wc.getElapsedSeconds(this.ojc,lb.a.Pa.zb),Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_7pzab_ConnectivityIssues")?
Wd.b().$Kb(557682689,0,50,Sd.connectivityIssues,this.data.durationMs,"ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: {0}",Fc.a.kc(this.data)):d.ULS.sendTraceTag(557682689,0,50,`ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: ${Fc.a.kc(this.data)}`),this.data&&this.data.isToastShown&&Ub.Health.instance.recordQosError(Vc.a.PZg,[yd.a.Xjc],!0,!1,!1,!1,null),ud.a(this.$).mKd(this.TWf),this.data=null)};this.TWf=
(Nc,gd)=>{this.data.hqj(gd.BU)};this.co=(Nc,gd)=>{this.data.F6i(gd.context.methodName);Nc=lb.a.Pa.zb;gd=Wc.getElapsedSeconds(this.ojc,Nc);this.ojc=Nc;gd>this.data.longestDurationBetweenFailedRequestsSec&&(this.data.longestDurationBetweenFailedRequestsSec=gd);this.tad++;this.data.averageDurationBetweenFailedRequestsSec=this.FUg(gd)};this.exf=(Nc,gd)=>{this.LCe=gd.KMj};this.$=Wb;pd.a(this.$).Wf.joe(this.hxf);this.$.Sf.ioe(this.exf)}dispose(){this.$&&(pd.a(this.$).Wf.xRf(this.hxf),this.$.Sf&&this.$.Sf.wRf(this.exf));
this.data&&this.$.pa.Sf.vSf(this.co);this.$=null}FUg(Wb){const Nc=this.tad-1;return(this.data.averageDurationBetweenFailedRequestsSec*(Nc-1)+Wb)/Nc}}Object(b.a)(Hd,"ConnectivityIssuesTelemetryManager",null,[10]);var le=a(846),Le=a(128),Md=a(751);class ke{constructor(Wb){this._count=0;this.sessionID=this.allOfflinePartialInteractivitiesDataInSession=null;this.allOfflinePartialInteractivitiesDataInSession=[];this.sessionID=Wb}get count(){return this._count}get eU(){return this.allOfflinePartialInteractivitiesDataInSession[this.allOfflinePartialInteractivitiesDataInSession.length-
1]}jRj(){this.eU&&this.eU.I_f()}wDg(Wb){this.allOfflinePartialInteractivitiesDataInSession.push(Wb);this._count++}}Object(b.a)(ke,"OfflinePartialInteractivitiesDataForLog",null,[]);class ve extends xd{constructor(Wb,Nc,gd){super(Wb,Nc,gd);this.timeFromLastOffline=0;this._errorDataDuringOfflineMode=null;this.timeFromLastOffline=-1;this.type=5}Ktj(Wb){this.timeFromLastOffline=Wb}iqj(Wb){this._errorDataDuringOfflineMode=Wb}}Object(b.a)(ve,"OfflinePartialInteractivityData",xd,[]);class ge{constructor(Wb,
Nc){this.SOa=this.eU=null;this.ZFd=-1;this.Aub=null;this.llf=w.Task.delay(0);this.v$a=(gd,Gd)=>{Gd.dM?this.tPi(Gd.joa):this.uPi()};this.Aca=(gd,Gd)=>{5===Gd.DHf&&this.p3a()};this.UWf=(gd,Gd)=>{this.eU.iqj(Gd.BU)};this.p3a=()=>{this.SOa.jRj();this.kkj(ge.bEd,Sys.Serialization.JavaScriptSerializer.serialize(this.SOa))};this.efj=gd=>{if(gd=gd.result)this.Lhg=!0,d.ULS.sendTraceTag(576811915,0,50,`OfflineModeTelemetryManager.ReportOfflinePartialInteractivityDataFromIDB: Previous session's offline partial interactivy data: ${gd}`)};
this.v$i=()=>{this.Lhg&&(this.$?fd.TaskExtensions.Aa(this.indexedDB.u6b(ge.bEd),()=>{d.ULS.sendTraceTag(537155204,0,50,"OfflineModeTelemetryManager.RemoveDataFromIDB: Previous session's offline partial interactivy data successfuly removed from IDB.")},this.$.la):d.ULS.sendTraceTag(537155203,0,10,"OfflineModeTelemetryManager.RemoveDataFromIDB: EwaControl is null when attempting to remove offline mode data stored in IDB."))};this.XOa=()=>{if(this.SOa&&0<this.SOa.count){const gd=Sys.Serialization.JavaScriptSerializer.serialize(this.SOa);
d.ULS.sendTraceTag(560791644,0,50,`OfflineModeTelemetryManager.OnBeforeUnload: This session's offline partial interactivy data: ${gd}`)}};this.$=Wb;this.indexedDB=Nc;this.Lhg=!1;this.indexedDB.Xe()&&(this.indexedDB.initialize(ge.ryb,ge.syb),this.Cej(),this.SOa=new ke(this.$.ya.UserSessionId),pd.a(this.$).Wf.HVc(this.v$a));this.Bm=Le.a.instance.iH();this.Bm.ka("beforeunload",this.XOa)}dispose(){this.$&&pd.a(this.$)&&pd.a(this.$).Wf.yKd(this.v$a);od.a.Ia(this.Aub);this.$=this.Aub=null}tPi(Wb){this.eU=
new ve(lb.a.Pa.zb,this.$,0!==Wb);this.eU.Ktj(-1!==this.ZFd?window.performance.now()-this.ZFd:-1);this.SOa.wDg(this.eU);pd.a(this.$).Wf.PVc(this.Aca);this.p3a();this.Aub=va.a.instance.WE(this.p3a,ge.$Ch,eb.a.p3a);ud.a(this.$).wVc(this.UWf)}uPi(){this.eU.iCd(this.$);this.p3a();od.a.Ia(this.Aub);this.Aub=null;this.ZFd=window.performance.now();pd.a(this.$).Wf.xtc(this.Aca);ud.a(this.$).mKd(this.UWf);this.Hej()}kkj(Wb,Nc){this.$?this.llf=fd.TaskExtensions.Aa(this.llf,()=>{this.indexedDB.jna(new Md.a(Wb,
Nc))},this.$.la):d.ULS.sendTraceTag(537155205,0,15,"OfflineModeTelemetryManager.SaveToIndexedDBSequential: EwaControl is null when attempting to write to IDB")}Cej(){const Wb=this.$.la;fd.TaskExtensions.Aa(fd.TaskExtensions.Aa(this.indexedDB.yja(ge.bEd),this.efj,Wb),this.v$i,Wb)}Hej(){if(this.eU){const Wb=Sys.Serialization.JavaScriptSerializer.serialize(this.eU);Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_71qb3_Offline")?Wd.b().$Kb(560791645,0,50,Sd.offline,this.eU.durationMs,
"OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: {0}",Wb):d.ULS.sendTraceTag(560791645,0,50,`OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: ${Wb}`)}this.eU&&this.eU.isToastShown&&Ub.Health.instance.recordQosError(Vc.a.aVj,[yd.a.Xjc],!0,!1,!1,!1,null)}}ge.ryb="NetworkAvailability";ge.syb="NetworkAvailabilityData";ge.bEd="partialInteractivityData";ge.$Ch=3E3;Object(b.a)(ge,
"OfflineModeTelemetryManager",null,[10]);class we{constructor(Wb,Nc){this.Cla=this.jDi=this.Ruf=null;this.$=Wb;Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&W.a.Uf||(this.Ruf=new ge(Wb,Nc));!Ua.EwaSettings.ma(554)||Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&W.a.Uf||(this.Cla=new le.NetworkConnectionHealthChecker(this.$));this.B2g=new Hd(this.$)}dispose(){od.a.Ia(this.Ruf);od.a.Ia(this.jDi);od.a.Ia(this.Cla);od.a.Ia(this.B2g);
this.$=null}}Object(b.a)(we,"NetworkConnectionTelemetryManager",null,[10]);class De extends xd{constructor(Wb,Nc,gd,Gd){super(Wb,Nc,gd);this.wasInteruptedByOfflineMode=!1;this.type=Gd;this.wasInteruptedByOfflineMode=!1}v$a(){this.wasInteruptedByOfflineMode=!0}}Object(b.a)(De,"SilentReopenData",xd,[]);class ib{constructor(Wb){this.y7=null;this.FEf=(Nc,gd)=>{this.CEf(gd,3)};this.UAf=(Nc,gd)=>{this.CEf(gd,2)};this.$=Wb;this.Wf=pd.a(this.$).Wf;this.Wf.Ooe(this.UAf);this.Wf.BIg(this.FEf)}dispose(){this.Wf.YRf(this.UAf);
this.Wf.ldj(this.FEf);this.y7=this.Wf=this.$=null}CEf(Wb,Nc){Wb.dM?this.y7=new De(lb.a.Pa.zb,this.$,0!==Wb.joa,Nc):(5===Wb.joa&&(this.y7.wasInteruptedByOfflineMode=!0),3!==Wb.joa&&2!==Wb.joa||d.ULS.sendTraceTag(537155202,0,10,"SilentReopenPartialInteractivityTelemetryManager.OnSilentReopen: BackToWork/DuringWork partial interactivity has been swapped to DuringWork/BackToWork."),this.y7.iCd(this.$),2===Nc?Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_8dtae_B2W")?Wd.b().aLb(571289604,
0,50,Sd.offline,this.y7.durationMs,this.y7):d.ULS.sendTraceTag(571289604,0,50,Fc.a.kc(this.y7)):Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_6w9lg_DuringWork")?Wd.b().aLb(542782150,0,50,Sd.Gjh,this.y7.durationMs,this.y7):d.ULS.sendTraceTag(542782150,0,50,Fc.a.kc(this.y7)),this.y7=null)}}Object(b.a)(ib,"SilentReopenPartialInteractivityTelemetryManager",null,[10]);class Yb extends mb.a{constructor(Wb,Nc,gd=!0){super();this.B0=this.O3b=this.TOa=this.Tna=this.bTa=null;
this.dtf=0;this.Asc=this.xbb=this.ybb=!1;this.etf=this.documentVisibilityObserver=null;this.pqa=!1;this.Dld=this.J7=0;this.tAb=!1;this.e6f=0;this.jSd=!1;this.P0=null;this.DBf=()=>{d.ULS.sendTraceTag(537155219,0,50,"NetworkConnectionStateManager.OnNetworkDownEvent: Network down.");this.Glc(1,!1)};this.x_=()=>{this.xka||this.HCb?window.setTimeout(()=>{this.vXd()},this.dtf):this.vXd();this.documentVisibilityObserver.UQa(this.x_);this.tAb=!1};this.Lf=()=>{d.ULS.sendTraceTag(537155218,0,50,`NetworkConnectionStateManager.OnEditEnded: Edit ended. IsInOfflineMode:${this.HCb}, IsInDuringWorkSilentReopenMode:${this.Fkc&&
!this.pqa}`);this.HCb&&this.ple();this.Fkc&&!this.pqa&&this.mle();Ha.g(this.$).hc.Fl(this.Lf);this.ybb=this.xbb=!1};this.EBf=()=>{d.ULS.sendTraceTag(537155213,0,50,"NetworkConnectionStateManager.OnNetworkResumedEvent: network was resumed.");this.Glc(1,!0);this.xbb&&!this.ybb&&Ha.g(this.$).hc.Fl(this.Lf);this.xbb=!1};this.uPa=(Gd,Zd)=>{this.Dld=this.J7;this.J7=Zd.GAc};this.EEf=()=>{this.$&&(this.Asc||(vb.a(this.$).uQ(hb.a.BPa).hGg(this.OBf),this.$.kl(this.dd),this.Asc=!0),this.pqa=this.gfi(),this.Glc(2,
!1))};this.OBf=()=>{var Gd=vb.a(this.$).hi;const Zd=Gd.pMg();Gd=Pb.f(Gd.Ns.kd.errors,xe=>xe.MessageIdName);d.ULS.sendTraceTag(545842889,0,50,`NetworkConnectionStateManager.OnOpenWebMethodErrorUserAlertExecuting: IsStateUnrecoverable:${Zd}, IsB2W:${this.pqa}, Errors: ${Fc.a.kc(Gd)}`);Zd&&(this.bTa?(this.pqa=!1,this.wHe(),this.GBc()):this.Tna&&(this.xHe(),this.GBc()))};this.dd=()=>{this.$?(d.ULS.sendTraceTag(541193955,0,50,"NetworkConnectionStateManager.OnWorkbookOpened: Workbook opened."),this.pqa=
!1,this.B0&&this.B0.Lq&&(od.a.Ia(this.B0),this.B0=null),this.P0&&this.P0.Lq&&(od.a.Ia(this.P0),this.P0=null),this.Glc(2,!0),this.GBc()):d.ULS.sendTraceTag(537155212,0,10,"NetworkConnectionStateManager.OnWorkbookOpened: bug monitoring: EwaControl is null.")};this.fxf=()=>{this.bsf(!0)};this.gxf=()=>{this.bsf(!1)};this.LWb=zc.Wsi;this.F2c=zc.connected;this.$=Wb;this.Sf=Wb.pa.Sf;gd&&(this.etf=new we(Wb,Nc));this.$.da.Za(291,Gd=>{this.documentVisibilityObserver=Gd});this.dtf=this.$.ya.ExcelNetworkCheckAfterTabActivationDelayMs;
this.Sf.nHg(this.DBf);this.Sf.UZb(this.EBf);this.Sf.ioe(this.fxf);this.Sf.OFg(this.gxf);new ib(this.$,this);this.Cof=this.$.ya.LongInactivityTimePeriodSeconds;this.$.ea.$Vc(this.EEf);this.$.ea.pf.Wra(this.uPa);this.e6f=this.$.ya.SilentReopenDuringWorkDelayMs}get hhi(){return this.pqa}get HCb(){return!(this.LWb&1)}get Fkc(){return!(this.LWb&2)}get xka(){return!!(this.F2c&2)}dispose(){this.Sf&&(this.Sf.mcj(this.DBf),this.Sf.ptc(this.EBf),this.Sf.wRf(this.fxf),this.Sf.abj(this.gxf));this.tAb&&this.documentVisibilityObserver&&
(this.documentVisibilityObserver.UQa(this.x_),this.tAb=!1);this.$&&(this.Asc&&this.GBc(),this.$.ea&&(this.$.ea.oSf(this.EEf),this.$.ea.pf&&this.$.ea.pf.YQa(this.uPa)));this.P0&&(this.P0.dispose(),this.P0=null);od.a.Ia(this.etf);this.$=null;super.dispose()}fzi(){this.jSd=!0}mle(){this.Tna||(this.Tna=pd.a(this.$).Wf.HYa(3,"NetworkConnectionStateManager.ActivateDuringWorkSilentReopenPartialInteractivity"))}gfi(){if(this.jSd)return this.jSd=!1,!0;const Wb=this.J7>this.Cof||this.Dld>this.Cof&&10>this.J7;
d.ULS.sendTraceTag(537155223,0,50,`NetworkConnectionStateManager.IsBackToWorkSilentReopen: Inactivity duration: Time from last activity:${this.J7}, Time gap between last two activities: ${this.Dld}. return value:${Wb}`);return Wb}pfj(){this.P0=va.a.instance.create(()=>{Ub.Health.instance.recordQosError(Vc.a.jDj,[yd.a.Xjc],!0,!0,!1,!1,null)},6E3,"ReportLongSilentReopenBackToWorkVeto",void 0,!0)}XAg(){this.Tna||this.B0?d.ULS.sendTraceTag(542782155,0,10,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Trying to activate during-work partial interactivity when we are already in this partial interactivity or there is a running timer that's going to do it soon."):
this.B0=va.a.instance.create(()=>{this.$?this.Tna?d.ULS.sendTraceTag(537155221,0,15,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Tried to activate SilentReopenDuringWork PI when there is already an DuringWorkSilentReopen partial interactivity object"):Ha.g(this.$).eb?(this.xbb||(Ha.g(this.$).hc.lm(this.Lf),d.ULS.sendTraceTag(541893722,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Registered OnEditEnded while during-work silent reopen")),
this.ybb=!0,d.ULS.sendTraceTag(537155220,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Need to init during-work silent reopen partial interactivity but the user is during a cell edit. Registered to OnEditEnded event.")):this.mle():d.ULS.sendTraceTag(537155222,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: EwaControl is null")},this.e6f,eb.a.iCj,void 0,!0)}bsf(Wb){this.F2c=this.Jwe(2,Wb,!0);this.cqe()}Glc(Wb,Nc){this.LWb=this.Jwe(Wb,Nc,
!1);this.cqe()}Jwe(Wb,Nc,gd){gd=gd?this.F2c:this.LWb;return Nc?gd|Wb:gd&~Wb}vXd(){const Wb=!!this.TOa,Nc=!!this.bTa,gd=!!this.Tna,Gd=!!this.O3b;this.HCb&&!Wb?this.WAg():!this.HCb&&Wb&&this.gdh();!this.Fkc||Nc||gd?this.Fkc||(Nc?this.wHe():(gd||this.B0&&this.B0.Lq)&&this.xHe()):this.pqa?this.UAg():this.B0||this.XAg();this.xka&&!Gd?this.jag(!0):!this.xka&&Gd&&this.jag(!1)}WAg(){this.$?this.TOa?d.ULS.sendTraceTag(537155215,0,15,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Tried to activate offline PI when there is already an offline partial interactivity object"):
Ha.g(this.$).eb?(this.ybb||(Ha.g(this.$).hc.lm(this.Lf),d.ULS.sendTraceTag(537155217,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Registered OnEditEnded during offline mode")),this.xbb=!0,d.ULS.sendTraceTag(537155216,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Turned offline while user is editing a cell, registered to OnEditEnded event.")):this.ple():d.ULS.sendTraceTag(537155214,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: EwaControl is null")}ple(){this.TOa||
(this.TOa=pd.a(this.$).Wf.HYa(5,"NetworkConnecStateManager.ActivateOfflinePartialInteractivity"))}gdh(){this.TOa&&(od.a.Ia(this.TOa),this.TOa=null)}wHe(){this.bTa&&(od.a.Ia(this.bTa),this.bTa=null);this.P0&&this.P0.Lq&&this.P0.cancel();this.P0=null}xHe(){this.Tna&&(od.a.Ia(this.Tna),this.Tna=null);this.B0&&(od.a.Ia(this.B0),this.B0=null);this.ybb&&!this.xbb&&Ha.g(this.$).hc.Fl(this.Lf);this.ybb=!1}UAg(){this.bTa||(this.bTa=pd.a(this.$).Wf.HYa(2,"NetworkConnectionStateManager.ActivateLongInactivitySilentReopenPartialInteractivity",
void 0,$b.a.instance.ga(2188)));this.pfj()}jag(Wb){Wb?(this.O3b=pd.a(this.$).Wf.HYa(4,"NetworkConnectionStateManager.ConnectivityIssues"),this.H2i()):(od.a.Ia(this.O3b),this.O3b=null)}H2i(){if(this.$&&this.$.pa){const Wb=this.$.pa.va.Tb();Fa.I(this.$.pa.va,null,null,null,Wb)}}GBc(){vb.a(this.$).uQ(hb.a.BPa).Yq(this.OBf);this.$.Hl(this.dd);this.Asc=!1}cqe(){this.documentVisibilityObserver||d.ULS.sendTraceTag(537155211,0,15,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: Document visibility observer is null while it shouldn't be.");
this.documentVisibilityObserver&&this.documentVisibilityObserver.vi?this.tAb||(this.documentVisibilityObserver.eZa(this.x_),this.tAb=!0,d.ULS.sendTraceTag(541193954,0,50,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: tabbed out user, will update the partial interactivity state when the user will be back.")):this.vXd()}}Object(b.a)(Yb,"NetworkConnectionStateManager",mb.a,[532,10]);class pc extends Y.a{constructor(Wb){super();this.$=Wb;this.Eb()}create(){fd.TaskExtensions.Aa(Cc.GetServiceTaskFactory.Sa(this.$.da,
395,396,this.fb),Wb=>{let Nc;Nc=Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:6143820_MoveServiceRegistrationFromFAM_V2")?Object(ba.c)(this.$.da,400,()=>new Yb(this.$,Wb.result)):this.$.da.za(400)||new Yb(this.$,Wb.result);this.pb(Nc)},this.$.la,3)}static ka(Wb){Wb.da.Ga(401,new pc(Wb))}}Object(b.a)(pc,"NetworkConnectionStateManagerFactory",Y.a,[]);var Jc=a(1249),Xc=a(1154),M=a(1211),$a=a(124),ob=a(107),Tb=a(146),Dc=a(321);class ad{constructor(Wb){this.NCb=this.nwd=this.qOa=this.Rkc=0;this.gwd=this.Ppf=
null;Wb?(this.$kc=Wb,this.nsb=Date.now,this.L9g(),this.b9i()):d.ULS.sendTraceTag(520955213,209,10,"Can not initialize PenMinutesManager because TaskManager is null")}esj(){this.Ppf="Office.Excel.Online.Data.Activity.PenMinutes"}b9i(){window.document.body.addEventListener("pointerenter",Object(B.a)(this,this.Coc,"onPointerEnter"));window.document.body.addEventListener("pointerleave",Object(B.a)(this,this.A_,"onPointerLeave"))}Coc(Wb){"pen"!==Wb.pointerType||this.qOa||(this.qOa=Math.floor(this.nsb()/
1E3),this.qOa<=this.Rkc&&(this.qOa=this.Rkc),this.nwd=0)}A_(Wb){"pen"===Wb.pointerType&&(Wb=Math.ceil(this.nsb()/1E3),this.qOa&&Wb>this.Rkc&&(this.nwd=Wb,this.NCb+=this.nwd-this.qOa),this.Rkc=Wb,this.qOa=0)}L9g(){this.gwd=new ob.a(4,2,6E4,Object(B.a)(this,this.Yvi,"logPenUsage"));this.$kc.Fg(this.gwd)}Yvi(){0<this.NCb&&this.inj(this.NCb);this.NCb=0}inj(Wb){const Nc=new Dc.a;Nc.name=this.Ppf;const gd=[];(Wb=$a.a.Dh("PenInputSec",Wb.toString(),3))&&Array.add(gd,Wb);Nc.dataFields=gd;Tb.a.sendActivityEvent(Nc)}dispose(){this.$kc.jp(this.gwd)}}
Object(b.a)(ad,"PenMinutesManager",null,[442]);class ld{constructor(){this.ZOc=this.gb=null}get name(){return"Common.App.PenMinutesManager"}Wh(Wb){this.gb=Wb;const Nc=f.AFrameworkApplication.Hi;this.gb.register(442,"Common.App.PenMinutesManager.IPenMinutesManager").wc().Fc(()=>new ad(Nc))}init(){this.ZOc=this.gb.resolve("Common.App.PenMinutesManager.IPenMinutesManager")}dispose(){this.ZOc&&this.ZOc.dispose()}static main(){V.a.instance.Gi(new ld)}}Object(b.a)(ld,"PenMinutesManagerPackage",null,[3,
4]);class md extends Y.a{constructor(Wb){super();this.$=Wb;this.Eb()}static ka(Wb){Wb.da.Ga(514,new md(Wb))}create(){this.pb(Object(ba.c)(this.$.da,513,()=>{Type.registerNamespace("Common.App.PenMinutesManager");ld.main();const Wb=ka.a.instance.resolve("Common.App.PenMinutesManager.IPenMinutesManager");Wb.esj();return Wb}))}}Object(b.a)(md,"PenMinutesFactory",Y.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.InsertPicture");Type.registerNamespace("_Ewa");Object(c.a)();Object(Z.a)();
Object(Ra.a)();Object(Da.a)();Object(Ba.a)();Object(xa.a)();Object(gb.a)();Object(M.a)();Type.registerNamespace("Common.App.InProductMessaging");da.main();Type.registerNamespace("Common.App.FirstRunExperienceLauncher");Na.main();(()=>{ea.a.Fa(()=>{ea.a.Fa(ua.ka)})})();(()=>{ea.a.Fa(()=>{ea.a.Fa(ia.ka)})})();ea.a.Fa(vc.ka);ea.a.Fa(pc.ka);(()=>{ea.a.Fa(Wb=>{md.ka(Wb)})})();Object(Jc.a)();Object(Xc.a)()},846:function(n,C,a){a.r(C);n=a(0);var c=a(7),b=a(15),d=a(319),f=a(29),e=a(11),k=a(312);class l{constructor(){this.scenario=
null;this.timeElapsed=0;this.isNewSession=!1;this.rawData=null}}Object(n.a)(l,"ConnectionErrorLogInfo",null,[]);class m{}m.Xig="b-ring_Apc_Trans";m.ijg="cdn_static_resource_ewa_image";Object(n.a)(m,"ResourceHosts",null,[]);var u=a(58),t=a(251);class w{constructor(z,A){this.testName=null;this.startTimeMs=0;this.isSuccess=!1;this.caller=this.errorStatusCode=this.errorMessage=null;this.reqTotalDurationMs=0;this.browserResourceTiming=null;this.testIteration=0;this.testName=z;this.caller=A;this.reset()}reset(){this.isSuccess=
!1;this.startTimeMs=-1;this.errorStatusCode=this.errorMessage="";this.reqTotalDurationMs=-1;this.browserResourceTiming=null}}Object(n.a)(w,"NetworkTestResult",null,[]);var r=a(582);class v{constructor(z,A,I,F,U){this.url="";this.W5a=!1;this.L7=-1;this.testIteration=0;this.baseUrl=I;this.Ywf=F;this.W9e=A;this.result=new w(A,U)}runTest(){try{if(this.W5a)return b.ULS.sendTraceTag(537155206,0,50,`NetworkTestReq.RunTest: a test for the host ${this.W9e} is already mid way, not starting a new one.`),!1;
this.reset();this.W5a=!0;this.result.startTimeMs=Date.now();const z=new t.QueryStringBuilder(this.baseUrl);z.y9("tid",this.result.startTimeMs.toString());this.url=z.toString();this.Fmj();this.testIteration++;this.result.testIteration=this.testIteration;return!0}catch(z){return this.kub("Exeption: "+z.message),!1}}reset(){this.url="";this.result.reset();this.W5a=!1;this.L7=-1}clearTimeout(){-1!==this.L7&&(window.clearTimeout(this.L7),this.L7=-1)}Fmj(){try{const z=new XMLHttpRequest;z.onreadystatechange=
()=>{4===z.readyState&&(200===z.status?this.YBh():this.kub(`Error when downloading resource. status code: ${z.status}, status text: ${z.statusText}`,z.status.toString()))};z.onerror=()=>{this.kub(`Client error when attempting to download resource. status code: ${z.status}, response: ${z.statusText}`)};this.L7=window.setTimeout(()=>{this.L7=-1;this.kub("Request timeout")},1E4);z.open("GET",this.url,!0);z.send(null)}catch(z){this.kub("Exeption: "+z.message)}}YBh(){this.W5a&&(this.result.reqTotalDurationMs=
Date.now()-this.result.startTimeMs,this.clearTimeout(),this.result.browserResourceTiming=r.a(this.url),this.result.isSuccess=!0,this.A3b())}kub(z,A=null){this.W5a&&(this.clearTimeout(),this.result.errorMessage=z,this.result.isSuccess=!1,this.result.errorStatusCode=A,this.A3b())}A3b(){this.W5a=!1;this.Ywf&&this.Ywf(this.result,this.W9e)}}Object(n.a)(v,"NetworkTestReq",null,[]);class y{static PGh(z,A,I=null){y.bmc||(y.bmc=Array.isArray(u.a.$h(A.ya.NetworkMeasurementUrlList))?u.a.$h(A.ya.NetworkMeasurementUrlList):
null);const F=[];for(let U=0;U<y.bmc.length;U++){const X=y.bmc[U];let T=X.key;T||(T=X.Key);if(I&&!I.includes(T))continue;let G=X.value;G||(G=X.Value);T&&G&&F.push(new v(A,T,G,z,"OnNetworkDownImmediatePing"))}return F}}y.bmc=null;Object(n.a)(y,"NetworkConnectionHelpers",null,[]);class x{constructor(z){this.Qkd=[m.ijg,m.Xig];this.Qn=(A,I)=>{this.gO[I]=A;this.L5h()&&this.jfj("OnNetworkDownImmediatePing"===A.caller)};this.Cla=z;this.$=z.$;this.gO={}}ori(){const z=y.PGh(this.Qn,this.$,this.Qkd);for(const A of z)A.runTest()}L5h(){for(const z of this.Qkd)if(void 0===
this.gO[z]||null===this.gO[z])return!1;return!0}jfj(z){const A=this.$.Sf.RZ;z&&this.eGj(A);for(var I of this.Qkd)this.gO[I]=Sys.Serialization.JavaScriptSerializer.serialize(this.gO[I]);z=Date.now();I=this.Cla.Ihd(a(846).NetworkConnectionHealthChecker.MDb).returnValue;const F=this.Cla.Ihd(a(846).NetworkConnectionHealthChecker.dLb).returnValue;this.gO.isOfflineMode=A;this.gO.networkDownBBAge=-1===I?I:z-I;this.gO.transientServerCommunicationFailuresBBAge=-1===F?F:z-F;this.Cla.businessBar?(this.gO.isNetworkDownBBShown=
this.Cla.businessBar.OE(56).toString(),this.gO.isServerErrorBBShown=this.Cla.businessBar.OE(21).toString()):(this.gO.isNetworkDownBBShown="unknown",this.gO.isServerErrorBBShown="unknown");b.ULS.sendTraceTag(537155224,0,50,`ConnectionHealthTestsRunner.ReportPingResults: ${Sys.Serialization.JavaScriptSerializer.serialize(this.gO)}`)}eGj(z){const {NetworkConnectionHealthChecker:A}=a(846),I={};for(const F of Object.keys(this.gO)){const U=this.gO[F];I[U.testName]=U.isSuccess}I.isOfflineMode=z;this.Cla.zVd(A.E2c,
Sys.Serialization.JavaScriptSerializer.serialize(I))}}Object(n.a)(x,"ConnectionHealthTestsRunner",null,[]);a.d(C,"NetworkConnectionHealthChecker",function(){return B});class B{constructor(z){this.businessBar=this.l8a=null;this.MGi=(A,I)=>{I.m7c?this.OGi(I):this.NGi(I)};this.yi=(A,I)=>{A=I.context.methodName;this.l8a&&A===this.l8a&&(b.ULS.sendTraceTag(537155230,0,50,`NetworkConnectionHealthChecker.OnWebMethodSuccess: Failed web method "${this.l8a}" has now succeeded. Querying local storage for BB showings.`),
this.J8a(B.dLb,!0),this.l8a=null);this.Onf(!1);this.M3b=!1};this.co=(A,I)=>{f.a.lh(I.errors,[-1387426400])&&!this.M3b&&(this.M3b=!0,this.t3f()&&window.performance.mark(B.Quf),(new x(this)).ori())};this.Cg=()=>{this.Onf(!0);this.J8a(B.MDb,!1);this.J8a(B.dLb,!1)};this.mFb=()=>{b.ULS.sendTraceTag(537155225,0,50,"NetworkConnectionHealthChecker.OnNetworkResumed: Network resumed for session. Querying local storage for BB showings.");this.J8a(B.MDb,!0)};this.$=z;this.pa=this.$.pa;this.localStorage=new k.a;
this.M3b=!1;this.$.ea.Ll(this.Cg);this.pa.Sf.UZb(this.mFb);this.pa.pr(this.yi);this.$.da.Za(5,A=>{this.businessBar=A;A.tFg(this.MGi)});this.pa.ux(this.co)}dispose(){this.$&&(this.$.ea&&this.$.ea.fo(this.Cg),this.pa&&(this.pa.Sf.ptc(this.mFb),this.pa.yy(this.co),this.pa.Fs(this.yi)))}OGi(z){const A={};A.Timestamp=Date.now().toString();switch(z.RGa){case 21:this.l8a=z.data.FailedMethod;A.FailedMethod=this.l8a;this.zVd(B.dLb,JSON.stringify(A));break;case 56:this.zVd(B.MDb,JSON.stringify(A))}}NGi(z){switch(z.RGa){case 21:this.J8a(B.dLb,
!0);break;case 56:this.J8a(B.MDb,!0)}}zVd(z,A){try{this.localStorage.Xe()&&this.localStorage.setItem(z,A)}catch(I){b.ULS.sendTraceTag(537155231,0,15,`NetworkConnectionHealthChecker.StoreDataInLocalStorage: Failed to set item to local storage. reason: ${I.message||"Unknown"}`)}}Ihd(z){if(this.localStorage.Xe()&&(z=this.localStorage.v4a(z))&&"null"!==z){var A=JSON.parse(z);z=parseInt(A.Timestamp,10);A=Sys.Serialization.JavaScriptSerializer.serialize(A);return{returnValue:z,rawData:A}}return{returnValue:-1,
rawData:null}}Onf(z){if(this.localStorage.Xe()){const A=this.localStorage.v4a(B.E2c);if(A&&"null"!==A){let I=-1;this.M3b&&(I=this.UNh(B.Quf,B.BFi));b.ULS.sendTraceTag(537155229,0,50,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: Ping Results: ${Sys.Serialization.JavaScriptSerializer.serialize(A)}, Period offline: ${I}, New session: ${z}`);this.localStorage.removeItem(B.E2c)}}}UNh(z,A){if(!this.t3f())return-1;window.performance.measure(A,z);z=window.performance.getEntriesByName(A);
return z.length&&z[z.length-1]?z[z.length-1].duration:(b.ULS.sendTraceTag(537155228,0,10,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: measure name ${A} returned no measures.`),-1)}J8a(z,A){try{let I;const F=({rawData:I}=this.Ihd(z)).returnValue;if(-1!==F){const U=Object(c.a)(new l,{timeElapsed:Date.now()-F,scenario:z,isNewSession:!A,rawData:I});b.ULS.sendTraceTag(537155227,0,50,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: ${JSON.stringify(U)}`)}this.localStorage.removeItem(z)}catch(I){b.ULS.sendTraceTag(537155226,
0,15,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: Failed to get item from local storage. reason: ${I.message||"Unknown"}`)}}t3f(){return e.HelperMethods.dZc&&d.a.jpb}}B.MDb="NetworkDownBBShown";B.dLb="ServerCommunicationFailureBBShown";B.E2c="ConnectionHealthPingRsults";B.Quf="offMoStMa";B.BFi="offMoDuMea";Object(n.a)(B,"NetworkConnectionHealthChecker",null,[10])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.pi.js.map/202675abdc07b8eff3748b4d127a8136/EwaDSEsNext.pi.js.map