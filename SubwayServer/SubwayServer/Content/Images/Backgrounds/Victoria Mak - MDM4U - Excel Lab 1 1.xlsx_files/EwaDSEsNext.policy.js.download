'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[59],{1428:function(n,C,a){a.r(C);var c=a(0),b=a(15),d=a(84),f=a(850),e=a(187);class k{constructor(Vb,Uc,ud=null){this.id=Vb.Id;ud||(ud="");this.q6i=ud;this.sensitivityLabel=Vb}}Object(c.a)(k,"AutoPolicyLabelData",null,[]);class l{constructor(Vb,Uc){this.wP=Vb;this.displayName=Uc}}Object(c.a)(l,"PolicyLabelRequestState",null,[]);var m=a(144),u=a(4),t=a(151),w=a(13),r=a(44),v=a(30);class y{static get Usd(){return y.mqi}}
y.mqi="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>";
Object(c.a)(y,"JustificationDialogHtml",null,[]);class x extends m.a{constructor(Vb,Uc){super(!1,!1,x.Gu);this.vqa=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther];this.UVb=null;this.SVb=!1;this.EWb=Vb;this.dE=Uc;this.mg=this.JRg();this.Rb=1;this.Ce=x.id;this.rc(1,CommonUIStrings.l_DialogChange);this.oL(1,!1);this.s0(0)}qTd(){if(x.Gu)this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,
Object(d.a)(this,this.sNf,"reactJustificationDialogHandler"),this.E2e(this.SVb));else{const Vb={};for(let Uc=0;Uc<this.vqa.length;Uc++)Vb[x.eHd+Uc]=!1;Vb[x.aOb]="";this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(d.a)(this,this.lqi,"justificationDialogHandler"),Vb);this.n8i();r.a.addHandler($get(x.aOb),w.a.input,Object(d.a)(this,this.EIj,"textAreaHandler"))}}validate(){if(x.Gu)return this.Lgg(this.UVb);const Vb=$get(x.aOb);return Vb.disabled?!0:this.Lgg(Vb.value)}Lgg(Vb){const Uc=
2>Vb.length,ud=500<Vb.length,Vc=RegExp("[{|}|;|\\\\]").test(Vb);Vb=""===v.a.Hsc(Vb);return!Uc&&!ud&&!Vc&&!Vb}lqi(Vb,Uc){let ud="";if(1===Vb)for(let Vc=0;Vc<this.vqa.length;Vc++)if(Uc[x.eHd+Vc]){ud=Vc===this.vqa.length-1?Uc[x.aOb]:this.vqa[Vc];break}this.dE(Vb,this.EWb,ud)}sNf(Vb){let Uc="";1===Vb&&this.UVb&&(Uc=this.UVb);this.dE(Vb,this.EWb,Uc)}PNi(Vb){this.UVb=Vb;Vb=this.validate();this.SVb!==Vb&&(this.SVb=Vb,this.rUa(CommonUIStrings.l_SensitivityJustificationTitle,Object(d.a)(this,this.sNf,"reactJustificationDialogHandler"),
this.E2e(this.SVb)))}E2e(Vb){return{["id"]:this.Ce,["bodyControls"]:{["choiceGroupProps"]:{},["textAreaProps"]:{["placeholder"]:CommonUIStrings.l_SensitivityJustificationPlaceholder}},["actionButtonProps"]:{["label"]:CommonUIStrings.l_DialogChange,["disabled"]:!Vb},["infoMessage"]:CommonUIStrings.l_SensitivityJustificationMessage,["justificationIrrelevantLabel"]:CommonUIStrings.l_SensitivityJustificationNoLongerApplies,["justificationIncorrectLabel"]:CommonUIStrings.l_SensitivityJustificationIncorrect,
["justificationOtherLabel"]:CommonUIStrings.l_SensitivityJustificationOther,["onJustificationUpdated"]:Object(d.a)(this,this.PNi,"onJustificationUpdated")}}EIj(Vb){Vb.target&&this.oL(1,this.validate())}JRg(){return m.a.Yp(x.Usd,u.AFrameworkApplication.pB,t.getImageClass(x.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this.vqa[0],this.vqa[1],this.vqa[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)}n8i(){const Vb=document.getElementsByName(x.Rsi);for(let Uc=0;Uc<Vb.length;Uc++)r.a.addHandler(Vb[Uc],
w.a.focus,Object(d.a)(this,this.YLf,"radioButtonFocusHandler")),r.a.addHandler(Vb[Uc],w.a.click,Object(d.a)(this,this.YLf,"radioButtonFocusHandler"))}YLf(Vb){if(Vb=Vb.target){Vb.checked=!0;var Uc=$get(x.aOb);Vb.id===x.eHd+(this.vqa.length-1)?(Uc.disabled=!1,Sys.UI.DomElement.setVisible(Uc,!0),Uc.focus()):(Uc.disabled=!0,Vb.focus());this.oL(1,this.validate())}}static get Gu(){return u.AFrameworkApplication.ta.Oa.vv&&u.AFrameworkApplication.ta.Oa.Gqd}}x.Usd=y.Usd;x.Rsi="ListRadioBox";x.eHd="radiobox";
x.aOb="txtJustification";x.iconName="Info_32x32x32";x.id="JustificationDialog";Object(c.a)(x,"JustificationDialog",m.a,[]);class B extends m.a{constructor(Vb,Uc,ud){super(!1,!1,!0);if(Vb&&ud){var Vc={["id"]:"MandatoryLabellingDialog"};this.mpg=ud;this.WMc=Uc;if(!u.AFrameworkApplication.fa.qa("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||this.WMc&&""!==this.WMc)Vc.learnMoreLink={["type"]:"AppLinkProps",["id"]:"mandatoryLabellingLearnMoreLink",["text"]:CommonUIStrings.l_LearnMore,["handler"]:{["href"]:this.WMc,
["target"]:"_blank"},["customTooltip"]:CommonUIStrings.L_LearnMoreTooltip};Uc={["sections"]:[],["shouldAutoOpen"]:!1};Array.add(Uc.sections,{["id"]:"mandatoryLabellingFlyoutMenuSection",["controls"]:Vb});Vc.labelFlyout={["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabellingFyout",["label"]:"Pick a label",["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!0,["menuDefinition"]:Uc};Vb={["id"]:"MandatoryLabellingDialog",["bodyControls"]:Vc};Vc.initialLabelText=CommonUIStrings.l_MandatoryLabellingDialogInitialLabelText;
Vc.descriptionText=CommonUIStrings.l_MandatoryLabellingDialogDescriptionText;this.initializeAndShow(CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,Object(d.a)(this,this.Ryi,"mandatoryLabellingDialogHandler"),Vb)}else b.ULS.sendTraceTag(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs")}Ryi(Vb,Uc){1===Vb&&Uc.selectedLabel&&(Vb=Uc.selectedLabel,""!==Vb&&this.mpg(Vb))}}Object(c.a)(B,"MandatoryLabellingDialog",m.a,[]);class z{constructor(){this.pjb=!!u.AFrameworkApplication.ta&&
u.AFrameworkApplication.ta.Oa.vv}N8g(Vb,Uc,ud){this.pjb&&new B(Vb,Uc,ud)}static get instance(){return z.Ma||(z.Ma=new z)}}z.Ma=null;Object(c.a)(z,"MandatoryLabellingDialogFactory",null,[672]);class A{}A.JFj="sbProtectForm14";A.LFj="SBStatusBarMarkAsReadOnly14";A.$ri="Info_16x16x32";A.hqb="QuickSearchCompletedToday_16x16x32";A.FHd="CommonControlCheckboxCheck_16";A.iag="On";A.visible="Visible";A.fDh="ImageIsVisible";A.nG="SourceControlId";A.menuItemId="MenuItemId";A.menu="Menu";A.RWc="AppLockId";A.value=
"Value";A.xi="LabelText";A.alt="Alt";A.O$e="Image16by16";A.Q5a="Image16by16Class";A.IFj="SBProtectForm_16";A.KFj="SBStatusBarMarkAsReadOnly_16";A.icon="Icon";A.iconColor="IconColor";A.customTooltip="CustomTooltip";A.K5i="MipTagDynamicFillWithOutline_20";A.L5i="MipTagLockDynamicFillWithOutline_20";A.J5i="MipTagErrorOutline_20";A.M5i="MipTagQuestionOutline_20";A.iYd="transparent";Object(c.a)(A,"PolicyConstants",null,[]);class I extends m.a{constructor(Vb,Uc,ud){super(!1,!1,I.Gu);this.EWb=Vb;this.QWa=
Uc;this.dE=ud;this.Rb=1;this.Ce=I.id;this.s0(1);this.s0(0)}OTd(){const Vb={["id"]:"UserDefinedPermissionsDialog"};I.Gu&&this.initializeAndShow("Defined Permissions",Object(d.a)(this,this.VUj,"userDefinedPermissionsDialogHandler"),Vb)}VUj(Vb){1!==Vb&&this.dE(Vb,this.EWb,"",this.QWa)}static get Gu(){return u.AFrameworkApplication.ta.Oa.vv&&u.AFrameworkApplication.ta.Oa.Gqd}}I.id="UserDefinedPermissionsDialog";Object(c.a)(I,"UserDefinedPermissionsDialog",m.a,[]);var F=a(591),U=a(374),X=a(311),T=a(569),
G=a(98),D=a(172),J=a(564),L=a(561),H=a(159),R=a(426),Q=a(134),O=a(88),V=a(199),W=a(329),da=a(83),ta=a(106),K=a(25),na=a(55);class P{constructor(Vb,Uc,ud,Vc){this.wMc=this.xMc=null;this.E$d=this.NLc=this.gMc=this.sjb=this.Eae=this.cce=this.KHc=!1;this.IVa=this.dfa=this.Wfa=this.qpa=this.QWa=this.Pu=this.b9=this.Ah=null;this.DFc=0;this.F7d=this.dMc=this.OFc=null;this.La=Vb;this.af=Uc;this.nb=ud;this.Tg=Vc;this.akb={};this.Zee={};this.dce={};this.Tyb=ud.qa("WacApplyManualPolicyLabelIsEnabled");this.Tg.value.vpe(Object(d.a)(this,
this.uGd,"processAutoSensitivityLabel"));this.Tg.value.XVc(Object(d.a)(this,this.uGd,"processAutoSensitivityLabel"));this.Tg.value.RZb(Object(d.a)(this,this.MTi,"onUpdateLabelInfo"));u.AFrameworkApplication.ta&&u.AFrameworkApplication.ta.jHg(Object(d.a)(this,this.u7i,"refreshDocumentPolicyLabelsOnModeChange"));ud.qa("SupportsPolicies")&&ud.Xa("AppliedPolicyId")&&(this.xMc=ud.Xa("IrmPolicyTitle"),this.wMc=ud.Xa("IrmPolicyDescription"));this.zPc=ud.qa("ProtectedFile");this.Tmg=this.nb.qd("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",
6);this.Umg=this.nb.qd("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5E3)}get d7a(){return u.AFrameworkApplication.d7a||!!this.dMc&&this.dMc()}Ig(){this.La.Nb(K.a.pGf,ta.a.frame,Object(d.a)(this,this.dKe,"documentLabelPaneHandler"));this.La.Le(K.a.Xab,ta.a.frame,Object(d.a)(this,this.Xab,"queryPolicyLabel"),96);this.La.Nb(K.a.XTa,ta.a.frame,Object(d.a)(this,this.XTa,"toggleSensitivity"));this.La.Nb(K.a.vza,ta.a.frame,Object(d.a)(this,this.vza,"populateSensitivityFlyout"));this.La.Nb(K.a.setSensitivity,
ta.a.frame,Object(d.a)(this,this.setSensitivity,"setSensitivity"));this.La.Le(K.a.Yab,ta.a.frame,Object(d.a)(this,this.Yab,"querySensitivity"),96);this.La.Nb(K.a.J6,ta.a.frame,Object(d.a)(this,this.J6,"querySensitivityToggleButton"));this.La.Nb(K.a.I6,ta.a.frame,Object(d.a)(this,this.I6,"querySensitivitySubFlyout"));this.zmb(K.a.XTa)||this.La.Wcb(K.a.XTa,4);this.zmb(K.a.vza)||this.La.Wcb(K.a.vza,4);this.zmb(K.a.setSensitivity)||this.La.Wcb(K.a.setSensitivity,4);this.zmb(K.a.J6)||this.La.Wcb(K.a.J6,
4);this.zmb(K.a.I6)||this.La.Wcb(K.a.I6,4);this.af.updateCommandUI();u.AFrameworkApplication.fa&&u.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&H.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")&&this.Tg.value.Xbj(Object(d.a)(this,this.kPf,"registerActionsHandler"))}kPf(){this.Ig()}XOb(){this.La.KD(K.a.pGf,ta.a.frame,Object(d.a)(this,this.dKe,"documentLabelPaneHandler"));
this.La.KD(K.a.Xab,ta.a.frame,Object(d.a)(this,this.Xab,"queryPolicyLabel"));this.La.KD(K.a.XTa,ta.a.frame,Object(d.a)(this,this.XTa,"toggleSensitivity"));this.La.KD(K.a.vza,ta.a.frame,Object(d.a)(this,this.vza,"populateSensitivityFlyout"));this.La.KD(K.a.setSensitivity,ta.a.frame,Object(d.a)(this,this.setSensitivity,"setSensitivity"));this.La.KD(K.a.Yab,ta.a.frame,Object(d.a)(this,this.Yab,"querySensitivity"));this.La.KD(K.a.J6,ta.a.frame,Object(d.a)(this,this.J6,"querySensitivityToggleButton"));
this.La.KD(K.a.I6,ta.a.frame,Object(d.a)(this,this.I6,"querySensitivitySubFlyout"))}XTa(){return 32}GXe(Vb){const Uc="mandatoryLabelling_"+Vb.Id;this.dce[Uc]=Vb.Id;return{["type"]:"AppToggleButtonProps",["id"]:Uc,["label"]:Vb.DisplayName,["hideLabel"]:!1,["customTooltip"]:Vb.Tooltip}}sNa(){return this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPEnabled",!1)}sSh(){const Vb=[],Uc=this.b9;for(let Vc in Uc){var ud=Uc[Vc];const yd=this.Pu[Vc];if(this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.HideUDPFromMandatoryDialogEnabled",
!1)){if(!yd||!yd.Enabled||yd.HasUserDefinedPermissions)continue}else if(!yd||!yd.Enabled)continue;if(ud.count){const Sd={["sections"]:[],["shouldAutoOpen"]:!1},Wd={["id"]:"mandatoryLabelling_flyoutMenuSection_"+yd.Id,["controls"]:[]};for(let Hd of ud){ud=this.Pu[Hd];if(this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.HideUDPFromMandatoryDialogEnabled",!1)){if(!ud||!ud.Enabled||ud.HasUserDefinedPermissions)continue}else if(!ud||!ud.Enabled)continue;Array.add(Wd.controls,this.GXe(ud))}Array.add(Sd.sections,
Wd);Array.add(Vb,{["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabelling_"+yd.Id,["label"]:yd.DisplayName,["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!1,["menuDefinition"]:Sd})}else Array.add(Vb,this.GXe(yd))}return Vb}vza(Vb,Uc,ud,Vc,yd){if(1===ud||!this.Tg.value.Yga(!0))return 32;yd.MenuItems=Object.assign(new J.a,{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0});Array.add(yd.MenuItems.MenuSectionList,this.Dc(!this.isReactRibbonEnabled()));this.Ah.CustomUrl&&Array.add(yd.MenuItems.MenuSectionList,
this.C8g(this.isReactRibbonEnabled()?this.Ah.CustomUrl:v.a.nf(this.Ah.CustomUrl)));this.isReactRibbonEnabled()||(yd.PopulationXML=X.q(yd.MenuItems));return 32}Yab(Vb,Uc,ud,Vc,yd){if(1===ud||!yd||!this.Tyb)return 32;this.Ah=this.Tg.value.Nn;if(this.Tg.value.Yga(!0)&&(yd[A.visible]=!0,this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelsAvailableActivityControlEnabled",!1)?this.Eae||(D.a("MipLabelsAvailable"),this.Eae=!0):D.a("MipLabelsAvailable"),this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelTUIEnabled",
!1)&&this.Ah&&this.Ah.AreLabelsAvailable&&(Vb=da.a.instance.Ub("Common.ISystemInitiatedFeedback")))){const Sd=P.Fh(this.Ah.AppliedPolicyId)?"LouderLabel_NoLabelAppliedOnLoadActivity":"LouderLabel_LabelExistsOnLoadActivity";Vb.execute(Wd=>{Wd.logActivity(Sd,null)})}return 32}J6(Vb,Uc,ud,Vc,yd){if(1===ud||!yd)return 32;let Sd,Wd;yd[A.iag]=!!(Sd=yd[A.menuItemId])&&!!(Wd=this.akb[Sd])&&Wd===this.Ah.AppliedPolicyId;return 32}I6(Vb,Uc,ud,Vc,yd){if(1===ud||!yd)return 32;let Sd,Wd,Hd;Vb=!!(Sd=yd[A.nG])&&
!!(Wd=this.akb[Sd])&&!!(Hd=this.b9[Wd])&&Hd.contains(this.Ah.AppliedPolicyId);yd[A.fDh]=Vb;yd[A.iag]=Vb;return 32}setSensitivity(Vb,Uc,ud,Vc,yd){return 1!==ud&&yd?this.rSa(this.akb[yd[A.nG]],yd,2):32}rgc(){return!!u.AFrameworkApplication.ta&&1===u.AFrameworkApplication.ta.mode}u7i(){this.NLc&&!this.rgc()&&(this.NLc=!1,this.Tg.value.t7i())}dbg(){this.Ah.DefaultLabelId&&this.Ah.MandatoryLabelingEnforced?this.KHc||this.rgc()?this.Ah.AppliedPolicyId?this.v9c(""):(this.Tg.value.bmi(this.Tg.value.UBb)||
this.rgc())&&this.xMe():this.A_f():this.Ah.DefaultLabelId?this.A_f():this.Ah.MandatoryLabelingEnforced&&(this.Ah.AppliedPolicyId?this.v9c(""):this.xMe())}ggf(){return this.Ah.MandatoryLabelingEnforced?this.Ah&&this.Ah.AreLabelsAvailable?this.nb.qa("TestOverrideIsReactDialogEnabled")||this.af&&this.af.Oa&&this.af.Oa.vv?!0:(b.ULS.sendTraceTag(539109065,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):(b.ULS.sendTraceTag(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),
!1):(b.ULS.sendTraceTag(539109063,306,50,"Mandatory labelling not invoked b/c user did not have policy!"),!1)}xMe(){!this.ggf()||u.AFrameworkApplication.X4||this.cce||(this.cce=u.AFrameworkApplication.X4=!0,b.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),this.Tg.value.qMf("",1),this.Tg.value.RUc(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,
()=>{this.Pyi()}))}v9c(Vb){this.ggf()&&u.AFrameworkApplication.X4&&(u.AFrameworkApplication.X4=!1,b.ULS.sendTraceTag(562837518,306,50,"Mandatory labelling is escaped successfully."),this.Tg.value.NJd(),this.Tg.value.qMf(Vb,2))}Pyi(){z.instance.N8g(this.sSh(),this.Ah.CustomUrl,Object(d.a)(this,this.Qyi,"mandatoryLabellingDialogCallback"))}Qyi(Vb){this.v9c(this.dce[Vb])}uue(){return this.nb.qa("CoAuthForProtectedFilesEnabled")&&this.nb.qa("SupportsOfficeClientCoauthoring")&&this.nb.qa("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&
!!this.F7d&&this.d7a}rSa(Vb,Uc,ud,Vc=null){this.Tg.value.r4i(ud);let yd=32,Sd=!1,Wd=!0;const Hd=2===ud||8===ud||16===ud,le=Vb===this.Ah.AppliedPolicyId;if(this.OFc&&this.OFc(Vb,Hd))b.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",ud),this.af.updateCommandUI();else if(Uc&&A.RWc in Uc&&this.Tg.value.Arj(Uc[A.RWc]),Vb)if(this.Tg.value.hif()||this.uue()&&this.gMc)b.ULS.sendTraceTag(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",
ud),this.af.updateCommandUI(),Hd&&this.E_b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this.nb.qa("HasDocumentEditRights"))if(this.Tg.value.PVg(Vb))if(!this.sNa()&&this.Pu[Vb]&&this.Pu[Vb].HasUserDefinedPermissions&&!le)b.ULS.sendTraceTag(540608323,306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",ud),1!==ud&&4!==ud&&this.cKg();else if(Hd&&this.Ah.MandatoryLabelingEnforced&&le)b.ULS.sendTraceTag(570972054,
306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",ud),this.E_b(CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogTitle,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogDescriptionText);else{if(Hd&&this.nb.qa("WacLabelingJustificationDialogIsEnabled")&&this.Ah.RequiredDowngradeJustification&&(le||this.Pu[Vb].RequiredDowngradeJustification)&&(this.sNa()?!this.E$d&&!Vc:!this.QWa))return b.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",
ud),this.qTd(Vb),yd;if(this.sNa()&&this.Pu[Vb].HasUserDefinedPermissions&&!le)return b.ULS.sendTraceTag(523019968,306,50,"UDP Label is selected. ApplyLabelFlag: {0}",ud),this.OTd(Vb,Vc),yd;if(this.uue()&&!this.F7d())this.DFc<this.Tmg?(b.ULS.sendTraceTag(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this.DFc,ud),this.gMc=!0,this.DFc++,na.Task.delay(this.Umg).continueWith(()=>{this.gMc=!1;this.rSa(Vb,Uc,ud)})):(b.ULS.sendTraceTag(577356771,
306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",ud),Sd=1!==ud,Wd=!1,yd=8);else{if(this.Kki(Vb)&&(b.ULS.sendTraceTag(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",ud),1===ud||8===ud||4===ud))return yd;b.ULS.sendTraceTag(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",ud);this.setPolicyLabel(le?"":Vb,this.sNa()?Vc:this.QWa,"",ud);return yd}}else b.ULS.sendTraceTag(42796169,
306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",ud),this.af.updateCommandUI(),Hd&&this.E_b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else b.ULS.sendTraceTag(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",ud),this.af.updateCommandUI(),Hd&&this.E_b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityNoEditRightsErrorMessage);
else b.ULS.sendTraceTag(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",ud),this.af.updateCommandUI(),Sd=Hd,Wd=!1,yd=8;this.Tg.value.tHd(0,ud,Sd,Wd);return yd}PZa(Vb,Uc,ud=null,Vc=!1){G.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",0,"wordclpfc",null);this.nb.qa("SupportsOfficeClientCoauthoring")&&this.nb.qa("CoAuthForProtectedFilesIsEnabled")?(this.sjb=!1,(this.Ah=this.Tg.value.Nn)&&!this.Ah.AppliedPolicyId?this.sjb=!0:this.Ah&&
this.Ah.PolicyLabelAssignmentMethod&&(this.sjb=V.e(this.Ah.PolicyLabelAssignmentMethod)===V.e("standard"))):this.sjb=Vc;Vb=P.Fh(Vb)?null:this.Pu[Vb];(Uc=P.Fh(Uc)?null:this.Pu[Uc])?this.Wfa=new k(Uc,!0,ud):(this.Tg.value.jda(29),this.dfa=null);Vb?this.qpa=new k(Vb,!1):this.IVa=null;this.uGd(null,null);return 32}YLg(Vb){""!==this.Ah.AppliedPolicyId?this.Tg.value.tHd(4,16,!0):this.rSa(Vb,null,16)}o0f(){this.Pu={};if(this.Ah=this.Tg.value.Nn)for(const Vb of this.Ah.SensitivityLabels)this.Pu[Vb.Id]=Vb}Kki(Vb){if(this.b9&&
Vb in this.b9){Vb=this.b9[Vb];for(let Uc of Vb)if((Vb=this.Pu[Uc])&&Vb.Enabled)return!0}return!1}V0f(){this.b9={};if(this.Ah=this.Tg.value.Nn){for(const Vb of this.Ah.SensitivityLabels)Vb.ParentId||(this.b9[Vb.Id]=new e.a);for(const Vb of this.Ah.SensitivityLabels)Vb.ParentId&&Vb.ParentId in this.b9&&this.b9[Vb.ParentId].add(Vb.Id)}}ELf(){if(this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)){this.Ah=this.Tg.value.Nn;const Vb=this.Tyb&&this.isReactRibbonEnabled()&&
this.Tg.value.Yga();P.aRa(Vb)}else this.Tyb&&this.isReactRibbonEnabled()?(this.Ah=this.Tg.value.Nn,this.Tg.value.Yga()?(P.aRa(!0),appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!1))):P.aRa(!1)):P.aRa(!1)}T7i(Vb){this.OFc=Vb}J8i(Vb){this.dMc=Vb}A_f(){this.nb.qa("WacApplyDefaultPolicyLabelIsEnabled")&&(this.rgc()?this.NLc=!0:this.KHc||(this.KHc=!0,(this.Ah=this.Tg.value.Nn)&&this.Ah.DefaultLabelId&&!this.Ah.AppliedPolicyId&&(b.ULS.sendTraceTag(593774210,306,50,"Default labeling triggered. DefaultLabel: {0}",
this.Ah.DefaultLabelId),this.rSa(this.Ah.DefaultLabelId,null,1))))}uGd(){if(!this.Tg.value.hif()){var Vb=this.Pu[this.Tg.value.Nn.AppliedPolicyId];this.sjb&&this.qpa&&this.IVa!==this.qpa.id&&(!Vb||Vb.Order<this.qpa.sensitivityLabel.Order)&&(Vb=this.rSa(this.qpa.id,{},4),32!==Vb?b.ULS.sendTraceTag(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+Vb):(this.IVa=this.qpa.id,this.dfa&&(Vb=this.Pu[this.dfa])&&Vb.Order<=this.qpa.sensitivityLabel.Order&&(this.Tg.value.jda(29),
this.dfa=null)));Vb=this.Pu[this.Tg.value.Nn.AppliedPolicyId];if(this.Wfa&&this.dfa!==this.Wfa.id&&(!Vb||Vb.Order<this.Wfa.sensitivityLabel.Order)){const Uc=this.Wfa.id;this.Tg.value.jda(29);this.Tg.value.fZb(29,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,this.qgd(this.Wfa.sensitivityLabel))+" "+this.Wfa.q6i,CommonUIStrings.l_PolicyLabelRecommendationButton,()=>{this.rSa(Uc,{},8)});this.dfa=this.Wfa.id}this.Wfa=this.qpa=null}}setPolicyLabel(Vb,
Uc,ud,Vc=2){this.sNa()?Uc&&(this.E$d=!0):this.QWa=Uc;this.Tg.value.setPolicyLabel(Vb);this.af.updateCommandUI();ud=new l(Vc,this.qgd(this.Pu[Vb]));this.Tg.value.uQd(Vb,this.sNa()?Uc:this.QWa,ud)}H3g(Vb,Uc,ud,Vc){1===Vb&&this.setPolicyLabel(Uc,Vc,ud)}G3g(Vb,Uc,ud){1===Vb?this.sNa()?this.rSa(Uc,null,2,ud):this.setPolicyLabel(Uc===this.Ah.AppliedPolicyId?"":Uc,ud,""):this.af.updateCommandUI()}qTd(Vb){(new x(Vb,Object(d.a)(this,this.G3g,"continueToSetPolicyLabelFromJustificationDialog"))).qTd()}OTd(Vb,
Uc){(new I(Vb,Uc,Object(d.a)(this,this.H3g,"continueToSetPolicyLabelFromUDPDialog"))).OTd()}E_b(Vb="",Uc=""){const ud=new Q.StandardDialog;ud.ut=u.AFrameworkApplication.azb;ud.Rb=0;ud.rc(1,CommonUIStrings.l_DialogClose);ud.JW(Vb,Uc,null)}TPg(Vb){1===Vb&&this.Tg.value.v4i()}cKg(){const Vb=new Q.StandardDialog;Vb.ut=u.AFrameworkApplication.azb;Vb.Rb=1;Vb.rc(1,CommonUIStrings.l_OICDownLoadACopyDialogOpenButton);Vb.rc(0,CommonUIStrings.l_DialogClose);Vb.JW(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,
CommonUIStrings.l_SensitivityBlockUDPSetLabelMessage,Object(d.a)(this,this.TPg,"blockUDPSetLabelHandler"))}isReactRibbonEnabled(){return!!this.af&&!!this.af.Oa&&this.af.Oa.Ri}Yhc(){return this.af&&this.af.Oa?this.af.Oa.Yhc:!1}dKe(){return 32}Xab(Vb,Uc,ud,Vc,yd){if(1===ud)return 32;this.Ah=this.Tg.value.Nn;if(!this.Ah||!yd)return 32;yd[A.value]="";yd[A.xi]="";yd[A.alt]=null;yd[A.O$e]=null;yd[A.Q5a]=null;yd[A.customTooltip]="";yd[A.visible]=!1;yd[A.iconColor]="";ud=Uc=Vb=yd[A.icon]="";if(!this.Ah.AreLabelsAvailable){if(!this.xMc)return 32;
Vb=this.xMc;ud=A.iYd;this.wMc&&(Uc=this.wMc)}else if(this.Ah.AppliedPolicyId){Vc=null;for(const Sd of this.Ah.SensitivityLabels)if(Sd.Id.toLowerCase()===this.Ah.AppliedPolicyId.toLowerCase()){Vc=Sd;break}Vc&&(Vb=this.qgd(Vc),Uc=Vc.Tooltip,this.zPc=u.AFrameworkApplication.protectedFile=Vc.IsEndpointProtectionEnabled,ud=this.FYe(Vc))}this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(Vb?(yd[A.value]=Vb,yd[A.xi]=Vb,yd[A.customTooltip]=Uc,this.x0f(ud,this.zPc,yd)):
this.nb.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.ClpUseOutlineImageForNoLabel")?(yd[A.iconColor]=A.iYd,this.Ah.MandatoryLabelingEnforced?(yd[A.value]=yd[A.xi]=HeaderStrings.SelectASensitivityLabel,yd[A.icon]=A.J5i):(yd[A.value]=yd[A.xi]=HeaderStrings.NoSensitivityLabel,yd[A.icon]=A.M5i)):(yd[A.iconColor]="#000000",this.Ah.MandatoryLabelingEnforced?(yd[A.value]=yd[A.xi]=HeaderStrings.SelectASensitivityLabel,yd[A.icon]="MipTagErrorDynamicColor_20"):(yd[A.value]=yd[A.xi]=HeaderStrings.NoSensitivityLabel,
yd[A.icon]="MipTagQuestionDynamicColor_20")),yd[A.visible]=!0):Vb&&(yd[A.value]=Vb,yd[A.xi]=Vb,this.Yhc()?yd[A.customTooltip]=Uc:yd[A.alt]=Uc,this.x0f(ud,this.zPc,yd),yd[A.visible]=!0);return 32}qgd(Vb){return Vb?this.Pu?Vb.ParentId&&this.Pu[Vb.ParentId]?this.Pu[Vb.ParentId].DisplayName+"\\"+Vb.DisplayName:Vb.DisplayName:(b.ULS.sendTraceTag(4282E4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),Vb.DisplayName):""}x0f(Vb,Uc,ud){this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",
!1)?(ud[A.icon]=this.n4e(Uc),ud[A.iconColor]=this.o4e(Vb)):this.Yhc()?ud[A.icon]=Uc?A.IFj:A.KFj:(ud[A.O$e]=u.AFrameworkApplication.pB,ud[A.Q5a]=Uc?t.getImageClass(A.JFj):t.getImageClass(A.LFj))}C8g(Vb){const Uc=this.XE("LearnMoreSection",!0);Vb=Object.assign(new U.a,{Id:"SensitivityLearnMore",ExternalId:"SensitivityLearnMore",MenuItemId:Vb,LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",Image16by16:u.AFrameworkApplication.pB,Image16by16Class:t.getImageClass(A.$ri),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,
KeyTip:"L"});Array.add(Uc.ControlList,Vb);return Uc}vGe(Vb,Uc,ud=!1){let Vc;Vc="Toggle_"+Vb.Id;Vc="Sensitivity_"+Vc;const yd=Vb.DisplayName,Sd=Vb.Tooltip;var Wd=Vb.Id===this.Ah.AppliedPolicyId,Hd=ud?v.a.nf(Vc):Vc;this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(Wd=this.FYe(Vb),Uc=Object.assign(new R.a,{Id:Hd,ExternalId:Hd,LabelText:ud?v.a.nf(yd):yd,Command:"2935633379",MenuItemId:Hd,QueryCommand:"991261903",Visible:!0,Alt:ud?v.a.nf(Sd):Sd,AriaLabel:O.a.k0b,
IconColor:this.o4e(Wd),KeyTip:Uc}),Uc.ExternalImageId=this.n4e(Vb.IsEndpointProtectionEnabled)):(Hd=Object.assign(new F.a,{Id:Hd,ExternalId:Hd,LabelText:ud?v.a.nf(yd):yd,Command:"2935633379",MenuItemId:Hd,QueryCommand:"991261903",CheckedImage:u.AFrameworkApplication.pB,Visible:!0,Alt:ud?v.a.nf(Sd):Sd,IsChecked:Wd,AriaLabel:O.a.k0b,KeyTip:Uc}),this.isReactRibbonEnabled()?(Hd.CheckedImageClass=t.getImageClass(A.FHd),Hd.ExternalImageId=A.FHd):Hd.CheckedImageClass=t.getImageClass(A.hqb),Uc=Hd);Hd=Vc;
this.akb[Hd]=Vb.Id;this.Zee[Vb.Id]=Hd;return Uc}XE(Vb,Uc=!1){return Object.assign(new L.a,{Title:"",Id:Vb,DisplayMode:A.menu,ShowMenuSectionSeparator:Uc,ControlsId:"Ctrl_"+Vb,ControlList:[]})}Dah(Vb,Uc,ud){Vb=this.XE(Vb+"Sub");let Vc=1;for(let yd of Uc)(Uc=this.Pu[yd])&&Uc.Enabled&&(Array.add(Vb.ControlList,this.vGe(Uc,Vc.toString(),ud)),Vc++);return Vb}Dc(Vb=!1){const Uc=this.XE("SensitivitySection");let ud=1;const Vc=this.b9;for(let Sd in Vc){const Wd=Vc[Sd],Hd=this.Pu[Sd];if(Hd&&Hd.Enabled){if(Wd.count){const le=
"Sensitivity_"+Hd.Name;var yd=Vb?v.a.nf(le):le;yd=Object.assign(new T.a,{Id:yd,ExternalId:yd,LabelText:Vb?v.a.nf(Hd.DisplayName):Hd.DisplayName,Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new J.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:O.a.k0b,KeyTip:ud.toString()});this.isReactRibbonEnabled()?yd.ExternalImageId=A.FHd:(yd.Image16by16=u.AFrameworkApplication.pB,yd.Image16by16Class=t.getImageClass(A.hqb));
Array.add(yd.Menu.MenuSectionList,this.Dah(le,Wd,Vb));Array.add(Uc.ControlList,yd);this.akb[yd.Id]=Hd.Id;this.Zee[Hd.Id]=yd.Id}else Array.add(Uc.ControlList,this.vGe(Hd,ud.toString(),Vb));ud++}}return Uc}zmb(Vb){return!!this.La.d4(Vb)&&!!this.La.d4(Vb).flags&&!!this.La.d4(Vb).flags.length}MTi(Vb,Uc){Uc.onSuccess&&this.Pu&&(Vb=this.Pu[this.Tg.value.Nn.AppliedPolicyId])&&(this.dfa&&(Uc=this.Pu[this.dfa])&&Uc.Order<=Vb.Order&&(this.Tg.value.jda(29),this.dfa=null),this.IVa&&this.IVa!==Vb.Id&&(this.Tg.value.jda(28),
this.IVa=null))}n4e(Vb){return Vb?A.L5i:A.K5i}o4e(Vb){return Vb?Vb:A.iYd}FYe(Vb){if(Vb.Color||!Vb.ParentId)return Vb.Color;const Uc=this.Pu[Vb.ParentId];return Uc?Uc.Color:Vb.Color}static aRa(Vb){u.AFrameworkApplication.fa&&u.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(Vb?(W.a.zzd("ribbon","sensitivity"),W.a.tzd("ribbon","sensitivity")):W.a.yzd("ribbon","sensitivity"));u.AFrameworkApplication.fa&&u.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",
!1)&&H.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!Vb))}static Fh(Vb){return Vb&&Vb.length?!1:!0}}Object(c.a)(P,"PolicyActor",null,[537]);var ka=a(641),pa=a(554),Na=a(95),Z;(function(Vb){Vb[Vb.unknown=0]="unknown";Vb[Vb.boot=1]="boot";Vb[Vb.refresh=2]="refresh";Vb[Vb.selfSetPolicyLabel=3]="selfSetPolicyLabel"})(Z||(Z={}));Object(c.b)("GetPolicyLabelsReason",Z);class Ra extends Sys.EventArgs{constructor(Vb,Uc,ud,Vc,yd,Sd){super();this.upb=Vb;this.title=Uc;
this.message=ud;this.buttonText=Vc;this.I2=yd;this.sAb=Sd}}Object(c.a)(Ra,"AddAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class Da extends Sys.EventArgs{constructor(Vb,Uc,ud,Vc,yd){super();this.upb=Vb;this.title=Uc;this.message=ud;this.buttonText=Vc;this.I2=yd}}Object(c.a)(Da,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Ba;(function(Vb){Vb[Vb.none=0]="none";Vb[Vb.reasonDefaultLabel=1]="reasonDefaultLabel";Vb[Vb.reasonManual=2]="reasonManual";Vb[Vb.reasonAutomatic=
4]="reasonAutomatic";Vb[Vb.reasonRecommended=8]="reasonRecommended";Vb[Vb.reasonMandatory=16]="reasonMandatory"})(Ba||(Ba={}));Object(c.b)("ApplyLabelFlags",Ba);class ea extends Sys.EventArgs{constructor(Vb,Uc,ud){super();this.YAe=Vb;this.XAe=Uc;this.existingLabelPriority=ud}}Object(c.a)(ea,"AutoCLPSecurityNodesEventArgs",Sys.EventArgs,[]);class Y extends Sys.EventArgs{constructor(){super()}}Object(c.a)(Y,"GetPolicyLabelEventArgs",Sys.EventArgs,[]);class ja extends Sys.EventArgs{constructor(){super()}}
Object(c.a)(ja,"GetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class ca{constructor(){this.AreLabelsAvailable=!1;this.AppliedPolicyId=null;this.MandatoryLabelingEnforced=this.RequiredDowngradeJustification=!1;this.SensitivityLabels=this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.CustomUrl=this.DefaultLabelId=null;this.AreLabelsAvailable=!1;this.AppliedPolicyId="";this.RequiredDowngradeJustification=!1;this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.DefaultLabelId=
"";this.SensitivityLabels=[];this.MandatoryLabelingEnforced=!1;this.CustomUrl=""}}Object(c.a)(ca,"GetPolicyLabelsData",null,[]);class ba extends Sys.EventArgs{constructor(Vb=!1){super();this.onSuccess=Vb}}Object(c.a)(ba,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);class ua extends Sys.EventArgs{constructor(Vb,Uc){super();this.kya=Vb;this.vre=Uc}}Object(c.a)(ua,"MandatoryLabellingAppHandlerEventArgs",Sys.EventArgs,[]);class wa extends Sys.EventArgs{constructor(Vb,Uc,ud,Vc){super();this.title=Vb;this.uqc=
Uc;this.buttonText=ud;this.awf=Vc}}Object(c.a)(wa,"PolicyTipEventArgs",Sys.EventArgs,[]);class ia extends Sys.EventArgs{constructor(Vb,Uc){super();this.upb=Vb;this.sAb=Uc}}Object(c.a)(ia,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class xa extends Sys.EventArgs{constructor(){super()}}Object(c.a)(xa,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);class gb extends Sys.EventArgs{constructor(Vb,Uc){super();this.tqc=Vb;this.wP=Uc}}Object(c.a)(gb,"SetPolicyLabelEventArgs",
Sys.EventArgs,[]);class va extends Sys.EventArgs{constructor(Vb,Uc,ud,Vc=null,yd=null,Sd=null,Wd=null){super();this.errorType=Vb;this.a5f=ud;this.title=Vc;this.message=yd;this.buttonText=Sd;this.I2=Wd}}Object(c.a)(va,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class sa extends Sys.EventArgs{constructor(){super()}}Object(c.a)(sa,"SetPolicyLabelTriggeredEventArgs",Sys.EventArgs,[]);class ab extends Sys.EventArgs{constructor(Vb){super();this.txj=Vb}}Object(c.a)(ab,"UDPLabelingAppHandlerEventArgs",
Sys.EventArgs,[]);var Ua=a(107),nb=a(103),Ha=a(41),sb=a(80),Qb=a(39);class mb{constructor(Vb,Uc,ud,Vc,yd,Sd,Wd,Hd=null,le=null,Le=!1,Md=null,ke=null,ve=null,ge=null,we=!1,De=null,ib=null,Yb=null,pc=null,Jc=null,Xc=null){this.url=Vb;this.$Vj=Uc;this.body=ud;this.headers=Vc;this.Jdb=yd;this.priority=Sd;this.state=Wd;this.Qhg=Hd;this.fO=le;this.XQ=Le;this.f3i=Md;this.Inj=ke;this.name=ve;this.hGb=ge;this.gcd=we;this.WGf=De;this.q9b=ib;this.Afc=Yb;this.ocb=pc;this.x7h=Jc;this.responseType=Xc}}Object(c.a)(mb,
"ClientRequest",null,[]);var Pb=a(462),gc=a(263);class Xb{static fqj(Vb,Uc){if(!Vb||!Uc||Vb.count!==Uc.count)return!1;for(let ud of Vb)if(!Uc.contains(ud))return!1;return!0}static toArray(Vb){if(!Vb)return null;const Uc=Array(Vb.count);let ud=0;for(let Vc of Vb)Uc[ud]=Vc,ud++;return Uc}}Object(c.a)(Xb,"HashSetUtils",null,[]);var Ca=a(279),ra=a(69),ma=a(188);class hb{constructor(Vb,Uc,ud,Vc=0,yd=null){this.GHc=this.U6d=null;this.sra=this.Kib=this.Mib=0;this.g8="";this.bFa=this.xFc=this.d$d=this.npa=
this.hNc=null;this.F$d=!1;this.HCa=null;this.iKc=0;this.KVb=this.dFa=this.KDa=this.JVb=null;this.$a=new Na.a;this.JLb=this.rwb=this.ZEa=null;this.YKc=!1;this.UBb=null;this.nb=Vb;this.zh=Uc;this.Ch=ud;this.OUb=Vc;this.Nn=new ca;this.Yee=this.nb.Xa("PolicyHandlerEndpointName")||"PolicyHandler.ashx";this.ZO=yd;this.Tyb=Vb.qa("WacApplyManualPolicyLabelIsEnabled");this.Zfc=Vb.qa("CoAuthForProtectedFilesIsEnabled");this.supportsOfficeClientCoauthoring=Vb.qa("SupportsOfficeClientCoauthoring");this.Umi=!1;
this.nsj=3E4;this.he=nb.a.instance;Vb.qa("SupportsPolicies")&&D.a("MipSupportsPolicies");this.Zfc&&this.supportsOfficeClientCoauthoring&&D.a("MipSupportsOfficeClientCoauthoring")}get rnd(){return this.YKc}hpe(Vb){this.$a.addHandler("PolicyTipEvent",Vb)}RZb(Vb){this.$a.addHandler("LabelInfoUpdateEvent",Vb)}Xbj(Vb){this.$a.removeHandler("LabelInfoUpdateEvent",Vb)}vpe(Vb){this.$a.addHandler("SetPolicyLabelEventKey",Vb)}hdj(Vb){this.$a.removeHandler("SetPolicyLabelEventKey",Vb)}XVc(Vb){this.$a.addHandler("SetPolicyLabelFailureEventKey",
Vb)}gdj(Vb){this.$a.removeHandler("SetPolicyLabelFailureEventKey",Vb)}wGg(Vb){this.$a.addHandler("GetPolicyLabelEventKey",Vb)}vGg(Vb){this.$a.addHandler("GetPolicyLabelFailureEventKey",Vb)}tGg(Vb){this.$a.addHandler("GetAutoPolicyLabelEventKey",Vb);this.rnd&&(b.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),this.iHd(new Y(0)))}Cbj(Vb){this.$a.removeHandler("GetAutoPolicyLabelEventKey",Vb)}TFg(Vb){this.$a.addHandler("CreateAutoCLPSecurityNodesEventKey",
Vb)}gbj(Vb){this.$a.removeHandler("CreateAutoCLPSecurityNodesEventKey",Vb)}NIg(Vb){this.$a.addHandler("UpdateAutoCLPLabelPriorityNodeEventKey",Vb)}wdj(Vb){this.$a.removeHandler("UpdateAutoCLPLabelPriorityNodeEventKey",Vb)}OIg(Vb){this.$a.addHandler("UpdateAutoCLPSITNodesEventKey",Vb)}xdj(Vb){this.$a.removeHandler("UpdateAutoCLPSITNodesEventKey",Vb)}Wne(Vb){this.$a.addHandler("AddAutoPolicyBusinessBarEntryEventKey",Vb)}zaj(Vb){this.$a.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",Vb)}kpe(Vb){this.$a.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",
Vb)}Qcj(Vb){this.$a.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",Vb)}Xne(Vb){this.$a.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",Vb)}Baj(Vb){this.$a.removeHandler("AddMandatoryLabellingBusinessBarEntryEventKey",Vb)}lpe(Vb){this.$a.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",Vb)}Rcj(Vb){this.$a.removeHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",Vb)}eHg(Vb){this.$a.addHandler("MandatoryLabellingAppHandlerEventKey",Vb)}fcj(Vb){this.$a.removeHandler("MandatoryLabellingAppHandlerEventKey",
Vb)}JIg(Vb){this.$a.addHandler("UDPLabelingAppHandlerEventKey",Vb)}tdj(Vb){this.$a.removeHandler("UDPLabelingAppHandlerEventKey",Vb)}get Eod(){if(!this.U6d)return!1;for(const Vb of this.U6d.QZj())if(!Vb.Capabilities||!Vb.Capabilities.SupportsClientIsMipTrusted)return!1;return!0}get omi(){return!!this.ZEa}gYg(){return this.d$d?this.d$d():!1}P7i(Vb){this.xFc=Vb}mw(){return(new Date).getTime()}yed(){this.Ch&&(this.JVb=this.Ch.Bc("WebServiceCall","Call Get Policy Endpoint On Server"));var Vb=Ca.a.Xha(1,
1);this.nb.qa("SendHostAttributionInfoForPolicyLabelEnabled")?(Vb=new mb(this.H4a("datalosspolicy"),1,null,null,!0,2,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Vb),this.zh.send(Vb).PId(Object(d.a)(this,this.xxf,"onDataLossPolicySuccessCallback"),Object(d.a)(this,this.wxf,"onDataLossPolicyFailureCallback"))):this.zh.Jm(this.H4a("datalosspolicy"),1,null,null,!0,2,Object(d.a)(this,this.xxf,"onDataLossPolicySuccessCallback"),Object(d.a)(this,this.wxf,"onDataLossPolicyFailureCallback"),
null);this.Mib++;b.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this.Yee,this.Mib)}t7i(){this.xed(this.g8,2,this.npa)}xed(Vb,Uc=0,ud=null,Vc=!1){G.Health.instance.recordKpiUsage("MipGetPolicyLabel",0,"officewebclp",this.Jed(void 0,Uc));this.rwb=this.mw();const yd=this.k4c(Uc);this.Uac(Vb,yd,ud,Vc,Uc);this.oLd(!0)}xxf(Vb){this.CIf();let Uc="";({data:Uc}=this.KYd(Vb)).returnValue&&(b.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),
this.Mib=0,this.Ch&&(this.KVb=this.Ch.Bc("Task","Parse and Handle Get Policy Response")),this.LWi(Uc),this.KVb&&(this.KVb.stop(),this.KVb=null))}wxf(Vb){this.CIf();this.Mib<=this.OUb?this.yed():(b.ULS.sendTraceTag(25565154,306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",Vb?Vb.data?Vb.data.mRa:null:null),this.Mib=0)}hif(){return 0<this.sra}setPolicyLabel(Vb){this.Nn.AppliedPolicyId=Vb}uQd(Vb,Uc,ud=null){const Vc=this.g8g(ud);this.msj(Vb,Uc,Vc,ud)}jEf(Vb){this.dFa&&
(this.dFa.stop(),this.dFa=null);let Uc,ud;({AYf:Uc,b1f:ud}=this.v3e(Vb));const Vc=Vb.data.state,yd=Vc?Vc.wP:2;let Sd="";({data:Sd}=this.KYd(Vb)).returnValue?(b.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",yd),this.sra=0,this.cXi(Sd,Uc,ud,Vc)):this.UMd(yd)}r4i(Vb){G.Health.instance.recordKpiUsage("MipSetPolicyLabel",0,"officewebclp",this.Jed(Vb));this.JLb=this.mw();b.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event.");
this.$a.raiseEvent("SetPolicyLabelTriggeredEventKey",new sa(Vb))}oEi(){this.Zfc&&this.supportsOfficeClientCoauthoring&&this.omi&&this.ZEa.Kda(12,null,!0)}iEf(Vb){this.dFa&&(this.dFa.stop(),this.dFa=null);let Uc;({AYf:ud,b1f:Uc}=this.v3e(Vb));if(this.sra<=this.OUb)this.uQd(ud,Uc);else{var ud=(ud=Vb.data.state)?ud.wP:2;b.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",Vb?Vb.data?Vb.data.mRa:null:null,ud);this.UBb="WACServerConnectionFailed";
this.sra=0;this.UMd(ud)}}bmi(Vb){if(Vb&&("LabelNotSupported"===Vb||"LabelErrorRetryLater"===Vb||"CoherencyFailure"===Vb||"LabelIdNotFound"===Vb||"LabelDisabled"===Vb))return b.ULS.sendTraceTag(539103556,306,50,"LabelError is retriable: {0}",Vb),!0;b.ULS.sendTraceTag(539103557,306,50,"LabelError is not retriable: {0}",Vb);return!1}PVg(Vb){if(!Vb)return!1;let Uc=null,ud=null;for(const Vc of this.Nn.SensitivityLabels)Vc.Id===Vb&&(Uc=Vc),Vc.Id===this.g8&&(ud=Vc);if(!Uc)return!1;if(this.Zfc&&this.supportsOfficeClientCoauthoring){if(this.xFc&&
this.xFc()||this.Eod)return!0}else if(u.AFrameworkApplication.ez&&u.AFrameworkApplication.ez.gvb||this.npa&&this.npa())return!0;return Uc.IsEndpointProtectionEnabled===(!!ud&&ud.IsEndpointProtectionEnabled)}fZb(Vb,Uc,ud,Vc,yd){28===Vb?this.$Lf(new Ra(Vb,Uc,ud,Vc,yd,!1)):this.$Lf(new Ra(Vb,Uc,ud,Vc,yd,!0))}jda(Vb){28===Vb?this.DMf(new ia(Vb,!1)):this.DMf(new ia(Vb,!0))}v3i(Vb,Uc,ud){b.ULS.sendTraceTag(545280777,306,50,"Raising a CreateAutoCLPSecurityNodes event.");this.$a.raiseEvent("CreateAutoCLPSecurityNodesEventKey",
new ea(Vb,Uc,ud))}w4i(Vb){b.ULS.sendTraceTag(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event.");this.$a.raiseEvent("UpdateAutoCLPLabelPriorityNodeEventKey",new ea(null,null,Vb))}x4i(Vb,Uc){b.ULS.sendTraceTag(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event.");this.$a.raiseEvent("UpdateAutoCLPSITNodesEventKey",new ea(Vb,Uc,null))}qMf(Vb,Uc){b.ULS.sendTraceTag(572650527,306,50,"Raising a mandatory labelling"+(1===Uc?"Reading":"Edit")+" switch event.");this.$a.raiseEvent("MandatoryLabellingAppHandlerEventKey",
new ua(Vb,Uc))}RUc(Vb,Uc,ud,Vc,yd){37===Vb&&this.k3i(new Da(37,Uc,ud,Vc,yd))}NJd(){this.l4i(new xa)}v4i(){b.ULS.sendTraceTag(540608322,306,50,"Raising a UDP labeling event.");this.$a.raiseEvent("UDPLabelingAppHandlerEventKey",new ab(!0))}Yga(Vb=!1){const Uc=!!this.Nn&&this.Nn.AreLabelsAvailable&&!!this.Nn.SensitivityLabels&&0<this.Nn.SensitivityLabels.length&&gc.a.any(this.Nn.SensitivityLabels,ud=>!!ud&&ud.Enabled);Uc||Vb||P.aRa(!1);return Uc}qzf(Vb){this.KDa&&(this.KDa.stop(),this.KDa=null);var Uc=
"";this.oLd(!1);({data:Uc}=this.KYd(Vb)).returnValue?(b.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),this.Kib=0,Uc=this.UWi(Uc),Vb=this.j2e(Vb.data),G.Health.instance.recordKpiSuccess("MipGetPolicyLabel",this.fac(void 0,Vb,this.rwb)),this.rwb=null,Vb=new Y(Vb),this.K3i(Vb),this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?Uc&&this.ewj()?this.rnd?this.uQj():(this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",
!1)||this.qrb(),this.iHd(Vb),this.YKc=!0):Uc||this.Frc():!this.rnd&&Uc&&this.nb.qa("WacApplyManualPolicyLabelIsEnabled")&&this.Tse()?(this.iHd(Vb),this.YKc=!0):Uc||this.Frc()):this.Frc()}ewj(){if(!this.nb.qa("WacApplyManualPolicyLabelIsEnabled"))return b.ULS.sendTraceTag(539877667,306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),!1;if(!this.Tse())return!1;if(""===this.g8)return b.ULS.sendTraceTag(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),
!0;if(this.HCa===this.iKc)return b.ULS.sendTraceTag(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),!1;b.ULS.sendTraceTag(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label");return!0}qrb(){this.Gdg();b.ULS.sendTraceTag(545104324,306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",0<this.bFa.count,this.HCa);const Vb=Xb.toArray(this.bFa);this.v3i(Vb,
Vb,this.HCa)}uQj(){var Vb=this.bFa;this.Gdg();Xb.fqj(Vb,this.bFa)||(b.ULS.sendTraceTag(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",0<this.bFa.count),Vb=Xb.toArray(this.bFa),this.x4i(Vb,Vb));this.F$d&&(b.ULS.sendTraceTag(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",this.HCa),this.w4i(this.HCa))}Gdg(){const Vb=new ka.a(pa.a.Zk());for(const Uc of this.Nn.SensitivityLabels)if(Uc&&Uc.AutoLabelingSensitiveTypeIds&&0<Uc.AutoLabelingSensitiveTypeIds.length)for(const ud of Uc.AutoLabelingSensitiveTypeIds)ud&&
Vb.add(ud);this.bFa=Vb}pzf(Vb){const Uc=this.j2e(Vb.data);G.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",!1,!1,this.fac(void 0,Uc,this.rwb));this.rwb=null;this.KDa&&(this.KDa.stop(),this.KDa=null);if(this.Kib<=this.OUb){if(this.nb.qa("SendHostAttributionInfoForPolicyLabelEnabled")){const ud=Vb.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in ud&&ud[Ca.a.NNd]&&"HostAttributionInfo.ScenarioTypeParamName"in ud&&ud[Ca.a.ONd]){Vb.data.request.get_headers();
Vb.data.request.get_headers();Vb=this.k4c(Uc);this.Uac(this.g8,Vb,this.npa,void 0,Uc);return}}this.xed(this.g8,Uc,this.npa)}else b.ULS.sendTraceTag(34996494,306,15,"Request to get label policy failed with error response: {0}.",Vb?Vb.data?Vb.data.mRa:null:null),this.Frc(),this.Kib=0,this.oLd(!1)}j2e(Vb){return Vb.state?Vb.state:0}H4a(Vb,Uc=!1){let ud=String.format("{0}{1}?action={2}&{3}",this.nb.Xa("PolicyHandlerWebServiceBase")||u.AFrameworkApplication.ta.Oa.AV,this.Yee,Vb,u.AFrameworkApplication.qj);
"setpolicylabel"===Vb&&u.AFrameworkApplication.ez&&u.AFrameworkApplication.ez.Def&&(ud=sb.a.Kl(ud,"sl","1"));Uc&&(ud=sb.a.Kl(ud,"cbd","1"));return ud}v3e(Vb){let Uc,ud;Uc=ud=null;Vb&&Vb.data&&Vb.data.request&&Vb.data.request.get_headers()&&(Uc=Vb.data.request.get_headers()[Pb.a.BYf],ud=Vb.data.request.get_headers()[Pb.a.c1f]);return{AYf:Uc,b1f:ud}}KYd(Vb){Vb=Vb?Vb.data?Vb.data.Xd:null:null;return Vb&&Vb.length&&!this.Qmi(Vb)?{returnValue:!0,data:Vb}:(b.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),
{returnValue:!1,data:Vb})}LWi(Vb){let Uc;try{Uc=Ha.b(Vb)}catch(ud){b.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.");return}if(Uc)if(Uc.IsPolicyTipAvailable)switch(Uc.IsPolicyTipAvailable.toLowerCase()){case "false":b.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");break;case "true":b.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document.");this.GHc=Uc.NavigateUrl;this.iBj(Uc.GeneralText,
Object(d.a)(this,this.UIi,"onDataLossPolicyOverrideButtonClick"));break;default:b.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",Uc.IsPolicyTipAvailable)}else b.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");else b.ULS.sendTraceTag(25565185,306,10,"policyData is null after deserializing DataLossPrevention response.")}cXi(Vb,Uc,ud,Vc){var yd=Vc?Vc.wP:2;
let Sd=0,Wd="",Hd;if(({fu:Hd}=Ha.d(Vb)).returnValue)if(Hd){Wd="Success";Vb=this.k4c(3);if(Hd.IsSuccessful){G.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.fac(yd,void 0,this.JLb));this.UBb=this.JLb=null;b.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",yd);2===yd&&this.jda(29);this.itj(Uc,yd);this.oEi();this.jda(28);Vc&&4===yd&&this.fZb(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,
Vc.displayName),CommonUIStrings.l_DialogOk,()=>{});D.a("MipAppliedLabels",void 0,void 0,[Object.assign(new ra.a,{name:"SetPolicyLabelApplyFlag",string:Ba[yd]})]);this.Uac(Uc,Vb,this.npa,void 0,3);return}b.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",yd,Hd.FailureReason);this.UBb=Hd.FailureReason;"FileTooLarge"===Hd.FailureReason?Sd=1:"LabelNotSupported"===Hd.FailureReason?Sd=2:
"LabelDisabled"===Hd.FailureReason?Sd=3:"MinorVersionLimitExceeded"===Hd.FailureReason&&(Sd=5);this.Umi&&0<=Hd.FailureReason.indexOf("InvalidOperationOnZeroByteFile")&&(Vc=new Ua.a(2,1,this.nsj,()=>{b.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",this.sra);this.sra<=this.OUb&&this.uQd(Uc,ud)}),this.he.Fg(Vc));this.Zfc&&this.supportsOfficeClientCoauthoring&&this.Uac(this.Nn.AppliedPolicyId,Vb,this.npa,!0,3)}else Wd=
"setPolicyLabelData null.",b.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",yd);else Wd="TryDeserialize failed.",b.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",yd);this.UMd(yd,Sd);yd=this.fac(yd,void 0,this.JLb);this.JLb=null;yd.extendedProperties.set("SetPolicyLabelDataFailureReason",this.UBb);yd.extendedProperties.set("SetPolicyLabelDataParseStatus",
Wd.toString());G.Health.instance.recordKpiFailure("MipSetPolicyLabel","SetPolicyLabelFailure",!1,!1,yd)}UMd(Vb,Uc=0){this.setPolicyLabel(this.g8);this.oMf(new ba);this.tHd(Uc,Vb,2===Vb||8===Vb||16===Vb,!1)}itj(Vb,Uc){this.setPolicyLabel(this.g8=Vb);if(""===Vb)u.AFrameworkApplication.protectedFile=!1,u.AFrameworkApplication.enableMacrosForProtectedFile=!1;else for(const ud of this.Nn.SensitivityLabels)if(ud.Id===Vb){u.AFrameworkApplication.protectedFile=ud.IsEndpointProtectionEnabled;break}this.q4i(new gb(Vb,
Uc))}pSj(){for(const Vb of this.Nn.SensitivityLabels)Vb&&Vb.Enabled&&(Vb.Id===this.g8&&(this.F$d=this.HCa!==Vb.Order,this.HCa=Vb.Order),Vb.Order>this.iKc&&(this.iKc=Vb.Order))}UWi(Vb){if(!({fu:Vb}=Ha.d(Vb)).returnValue)return b.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1;if(!Vb)return b.ULS.sendTraceTag(42467542,306,10,"policyData is null after deserializing label policy data response."),!1;if(!Vb.AreLabelsAvailable)return!1;this.Nn=Vb;this.g8=Vb.AppliedPolicyId;
this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&this.pSj();this.Yga()&&b.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call.");this.oMf(new ba(!0));return!0}Tse(){if(!this.Yga())return b.ULS.sendTraceTag(539877699,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),!1;for(const Vb of this.Nn.SensitivityLabels)if(Vb&&Vb.AutoLabelingSensitiveTypeIds&&0<Vb.AutoLabelingSensitiveTypeIds.length)return!0;
b.ULS.sendTraceTag(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT");return!1}oMf(Vb){b.ULS.sendTraceTag(35393610,306,50,"Raising label info update event.");this.$a.raiseEvent("LabelInfoUpdateEvent",Vb)}K3i(Vb){b.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event.");this.$a.raiseEvent("GetPolicyLabelEventKey",Vb)}Frc(){P.aRa(!1);this.$a.raiseEvent("GetPolicyLabelFailureEventKey",new ja)}iHd(Vb){this.ZO&&this.ZO.execute(Uc=>{Uc=[Uc.isFeatureEnabled("MsoClpSpTwo",
!0),Uc.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(Uc).then(ud=>{gc.a.any(ud,Vc=>Vc)&&(b.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),this.$a.raiseEvent("GetAutoPolicyLabelEventKey",Vb),this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)&&this.qrb(),D.a("MipAutoClassificationEnabled"));return null})})}Jed(Vb=null,Uc=null){const ud=new Map;ud.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString());null!=
Vb&&ud.set("ApplyLabelFlags",Ba[Vb]);null!=Uc&&ud.set("GetPolicyLabelsReason",Z[Uc]);return ud}fac(Vb=null,Uc=null,ud=null){const Vc=new ma.a;Vc.extendedProperties=this.Jed(Vb,Uc);null!=ud&&(Vc.durationMs=this.mw()-ud);return Vc}q4i(Vb){b.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event.");this.$a.raiseEvent("SetPolicyLabelEventKey",Vb)}$Lf(Vb){b.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event.");Vb&&Vb.sAb&&D.a("MipRecommendations");this.$a.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",
Vb)}DMf(Vb){b.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event.");this.$a.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",Vb)}k3i(Vb){b.ULS.sendTraceTag(573842331,306,50,"Raising an add mandatory labelling business bar entry event.");this.$a.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",Vb)}l4i(Vb){b.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event.");this.$a.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",
Vb)}iBj(Vb,Uc=null){b.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user.");this.$a.raiseEvent("PolicyTipEvent",new wa(CommonUIStrings.l_PolicyBusinessBarTitle,Vb,CommonUIStrings.l_PolicyOverrideButton,Uc))}tHd(Vb,Uc,ud,Vc=!0){b.ULS.sendTraceTag(42074656,306,Vc?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",Uc);Vc=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;let yd=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,Sd=null,Wd=null;switch(Vb){case 1:Vc=
CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle;yd=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage;break;case 2:Vc=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle;yd=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage;break;case 3:Vc=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle;yd=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage;
break;case 4:Vc=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle;yd=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage;break;case 5:Vc=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,yd=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,Sd=CommonUIStrings.l_LearnMore,Wd=()=>{this.osj()}}Vb=new va(Vb,Uc,ud,Vc,yd,Sd,Wd);this.$a.raiseEvent("SetPolicyLabelFailureEventKey",Vb)}Arj(Vb){this.hNc=
Vb}UIi(){this.GHc?(b.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),Qb.a.LU(this.GHc)):b.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")}Qmi(Vb){if(!Vb.startsWith("<")||-1===Vb.indexOf("Error")&&-1===Vb.indexOf("Unavailable"))return!1;b.ULS.sendTraceTag(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint.");
return!0}CIf(){this.JVb&&(this.JVb.stop(),this.JVb=null)}XHh(Vb){if(!Vb)return"manual";switch(Vb.wP){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";default:return"manual"}}cJh(Vb){if(!Vb)return"privileged";Vb=Vb.wP;let Uc="privileged";if(4===Vb||1===Vb)Uc="standard";return Uc}Uac(Vb,Uc,ud=null,Vc=!1,yd=0){this.nb.qa("WacLabelingGetPolicyLabelsIsEnabled")&&(this.g8=Vb,this.npa=ud,this.Ch&&(this.KDa=this.Ch.Bc("WebServiceCall",
"Call Get Policy Endpoint On Server")),ud={},ud[Pb.a.NLg]=Vb,this.nb.qa("SendHostAttributionInfoForPolicyLabelEnabled")?(Vb=new mb(this.H4a("getpolicylabels",Vc),1,null,ud,!0,2,yd,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Uc),this.zh.send(Vb).PId(Object(d.a)(this,this.qzf,"onGetPolicyLabelsSuccessCallback"),Object(d.a)(this,this.pzf,"onGetPolicyLabelsFailureCallback"))):this.zh.Jm(this.H4a("getpolicylabels",Vc),1,null,ud,!0,2,Object(d.a)(this,this.qzf,"onGetPolicyLabelsSuccessCallback"),
Object(d.a)(this,this.pzf,"onGetPolicyLabelsFailureCallback"),yd,void 0,void 0,void 0,void 0,"22"),this.Kib++,b.ULS.sendTraceTag(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",this.Kib))}msj(Vb,Uc,ud,Vc=null){if(this.Tyb){this.Ch&&(this.dFa=this.Ch.Bc("WebServiceCall","Call Set Policy Endpoint On Server"));var yd={};yd[Pb.a.BYf]=Vb;Uc&&(yd[Pb.a.c1f]=encodeURIComponent(Uc));this.hNc&&(yd[Pb.a.eLg]=this.hNc);Vc?(yd[Pb.a.$0f]=this.XHh(Vc),yd[Pb.a.a1f]=this.cJh(Vc)):(yd[Pb.a.$0f]=
"manual",yd[Pb.a.a1f]="privileged");this.supportsOfficeClientCoauthoring&&this.Nn&&(yd[Pb.a.RYi]=this.Nn.PolicyLabelVersionToken);this.nb.qa("SendHostAttributionInfoForPolicyLabelEnabled")?(Vb=new mb(this.H4a("setpolicylabel",!0),1,null,yd,!0,2,Vc,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,ud),this.zh.send(Vb).PId(Object(d.a)(this,this.jEf,"onSetPolicyLabelSuccessCallback"),Object(d.a)(this,this.iEf,"onSetPolicyLabelFailureCallback"))):this.zh.Jm(this.H4a("setpolicylabel",
!0),1,null,yd,!0,2,Object(d.a)(this,this.jEf,"onSetPolicyLabelSuccessCallback"),Object(d.a)(this,this.iEf,"onSetPolicyLabelFailureCallback"),Vc,void 0,void 0,void 0,void 0,"32");this.sra++;b.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.sra)}else b.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")}osj(){const Vb=new Q.StandardDialog,Uc=this.nb.Xa("BreadcrumbFolderUrl");
Uc?(Vb.Rb=11,Vb.rc(1,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoAction),Vb.rc(2,CommonUIStrings.l_DialogOk)):(Vb.Rb=0,Vb.rc(1,CommonUIStrings.l_DialogOk));Vb.Qme(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoHelpText,"0f6cd105-974f-44a4-aadb-43ac5bdfd247");Vb.H$i();Vb.JW(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoMessage,
ud=>{1===ud&&Uc&&Qb.a.Ze(Uc,"_blank",void 0,"SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")})}k4c(Vb){switch(Vb){case 1:return Ca.a.Xha(1,1);case 2:return Ca.a.Xha(7,1);case 3:return Ca.a.Xha(8,1);default:return Ca.a.Xha(7,0)}}g8g(Vb=null){if(!Vb)return Ca.a.Xha(8,0);switch(Vb.wP){case 1:case 16:return Ca.a.Xha(1,1);case 4:case 2:case 8:return Ca.a.Xha(8,1);default:return Ca.a.Xha(8,0)}}oLd(Vb){this.nb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",
!1)&&appChrome.api.setAsyncRequestStatus("sensitivity",Vb)}}Object(c.a)(hb,"PolicyManager",null,[513]);var vb=a(137),Va=a(247);class db{constructor(){this.i1=this.$qa=this.gb=this.Tg=null}get name(){return"Common.App.Policy"}init(){u.AFrameworkApplication.fa.qa("ShouldInitCommonPolicyPackage")&&(u.AFrameworkApplication.fa.qa("IsDataLossPreventionEnabledForUser")&&u.AFrameworkApplication.ta&&(this.Tg=this.gb.resolve("Common.App.Policy.Contracts.IPolicyManager"),this.Tg.hpe(Object(d.a)(this,this.ATd,
"showPolicyBusinessBar")),b.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),vb.a.get_instance().yk(6,()=>{this.Tg.yed()})),u.AFrameworkApplication.fa.qa("WacLabelingPoliciesIsEnabled")&&u.AFrameworkApplication.fa.qa("SupportsPolicies")?vb.a.get_instance().yk(6,Object(d.a)(this,this.eGi,"onAfterRibbonBehaviorAttached")):P.aRa(!1))}dispose(){}Wh(Vb){Vb.register(513,"Common.App.Policy.Contracts.IPolicyManager").wc().Fc(()=>new hb(u.AFrameworkApplication.fa,u.AFrameworkApplication.yd,
u.AFrameworkApplication.ta.ZD,u.AFrameworkApplication.fa.qd("MaxGetPolicyRetries",1),Vb.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),u.AFrameworkApplication.ta.Oa.Dj));Vb.register(P,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").wc().Fc(()=>new P(u.AFrameworkApplication.vb,u.AFrameworkApplication.ta,u.AFrameworkApplication.fa,Vb.zMd("Common.App.Policy.Contracts.IPolicyManager")));this.gb=Vb}eGi(){this.i1=this.gb.yh("CommonUI.BusinessBar");this.Tg||
(this.Tg=this.gb.resolve("Common.App.Policy.Contracts.IPolicyManager"));this.$qa=this.gb.resolve("Common.App.Policy.PolicyActor");u.AFrameworkApplication.fa&&u.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&H.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")?this.Tg.RZb(Object(d.a)(this.$qa,this.$qa.kPf,"registerActionsHandler")):this.$qa.Ig();this.Tg.RZb(Object(d.a)(this,
this.YZd,"updateLabelInfo"));u.AFrameworkApplication.fa.qa("WacApplyManualPolicyLabelIsEnabled")&&(this.Tg.XVc(Object(d.a)(this,this.x4h,"handleSetPolicyLabelFailure")),this.Tg.Wne(Object(d.a)(this,this.fZb,"addAutoPolicyBusinessBarEntry")),this.Tg.kpe(Object(d.a)(this,this.jda,"removeAutoPolicyBusinessBarEntry")),this.Tg.Xne(Object(d.a)(this,this.RUc,"addMandatoryLabellingBusinessBarEntry")),this.Tg.lpe(Object(d.a)(this,this.NJd,"removeMandatoryLabellingBusinessBarEntry")))}YZd(){this.$qa.V0f();
this.$qa.o0f();this.$qa.ELf();const Vb=this.Tg.gYg();u.AFrameworkApplication.fa.qa("HasDocumentEditRights")&&!Vb?this.$qa.dbg():b.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",u.AFrameworkApplication.fa.qa("HasDocumentEditRights"),Vb);u.AFrameworkApplication.ta.updateCommandUI()}ATd(Vb,Uc){this.h2e(Uc.title,Uc.uqc,38,Uc.awf,Uc.buttonText);b.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")}x4h(Vb,
Uc){Uc.a5f&&(this.h2e(Uc.title,Uc.message,21,null,null,Uc.I2,Uc.buttonText),b.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user."))}jda(){}fZb(Vb,Uc){this.i1&&(this.Tg.jda(Uc.upb),Vb=new f.a(Uc.title,Uc.message,null),Vb.id=Uc.upb,Vb.closeable=!0,Vb.image=3,Vb.addButton(Uc.buttonText,Uc.I2,Uc.buttonText,!0),this.i1.qC(Vb,!1))}RUc(Vb,Uc){this.i1&&(Vb=new f.a(Uc.title,Uc.message,null),Vb.id=Uc.upb,Vb.closeable=!1,Vb.image=3,Vb.addButton(Uc.buttonText,
Uc.I2,Uc.buttonText,!1),this.i1.qC(Vb,!1))}NJd(){}h2e(Vb,Uc,ud,Vc=null,yd=null,Sd=null,Wd=null){Vb=new f.a(Vb,Uc,null);Vb.id=ud;Vb.closeable=!0;Vc&&Vb.UCg(yd,Vc);Sd&&Vb.addButton(Wd,Sd,Wd)}static main(){Va.a.instance.Gi(new db)}}Object(c.a)(db,"PackageManager",null,[3,4]);var oa=a(9),Oa=a(553),Wa=a(222),Sa=a(50),yb=a(37),Ma=a(82),Bb=a(38),Nb=a(176),Ia=a(370),jb=a(171),Ob=a(90),Jb=a(29),Kb=a(282),Qa=a(1),ha=a(22),qa=a(281);class pb{constructor(){this.tqc=this.rZf=null;this.wP=0}}Object(c.a)(pb,"ApplyPolicyContextParameters",
null,[]);var bb=a(7),eb=a(693),Fa=a(565),tb=a(47),dc=a(45);class jc{constructor(){this.vGa=this.annotationType=null;this.kMa=this.vw=!1}}Object(c.a)(jc,"AnnotationActivationOptions",null,[]);var fb=a(61);const ec=(Vb,Uc,ud,Vc,yd,Sd,Wd=null)=>{Wd=Vb.Na(1,Wd);Wd.tenantId=Uc;return fb.g(Vb,"GetPolicyLabelId",Wd,ud,Vc,yd,Sd,4)},lb=(Vb,Uc,ud,Vc,yd,Sd,Wd,Hd,le,Le,Md=null)=>{Md=Vb.Na(41,Md);Md.labelsInfoJson=Uc;Md.appliedLabelId=ud;Md.tenantId=Vc;Md.applyLabelFlag=yd;Md.skipApplyOutcomes=Sd;return fb.g(Vb,
"ApplyPolicyLabel",Md,Wd,Hd,le,Le,0)},ac=(Vb,Uc,ud,Vc,yd,Sd,Wd=null)=>{Wd=Vb.Na(1,Wd);Wd.tenantId=Uc;return fb.g(Vb,"GetPolicyApplicationMethod",Wd,ud,Vc,yd,Sd,4)};var Gb=a(724),wb=a(698);class qc extends Gb.a{constructor(){super();this.source=this.automatic=this.recommended=null;this.H_=Object.assign(new wb.a,{T_:qc.getTypeName(),B_:qc.Qd()})}static getTypeName(){return"AugLoop_SecurityClp_LabellingAnnotation"}static Qd(){return["AugLoop_Core_Annotation"]}}Object(c.a)(qc,"LabellingAnnotation",Gb.a,
[]);var Ya=a(719);class xb extends Ya.a{constructor(){super();this.fullDocSITs=this.partialDocSITs=null;this.H_=Object.assign(new wb.a,{T_:xb.getTypeName(),B_:xb.Qd()})}static getTypeName(){return"AugLoop_SecurityShared_SecurityShared"}static Qd(){return[]}}Object(c.a)(xb,"SecurityShared",Ya.a,[]);class wc extends xb{constructor(){super();this.existingLabelPriority=null;this.H_=Object.assign(new wb.a,{T_:wc.getTypeName(),B_:wc.Qd()})}static getTypeName(){return"AugLoop_SecurityShared_CLP"}static Qd(){return["AugLoop_SecurityShared_SecurityShared"]}}
Object(c.a)(wc,"CLP",xb,[]);class Oc extends Gb.a{constructor(){super();this.source=this.automatic=this.recommended=null;this.H_=Object.assign(new wb.a,{T_:Oc.getTypeName(),B_:Oc.Qd()})}static getTypeName(){return"AugLoop_Automatic_Clp_LabellingAnnotation"}static Qd(){return["AugLoop_Core_Annotation"]}}Object(c.a)(Oc,"LabellingAnnotation",Gb.a,[]);var Cb=a(972),Ib=a(867),fc=a(974);class vc extends Gb.a{constructor(){super();this.classificationId=null;this.H_=Object.assign(new wb.a,{T_:vc.getTypeName(),
B_:vc.Qd()})}static getTypeName(){return"AugLoop_LinkedDataType_LinkedDataTypeAnnotation"}static Qd(){return["AugLoop_Core_Annotation"]}}Object(c.a)(vc,"LinkedDataTypeAnnotation",Gb.a,[]);class Cc extends Bb.a{constructor(Vb,Uc,ud,Vc,yd){super();this.Fqf=3;this.PA=this.augmentationLoopManager=null;this.j_a=!1;this.M$a=[];this.glf=new eb.a(Fa.a.kK());this.WFd=0;this.aGd=null;this.qrb=(Sd,Wd)=>{Sd=Object(bb.a)(new Cb.a,{parentPath:["session","doc","security"],items:[Object(bb.a)(new Ib.a,{id:"clp",
body:Object(bb.a)(new wc,{existingLabelPriority:Wd.existingLabelPriority,partialDocSITs:Wd.YAe,fullDocSITs:Wd.XAe})})]});this.M$a.push(Sd);this.tyb()};this.Edg=(Sd,Wd)=>{Sd=Object(bb.a)(new fc.a,{parentPath:["session","doc","security"],items:[Object(bb.a)(new Ib.a,{id:"clp",body:Object(bb.a)(new wc,{existingLabelPriority:Wd.existingLabelPriority})})]});this.M$a.push(Sd);this.tyb()};this.Fdg=(Sd,Wd)=>{Sd=Object(bb.a)(new fc.a,{parentPath:["session","doc","security"],items:[Object(bb.a)(new Ib.a,{id:"clp",
body:Object(bb.a)(new wc,{partialDocSITs:Wd.YAe,fullDocSITs:Wd.XAe})})]});this.M$a.push(Sd);this.tyb()};this.mR=()=>{b.ULS.sendTraceTag(537154588,306,50,`AutoPolicyManager::OnApplicationModeChanged - isEditMode:${this.$.isEditMode}.`);this.$.isEditMode?Qa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.tyb():this.qaf():(this.businessBar.removeEntry(41),this.businessBar.removeEntry(40),this.ddh())};this.R9a=()=>{b.ULS.sendTraceTag(537154587,306,50,"AutoPolicyManager::OnAugmentationLoopSessionClose called.");
this.uIe();this.augmentationLoopManager=null};this.Nqi=(Sd,Wd)=>{var Hd,le,Le,Md,ke;b.ULS.sendTraceTag(537154586,306,50,"AutoPolicyManager::LabellingAnnotationHandler called.");if(3===Wd.operationType)b.ULS.sendTraceTag(537154585,306,50,"AutoPolicyManager::LabellingAnnotationHandler Ignoring delete operation.");else{var ve=Sd=null,ge=null;if(this.Lfc()){var we=Wd.oM;if(!we){b.ULS.sendTraceTag(537154584,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===
(Hd=we.automatic)||void 0===Hd?0:Hd.id)Sd=we.automatic.id;if(null===(le=we.recommended)||void 0===le?0:le.id)ve=we.recommended.id,we.recommended.policyTip&&(ge=we.recommended.policyTip)}else{Hd=Wd.oM;if(!Hd){b.ULS.sendTraceTag(537154583,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===(Le=null===(we=Hd.automatic)||void 0===we?void 0:we.sensitivityLabel)||void 0===Le?0:Le.id)Sd=Hd.automatic.sensitivityLabel.id;if(null===(ke=null===(Md=Hd.recommended)||
void 0===Md?void 0:Md.sensitivityLabel)||void 0===ke?0:ke.id)ve=Hd.recommended.sensitivityLabel.id,Hd.recommended.sensitivityLabel.policyTip&&(ge=Hd.recommended.sensitivityLabel.policyTip)}this.applyPolicyLabel(Sd,ve,ge,1)}};this.Osi=(Sd,Wd)=>{b.ULS.sendTraceTag(537154582,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Handler called.");3===Wd.operationType?b.ULS.sendTraceTag(537154581,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received delete operation."):
(Sd=Wd.oM)?(Sd=Sd.classificationId,this.applyPolicyLabel(Sd,Sd,null,2)):b.ULS.sendTraceTag(537154580,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received an empty annotation.")};this.iQf=(Sd,Wd)=>{Wd?Wd.sAb&&this.businessBar.OE(41)?(this.businessBar.removeEntry(41),b.ULS.sendTraceTag(537154562,306,50,"Remove entry to RecommendedSensitivityLabelBusinessBarEntry succeeded.")):!Wd.sAb&&this.businessBar.OE(40)&&(this.businessBar.removeEntry(40),b.ULS.sendTraceTag(537154561,
306,50,"Remove entry to AutomaticSensitivityLabelBusinessBarEntry succeeded.")):b.ULS.sendTraceTag(537154563,306,15,"RemoveAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.m4f=(Sd,Wd)=>{Wd?Wd.sAb?(this.businessBar.vBj(Wd.title,Wd.message,Wd.buttonText,Hd=>{Wd.I2(Hd);this.businessBar.OE(41)&&this.businessBar.removeEntry(41)}),b.ULS.sendTraceTag(537154531,306,50,"Add entry to RecommendedSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):
(this.businessBar.mzj(Wd.title,Wd.message,Wd.buttonText,Hd=>{Wd.I2(Hd);this.businessBar.OE(40)&&this.businessBar.removeEntry(40)}),b.ULS.sendTraceTag(537154530,306,50,"Add entry to AutomaticSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):b.ULS.sendTraceTag(537154560,306,15,"ShowAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.JEd=Vb;this.policyManager=Uc;this.$=ud;this.fa=Vc;this.businessBar=yd;this.x9h();this.R7i();this.disposed=
!1}get fc(){return!this.disposed&&this.$.ea.fc}dispose(){this.disposed||(this.disposed=!0,this.Peh(),this.uIe(),this.JEd=this.policyManager=this.augmentationLoopManager=null,super.dispose())}PZa(Vb,Uc,ud,Vc,yd=!1){b.ULS.sendTraceTag(537154642,306,50,`AutoPolicyManager: ApplyAutoPolicyLabel called for LabellingSource ${Vc} with AutoLabelPresent: ${!!Vb}, RecommendedLabelPresent: ${!!Uc}, isStandard: ${yd}.`);this.fc?this.JEd&&(this.QVg(Uc,Vc)?(this.aGd=Uc,this.WFd=Vc,this.glf.ia(Vc,Uc)):Uc=this.aGd,
Vb=this.JEd.PZa(Vb,Uc,ud,yd),b.ULS.sendTraceTag(537154640,306,50,`AutoPolicyManager::ApplyAutoPolicyLabel - policyActor.ApplyAutoPolicyLabel returned ${Vb}.`)):b.ULS.sendTraceTag(537154641,306,15,`AutoPolicyManager: ApplyAutoPolicyLabel failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.fc}.`)}QVg(Vb,Uc){if(!this.policyManager.Yga())return b.ULS.sendTraceTag(537154639,306,15,"CanShowRecommendedSensitivityLabel - Labels are not available."),!1;const ud=this.policyManager.Nn;
let Vc;({value:Vc}=this.glf.Cc(this.WFd));let yd=null,Sd=null,Wd=null;for(const Hd of ud.SensitivityLabels)Hd.Id===Vb&&(yd=Hd),Hd.Id===Vc&&(Sd=Hd),Hd.Id===this.aGd&&(Wd=Hd);return Sd&&Sd.Id===Vb?(b.ULS.sendTraceTag(537154638,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since it is same as last recommendation from current source."),!1):this.businessBar.OE(41)&&this.WFd!==Uc&&Wd&&(!yd||Wd.Order>=yd.Order)?(b.ULS.sendTraceTag(537154637,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since current label priority is lower than last label priority."),
!1):!0}Lfc(){return Qa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)}Tcf(){return Qa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPSecurityNodeCreation",!1)}R7i(){this.policyManager.Wne(this.m4f);this.policyManager.kpe(this.iQf);this.$.ea.aY(this.mR);this.Lfc()&&this.Tcf()&&(this.policyManager.TFg(this.qrb),this.policyManager.NIg(this.Edg),this.policyManager.OIg(this.Fdg))}Peh(){this.businessBar.removeEntry(41);this.businessBar.removeEntry(40);
this.policyManager.zaj(this.m4f);this.policyManager.Qcj(this.iQf);this.$.ea.b0(this.mR);this.Lfc()&&this.Tcf()&&(this.policyManager.gbj(this.qrb),this.policyManager.wdj(this.Edg),this.policyManager.xdj(this.Fdg))}x9h(){this.PA=new eb.a(Fa.a.kK());const Vb=this.Lfc()?qc.getTypeName():Oc.getTypeName();this.PA.add(1,Object(bb.a)(new jc,{annotationType:Vb,vGa:this.Nqi,vw:!1,kMa:!1}));this.PA.add(2,Object(bb.a)(new jc,{annotationType:vc.getTypeName(),vGa:this.Osi,vw:!1,kMa:!1}))}B8f(){for(let Vb of this.M$a)this.augmentationLoopManager.submitOperation(Vb);
this.M$a=[]}M7i(Vb){if(!this.PA.lb(Vb))return b.ULS.sendTraceTag(537154636,306,15,`AutoPolicyManager::RegisterAnnotation - AnnotationActivationOptions not available for LabellingSource ${Vb}.`),!1;if(this.PA.na(Vb).vw)return b.ULS.sendTraceTag(537154635,306,15,`AutoPolicyManager::RegisterAnnotation - Annotations already registered for LabellingSource ${Vb}.`),!0;this.PA.na(Vb).vw=!0;b.ULS.sendTraceTag(537154634,306,50,`AutoPolicyManager::RegisterAnnotation - Annotations registered for LabellingSource ${Vb}.`);
if(!this.$.isEditMode)return b.ULS.sendTraceTag(537154633,306,50,"AutoPolicyManager::RegisterAnnotation - Skipping AugmentationLoop initialization in view mode."),!0;Qa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.tyb():this.qaf();return!0}qaf(){var Vb=!1;for(let Uc of this.PA)if(Vb=Uc.value.vw||Vb)break;Vb?this.augmentationLoopManager?(b.ULS.sendTraceTag(537154631,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop already initialized."),
this.FYb()):this.j_a?b.ULS.sendTraceTag(537154630,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop initialization in-progress."):(this.j_a=!0,Vb=this.$.ya.FlightingSettings.AutoCLPStartUpDelay,b.ULS.sendTraceTag(537154629,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - Initializing AugmentationLoop in ${Vb} milliseconds.`),tb.a.instance.create(()=>{this.z9h()},Vb,dc.a.pue,!0,!0)):b.ULS.sendTraceTag(537154632,306,
50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - no registered annotations.")}tyb(){var Vb=0<this.M$a.length;if(!Vb)for(let Uc of this.PA)if(Vb=Uc.value.vw||Vb)break;Vb?this.augmentationLoopManager?(b.ULS.sendTraceTag(537154627,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop already initialized."),this.FYb(),this.B8f()):this.j_a?b.ULS.sendTraceTag(537154626,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop initialization in-progress."):
(this.j_a=!0,Vb=this.$.ya.FlightingSettings.AutoCLPStartUpDelay,b.ULS.sendTraceTag(537154625,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessary - Initializing AugmentationLoop in ${Vb} milliseconds.`),tb.a.instance.create(()=>{this.A9h()},Vb,dc.a.pue,!0,!0)):b.ULS.sendTraceTag(537154628,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - no registered annotations and operations.")}A9h(){yb.TaskExtensions.Aa(Sa.GetServiceTaskFactory.Sa(this.$.da,328,327,1),Vb=>{this.augmentationLoopManager=
Vb.result;this.j_a=!1;this.augmentationLoopManager?(b.ULS.sendTraceTag(537154595,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.augmentationLoopManager.hZb(this.R9a),this.$.isEditMode?(this.FYb(),this.B8f()):b.ULS.sendTraceTag(537154594,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):b.ULS.sendTraceTag(537154624,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},
this.la,3)}z9h(){yb.TaskExtensions.Aa(Sa.GetServiceTaskFactory.Sa(this.$.da,328,327,1),Vb=>{this.augmentationLoopManager=Vb.result;this.j_a=!1;this.augmentationLoopManager?(b.ULS.sendTraceTag(571479120,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.augmentationLoopManager.hZb(this.R9a),this.$.isEditMode?this.FYb():b.ULS.sendTraceTag(537154592,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):b.ULS.sendTraceTag(537154593,
306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.la,3)}uIe(){for(let Vb of this.PA)Vb.value.vw&&this.Oeh(Vb.key)}Oeh(Vb){this.PA.na(Vb).kMa&&this.uHe(Vb);this.PA.na(Vb).vw=!1;b.ULS.sendTraceTag(537154591,306,50,`AutoPolicyManager::DeregisterAnnotation completed for LabellingSource ${Vb}.`)}FYb(){for(let Vb of this.PA)Vb.value.vw&&!Vb.value.kMa&&this.activateAnnotation(Vb.key)}activateAnnotation(Vb){this.augmentationLoopManager.activateAnnotation(this.PA.na(Vb).annotationType);
this.augmentationLoopManager.qP(this.PA.na(Vb).annotationType,this.PA.na(Vb).vGa);this.PA.na(Vb).kMa=!0;b.ULS.sendTraceTag(537154590,306,50,`AutoPolicyManager::ActivateAnnotation completed for LabellingSource ${Vb}.`)}ddh(){for(let Vb of this.PA)Vb.value.kMa&&this.uHe(Vb.key)}uHe(Vb){this.augmentationLoopManager.NQa(this.PA.na(Vb).annotationType,this.PA.na(Vb).vGa);this.PA.na(Vb).kMa=!1;b.ULS.sendTraceTag(537154589,306,50,`AutoPolicyManager::DeactivateAnnotation completed for LabellingSource ${Vb}.`)}applyPolicyLabel(Vb,
Uc,ud,Vc){if(this.fa.qa("SupportsOfficeClientCoauthoring"))b.ULS.sendTraceTag(537154579,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is enabled."),this.PZa(Vb,Uc,ud,Vc);else{b.ULS.sendTraceTag(537154578,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is disabled.");const yd=Sd=>{this.PZa(Vb,Uc,ud,Vc,0===Sd||1===Sd||4===Sd)};this.vgd(yd,()=>{yd(2)},this.Fqf)}}XXc(Vb,Uc){let ud=null,Vc=null;if(!({sensitivityLabel:ud,xGa:Vc}=this.Rbg(Vb)).returnValue)return b.ULS.sendTraceTag(537154577,
306,15,"AutoApplyOrRecommendPolicyLabel - Failed to set the sensitivity labels."),!1;if(Vc&&Vc.Order>=ud.Order)return b.ULS.sendTraceTag(537154576,306,50,"AutoApplyOrRecommendPolicyLabel - The applied label has a higher sensitivty."),!1;this.applyPolicyLabel(ud.Id,ud.Id,null,Uc);return!0}YXc(Vb,Uc){Uc=!1;let ud=null,Vc=null;if(!({sensitivityLabel:ud,xGa:Vc}=this.Rbg(Vb)).returnValue)return b.ULS.sendTraceTag(537154575,306,15,"AutoApplyOrRecommendPowerBILabel - Failed to set the sensitivity labels."),
{returnValue:!1,F6a:Uc};if(Vc&&Vc.ParentId&&ud.ParentId&&Vc.ParentId===ud.ParentId)return b.ULS.sendTraceTag(537154574,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label has a common parent with AppliedLabel."),{returnValue:!1,F6a:Uc};if(Vc&&Vc.Order>=ud.Order)return b.ULS.sendTraceTag(537154573,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label does not have a higher priority than AppliedLabel."),{returnValue:!1,F6a:Uc};if(this.fa.qa("SupportsOfficeClientCoauthoring"))b.ULS.sendTraceTag(537154572,
306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is enabled."),Vb=this.policyManager.Nn,Vb=!Vb.AppliedPolicyId||!Vb.PolicyLabelAssignmentMethod||V.e(Vb.PolicyLabelAssignmentMethod)===V.e("standard"),this.Nse(ud.Id,Vb);else{b.ULS.sendTraceTag(537154571,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is disabled.");const yd=Sd=>{this.Nse(ud.Id,0===Sd||1===Sd||4===Sd)};this.vgd(yd,()=>{yd(2)},this.Fqf)}return{returnValue:!0,
F6a:Uc}}vgd(Vb,Uc,ud,Vc=0){if(this.fc){var yd=this.$.pa.va.Tb();ac(this.$.pa.va,this.$.ya.DocumentHostInfo.TenantId,Sd=>{this.MUh(Sd,Vb)},()=>{this.LUh(Vb,Uc,ud,Vc)},null,null,yd)}else b.ULS.sendTraceTag(537154570,306,15,`AutoPolicyManager: GetPolicyApplicationMethod failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.fc}.`)}MUh(Vb,Uc){b.ULS.sendTraceTag(537154569,306,50,"AutoPolicyManager: GetPolicyApplicationMethod web service call was successful.");this.fc?!Vb||Kb.a(Vb)?
b.ULS.sendTraceTag(537154567,306,15,Vb?"AutoPolicyManager: GetPolicyApplicationMethod result has non-status message.":"AutoPolicyManager: GetPolicyApplicationMethod result is null"):Uc(Vb.Result):b.ULS.sendTraceTag(537154568,306,50,`AutoPolicyManager: GetPolicyApplicationMethodSuccessCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.fc}.`)}LUh(Vb,Uc,ud,Vc){b.ULS.sendTraceTag(537154566,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Trying again");
this.fc?Vc>=ud?(b.ULS.sendTraceTag(537154564,306,15,"AutoPolicyManager: GetPolicyApplicationMethod max retries exhausted."),Uc()):this.vgd(Vb,Uc,ud,Vc+1):b.ULS.sendTraceTag(537154565,306,50,`AutoPolicyManager: GetPolicyApplicationMethodFailureCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.fc}.`)}Nse(Vb,Uc){Uc?this.PZa(Vb,null,null,3,!0):this.PZa(null,Vb,null,3,!1)}Rbg(Vb){let Uc,ud;ud=Uc=null;if(!this.$.isEditMode)return{returnValue:!1,sensitivityLabel:Uc,xGa:ud};
if(!this.policyManager.Yga())return b.ULS.sendTraceTag(537154529,306,15,"TryGettingSensitivityLabels - Labels are not available."),{returnValue:!1,sensitivityLabel:Uc,xGa:ud};const Vc=this.policyManager.Nn;if(!Vc)return b.ULS.sendTraceTag(537154528,306,15,"TryGettingSensitivityLabels - GetPolicyLabelsData returned an invalid result."),{returnValue:!1,sensitivityLabel:Uc,xGa:ud};if(gc.a.Fh(Vc.SensitivityLabels))return b.ULS.sendTraceTag(537154527,306,15,"TryGettingSensitivityLabels - Attempting to apply labels when there are no sensitivity labels available."),
{returnValue:!1,sensitivityLabel:Uc,xGa:ud};const yd=Vc.AppliedPolicyId;for(const Sd of Vb)for(const Wd of Vc.SensitivityLabels)Wd.Id===Sd&&(!Uc||Uc.Order<Wd.Order)&&(Uc=Wd),Wd.Id===yd&&(ud=Wd);return Uc?{returnValue:!0,sensitivityLabel:Uc,xGa:ud}:(b.ULS.sendTraceTag(537154526,306,10,"TryGettingSensitivityLabels - None of the sensitivity labels matched."),{returnValue:!1,sensitivityLabel:Uc,xGa:ud})}}Object(c.a)(Cc,"AutoPolicyManager",Bb.a,[10]);var fd=a(153),od=a(12),Ub=a(14);class Fc extends fd.ErrorDialog{constructor(Vb){super(Vb,
Fc.xQ(Vb))}Po(){super.Po();if(this.error.Appearance&1&&this.$.Cd&2){const Vb=this.getButton(0);od.DOMElementExtensions.JPd(Vb.get_element(),Ub.a.instance.ga(1318));this.rP(()=>{0===this.returnValue&&this.$.Cd&2&&(b.ULS.sendTraceTag(50373725,306,50,"BlockSenitivityLabelActionDialog : Opening the book in excel desktop."),yb.TaskExtensions.Aa(Sa.GetServiceTaskFactory.Sa(this.$.da,55,56,0),Uc=>{Uc.result.Y2c()},this.$.la,3))})}}static xQ(Vb){return Vb.Cd&2?Jb.a.Yc(3,1,0,1973,0,-1237306487,"SensitivityLabelBlockApplyLabelOpenInDesktop"):
Jb.a.Yc(1,1,0,1974,0,-313914360,"SensitivityLabelBlockApplyLabel")}}Object(c.a)(Fc,"BlockSenitivityLabelActionDialog",fd.ErrorDialog,[]);class $b extends Bb.a{constructor(Vb,Uc,ud,Vc,yd){super();this.statusBarManager=null;this.WYc=!1;this.d$=null;this.MCc=!1;this.kya=this.ZOd=null;this.Do=this.KEd=!1;this.fEa=this.Qde=this.Hfa=this.$ee=this.Pp=null;this.$Le=()=>{b.ULS.sendTraceTag(537154520,306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Triggered EnableAutoLabellingInDocument");const Sd=
this.mPf(1);b.ULS.sendTraceTag(537154519,306,50,`PolicyManagerWrapper::EnableAutoLabellingInDocument - Annotation registration result: ${Sd}.`)};this.ATd=(Sd,Wd)=>{Wd?(this.Pp=Wd.title,this.$ee=Wd.uqc,this.Hfa=Wd.buttonText,this.Qde=Wd.awf,this.FE.Zf(27,null),b.ULS.sendTraceTag(537154509,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")):b.ULS.sendTraceTag(537154510,306,15,"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.")};this.B5f=(Sd,Wd)=>{const Hd=Object(Ma.a)(va,
Wd);Hd?Hd.a5f?this.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)?(b.ULS.sendTraceTag(537154508,306,15,`ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of ${Hd.errorType}`),this.FE.DBj(Hd.title,Hd.message,Hd.buttonText,le=>{Hd.I2&&(this.FE.OE(54)&&this.FE.removeEntry(54),Hd.I2(le))})):1===Hd.errorType?(b.ULS.sendTraceTag(537154507,306,15,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of File too large"),
this.FE.Zf(49,null)):2===Hd.errorType?this.FE.Zf(50,null):3===Hd.errorType?this.FE.Zf(51,null):4===Hd.errorType?this.FE.Zf(52,null):5===Hd.errorType?this.FE.EBj(Hd.title,Hd.message,Hd.buttonText,le=>{this.FE.OE(53)&&this.FE.removeEntry(53);Hd.I2(le)}):this.FE.Zf(48,null):b.ULS.sendTraceTag(537154506,306,50,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure ShowMessage is false"):(b.ULS.sendTraceTag(537154505,306,10,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure args is null"),
this.FE.Zf(48,null))};this.YZd=(Sd,Wd)=>{this.C6&&(b.ULS.sendTraceTag(537154504,306,50,"PolicyManagerWrapper: UpdateLabelInfo called"),this.C6.V0f(),this.C6.o0f(),this.C6.ELf(),this.$.Cd&64&&(Wd.onSuccess&&this.kya?this.XLg():this.C6.dbg()));this.fa.qa("SupportsOfficeClientCoauthoring")&&(Sd=this.zs.Nn,this.fEa=Sd.AppliedPolicyId,"null"===this.labelId&&(this.fEa=""),this.MCc&&(Sd=Sd.PolicyLabelAssignmentMethod&&V.e(Sd.PolicyLabelAssignmentMethod)===V.e("standard")?4:2,this.applyPolicyLabel(this.labelId,
Sd,!0,this.ZOd)));this.qSe();this.Jz()};this.ozf=()=>{this.KEd=!0;this.qSe()};this.hEf=(Sd,Wd)=>{b.ULS.sendTraceTag(42322116,306,50,`PolicyManagerWrapper.OnSetLabelSucceeded: Applying outcomes for change in policy label. ProtectedFile = ${u.AFrameworkApplication.protectedFile}, ApplyLabelFlag = ${Wd.wP}`);this.applyPolicyLabel(Wd.tqc,Wd.wP,!1,null)};this.oGi=(Sd,Wd)=>{this.fEa=Wd.tqc;if(Jb.a.Dq(Sd.Errors)){var Hd=Jb.a.T3(Sd.Errors,[2045508683]);0<Hd.length&&(Sd.Errors=Jb.a.bG(Sd.Errors,[2045508683],
"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.ea.Gp(Sd.Errors));Hd=Jb.a.T3(Sd.Errors,[2046680228]);0<Hd.length&&(4===Wd.wP||1===Wd.wP)&&(Sd.Errors=Jb.a.bG(Sd.Errors,[2046680228],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.ea.Gp(Sd.Errors));Hd=Sd=null;for(var le of this.zs.Nn.SensitivityLabels)ha.a.equals(this.labelId,le.Id,!1)&&(Sd=le),ha.a.equals(Wd.rZf,le.Id,!1)&&(Hd=le);le={};le.ApplyLabelFlag=Wd.wP;Sd?(le.currentLabel="Set",le.currentLabelEnabled=
Sd.Enabled,le.currentLabelName=Sd.Name?"Set":"NotSet",le.currentLabelParentId=Sd.ParentId?"Set":"NotSet"):le.currentLabel="NotSet";Hd?(le.serverLabel="Set",le.serverLabelEnabled=Hd.Enabled,le.serverLabelName=Hd.Name?"Set":"NotSet",le.serverLabelParentId=Hd.ParentId?"Set":"NotSet"):le.serverLabel="NotSet";b.ULS.sendTraceTag(541638850,306,15,`PolicyManagerWrapper.OnApplyManualPolicyLabelSuccessCallback Failed. DiagnosticInfo : ${JSON.stringify(le)}`)}};this.RPg=(Sd,Wd)=>{if(!this.$.workbookContext.HasRoundTrippedHFPart)return!1;
const Hd=this.zs.Nn;if(!Hd)return b.ULS.sendTraceTag(537154502,306,15,"PolicyManagerWrapper.BlockSetSensitivityCall: policyLabelsData is null."),!1;let le=null;for(const Le of Hd.SensitivityLabels)ha.a.equals(Le.Id,Sd,!1)&&(le=Le);return le&&this.Z5h(le)?(b.ULS.sendTraceTag(50341186,306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: selectedSensitivityLabel has watermark label action."),this.pzj(Wd),!0):!1};this.pei=()=>{let Sd=!1;!this.$.ya.IsNewWorkbook||this.labelId&&this.labelId.length||(Sd=
!0);b.ULS.sendTraceTag(537154501,306,50,`PolicyManagerWrapper.IsANewFile: is this a new file : ${Sd}`);return Sd};this.uqf=(Sd,Wd)=>{1===Wd.vre?this.$.isEditMode?(b.ULS.sendTraceTag(537154500,306,50,"MandatoryLabellingHandler : Swtiching to view-mode."),this.$.Ka.Lb(new Ob.a(-723527778,0,this.$.Kc,10,null))):b.ULS.sendTraceTag(537154499,306,50,"MandatoryLabellingHandler : App is already in view-mode."):(this.kya=Wd.kya,this.$.ea.aY(this.Ise),this.$.yfb(),b.ULS.sendTraceTag(537154498,306,50,"MandatoryLabellingHandler : Swtiching to edit-mode."),
this.$.Ka.Lb(new Ob.a(-8805455,0,this.$.Kc,10,null)))};this.Xme=(Sd,Wd)=>{Wd?(Sd=!!(this.$.Cd&64),b.ULS.sendTraceTag(537154496,306,50,`AddMandatoryLabellingBusinessBar User has edit permission : ${Sd}`),Sd&&(this.$.yfb(),this.FE.LAj(Wd.title,Wd.message,Wd.buttonText,Hd=>{Wd.I2(Hd)}))):b.ULS.sendTraceTag(537154497,306,15,"AddMandatoryLabellingBusinessBar is called but MandatoryLabellingAppHandlerEventArgs is null.")};this.GQf=()=>{this.FE.OE(42)&&this.FE.removeEntry(42)};this.rcg=(Sd,Wd)=>{Wd.txj&&
(b.ULS.sendTraceTag(527716803,306,50,"PolicyManagerWrapper.udpLabelingAppHandler: Open the document in the client when the applied label is a UDP label."),yb.TaskExtensions.Aa(Sa.GetServiceTaskFactory.Sa(this.$.da,55,56,0),Hd=>{Hd.result.Y2c()},this.$.la,3))};this.Ise=()=>{this.kya&&this.$.isEditMode?(this.$.ea.b0(this.Ise),this.Fvb()):b.ULS.sendTraceTag(537154467,306,15,`ApplyMandatoryLabelOnEditMode : mandatoryPolicyId empty ${!this.kya} , edit mode : ${this.$.isEditMode}.`)};this.Xja=()=>{const Sd=
this.$.ea.Eo;Sd&&!ha.a.equals(Sd.AppliedPolicyLabelId,this.labelId,!1)&&(b.ULS.sendTraceTag(537154464,306,50,"PolicyManagerWrapper.HandleWorkbookMetadataChanged: Calling GetPolicyLabels to update statusbar and ribbon control."),b.ULS.shipAssertTag(537154463,306,this.$.isEditMode,"PolicyManagerWrapper.HandleWorkbookMetadataChanged policyId cannot change in read-only mode, this can happen if right policy id is not read from server."),this.fa.qa("SupportsOfficeClientCoauthoring")&&this.$.isEditMode&&
(this.MCc=!0,this.ZOd=Sd.AppliedPolicyLabelId),this.fEa=Sd.AppliedPolicyLabelId,this.Fvb())};this.Eod=()=>{let Sd=!0;if(!this.$.ea.amIAlone)for(const Wd of this.$.ea.Rm)if(!Wd.SupportsClientIsMipTrusted){Sd=!1;break}b.ULS.sendTraceTag(537154462,306,50,`PolicyManagerWrapper.IsEveryCoauthorInSessionClientMipTrusted : ${Sd}`);return Sd};this.wAf=()=>{b.ULS.sendTraceTag(537154461,306,50,"PolicyManagerWrapper.OnLabelUpdate: RTC notification received");this.MCc=!0;this.Fvb()};this.$=Vc;this.zs=Vb;this.FE=
ud;this.fa=yd;this.zs.hpe(this.ATd);this.C6=Uc}initialize(){this.fa.qa("SupportsPolicies")?(this.fEa=this.fa.Xa("AppliedPolicyId"),this.C6.Ig(),this.$.da.Za(29,Vb=>{this.statusBarManager=Vb;Vb.uJ(this)}),this.Jz(),ha.a.Fh(this.fa.Xa("HostUserId"))||this.SYi(),this.C6.T7i(this.RPg),this.C6.J8i(this.pei),this.zs.P7i(this.Eod),this.Do=Qa.EwaSettings.getBooleanFeatureGate(Nb.a.fQa,!1)):Qa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&H.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",
!0));!ha.a.Fh(this.fa.Xa("HostUserId"))&&Qa.EwaSettings.ma(169)&&this.$.ea.Wg.get(45)&&(b.ULS.sendTraceTag(537154524,306,50,"DataLossPrevention feature is Enabled and launched on Excel."),this.PNh())}Cq(Vb){this.addHandler("LabelInfoChangedKey",Vb)}Yq(Vb){this.removeHandler("LabelInfoChangedKey",Vb)}vn(){return!0}ds(Vb,Uc){if("QueryPolicyLabel"!==Vb)return!1;if(this.Ona())return Uc.Visible=!1,!0;Uc.Visible=!0;return 32===u.AFrameworkApplication.vb.de(K.a.Xab,2,Uc)}dispose(){this.statusBarManager&&
(this.statusBarManager.aG(this),this.statusBarManager=null);this.C6.XOb();this.WYc=!1;this.zs.gdj(this.B5f);this.zs.hdj(this.hEf);this.$.ea.Sw(this.Xja);if(this.fa.qa("SupportsOfficeClientCoauthoring")){const Vb=this.$.da.za(292);Vb&&Vb.Ybj(this.wAf)}this.zs.Baj(this.Xme);this.zs.Rcj(this.GQf);this.zs.fcj(this.uqf);this.zs.tdj(this.rcg);Qa.EwaSettings.ma(291)&&this.zs.Cbj(this.$Le);this.d$&&(this.d$.dispose(),this.d$=null);super.dispose()}get title(){return this.Pp}get uqc(){return this.$ee}get linkText(){return this.Hfa}get kOi(){return this.Qde}get labelId(){return this.fEa}XXc(Vb,
Uc){if(!this.fa.qa("SupportsPolicies"))return b.ULS.sendTraceTag(537154523,306,15,"AutoApplyOrRecommendPolicyLabel - Called when SupportPolicies is disabled."),!1;if(!this.KEd)return b.ULS.sendTraceTag(537154522,306,15,"AutoApplyOrRecommendPolicyLabel - PolicyData hasn't been received yet."),!1;if(gc.a.Fh(Vb))return!1;this.d$||this.Qld();return this.d$.XXc(Vb,Uc)}Jz(){this.raiseEvent("LabelInfoChangedKey")}PNh(){vb.a.get_instance().yk(10,()=>{this.zs.yed()})}SYi(){vb.a.get_instance().yk(10,()=>{this.zs.RZb(this.YZd);
this.zs.wGg(this.ozf);this.zs.vGg(this.ozf);this.zs.XVc(this.B5f);this.zs.vpe(this.hEf);this.$.ea.Vu(this.Xja);this.zs.Xne(this.Xme);this.zs.lpe(this.GQf);this.zs.eHg(this.uqf);this.zs.JIg(this.rcg);if(this.fa.qa("SupportsOfficeClientCoauthoring")){const Vb=this.$.da.za(292);Vb&&Vb.WGg(this.wAf)}Qa.EwaSettings.ma(291)&&(b.ULS.sendTraceTag(537154521,306,50,"PolicyManagerWrapper: ApplyAutomaticPolicyLabel enabled and registered GetAutoPolicyLabelHandler"),this.zs.tGg(this.$Le));this.Gzh()});this.$.ldb("sensitivity",
!0)}Gzh(){this.fa.qa("SupportsOfficeClientCoauthoring")||this.labelId&&this.labelId.length?this.Fvb():this.VIh(this.$.ya.DocumentHostInfo.TenantId)}Qld(){this.d$=new Cc(this.C6,this.zs,this.$,this.fa,this.FE)}mPf(Vb){if(!this.fa.qa("SupportsPolicies"))return b.ULS.sendTraceTag(537154518,306,10,"PolicyManagerWrapper::RegisterAugmentationLoopAnnotations called when CLP is disabled."),!1;this.d$||this.Qld();return this.d$.M7i(Vb)}YXc(Vb,Uc){if(!this.fa.qa("SupportsPolicies"))return b.ULS.sendTraceTag(537154517,
306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when CLP is disabled."),{returnValue:!1,F6a:!1};if(!this.KEd)return b.ULS.sendTraceTag(537154516,306,15,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called before PolicyData fetch is complete."),{returnValue:!1,F6a:!0};this.d$||this.Qld();return this.d$.YXc(Vb,Uc)}VIh(Vb){b.ULS.sendTraceTag(537154514,306,50,`PolicyManagerWrapper: Doing GetPolicyLabelId web service call with tenantId length ${Vb.length}`);const Uc=this.$.pa.va.Tb();
ec(this.$.pa.va,Vb,ud=>{this.HGj(ud)},null,null,null,Uc)}HGj(Vb){b.ULS.sendTraceTag(537154513,306,50,"PolicyManagerWrapper: GetPolicyLabelId web service call was successful");Vb&&!Kb.a(Vb)&&(this.fEa=Vb.Result);this.Fvb();this.labelId?b.ULS.sendTraceTag(537154512,306,50,`PolicyManagerWrapper: Fetched LabelId length from custom.xml is ${this.labelId.length}`):b.ULS.sendTraceTag(537154511,306,50,"PolicyManagerWrapper: LabelId is invalid")}Fvb(){this.zs.xed(this.labelId,void 0,void 0,!1)}qSe(){if(!this.WYc){this.$.$e();
this.WYc=!0;this.FE.b7e();const Vb={};Vb.hasLabel=!!this.labelId&&0<this.labelId.length;Vb.isProtectedFile=this.fa.qa("ProtectedFile");Vb.SupportsPolicies=this.fa.qa("SupportsPolicies");Vb.AreLabelsAvailableForDisplay=this.zs.Yga();Vb.SupportsOfficeClientCoauthoring=this.fa.qa("SupportsOfficeClientCoauthoring");Vb.IsAnonymousUser=this.fa.qa("IsAnonymousUser");b.ULS.sendTraceTag(51238051,306,50,`CLPUsage : ${JSON.stringify(Vb)}`)}}XLg(){this.C6.YLg(this.kya);this.kya=null}Z5h(Vb){for(const Uc of Vb.LabelActions)if(ha.a.equals(Uc.Name,
"ApplyWatermark",!1))return!0;return!1}pzj(Vb){Vb?(new Fc(this.$)).ig():b.ULS.sendTraceTag(537154465,306,50,"PolicyManagerWrapper.showBlockApplyLabelDialogDialog: Watermark Dialog box called with showDialog set to false from autoapply.")}applyPolicyLabel(Vb,Uc,ud,Vc){const yd=Ha.c(this.zs.Nn);if(void 0===Vb||null===Vb)Vb="";const Sd=new pb;Sd.tqc=Vb;Sd.rZf=Vc;Sd.wP=Uc;const Wd=this.$.pa.va;Ia.a(this.$.userOperationManager,(Hd,le,Le)=>lb(Wd,yd,Vb,this.$.ya.DocumentHostInfo.TenantId,Uc,ud,qa.b.call(null,
this.oGi,Hd),null,Le,Sd),Hd=>new jb.a(222,0,Hd),null);this.MCc=!1;this.ZOd=null}Ona(){const Vb=this.$.da.za(478);return this.Do&&Vb?Vb.Do():!1}}Object(c.a)($b,"PolicyManagerWrapper",Bb.a,[160,161,545]);class zc extends Wa.a{constructor(Vb){super();this.$=Vb;this.Eb()}create(){const Vb=Sa.GetServiceTaskFactory.Sa(this.$.da,5,4,this.fb),Uc=u.AFrameworkApplication.yd,ud=u.AFrameworkApplication.fa;yb.TaskExtensions.Aa(Vb,()=>{try{const Vc=new Oa.a(()=>new hb(ud,Uc,u.AFrameworkApplication.ta.ZD,this.$.ya.MaxGetPolicyRetries,
da.a.instance.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"))),yd=new Oa.a(()=>new P(u.AFrameworkApplication.vb,u.AFrameworkApplication.ta,u.AFrameworkApplication.fa,Vc));let Sd=this.$.da.za(274);Sd||(Sd=new $b(Vc.value,yd.value,Vb.result,this.$,u.AFrameworkApplication.fa),Qa.EwaSettings.isChangeGateEnabled("OfficeVSO:6143820_MoveServiceRegistrationFromFAM_V2")&&this.$.da.Ga(274,Sd),Sd.initialize());this.pb(Sd)}catch(Vc){throw b.ULS.sendTraceTag(537154525,306,10,`PolicyManager was not created successfully [Exception: ${Vc.toString()}]`),
Vc;}},this.la,3)}static ka(Vb){Vb.da.Ga(275,new zc(Vb))}}Object(c.a)(zc,"PolicyManagerFactory",Wa.a,[]);var Wc=a(694),yc=a(183);class pd{constructor(Vb){this.$=Vb}Lc(){return!1}executeCommand(Vb,Uc,ud){switch(Uc.command){case K.a.setSensitivity:return this.$.workbookContext.FileCoauthorable||(ud[A.RWc]=this.$.workbookContext.ExclusiveLockId),Vb=u.AFrameworkApplication.vb.de(K.a.setSensitivity,2,ud),na.Task.Ta(32===Vb);case K.a.I6:return Vb=u.AFrameworkApplication.vb.de(K.a.I6,2,ud),na.Task.Ta(32===
Vb);case K.a.J6:return Vb=u.AFrameworkApplication.vb.de(K.a.J6,2,ud),na.Task.Ta(32===Vb);default:return yc.a(Uc.command)}}Ac(Vb,Uc){switch(Uc.command){case K.a.setSensitivity:case K.a.I6:case K.a.J6:return!0;default:return!1}}Oc(Vb,Uc,ud){switch(Uc){case "PopulateSensitivityFlyout":return 32===u.AFrameworkApplication.vb.de(K.a.vza,2,ud);default:return!1}}}Object(c.a)(pd,"SensitivityCommandHandler",null,[164]);class xd extends Wc.a{constructor(Vb){super(Vb)}vd(){this.$c([new pd(this.$)])}static ka(Vb){Wc.a.Od(316,
new xd(Vb))}}Object(c.a)(xd,"SensitivityCommandHandlerFactory",Wc.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.Policy.Contracts");Type.registerNamespace("Common.App.Policy");db.main();(()=>{oa.a.Fa(Vb=>{zc.ka(Vb);xd.ka(Vb)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.policy.js.map/8e9ea938db8884b1fd26890241165b87/EwaDSEsNext.policy.js.map